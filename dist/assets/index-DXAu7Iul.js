function t1(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function n1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ex={exports:{}},_d={},tx={exports:{}},be={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ru=Symbol.for("react.element"),r1=Symbol.for("react.portal"),s1=Symbol.for("react.fragment"),i1=Symbol.for("react.strict_mode"),o1=Symbol.for("react.profiler"),a1=Symbol.for("react.provider"),l1=Symbol.for("react.context"),u1=Symbol.for("react.forward_ref"),c1=Symbol.for("react.suspense"),h1=Symbol.for("react.memo"),d1=Symbol.for("react.lazy"),kv=Symbol.iterator;function f1(n){return n===null||typeof n!="object"?null:(n=kv&&n[kv]||n["@@iterator"],typeof n=="function"?n:null)}var nx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rx=Object.assign,sx={};function ka(n,e,t){this.props=n,this.context=e,this.refs=sx,this.updater=t||nx}ka.prototype.isReactComponent={};ka.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ka.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function ix(){}ix.prototype=ka.prototype;function Op(n,e,t){this.props=n,this.context=e,this.refs=sx,this.updater=t||nx}var Mp=Op.prototype=new ix;Mp.constructor=Op;rx(Mp,ka.prototype);Mp.isPureReactComponent=!0;var Pv=Array.isArray,ox=Object.prototype.hasOwnProperty,Fp={current:null},ax={key:!0,ref:!0,__self:!0,__source:!0};function lx(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)ox.call(e,r)&&!ax.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Ru,type:n,key:i,ref:o,props:s,_owner:Fp.current}}function m1(n,e){return{$$typeof:Ru,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Up(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ru}function g1(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Dv=/\/+/g;function wf(n,e){return typeof n=="object"&&n!==null&&n.key!=null?g1(""+n.key):e.toString(36)}function Bc(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ru:case r1:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+wf(o,0):r,Pv(s)?(t="",n!=null&&(t=n.replace(Dv,"$&/")+"/"),Bc(s,e,t,"",function(u){return u})):s!=null&&(Up(s)&&(s=m1(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Dv,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Pv(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+wf(i,a);o+=Bc(i,e,t,l,s)}else if(l=f1(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+wf(i,a++),o+=Bc(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Zu(n,e,t){if(n==null)return n;var r=[],s=0;return Bc(n,r,"","",function(i){return e.call(t,i,s++)}),r}function p1(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var dn={current:null},$c={transition:null},y1={ReactCurrentDispatcher:dn,ReactCurrentBatchConfig:$c,ReactCurrentOwner:Fp};function ux(){throw Error("act(...) is not supported in production builds of React.")}be.Children={map:Zu,forEach:function(n,e,t){Zu(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Zu(n,function(){e++}),e},toArray:function(n){return Zu(n,function(e){return e})||[]},only:function(n){if(!Up(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};be.Component=ka;be.Fragment=s1;be.Profiler=o1;be.PureComponent=Op;be.StrictMode=i1;be.Suspense=c1;be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y1;be.act=ux;be.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=rx({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Fp.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)ox.call(e,l)&&!ax.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ru,type:n.type,key:s,ref:i,props:r,_owner:o}};be.createContext=function(n){return n={$$typeof:l1,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:a1,_context:n},n.Consumer=n};be.createElement=lx;be.createFactory=function(n){var e=lx.bind(null,n);return e.type=n,e};be.createRef=function(){return{current:null}};be.forwardRef=function(n){return{$$typeof:u1,render:n}};be.isValidElement=Up;be.lazy=function(n){return{$$typeof:d1,_payload:{_status:-1,_result:n},_init:p1}};be.memo=function(n,e){return{$$typeof:h1,type:n,compare:e===void 0?null:e}};be.startTransition=function(n){var e=$c.transition;$c.transition={};try{n()}finally{$c.transition=e}};be.unstable_act=ux;be.useCallback=function(n,e){return dn.current.useCallback(n,e)};be.useContext=function(n){return dn.current.useContext(n)};be.useDebugValue=function(){};be.useDeferredValue=function(n){return dn.current.useDeferredValue(n)};be.useEffect=function(n,e){return dn.current.useEffect(n,e)};be.useId=function(){return dn.current.useId()};be.useImperativeHandle=function(n,e,t){return dn.current.useImperativeHandle(n,e,t)};be.useInsertionEffect=function(n,e){return dn.current.useInsertionEffect(n,e)};be.useLayoutEffect=function(n,e){return dn.current.useLayoutEffect(n,e)};be.useMemo=function(n,e){return dn.current.useMemo(n,e)};be.useReducer=function(n,e,t){return dn.current.useReducer(n,e,t)};be.useRef=function(n){return dn.current.useRef(n)};be.useState=function(n){return dn.current.useState(n)};be.useSyncExternalStore=function(n,e,t){return dn.current.useSyncExternalStore(n,e,t)};be.useTransition=function(){return dn.current.useTransition()};be.version="18.3.1";tx.exports=be;var $=tx.exports;const cx=n1($),v1=t1({__proto__:null,default:cx},[$]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E1=$,T1=Symbol.for("react.element"),S1=Symbol.for("react.fragment"),_1=Object.prototype.hasOwnProperty,x1=E1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,I1={key:!0,ref:!0,__self:!0,__source:!0};function hx(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)_1.call(e,r)&&!I1.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:T1,type:n,key:i,ref:o,props:s,_owner:x1.current}}_d.Fragment=S1;_d.jsx=hx;_d.jsxs=hx;ex.exports=_d;var w=ex.exports,$m={},dx={exports:{}},Bn={},fx={exports:{}},mx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(U,H){var N=U.length;U.push(H);e:for(;0<N;){var B=N-1>>>1,O=U[B];if(0<s(O,H))U[B]=H,U[N]=O,N=B;else break e}}function t(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var H=U[0],N=U.pop();if(N!==H){U[0]=N;e:for(var B=0,O=U.length,K=O>>>1;B<K;){var Q=2*(B+1)-1,Y=U[Q],ee=Q+1,de=U[ee];if(0>s(Y,N))ee<O&&0>s(de,Y)?(U[B]=de,U[ee]=N,B=ee):(U[B]=Y,U[Q]=N,B=Q);else if(ee<O&&0>s(de,N))U[B]=de,U[ee]=N,B=ee;else break e}}return H}function s(U,H){var N=U.sortIndex-H.sortIndex;return N!==0?N:U.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,h=null,d=3,m=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(U){for(var H=t(u);H!==null;){if(H.callback===null)r(u);else if(H.startTime<=U)r(u),H.sortIndex=H.expirationTime,e(l,H);else break;H=t(u)}}function L(U){if(y=!1,S(U),!g)if(t(l)!==null)g=!0,J(D);else{var H=t(u);H!==null&&W(L,H.startTime-U)}}function D(U,H){g=!1,y&&(y=!1,E(x),x=-1),m=!0;var N=d;try{for(S(H),h=t(l);h!==null&&(!(h.expirationTime>H)||U&&!C());){var B=h.callback;if(typeof B=="function"){h.callback=null,d=h.priorityLevel;var O=B(h.expirationTime<=H);H=n.unstable_now(),typeof O=="function"?h.callback=O:h===t(l)&&r(l),S(H)}else r(l);h=t(l)}if(h!==null)var K=!0;else{var Q=t(u);Q!==null&&W(L,Q.startTime-H),K=!1}return K}finally{h=null,d=N,m=!1}}var F=!1,A=null,x=-1,R=5,b=-1;function C(){return!(n.unstable_now()-b<R)}function M(){if(A!==null){var U=n.unstable_now();b=U;var H=!0;try{H=A(!0,U)}finally{H?k():(F=!1,A=null)}}else F=!1}var k;if(typeof p=="function")k=function(){p(M)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,te=re.port2;re.port1.onmessage=M,k=function(){te.postMessage(null)}}else k=function(){v(M,0)};function J(U){A=U,F||(F=!0,k())}function W(U,H){x=v(function(){U(n.unstable_now())},H)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(U){U.callback=null},n.unstable_continueExecution=function(){g||m||(g=!0,J(D))},n.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(U){switch(d){case 1:case 2:case 3:var H=3;break;default:H=d}var N=d;d=H;try{return U()}finally{d=N}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(U,H){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var N=d;d=U;try{return H()}finally{d=N}},n.unstable_scheduleCallback=function(U,H,N){var B=n.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?B+N:B):N=B,U){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=N+O,U={id:c++,callback:H,priorityLevel:U,startTime:N,expirationTime:O,sortIndex:-1},N>B?(U.sortIndex=N,e(u,U),t(l)===null&&U===t(u)&&(y?(E(x),x=-1):y=!0,W(L,N-B))):(U.sortIndex=O,e(l,U),g||m||(g=!0,J(D))),U},n.unstable_shouldYield=C,n.unstable_wrapCallback=function(U){var H=d;return function(){var N=d;d=H;try{return U.apply(this,arguments)}finally{d=N}}}})(mx);fx.exports=mx;var A1=fx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w1=$,Un=A1;function ne(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gx=new Set,Hl={};function yo(n,e){ga(n,e),ga(n+"Capture",e)}function ga(n,e){for(Hl[n]=e,n=0;n<e.length;n++)gx.add(e[n])}var ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vm=Object.prototype.hasOwnProperty,R1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nv={},Ov={};function b1(n){return Vm.call(Ov,n)?!0:Vm.call(Nv,n)?!1:R1.test(n)?Ov[n]=!0:(Nv[n]=!0,!1)}function L1(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function C1(n,e,t,r){if(e===null||typeof e>"u"||L1(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function fn(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){qt[n]=new fn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];qt[e]=new fn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){qt[n]=new fn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){qt[n]=new fn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){qt[n]=new fn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){qt[n]=new fn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){qt[n]=new fn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){qt[n]=new fn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){qt[n]=new fn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Bp=/[\-:]([a-z])/g;function $p(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Bp,$p);qt[e]=new fn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Bp,$p);qt[e]=new fn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Bp,$p);qt[e]=new fn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){qt[n]=new fn(n,1,!1,n.toLowerCase(),null,!1,!1)});qt.xlinkHref=new fn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){qt[n]=new fn(n,1,!1,n.toLowerCase(),null,!0,!0)});function Vp(n,e,t,r){var s=qt.hasOwnProperty(e)?qt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(C1(e,t,s,r)&&(t=null),r||s===null?b1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var _s=w1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ec=Symbol.for("react.element"),Bo=Symbol.for("react.portal"),$o=Symbol.for("react.fragment"),jp=Symbol.for("react.strict_mode"),jm=Symbol.for("react.profiler"),px=Symbol.for("react.provider"),yx=Symbol.for("react.context"),Gp=Symbol.for("react.forward_ref"),Gm=Symbol.for("react.suspense"),Km=Symbol.for("react.suspense_list"),Kp=Symbol.for("react.memo"),$s=Symbol.for("react.lazy"),vx=Symbol.for("react.offscreen"),Mv=Symbol.iterator;function rl(n){return n===null||typeof n!="object"?null:(n=Mv&&n[Mv]||n["@@iterator"],typeof n=="function"?n:null)}var ct=Object.assign,Rf;function fl(n){if(Rf===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Rf=e&&e[1]||""}return`
`+Rf+n}var bf=!1;function Lf(n,e){if(!n||bf)return"";bf=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{bf=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?fl(n):""}function k1(n){switch(n.tag){case 5:return fl(n.type);case 16:return fl("Lazy");case 13:return fl("Suspense");case 19:return fl("SuspenseList");case 0:case 2:case 15:return n=Lf(n.type,!1),n;case 11:return n=Lf(n.type.render,!1),n;case 1:return n=Lf(n.type,!0),n;default:return""}}function Hm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case $o:return"Fragment";case Bo:return"Portal";case jm:return"Profiler";case jp:return"StrictMode";case Gm:return"Suspense";case Km:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case yx:return(n.displayName||"Context")+".Consumer";case px:return(n._context.displayName||"Context")+".Provider";case Gp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Kp:return e=n.displayName||null,e!==null?e:Hm(n.type)||"Memo";case $s:e=n._payload,n=n._init;try{return Hm(n(e))}catch{}}return null}function P1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hm(e);case 8:return e===jp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function pi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ex(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function D1(n){var e=Ex(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function tc(n){n._valueTracker||(n._valueTracker=D1(n))}function Tx(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Ex(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function gh(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function zm(n,e){var t=e.checked;return ct({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Fv(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=pi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Sx(n,e){e=e.checked,e!=null&&Vp(n,"checked",e,!1)}function Wm(n,e){Sx(n,e);var t=pi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?qm(n,e.type,t):e.hasOwnProperty("defaultValue")&&qm(n,e.type,pi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Uv(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function qm(n,e,t){(e!=="number"||gh(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ml=Array.isArray;function Jo(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+pi(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Ym(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return ct({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Bv(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ne(92));if(ml(t)){if(1<t.length)throw Error(ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:pi(t)}}function _x(n,e){var t=pi(e.value),r=pi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function $v(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function xx(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?xx(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var nc,Ix=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(nc=nc||document.createElement("div"),nc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=nc.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function zl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var wl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},N1=["Webkit","ms","Moz","O"];Object.keys(wl).forEach(function(n){N1.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),wl[e]=wl[n]})});function Ax(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||wl.hasOwnProperty(n)&&wl[n]?(""+e).trim():e+"px"}function wx(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Ax(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var O1=ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xm(n,e){if(e){if(O1[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function Jm(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zm=null;function Hp(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var eg=null,Zo=null,ea=null;function Vv(n){if(n=Cu(n)){if(typeof eg!="function")throw Error(ne(280));var e=n.stateNode;e&&(e=Rd(e),eg(n.stateNode,n.type,e))}}function Rx(n){Zo?ea?ea.push(n):ea=[n]:Zo=n}function bx(){if(Zo){var n=Zo,e=ea;if(ea=Zo=null,Vv(n),e)for(n=0;n<e.length;n++)Vv(e[n])}}function Lx(n,e){return n(e)}function Cx(){}var Cf=!1;function kx(n,e,t){if(Cf)return n(e,t);Cf=!0;try{return Lx(n,e,t)}finally{Cf=!1,(Zo!==null||ea!==null)&&(Cx(),bx())}}function Wl(n,e){var t=n.stateNode;if(t===null)return null;var r=Rd(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ne(231,e,typeof t));return t}var tg=!1;if(ms)try{var sl={};Object.defineProperty(sl,"passive",{get:function(){tg=!0}}),window.addEventListener("test",sl,sl),window.removeEventListener("test",sl,sl)}catch{tg=!1}function M1(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Rl=!1,ph=null,yh=!1,ng=null,F1={onError:function(n){Rl=!0,ph=n}};function U1(n,e,t,r,s,i,o,a,l){Rl=!1,ph=null,M1.apply(F1,arguments)}function B1(n,e,t,r,s,i,o,a,l){if(U1.apply(this,arguments),Rl){if(Rl){var u=ph;Rl=!1,ph=null}else throw Error(ne(198));yh||(yh=!0,ng=u)}}function vo(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Px(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function jv(n){if(vo(n)!==n)throw Error(ne(188))}function $1(n){var e=n.alternate;if(!e){if(e=vo(n),e===null)throw Error(ne(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return jv(s),n;if(i===r)return jv(s),e;i=i.sibling}throw Error(ne(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(ne(189))}}if(t.alternate!==r)throw Error(ne(190))}if(t.tag!==3)throw Error(ne(188));return t.stateNode.current===t?n:e}function Dx(n){return n=$1(n),n!==null?Nx(n):null}function Nx(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Nx(n);if(e!==null)return e;n=n.sibling}return null}var Ox=Un.unstable_scheduleCallback,Gv=Un.unstable_cancelCallback,V1=Un.unstable_shouldYield,j1=Un.unstable_requestPaint,vt=Un.unstable_now,G1=Un.unstable_getCurrentPriorityLevel,zp=Un.unstable_ImmediatePriority,Mx=Un.unstable_UserBlockingPriority,vh=Un.unstable_NormalPriority,K1=Un.unstable_LowPriority,Fx=Un.unstable_IdlePriority,xd=null,Fr=null;function H1(n){if(Fr&&typeof Fr.onCommitFiberRoot=="function")try{Fr.onCommitFiberRoot(xd,n,void 0,(n.current.flags&128)===128)}catch{}}var hr=Math.clz32?Math.clz32:q1,z1=Math.log,W1=Math.LN2;function q1(n){return n>>>=0,n===0?32:31-(z1(n)/W1|0)|0}var rc=64,sc=4194304;function gl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Eh(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=gl(a):(i&=o,i!==0&&(r=gl(i)))}else o=t&~s,o!==0?r=gl(o):i!==0&&(r=gl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-hr(e),s=1<<t,r|=n[t],e&=~s;return r}function Y1(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Q1(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-hr(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=Y1(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function rg(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Ux(){var n=rc;return rc<<=1,!(rc&4194240)&&(rc=64),n}function kf(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function bu(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-hr(e),n[e]=t}function X1(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-hr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Wp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-hr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Ke=0;function Bx(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var $x,qp,Vx,jx,Gx,sg=!1,ic=[],Zs=null,ei=null,ti=null,ql=new Map,Yl=new Map,Ks=[],J1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kv(n,e){switch(n){case"focusin":case"focusout":Zs=null;break;case"dragenter":case"dragleave":ei=null;break;case"mouseover":case"mouseout":ti=null;break;case"pointerover":case"pointerout":ql.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yl.delete(e.pointerId)}}function il(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Cu(e),e!==null&&qp(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function Z1(n,e,t,r,s){switch(e){case"focusin":return Zs=il(Zs,n,e,t,r,s),!0;case"dragenter":return ei=il(ei,n,e,t,r,s),!0;case"mouseover":return ti=il(ti,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return ql.set(i,il(ql.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Yl.set(i,il(Yl.get(i)||null,n,e,t,r,s)),!0}return!1}function Kx(n){var e=zi(n.target);if(e!==null){var t=vo(e);if(t!==null){if(e=t.tag,e===13){if(e=Px(t),e!==null){n.blockedOn=e,Gx(n.priority,function(){Vx(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Vc(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ig(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Zm=r,t.target.dispatchEvent(r),Zm=null}else return e=Cu(t),e!==null&&qp(e),n.blockedOn=t,!1;e.shift()}return!0}function Hv(n,e,t){Vc(n)&&t.delete(e)}function eC(){sg=!1,Zs!==null&&Vc(Zs)&&(Zs=null),ei!==null&&Vc(ei)&&(ei=null),ti!==null&&Vc(ti)&&(ti=null),ql.forEach(Hv),Yl.forEach(Hv)}function ol(n,e){n.blockedOn===e&&(n.blockedOn=null,sg||(sg=!0,Un.unstable_scheduleCallback(Un.unstable_NormalPriority,eC)))}function Ql(n){function e(s){return ol(s,n)}if(0<ic.length){ol(ic[0],n);for(var t=1;t<ic.length;t++){var r=ic[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Zs!==null&&ol(Zs,n),ei!==null&&ol(ei,n),ti!==null&&ol(ti,n),ql.forEach(e),Yl.forEach(e),t=0;t<Ks.length;t++)r=Ks[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Ks.length&&(t=Ks[0],t.blockedOn===null);)Kx(t),t.blockedOn===null&&Ks.shift()}var ta=_s.ReactCurrentBatchConfig,Th=!0;function tC(n,e,t,r){var s=Ke,i=ta.transition;ta.transition=null;try{Ke=1,Yp(n,e,t,r)}finally{Ke=s,ta.transition=i}}function nC(n,e,t,r){var s=Ke,i=ta.transition;ta.transition=null;try{Ke=4,Yp(n,e,t,r)}finally{Ke=s,ta.transition=i}}function Yp(n,e,t,r){if(Th){var s=ig(n,e,t,r);if(s===null)Vf(n,e,r,Sh,t),Kv(n,r);else if(Z1(s,n,e,t,r))r.stopPropagation();else if(Kv(n,r),e&4&&-1<J1.indexOf(n)){for(;s!==null;){var i=Cu(s);if(i!==null&&$x(i),i=ig(n,e,t,r),i===null&&Vf(n,e,r,Sh,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Vf(n,e,r,null,t)}}var Sh=null;function ig(n,e,t,r){if(Sh=null,n=Hp(r),n=zi(n),n!==null)if(e=vo(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Px(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Sh=n,null}function Hx(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(G1()){case zp:return 1;case Mx:return 4;case vh:case K1:return 16;case Fx:return 536870912;default:return 16}default:return 16}}var Ys=null,Qp=null,jc=null;function zx(){if(jc)return jc;var n,e=Qp,t=e.length,r,s="value"in Ys?Ys.value:Ys.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return jc=s.slice(n,1<r?1-r:void 0)}function Gc(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function oc(){return!0}function zv(){return!1}function $n(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?oc:zv,this.isPropagationStopped=zv,this}return ct(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=oc)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=oc)},persist:function(){},isPersistent:oc}),e}var Pa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xp=$n(Pa),Lu=ct({},Pa,{view:0,detail:0}),rC=$n(Lu),Pf,Df,al,Id=ct({},Lu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==al&&(al&&n.type==="mousemove"?(Pf=n.screenX-al.screenX,Df=n.screenY-al.screenY):Df=Pf=0,al=n),Pf)},movementY:function(n){return"movementY"in n?n.movementY:Df}}),Wv=$n(Id),sC=ct({},Id,{dataTransfer:0}),iC=$n(sC),oC=ct({},Lu,{relatedTarget:0}),Nf=$n(oC),aC=ct({},Pa,{animationName:0,elapsedTime:0,pseudoElement:0}),lC=$n(aC),uC=ct({},Pa,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),cC=$n(uC),hC=ct({},Pa,{data:0}),qv=$n(hC),dC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gC(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=mC[n])?!!e[n]:!1}function Jp(){return gC}var pC=ct({},Lu,{key:function(n){if(n.key){var e=dC[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Gc(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?fC[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jp,charCode:function(n){return n.type==="keypress"?Gc(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Gc(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),yC=$n(pC),vC=ct({},Id,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yv=$n(vC),EC=ct({},Lu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jp}),TC=$n(EC),SC=ct({},Pa,{propertyName:0,elapsedTime:0,pseudoElement:0}),_C=$n(SC),xC=ct({},Id,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),IC=$n(xC),AC=[9,13,27,32],Zp=ms&&"CompositionEvent"in window,bl=null;ms&&"documentMode"in document&&(bl=document.documentMode);var wC=ms&&"TextEvent"in window&&!bl,Wx=ms&&(!Zp||bl&&8<bl&&11>=bl),Qv=" ",Xv=!1;function qx(n,e){switch(n){case"keyup":return AC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yx(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Vo=!1;function RC(n,e){switch(n){case"compositionend":return Yx(e);case"keypress":return e.which!==32?null:(Xv=!0,Qv);case"textInput":return n=e.data,n===Qv&&Xv?null:n;default:return null}}function bC(n,e){if(Vo)return n==="compositionend"||!Zp&&qx(n,e)?(n=zx(),jc=Qp=Ys=null,Vo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Wx&&e.locale!=="ko"?null:e.data;default:return null}}var LC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!LC[n.type]:e==="textarea"}function Qx(n,e,t,r){Rx(r),e=_h(e,"onChange"),0<e.length&&(t=new Xp("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ll=null,Xl=null;function CC(n){aI(n,0)}function Ad(n){var e=Ko(n);if(Tx(e))return n}function kC(n,e){if(n==="change")return e}var Xx=!1;if(ms){var Of;if(ms){var Mf="oninput"in document;if(!Mf){var Zv=document.createElement("div");Zv.setAttribute("oninput","return;"),Mf=typeof Zv.oninput=="function"}Of=Mf}else Of=!1;Xx=Of&&(!document.documentMode||9<document.documentMode)}function eE(){Ll&&(Ll.detachEvent("onpropertychange",Jx),Xl=Ll=null)}function Jx(n){if(n.propertyName==="value"&&Ad(Xl)){var e=[];Qx(e,Xl,n,Hp(n)),kx(CC,e)}}function PC(n,e,t){n==="focusin"?(eE(),Ll=e,Xl=t,Ll.attachEvent("onpropertychange",Jx)):n==="focusout"&&eE()}function DC(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ad(Xl)}function NC(n,e){if(n==="click")return Ad(e)}function OC(n,e){if(n==="input"||n==="change")return Ad(e)}function MC(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var gr=typeof Object.is=="function"?Object.is:MC;function Jl(n,e){if(gr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Vm.call(e,s)||!gr(n[s],e[s]))return!1}return!0}function tE(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function nE(n,e){var t=tE(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=tE(t)}}function Zx(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Zx(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function eI(){for(var n=window,e=gh();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=gh(n.document)}return e}function e0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function FC(n){var e=eI(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Zx(t.ownerDocument.documentElement,t)){if(r!==null&&e0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=nE(t,i);var o=nE(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var UC=ms&&"documentMode"in document&&11>=document.documentMode,jo=null,og=null,Cl=null,ag=!1;function rE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ag||jo==null||jo!==gh(r)||(r=jo,"selectionStart"in r&&e0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Cl&&Jl(Cl,r)||(Cl=r,r=_h(og,"onSelect"),0<r.length&&(e=new Xp("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=jo)))}function ac(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Go={animationend:ac("Animation","AnimationEnd"),animationiteration:ac("Animation","AnimationIteration"),animationstart:ac("Animation","AnimationStart"),transitionend:ac("Transition","TransitionEnd")},Ff={},tI={};ms&&(tI=document.createElement("div").style,"AnimationEvent"in window||(delete Go.animationend.animation,delete Go.animationiteration.animation,delete Go.animationstart.animation),"TransitionEvent"in window||delete Go.transitionend.transition);function wd(n){if(Ff[n])return Ff[n];if(!Go[n])return n;var e=Go[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in tI)return Ff[n]=e[t];return n}var nI=wd("animationend"),rI=wd("animationiteration"),sI=wd("animationstart"),iI=wd("transitionend"),oI=new Map,sE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(n,e){oI.set(n,e),yo(e,[n])}for(var Uf=0;Uf<sE.length;Uf++){var Bf=sE[Uf],BC=Bf.toLowerCase(),$C=Bf[0].toUpperCase()+Bf.slice(1);wi(BC,"on"+$C)}wi(nI,"onAnimationEnd");wi(rI,"onAnimationIteration");wi(sI,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(iI,"onTransitionEnd");ga("onMouseEnter",["mouseout","mouseover"]);ga("onMouseLeave",["mouseout","mouseover"]);ga("onPointerEnter",["pointerout","pointerover"]);ga("onPointerLeave",["pointerout","pointerover"]);yo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yo("onBeforeInput",["compositionend","keypress","textInput","paste"]);yo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VC=new Set("cancel close invalid load scroll toggle".split(" ").concat(pl));function iE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,B1(r,e,void 0,n),n.currentTarget=null}function aI(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;iE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;iE(s,a,u),i=l}}}if(yh)throw n=ng,yh=!1,ng=null,n}function Ze(n,e){var t=e[dg];t===void 0&&(t=e[dg]=new Set);var r=n+"__bubble";t.has(r)||(lI(e,n,2,!1),t.add(r))}function $f(n,e,t){var r=0;e&&(r|=4),lI(t,n,r,e)}var lc="_reactListening"+Math.random().toString(36).slice(2);function Zl(n){if(!n[lc]){n[lc]=!0,gx.forEach(function(t){t!=="selectionchange"&&(VC.has(t)||$f(t,!1,n),$f(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[lc]||(e[lc]=!0,$f("selectionchange",!1,e))}}function lI(n,e,t,r){switch(Hx(e)){case 1:var s=tC;break;case 4:s=nC;break;default:s=Yp}t=s.bind(null,e,t,n),s=void 0,!tg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Vf(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=zi(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}kx(function(){var u=i,c=Hp(t),h=[];e:{var d=oI.get(n);if(d!==void 0){var m=Xp,g=n;switch(n){case"keypress":if(Gc(t)===0)break e;case"keydown":case"keyup":m=yC;break;case"focusin":g="focus",m=Nf;break;case"focusout":g="blur",m=Nf;break;case"beforeblur":case"afterblur":m=Nf;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Wv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=iC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=TC;break;case nI:case rI:case sI:m=lC;break;case iI:m=_C;break;case"scroll":m=rC;break;case"wheel":m=IC;break;case"copy":case"cut":case"paste":m=cC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Yv}var y=(e&4)!==0,v=!y&&n==="scroll",E=y?d!==null?d+"Capture":null:d;y=[];for(var p=u,S;p!==null;){S=p;var L=S.stateNode;if(S.tag===5&&L!==null&&(S=L,E!==null&&(L=Wl(p,E),L!=null&&y.push(eu(p,L,S)))),v)break;p=p.return}0<y.length&&(d=new m(d,g,null,t,c),h.push({event:d,listeners:y}))}}if(!(e&7)){e:{if(d=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",d&&t!==Zm&&(g=t.relatedTarget||t.fromElement)&&(zi(g)||g[gs]))break e;if((m||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=u,g=g?zi(g):null,g!==null&&(v=vo(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=u),m!==g)){if(y=Wv,L="onMouseLeave",E="onMouseEnter",p="mouse",(n==="pointerout"||n==="pointerover")&&(y=Yv,L="onPointerLeave",E="onPointerEnter",p="pointer"),v=m==null?d:Ko(m),S=g==null?d:Ko(g),d=new y(L,p+"leave",m,t,c),d.target=v,d.relatedTarget=S,L=null,zi(c)===u&&(y=new y(E,p+"enter",g,t,c),y.target=S,y.relatedTarget=v,L=y),v=L,m&&g)t:{for(y=m,E=g,p=0,S=y;S;S=Ro(S))p++;for(S=0,L=E;L;L=Ro(L))S++;for(;0<p-S;)y=Ro(y),p--;for(;0<S-p;)E=Ro(E),S--;for(;p--;){if(y===E||E!==null&&y===E.alternate)break t;y=Ro(y),E=Ro(E)}y=null}else y=null;m!==null&&oE(h,d,m,y,!1),g!==null&&v!==null&&oE(h,v,g,y,!0)}}e:{if(d=u?Ko(u):window,m=d.nodeName&&d.nodeName.toLowerCase(),m==="select"||m==="input"&&d.type==="file")var D=kC;else if(Jv(d))if(Xx)D=OC;else{D=DC;var F=PC}else(m=d.nodeName)&&m.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(D=NC);if(D&&(D=D(n,u))){Qx(h,D,t,c);break e}F&&F(n,d,u),n==="focusout"&&(F=d._wrapperState)&&F.controlled&&d.type==="number"&&qm(d,"number",d.value)}switch(F=u?Ko(u):window,n){case"focusin":(Jv(F)||F.contentEditable==="true")&&(jo=F,og=u,Cl=null);break;case"focusout":Cl=og=jo=null;break;case"mousedown":ag=!0;break;case"contextmenu":case"mouseup":case"dragend":ag=!1,rE(h,t,c);break;case"selectionchange":if(UC)break;case"keydown":case"keyup":rE(h,t,c)}var A;if(Zp)e:{switch(n){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Vo?qx(n,t)&&(x="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(x="onCompositionStart");x&&(Wx&&t.locale!=="ko"&&(Vo||x!=="onCompositionStart"?x==="onCompositionEnd"&&Vo&&(A=zx()):(Ys=c,Qp="value"in Ys?Ys.value:Ys.textContent,Vo=!0)),F=_h(u,x),0<F.length&&(x=new qv(x,n,null,t,c),h.push({event:x,listeners:F}),A?x.data=A:(A=Yx(t),A!==null&&(x.data=A)))),(A=wC?RC(n,t):bC(n,t))&&(u=_h(u,"onBeforeInput"),0<u.length&&(c=new qv("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=A))}aI(h,e)})}function eu(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _h(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Wl(n,t),i!=null&&r.unshift(eu(n,i,s)),i=Wl(n,e),i!=null&&r.push(eu(n,i,s))),n=n.return}return r}function Ro(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function oE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Wl(t,i),l!=null&&o.unshift(eu(t,l,a))):s||(l=Wl(t,i),l!=null&&o.push(eu(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var jC=/\r\n?/g,GC=/\u0000|\uFFFD/g;function aE(n){return(typeof n=="string"?n:""+n).replace(jC,`
`).replace(GC,"")}function uc(n,e,t){if(e=aE(e),aE(n)!==e&&t)throw Error(ne(425))}function xh(){}var lg=null,ug=null;function cg(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var hg=typeof setTimeout=="function"?setTimeout:void 0,KC=typeof clearTimeout=="function"?clearTimeout:void 0,lE=typeof Promise=="function"?Promise:void 0,HC=typeof queueMicrotask=="function"?queueMicrotask:typeof lE<"u"?function(n){return lE.resolve(null).then(n).catch(zC)}:hg;function zC(n){setTimeout(function(){throw n})}function jf(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Ql(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Ql(e)}function ni(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function uE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Da=Math.random().toString(36).slice(2),Dr="__reactFiber$"+Da,tu="__reactProps$"+Da,gs="__reactContainer$"+Da,dg="__reactEvents$"+Da,WC="__reactListeners$"+Da,qC="__reactHandles$"+Da;function zi(n){var e=n[Dr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[gs]||t[Dr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=uE(n);n!==null;){if(t=n[Dr])return t;n=uE(n)}return e}n=t,t=n.parentNode}return null}function Cu(n){return n=n[Dr]||n[gs],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ko(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ne(33))}function Rd(n){return n[tu]||null}var fg=[],Ho=-1;function Ri(n){return{current:n}}function nt(n){0>Ho||(n.current=fg[Ho],fg[Ho]=null,Ho--)}function Qe(n,e){Ho++,fg[Ho]=n.current,n.current=e}var yi={},rn=Ri(yi),Sn=Ri(!1),no=yi;function pa(n,e){var t=n.type.contextTypes;if(!t)return yi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function _n(n){return n=n.childContextTypes,n!=null}function Ih(){nt(Sn),nt(rn)}function cE(n,e,t){if(rn.current!==yi)throw Error(ne(168));Qe(rn,e),Qe(Sn,t)}function uI(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ne(108,P1(n)||"Unknown",s));return ct({},t,r)}function Ah(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||yi,no=rn.current,Qe(rn,n),Qe(Sn,Sn.current),!0}function hE(n,e,t){var r=n.stateNode;if(!r)throw Error(ne(169));t?(n=uI(n,e,no),r.__reactInternalMemoizedMergedChildContext=n,nt(Sn),nt(rn),Qe(rn,n)):nt(Sn),Qe(Sn,t)}var is=null,bd=!1,Gf=!1;function cI(n){is===null?is=[n]:is.push(n)}function YC(n){bd=!0,cI(n)}function bi(){if(!Gf&&is!==null){Gf=!0;var n=0,e=Ke;try{var t=is;for(Ke=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}is=null,bd=!1}catch(s){throw is!==null&&(is=is.slice(n+1)),Ox(zp,bi),s}finally{Ke=e,Gf=!1}}return null}var zo=[],Wo=0,wh=null,Rh=0,jn=[],Gn=0,ro=null,ls=1,us="";function ji(n,e){zo[Wo++]=Rh,zo[Wo++]=wh,wh=n,Rh=e}function hI(n,e,t){jn[Gn++]=ls,jn[Gn++]=us,jn[Gn++]=ro,ro=n;var r=ls;n=us;var s=32-hr(r)-1;r&=~(1<<s),t+=1;var i=32-hr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,ls=1<<32-hr(e)+s|t<<s|r,us=i+n}else ls=1<<i|t<<s|r,us=n}function t0(n){n.return!==null&&(ji(n,1),hI(n,1,0))}function n0(n){for(;n===wh;)wh=zo[--Wo],zo[Wo]=null,Rh=zo[--Wo],zo[Wo]=null;for(;n===ro;)ro=jn[--Gn],jn[Gn]=null,us=jn[--Gn],jn[Gn]=null,ls=jn[--Gn],jn[Gn]=null}var On=null,Nn=null,rt=!1,lr=null;function dI(n,e){var t=zn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function dE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,On=n,Nn=ni(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,On=n,Nn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ro!==null?{id:ls,overflow:us}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=zn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,On=n,Nn=null,!0):!1;default:return!1}}function mg(n){return(n.mode&1)!==0&&(n.flags&128)===0}function gg(n){if(rt){var e=Nn;if(e){var t=e;if(!dE(n,e)){if(mg(n))throw Error(ne(418));e=ni(t.nextSibling);var r=On;e&&dE(n,e)?dI(r,t):(n.flags=n.flags&-4097|2,rt=!1,On=n)}}else{if(mg(n))throw Error(ne(418));n.flags=n.flags&-4097|2,rt=!1,On=n}}}function fE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;On=n}function cc(n){if(n!==On)return!1;if(!rt)return fE(n),rt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!cg(n.type,n.memoizedProps)),e&&(e=Nn)){if(mg(n))throw fI(),Error(ne(418));for(;e;)dI(n,e),e=ni(e.nextSibling)}if(fE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ne(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Nn=ni(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Nn=null}}else Nn=On?ni(n.stateNode.nextSibling):null;return!0}function fI(){for(var n=Nn;n;)n=ni(n.nextSibling)}function ya(){Nn=On=null,rt=!1}function r0(n){lr===null?lr=[n]:lr.push(n)}var QC=_s.ReactCurrentBatchConfig;function ll(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ne(309));var r=t.stateNode}if(!r)throw Error(ne(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(ne(284));if(!t._owner)throw Error(ne(290,n))}return n}function hc(n,e){throw n=Object.prototype.toString.call(e),Error(ne(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function mE(n){var e=n._init;return e(n._payload)}function mI(n){function e(E,p){if(n){var S=E.deletions;S===null?(E.deletions=[p],E.flags|=16):S.push(p)}}function t(E,p){if(!n)return null;for(;p!==null;)e(E,p),p=p.sibling;return null}function r(E,p){for(E=new Map;p!==null;)p.key!==null?E.set(p.key,p):E.set(p.index,p),p=p.sibling;return E}function s(E,p){return E=oi(E,p),E.index=0,E.sibling=null,E}function i(E,p,S){return E.index=S,n?(S=E.alternate,S!==null?(S=S.index,S<p?(E.flags|=2,p):S):(E.flags|=2,p)):(E.flags|=1048576,p)}function o(E){return n&&E.alternate===null&&(E.flags|=2),E}function a(E,p,S,L){return p===null||p.tag!==6?(p=Qf(S,E.mode,L),p.return=E,p):(p=s(p,S),p.return=E,p)}function l(E,p,S,L){var D=S.type;return D===$o?c(E,p,S.props.children,L,S.key):p!==null&&(p.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===$s&&mE(D)===p.type)?(L=s(p,S.props),L.ref=ll(E,p,S),L.return=E,L):(L=Qc(S.type,S.key,S.props,null,E.mode,L),L.ref=ll(E,p,S),L.return=E,L)}function u(E,p,S,L){return p===null||p.tag!==4||p.stateNode.containerInfo!==S.containerInfo||p.stateNode.implementation!==S.implementation?(p=Xf(S,E.mode,L),p.return=E,p):(p=s(p,S.children||[]),p.return=E,p)}function c(E,p,S,L,D){return p===null||p.tag!==7?(p=Ji(S,E.mode,L,D),p.return=E,p):(p=s(p,S),p.return=E,p)}function h(E,p,S){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Qf(""+p,E.mode,S),p.return=E,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case ec:return S=Qc(p.type,p.key,p.props,null,E.mode,S),S.ref=ll(E,null,p),S.return=E,S;case Bo:return p=Xf(p,E.mode,S),p.return=E,p;case $s:var L=p._init;return h(E,L(p._payload),S)}if(ml(p)||rl(p))return p=Ji(p,E.mode,S,null),p.return=E,p;hc(E,p)}return null}function d(E,p,S,L){var D=p!==null?p.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return D!==null?null:a(E,p,""+S,L);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ec:return S.key===D?l(E,p,S,L):null;case Bo:return S.key===D?u(E,p,S,L):null;case $s:return D=S._init,d(E,p,D(S._payload),L)}if(ml(S)||rl(S))return D!==null?null:c(E,p,S,L,null);hc(E,S)}return null}function m(E,p,S,L,D){if(typeof L=="string"&&L!==""||typeof L=="number")return E=E.get(S)||null,a(p,E,""+L,D);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case ec:return E=E.get(L.key===null?S:L.key)||null,l(p,E,L,D);case Bo:return E=E.get(L.key===null?S:L.key)||null,u(p,E,L,D);case $s:var F=L._init;return m(E,p,S,F(L._payload),D)}if(ml(L)||rl(L))return E=E.get(S)||null,c(p,E,L,D,null);hc(p,L)}return null}function g(E,p,S,L){for(var D=null,F=null,A=p,x=p=0,R=null;A!==null&&x<S.length;x++){A.index>x?(R=A,A=null):R=A.sibling;var b=d(E,A,S[x],L);if(b===null){A===null&&(A=R);break}n&&A&&b.alternate===null&&e(E,A),p=i(b,p,x),F===null?D=b:F.sibling=b,F=b,A=R}if(x===S.length)return t(E,A),rt&&ji(E,x),D;if(A===null){for(;x<S.length;x++)A=h(E,S[x],L),A!==null&&(p=i(A,p,x),F===null?D=A:F.sibling=A,F=A);return rt&&ji(E,x),D}for(A=r(E,A);x<S.length;x++)R=m(A,E,x,S[x],L),R!==null&&(n&&R.alternate!==null&&A.delete(R.key===null?x:R.key),p=i(R,p,x),F===null?D=R:F.sibling=R,F=R);return n&&A.forEach(function(C){return e(E,C)}),rt&&ji(E,x),D}function y(E,p,S,L){var D=rl(S);if(typeof D!="function")throw Error(ne(150));if(S=D.call(S),S==null)throw Error(ne(151));for(var F=D=null,A=p,x=p=0,R=null,b=S.next();A!==null&&!b.done;x++,b=S.next()){A.index>x?(R=A,A=null):R=A.sibling;var C=d(E,A,b.value,L);if(C===null){A===null&&(A=R);break}n&&A&&C.alternate===null&&e(E,A),p=i(C,p,x),F===null?D=C:F.sibling=C,F=C,A=R}if(b.done)return t(E,A),rt&&ji(E,x),D;if(A===null){for(;!b.done;x++,b=S.next())b=h(E,b.value,L),b!==null&&(p=i(b,p,x),F===null?D=b:F.sibling=b,F=b);return rt&&ji(E,x),D}for(A=r(E,A);!b.done;x++,b=S.next())b=m(A,E,x,b.value,L),b!==null&&(n&&b.alternate!==null&&A.delete(b.key===null?x:b.key),p=i(b,p,x),F===null?D=b:F.sibling=b,F=b);return n&&A.forEach(function(M){return e(E,M)}),rt&&ji(E,x),D}function v(E,p,S,L){if(typeof S=="object"&&S!==null&&S.type===$o&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case ec:e:{for(var D=S.key,F=p;F!==null;){if(F.key===D){if(D=S.type,D===$o){if(F.tag===7){t(E,F.sibling),p=s(F,S.props.children),p.return=E,E=p;break e}}else if(F.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===$s&&mE(D)===F.type){t(E,F.sibling),p=s(F,S.props),p.ref=ll(E,F,S),p.return=E,E=p;break e}t(E,F);break}else e(E,F);F=F.sibling}S.type===$o?(p=Ji(S.props.children,E.mode,L,S.key),p.return=E,E=p):(L=Qc(S.type,S.key,S.props,null,E.mode,L),L.ref=ll(E,p,S),L.return=E,E=L)}return o(E);case Bo:e:{for(F=S.key;p!==null;){if(p.key===F)if(p.tag===4&&p.stateNode.containerInfo===S.containerInfo&&p.stateNode.implementation===S.implementation){t(E,p.sibling),p=s(p,S.children||[]),p.return=E,E=p;break e}else{t(E,p);break}else e(E,p);p=p.sibling}p=Xf(S,E.mode,L),p.return=E,E=p}return o(E);case $s:return F=S._init,v(E,p,F(S._payload),L)}if(ml(S))return g(E,p,S,L);if(rl(S))return y(E,p,S,L);hc(E,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,p!==null&&p.tag===6?(t(E,p.sibling),p=s(p,S),p.return=E,E=p):(t(E,p),p=Qf(S,E.mode,L),p.return=E,E=p),o(E)):t(E,p)}return v}var va=mI(!0),gI=mI(!1),bh=Ri(null),Lh=null,qo=null,s0=null;function i0(){s0=qo=Lh=null}function o0(n){var e=bh.current;nt(bh),n._currentValue=e}function pg(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function na(n,e){Lh=n,s0=qo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(En=!0),n.firstContext=null)}function qn(n){var e=n._currentValue;if(s0!==n)if(n={context:n,memoizedValue:e,next:null},qo===null){if(Lh===null)throw Error(ne(308));qo=n,Lh.dependencies={lanes:0,firstContext:n}}else qo=qo.next=n;return e}var Wi=null;function a0(n){Wi===null?Wi=[n]:Wi.push(n)}function pI(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,a0(e)):(t.next=s.next,s.next=t),e.interleaved=t,ps(n,r)}function ps(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Vs=!1;function l0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yI(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ds(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ri(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,De&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ps(n,t)}return s=r.interleaved,s===null?(e.next=e,a0(r)):(e.next=s.next,s.next=e),r.interleaved=e,ps(n,t)}function Kc(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Wp(n,t)}}function gE(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ch(n,e,t,r){var s=n.updateQueue;Vs=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,c=u=l=null,a=i;do{var d=a.lane,m=a.eventTime;if((r&d)===d){c!==null&&(c=c.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,y=a;switch(d=e,m=t,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(m,h,d);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,d=typeof g=="function"?g.call(m,h,d):g,d==null)break e;h=ct({},h,d);break e;case 2:Vs=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,d=s.effects,d===null?s.effects=[a]:d.push(a))}else m={eventTime:m,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=m,l=h):c=c.next=m,o|=d;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;d=a,a=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(c===null&&(l=h),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);io|=o,n.lanes=o,n.memoizedState=h}}function pE(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(ne(191,s));s.call(r)}}}var ku={},Ur=Ri(ku),nu=Ri(ku),ru=Ri(ku);function qi(n){if(n===ku)throw Error(ne(174));return n}function u0(n,e){switch(Qe(ru,e),Qe(nu,n),Qe(Ur,ku),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Qm(e,n)}nt(Ur),Qe(Ur,e)}function Ea(){nt(Ur),nt(nu),nt(ru)}function vI(n){qi(ru.current);var e=qi(Ur.current),t=Qm(e,n.type);e!==t&&(Qe(nu,n),Qe(Ur,t))}function c0(n){nu.current===n&&(nt(Ur),nt(nu))}var ot=Ri(0);function kh(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Kf=[];function h0(){for(var n=0;n<Kf.length;n++)Kf[n]._workInProgressVersionPrimary=null;Kf.length=0}var Hc=_s.ReactCurrentDispatcher,Hf=_s.ReactCurrentBatchConfig,so=0,lt=null,bt=null,Ft=null,Ph=!1,kl=!1,su=0,XC=0;function Xt(){throw Error(ne(321))}function d0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!gr(n[t],e[t]))return!1;return!0}function f0(n,e,t,r,s,i){if(so=i,lt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Hc.current=n===null||n.memoizedState===null?tk:nk,n=t(r,s),kl){i=0;do{if(kl=!1,su=0,25<=i)throw Error(ne(301));i+=1,Ft=bt=null,e.updateQueue=null,Hc.current=rk,n=t(r,s)}while(kl)}if(Hc.current=Dh,e=bt!==null&&bt.next!==null,so=0,Ft=bt=lt=null,Ph=!1,e)throw Error(ne(300));return n}function m0(){var n=su!==0;return su=0,n}function wr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?lt.memoizedState=Ft=n:Ft=Ft.next=n,Ft}function Yn(){if(bt===null){var n=lt.alternate;n=n!==null?n.memoizedState:null}else n=bt.next;var e=Ft===null?lt.memoizedState:Ft.next;if(e!==null)Ft=e,bt=n;else{if(n===null)throw Error(ne(310));bt=n,n={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Ft===null?lt.memoizedState=Ft=n:Ft=Ft.next=n}return Ft}function iu(n,e){return typeof e=="function"?e(n):e}function zf(n){var e=Yn(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=n;var r=bt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((so&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,lt.lanes|=c,io|=c}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,gr(r,e.memoizedState)||(En=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,lt.lanes|=i,io|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Wf(n){var e=Yn(),t=e.queue;if(t===null)throw Error(ne(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);gr(i,e.memoizedState)||(En=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function EI(){}function TI(n,e){var t=lt,r=Yn(),s=e(),i=!gr(r.memoizedState,s);if(i&&(r.memoizedState=s,En=!0),r=r.queue,g0(xI.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Ft!==null&&Ft.memoizedState.tag&1){if(t.flags|=2048,ou(9,_I.bind(null,t,r,s,e),void 0,null),Ut===null)throw Error(ne(349));so&30||SI(t,e,s)}return s}function SI(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=lt.updateQueue,e===null?(e={lastEffect:null,stores:null},lt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function _I(n,e,t,r){e.value=t,e.getSnapshot=r,II(e)&&AI(n)}function xI(n,e,t){return t(function(){II(e)&&AI(n)})}function II(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!gr(n,t)}catch{return!0}}function AI(n){var e=ps(n,1);e!==null&&dr(e,n,1,-1)}function yE(n){var e=wr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:iu,lastRenderedState:n},e.queue=n,n=n.dispatch=ek.bind(null,lt,n),[e.memoizedState,n]}function ou(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=lt.updateQueue,e===null?(e={lastEffect:null,stores:null},lt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function wI(){return Yn().memoizedState}function zc(n,e,t,r){var s=wr();lt.flags|=n,s.memoizedState=ou(1|e,t,void 0,r===void 0?null:r)}function Ld(n,e,t,r){var s=Yn();r=r===void 0?null:r;var i=void 0;if(bt!==null){var o=bt.memoizedState;if(i=o.destroy,r!==null&&d0(r,o.deps)){s.memoizedState=ou(e,t,i,r);return}}lt.flags|=n,s.memoizedState=ou(1|e,t,i,r)}function vE(n,e){return zc(8390656,8,n,e)}function g0(n,e){return Ld(2048,8,n,e)}function RI(n,e){return Ld(4,2,n,e)}function bI(n,e){return Ld(4,4,n,e)}function LI(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function CI(n,e,t){return t=t!=null?t.concat([n]):null,Ld(4,4,LI.bind(null,e,n),t)}function p0(){}function kI(n,e){var t=Yn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&d0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function PI(n,e){var t=Yn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&d0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function DI(n,e,t){return so&21?(gr(t,e)||(t=Ux(),lt.lanes|=t,io|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,En=!0),n.memoizedState=t)}function JC(n,e){var t=Ke;Ke=t!==0&&4>t?t:4,n(!0);var r=Hf.transition;Hf.transition={};try{n(!1),e()}finally{Ke=t,Hf.transition=r}}function NI(){return Yn().memoizedState}function ZC(n,e,t){var r=ii(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},OI(n))MI(e,t);else if(t=pI(n,e,t,r),t!==null){var s=hn();dr(t,n,r,s),FI(t,e,r)}}function ek(n,e,t){var r=ii(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(OI(n))MI(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,gr(a,o)){var l=e.interleaved;l===null?(s.next=s,a0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=pI(n,e,s,r),t!==null&&(s=hn(),dr(t,n,r,s),FI(t,e,r))}}function OI(n){var e=n.alternate;return n===lt||e!==null&&e===lt}function MI(n,e){kl=Ph=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function FI(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Wp(n,t)}}var Dh={readContext:qn,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useInsertionEffect:Xt,useLayoutEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useMutableSource:Xt,useSyncExternalStore:Xt,useId:Xt,unstable_isNewReconciler:!1},tk={readContext:qn,useCallback:function(n,e){return wr().memoizedState=[n,e===void 0?null:e],n},useContext:qn,useEffect:vE,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,zc(4194308,4,LI.bind(null,e,n),t)},useLayoutEffect:function(n,e){return zc(4194308,4,n,e)},useInsertionEffect:function(n,e){return zc(4,2,n,e)},useMemo:function(n,e){var t=wr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=wr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=ZC.bind(null,lt,n),[r.memoizedState,n]},useRef:function(n){var e=wr();return n={current:n},e.memoizedState=n},useState:yE,useDebugValue:p0,useDeferredValue:function(n){return wr().memoizedState=n},useTransition:function(){var n=yE(!1),e=n[0];return n=JC.bind(null,n[1]),wr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=lt,s=wr();if(rt){if(t===void 0)throw Error(ne(407));t=t()}else{if(t=e(),Ut===null)throw Error(ne(349));so&30||SI(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,vE(xI.bind(null,r,i,n),[n]),r.flags|=2048,ou(9,_I.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=wr(),e=Ut.identifierPrefix;if(rt){var t=us,r=ls;t=(r&~(1<<32-hr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=su++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=XC++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},nk={readContext:qn,useCallback:kI,useContext:qn,useEffect:g0,useImperativeHandle:CI,useInsertionEffect:RI,useLayoutEffect:bI,useMemo:PI,useReducer:zf,useRef:wI,useState:function(){return zf(iu)},useDebugValue:p0,useDeferredValue:function(n){var e=Yn();return DI(e,bt.memoizedState,n)},useTransition:function(){var n=zf(iu)[0],e=Yn().memoizedState;return[n,e]},useMutableSource:EI,useSyncExternalStore:TI,useId:NI,unstable_isNewReconciler:!1},rk={readContext:qn,useCallback:kI,useContext:qn,useEffect:g0,useImperativeHandle:CI,useInsertionEffect:RI,useLayoutEffect:bI,useMemo:PI,useReducer:Wf,useRef:wI,useState:function(){return Wf(iu)},useDebugValue:p0,useDeferredValue:function(n){var e=Yn();return bt===null?e.memoizedState=n:DI(e,bt.memoizedState,n)},useTransition:function(){var n=Wf(iu)[0],e=Yn().memoizedState;return[n,e]},useMutableSource:EI,useSyncExternalStore:TI,useId:NI,unstable_isNewReconciler:!1};function or(n,e){if(n&&n.defaultProps){e=ct({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function yg(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ct({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Cd={isMounted:function(n){return(n=n._reactInternals)?vo(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=hn(),s=ii(n),i=ds(r,s);i.payload=e,t!=null&&(i.callback=t),e=ri(n,i,s),e!==null&&(dr(e,n,s,r),Kc(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=hn(),s=ii(n),i=ds(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=ri(n,i,s),e!==null&&(dr(e,n,s,r),Kc(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=hn(),r=ii(n),s=ds(t,r);s.tag=2,e!=null&&(s.callback=e),e=ri(n,s,r),e!==null&&(dr(e,n,r,t),Kc(e,n,r))}};function EE(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Jl(t,r)||!Jl(s,i):!0}function UI(n,e,t){var r=!1,s=yi,i=e.contextType;return typeof i=="object"&&i!==null?i=qn(i):(s=_n(e)?no:rn.current,r=e.contextTypes,i=(r=r!=null)?pa(n,s):yi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Cd,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function TE(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Cd.enqueueReplaceState(e,e.state,null)}function vg(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},l0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=qn(i):(i=_n(e)?no:rn.current,s.context=pa(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(yg(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Cd.enqueueReplaceState(s,s.state,null),Ch(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Ta(n,e){try{var t="",r=e;do t+=k1(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function qf(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Eg(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var sk=typeof WeakMap=="function"?WeakMap:Map;function BI(n,e,t){t=ds(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Oh||(Oh=!0,Lg=r),Eg(n,e)},t}function $I(n,e,t){t=ds(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Eg(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Eg(n,e),typeof r!="function"&&(si===null?si=new Set([this]):si.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function SE(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new sk;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=vk.bind(null,n,e,t),e.then(n,n))}function _E(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function xE(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ds(-1,1),e.tag=2,ri(t,e,1))),t.lanes|=1),n)}var ik=_s.ReactCurrentOwner,En=!1;function ln(n,e,t,r){e.child=n===null?gI(e,null,t,r):va(e,n.child,t,r)}function IE(n,e,t,r,s){t=t.render;var i=e.ref;return na(e,s),r=f0(n,e,t,r,i,s),t=m0(),n!==null&&!En?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ys(n,e,s)):(rt&&t&&t0(e),e.flags|=1,ln(n,e,r,s),e.child)}function AE(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!I0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,VI(n,e,i,r,s)):(n=Qc(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Jl,t(o,r)&&n.ref===e.ref)return ys(n,e,s)}return e.flags|=1,n=oi(i,r),n.ref=e.ref,n.return=e,e.child=n}function VI(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Jl(i,r)&&n.ref===e.ref)if(En=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(En=!0);else return e.lanes=n.lanes,ys(n,e,s)}return Tg(n,e,t,r,s)}function jI(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(Qo,Pn),Pn|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Qe(Qo,Pn),Pn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Qe(Qo,Pn),Pn|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Qe(Qo,Pn),Pn|=r;return ln(n,e,s,t),e.child}function GI(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Tg(n,e,t,r,s){var i=_n(t)?no:rn.current;return i=pa(e,i),na(e,s),t=f0(n,e,t,r,i,s),r=m0(),n!==null&&!En?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ys(n,e,s)):(rt&&r&&t0(e),e.flags|=1,ln(n,e,t,s),e.child)}function wE(n,e,t,r,s){if(_n(t)){var i=!0;Ah(e)}else i=!1;if(na(e,s),e.stateNode===null)Wc(n,e),UI(e,t,r),vg(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=qn(u):(u=_n(t)?no:rn.current,u=pa(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&TE(e,o,r,u),Vs=!1;var d=e.memoizedState;o.state=d,Ch(e,r,o,s),l=e.memoizedState,a!==r||d!==l||Sn.current||Vs?(typeof c=="function"&&(yg(e,t,c,r),l=e.memoizedState),(a=Vs||EE(e,t,a,r,d,l,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,yI(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:or(e.type,a),o.props=u,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=qn(l):(l=_n(t)?no:rn.current,l=pa(e,l));var m=t.getDerivedStateFromProps;(c=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&TE(e,o,r,l),Vs=!1,d=e.memoizedState,o.state=d,Ch(e,r,o,s);var g=e.memoizedState;a!==h||d!==g||Sn.current||Vs?(typeof m=="function"&&(yg(e,t,m,r),g=e.memoizedState),(u=Vs||EE(e,t,u,r,d,g,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&d===n.memoizedState||(e.flags|=1024),r=!1)}return Sg(n,e,t,r,i,s)}function Sg(n,e,t,r,s,i){GI(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&hE(e,t,!1),ys(n,e,i);r=e.stateNode,ik.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=va(e,n.child,null,i),e.child=va(e,null,a,i)):ln(n,e,a,i),e.memoizedState=r.state,s&&hE(e,t,!0),e.child}function KI(n){var e=n.stateNode;e.pendingContext?cE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&cE(n,e.context,!1),u0(n,e.containerInfo)}function RE(n,e,t,r,s){return ya(),r0(s),e.flags|=256,ln(n,e,t,r),e.child}var _g={dehydrated:null,treeContext:null,retryLane:0};function xg(n){return{baseLanes:n,cachePool:null,transitions:null}}function HI(n,e,t){var r=e.pendingProps,s=ot.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Qe(ot,s&1),n===null)return gg(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Dd(o,r,0,null),n=Ji(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=xg(t),e.memoizedState=_g,n):y0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return ok(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=oi(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=oi(a,i):(i=Ji(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?xg(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=_g,r}return i=n.child,n=i.sibling,r=oi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function y0(n,e){return e=Dd({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function dc(n,e,t,r){return r!==null&&r0(r),va(e,n.child,null,t),n=y0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function ok(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=qf(Error(ne(422))),dc(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Dd({mode:"visible",children:r.children},s,0,null),i=Ji(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&va(e,n.child,null,o),e.child.memoizedState=xg(o),e.memoizedState=_g,i);if(!(e.mode&1))return dc(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(ne(419)),r=qf(i,r,void 0),dc(n,e,o,r)}if(a=(o&n.childLanes)!==0,En||a){if(r=Ut,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ps(n,s),dr(r,n,s,-1))}return x0(),r=qf(Error(ne(421))),dc(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Ek.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Nn=ni(s.nextSibling),On=e,rt=!0,lr=null,n!==null&&(jn[Gn++]=ls,jn[Gn++]=us,jn[Gn++]=ro,ls=n.id,us=n.overflow,ro=e),e=y0(e,r.children),e.flags|=4096,e)}function bE(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),pg(n.return,e,t)}function Yf(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function zI(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ln(n,e,r.children,t),r=ot.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&bE(n,t,e);else if(n.tag===19)bE(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Qe(ot,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&kh(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Yf(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&kh(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Yf(e,!0,t,null,i);break;case"together":Yf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wc(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ys(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),io|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ne(153));if(e.child!==null){for(n=e.child,t=oi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=oi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ak(n,e,t){switch(e.tag){case 3:KI(e),ya();break;case 5:vI(e);break;case 1:_n(e.type)&&Ah(e);break;case 4:u0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Qe(bh,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Qe(ot,ot.current&1),e.flags|=128,null):t&e.child.childLanes?HI(n,e,t):(Qe(ot,ot.current&1),n=ys(n,e,t),n!==null?n.sibling:null);Qe(ot,ot.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return zI(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Qe(ot,ot.current),r)break;return null;case 22:case 23:return e.lanes=0,jI(n,e,t)}return ys(n,e,t)}var WI,Ig,qI,YI;WI=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Ig=function(){};qI=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,qi(Ur.current);var i=null;switch(t){case"input":s=zm(n,s),r=zm(n,r),i=[];break;case"select":s=ct({},s,{value:void 0}),r=ct({},r,{value:void 0}),i=[];break;case"textarea":s=Ym(n,s),r=Ym(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=xh)}Xm(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Hl.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Hl.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ze("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};YI=function(n,e,t,r){t!==r&&(e.flags|=4)};function ul(n,e){if(!rt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Jt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function lk(n,e,t){var r=e.pendingProps;switch(n0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(e),null;case 1:return _n(e.type)&&Ih(),Jt(e),null;case 3:return r=e.stateNode,Ea(),nt(Sn),nt(rn),h0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(cc(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lr!==null&&(Pg(lr),lr=null))),Ig(n,e),Jt(e),null;case 5:c0(e);var s=qi(ru.current);if(t=e.type,n!==null&&e.stateNode!=null)qI(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ne(166));return Jt(e),null}if(n=qi(Ur.current),cc(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Dr]=e,r[tu]=i,n=(e.mode&1)!==0,t){case"dialog":Ze("cancel",r),Ze("close",r);break;case"iframe":case"object":case"embed":Ze("load",r);break;case"video":case"audio":for(s=0;s<pl.length;s++)Ze(pl[s],r);break;case"source":Ze("error",r);break;case"img":case"image":case"link":Ze("error",r),Ze("load",r);break;case"details":Ze("toggle",r);break;case"input":Fv(r,i),Ze("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ze("invalid",r);break;case"textarea":Bv(r,i),Ze("invalid",r)}Xm(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&uc(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&uc(r.textContent,a,n),s=["children",""+a]):Hl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ze("scroll",r)}switch(t){case"input":tc(r),Uv(r,i,!0);break;case"textarea":tc(r),$v(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=xh)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=xx(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Dr]=e,n[tu]=r,WI(n,e,!1,!1),e.stateNode=n;e:{switch(o=Jm(t,r),t){case"dialog":Ze("cancel",n),Ze("close",n),s=r;break;case"iframe":case"object":case"embed":Ze("load",n),s=r;break;case"video":case"audio":for(s=0;s<pl.length;s++)Ze(pl[s],n);s=r;break;case"source":Ze("error",n),s=r;break;case"img":case"image":case"link":Ze("error",n),Ze("load",n),s=r;break;case"details":Ze("toggle",n),s=r;break;case"input":Fv(n,r),s=zm(n,r),Ze("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=ct({},r,{value:void 0}),Ze("invalid",n);break;case"textarea":Bv(n,r),s=Ym(n,r),Ze("invalid",n);break;default:s=r}Xm(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?wx(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Ix(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&zl(n,l):typeof l=="number"&&zl(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Hl.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ze("scroll",n):l!=null&&Vp(n,i,l,o))}switch(t){case"input":tc(n),Uv(n,r,!1);break;case"textarea":tc(n),$v(n);break;case"option":r.value!=null&&n.setAttribute("value",""+pi(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Jo(n,!!r.multiple,i,!1):r.defaultValue!=null&&Jo(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=xh)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Jt(e),null;case 6:if(n&&e.stateNode!=null)YI(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ne(166));if(t=qi(ru.current),qi(Ur.current),cc(e)){if(r=e.stateNode,t=e.memoizedProps,r[Dr]=e,(i=r.nodeValue!==t)&&(n=On,n!==null))switch(n.tag){case 3:uc(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&uc(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Dr]=e,e.stateNode=r}return Jt(e),null;case 13:if(nt(ot),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(rt&&Nn!==null&&e.mode&1&&!(e.flags&128))fI(),ya(),e.flags|=98560,i=!1;else if(i=cc(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(ne(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ne(317));i[Dr]=e}else ya(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Jt(e),i=!1}else lr!==null&&(Pg(lr),lr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ot.current&1?kt===0&&(kt=3):x0())),e.updateQueue!==null&&(e.flags|=4),Jt(e),null);case 4:return Ea(),Ig(n,e),n===null&&Zl(e.stateNode.containerInfo),Jt(e),null;case 10:return o0(e.type._context),Jt(e),null;case 17:return _n(e.type)&&Ih(),Jt(e),null;case 19:if(nt(ot),i=e.memoizedState,i===null)return Jt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)ul(i,!1);else{if(kt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=kh(n),o!==null){for(e.flags|=128,ul(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Qe(ot,ot.current&1|2),e.child}n=n.sibling}i.tail!==null&&vt()>Sa&&(e.flags|=128,r=!0,ul(i,!1),e.lanes=4194304)}else{if(!r)if(n=kh(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ul(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!rt)return Jt(e),null}else 2*vt()-i.renderingStartTime>Sa&&t!==1073741824&&(e.flags|=128,r=!0,ul(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=vt(),e.sibling=null,t=ot.current,Qe(ot,r?t&1|2:t&1),e):(Jt(e),null);case 22:case 23:return _0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Pn&1073741824&&(Jt(e),e.subtreeFlags&6&&(e.flags|=8192)):Jt(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function uk(n,e){switch(n0(e),e.tag){case 1:return _n(e.type)&&Ih(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ea(),nt(Sn),nt(rn),h0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return c0(e),null;case 13:if(nt(ot),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));ya()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return nt(ot),null;case 4:return Ea(),null;case 10:return o0(e.type._context),null;case 22:case 23:return _0(),null;case 24:return null;default:return null}}var fc=!1,tn=!1,ck=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Yo(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){gt(n,e,r)}else t.current=null}function Ag(n,e,t){try{t()}catch(r){gt(n,e,r)}}var LE=!1;function hk(n,e){if(lg=Th,n=eI(),e0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,h=n,d=null;t:for(;;){for(var m;h!==t||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)d=h,h=m;for(;;){if(h===n)break t;if(d===t&&++u===s&&(a=o),d===i&&++c===r&&(l=o),(m=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(ug={focusedElem:n,selectionRange:t},Th=!1,ue=e;ue!==null;)if(e=ue,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ue=n;else for(;ue!==null;){e=ue;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,v=g.memoizedState,E=e.stateNode,p=E.getSnapshotBeforeUpdate(e.elementType===e.type?y:or(e.type,y),v);E.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(L){gt(e,e.return,L)}if(n=e.sibling,n!==null){n.return=e.return,ue=n;break}ue=e.return}return g=LE,LE=!1,g}function Pl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Ag(e,t,i)}s=s.next}while(s!==r)}}function kd(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function wg(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function QI(n){var e=n.alternate;e!==null&&(n.alternate=null,QI(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Dr],delete e[tu],delete e[dg],delete e[WC],delete e[qC])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function XI(n){return n.tag===5||n.tag===3||n.tag===4}function CE(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||XI(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Rg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=xh));else if(r!==4&&(n=n.child,n!==null))for(Rg(n,e,t),n=n.sibling;n!==null;)Rg(n,e,t),n=n.sibling}function bg(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(bg(n,e,t),n=n.sibling;n!==null;)bg(n,e,t),n=n.sibling}var Vt=null,ar=!1;function Os(n,e,t){for(t=t.child;t!==null;)JI(n,e,t),t=t.sibling}function JI(n,e,t){if(Fr&&typeof Fr.onCommitFiberUnmount=="function")try{Fr.onCommitFiberUnmount(xd,t)}catch{}switch(t.tag){case 5:tn||Yo(t,e);case 6:var r=Vt,s=ar;Vt=null,Os(n,e,t),Vt=r,ar=s,Vt!==null&&(ar?(n=Vt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Vt.removeChild(t.stateNode));break;case 18:Vt!==null&&(ar?(n=Vt,t=t.stateNode,n.nodeType===8?jf(n.parentNode,t):n.nodeType===1&&jf(n,t),Ql(n)):jf(Vt,t.stateNode));break;case 4:r=Vt,s=ar,Vt=t.stateNode.containerInfo,ar=!0,Os(n,e,t),Vt=r,ar=s;break;case 0:case 11:case 14:case 15:if(!tn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Ag(t,e,o),s=s.next}while(s!==r)}Os(n,e,t);break;case 1:if(!tn&&(Yo(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){gt(t,e,a)}Os(n,e,t);break;case 21:Os(n,e,t);break;case 22:t.mode&1?(tn=(r=tn)||t.memoizedState!==null,Os(n,e,t),tn=r):Os(n,e,t);break;default:Os(n,e,t)}}function kE(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new ck),e.forEach(function(r){var s=Tk.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function tr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Vt=a.stateNode,ar=!1;break e;case 3:Vt=a.stateNode.containerInfo,ar=!0;break e;case 4:Vt=a.stateNode.containerInfo,ar=!0;break e}a=a.return}if(Vt===null)throw Error(ne(160));JI(i,o,s),Vt=null,ar=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){gt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ZI(e,n),e=e.sibling}function ZI(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(tr(e,n),Tr(n),r&4){try{Pl(3,n,n.return),kd(3,n)}catch(y){gt(n,n.return,y)}try{Pl(5,n,n.return)}catch(y){gt(n,n.return,y)}}break;case 1:tr(e,n),Tr(n),r&512&&t!==null&&Yo(t,t.return);break;case 5:if(tr(e,n),Tr(n),r&512&&t!==null&&Yo(t,t.return),n.flags&32){var s=n.stateNode;try{zl(s,"")}catch(y){gt(n,n.return,y)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Sx(s,i),Jm(a,o);var u=Jm(a,i);for(o=0;o<l.length;o+=2){var c=l[o],h=l[o+1];c==="style"?wx(s,h):c==="dangerouslySetInnerHTML"?Ix(s,h):c==="children"?zl(s,h):Vp(s,c,h,u)}switch(a){case"input":Wm(s,i);break;case"textarea":_x(s,i);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Jo(s,!!i.multiple,m,!1):d!==!!i.multiple&&(i.defaultValue!=null?Jo(s,!!i.multiple,i.defaultValue,!0):Jo(s,!!i.multiple,i.multiple?[]:"",!1))}s[tu]=i}catch(y){gt(n,n.return,y)}}break;case 6:if(tr(e,n),Tr(n),r&4){if(n.stateNode===null)throw Error(ne(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(y){gt(n,n.return,y)}}break;case 3:if(tr(e,n),Tr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Ql(e.containerInfo)}catch(y){gt(n,n.return,y)}break;case 4:tr(e,n),Tr(n);break;case 13:tr(e,n),Tr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(T0=vt())),r&4&&kE(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(tn=(u=tn)||c,tr(e,n),tn=u):tr(e,n),Tr(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(ue=n,c=n.child;c!==null;){for(h=ue=c;ue!==null;){switch(d=ue,m=d.child,d.tag){case 0:case 11:case 14:case 15:Pl(4,d,d.return);break;case 1:Yo(d,d.return);var g=d.stateNode;if(typeof g.componentWillUnmount=="function"){r=d,t=d.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){gt(r,t,y)}}break;case 5:Yo(d,d.return);break;case 22:if(d.memoizedState!==null){DE(h);continue}}m!==null?(m.return=d,ue=m):DE(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Ax("display",o))}catch(y){gt(n,n.return,y)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(y){gt(n,n.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:tr(e,n),Tr(n),r&4&&kE(n);break;case 21:break;default:tr(e,n),Tr(n)}}function Tr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(XI(t)){var r=t;break e}t=t.return}throw Error(ne(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(zl(s,""),r.flags&=-33);var i=CE(n);bg(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=CE(n);Rg(n,a,o);break;default:throw Error(ne(161))}}catch(l){gt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function dk(n,e,t){ue=n,eA(n)}function eA(n,e,t){for(var r=(n.mode&1)!==0;ue!==null;){var s=ue,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||fc;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||tn;a=fc;var u=tn;if(fc=o,(tn=l)&&!u)for(ue=s;ue!==null;)o=ue,l=o.child,o.tag===22&&o.memoizedState!==null?NE(s):l!==null?(l.return=o,ue=l):NE(s);for(;i!==null;)ue=i,eA(i),i=i.sibling;ue=s,fc=a,tn=u}PE(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ue=i):PE(n)}}function PE(n){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tn||kd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!tn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:or(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&pE(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}pE(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Ql(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}tn||e.flags&512&&wg(e)}catch(d){gt(e,e.return,d)}}if(e===n){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function DE(n){for(;ue!==null;){var e=ue;if(e===n){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function NE(n){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{kd(4,e)}catch(l){gt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){gt(e,s,l)}}var i=e.return;try{wg(e)}catch(l){gt(e,i,l)}break;case 5:var o=e.return;try{wg(e)}catch(l){gt(e,o,l)}}}catch(l){gt(e,e.return,l)}if(e===n){ue=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ue=a;break}ue=e.return}}var fk=Math.ceil,Nh=_s.ReactCurrentDispatcher,v0=_s.ReactCurrentOwner,Wn=_s.ReactCurrentBatchConfig,De=0,Ut=null,xt=null,Wt=0,Pn=0,Qo=Ri(0),kt=0,au=null,io=0,Pd=0,E0=0,Dl=null,yn=null,T0=0,Sa=1/0,ns=null,Oh=!1,Lg=null,si=null,mc=!1,Qs=null,Mh=0,Nl=0,Cg=null,qc=-1,Yc=0;function hn(){return De&6?vt():qc!==-1?qc:qc=vt()}function ii(n){return n.mode&1?De&2&&Wt!==0?Wt&-Wt:QC.transition!==null?(Yc===0&&(Yc=Ux()),Yc):(n=Ke,n!==0||(n=window.event,n=n===void 0?16:Hx(n.type)),n):1}function dr(n,e,t,r){if(50<Nl)throw Nl=0,Cg=null,Error(ne(185));bu(n,t,r),(!(De&2)||n!==Ut)&&(n===Ut&&(!(De&2)&&(Pd|=t),kt===4&&Hs(n,Wt)),xn(n,r),t===1&&De===0&&!(e.mode&1)&&(Sa=vt()+500,bd&&bi()))}function xn(n,e){var t=n.callbackNode;Q1(n,e);var r=Eh(n,n===Ut?Wt:0);if(r===0)t!==null&&Gv(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Gv(t),e===1)n.tag===0?YC(OE.bind(null,n)):cI(OE.bind(null,n)),HC(function(){!(De&6)&&bi()}),t=null;else{switch(Bx(r)){case 1:t=zp;break;case 4:t=Mx;break;case 16:t=vh;break;case 536870912:t=Fx;break;default:t=vh}t=lA(t,tA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function tA(n,e){if(qc=-1,Yc=0,De&6)throw Error(ne(327));var t=n.callbackNode;if(ra()&&n.callbackNode!==t)return null;var r=Eh(n,n===Ut?Wt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Fh(n,r);else{e=r;var s=De;De|=2;var i=rA();(Ut!==n||Wt!==e)&&(ns=null,Sa=vt()+500,Xi(n,e));do try{pk();break}catch(a){nA(n,a)}while(!0);i0(),Nh.current=i,De=s,xt!==null?e=0:(Ut=null,Wt=0,e=kt)}if(e!==0){if(e===2&&(s=rg(n),s!==0&&(r=s,e=kg(n,s))),e===1)throw t=au,Xi(n,0),Hs(n,r),xn(n,vt()),t;if(e===6)Hs(n,r);else{if(s=n.current.alternate,!(r&30)&&!mk(s)&&(e=Fh(n,r),e===2&&(i=rg(n),i!==0&&(r=i,e=kg(n,i))),e===1))throw t=au,Xi(n,0),Hs(n,r),xn(n,vt()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(ne(345));case 2:Gi(n,yn,ns);break;case 3:if(Hs(n,r),(r&130023424)===r&&(e=T0+500-vt(),10<e)){if(Eh(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){hn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=hg(Gi.bind(null,n,yn,ns),e);break}Gi(n,yn,ns);break;case 4:if(Hs(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-hr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=vt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*fk(r/1960))-r,10<r){n.timeoutHandle=hg(Gi.bind(null,n,yn,ns),r);break}Gi(n,yn,ns);break;case 5:Gi(n,yn,ns);break;default:throw Error(ne(329))}}}return xn(n,vt()),n.callbackNode===t?tA.bind(null,n):null}function kg(n,e){var t=Dl;return n.current.memoizedState.isDehydrated&&(Xi(n,e).flags|=256),n=Fh(n,e),n!==2&&(e=yn,yn=t,e!==null&&Pg(e)),n}function Pg(n){yn===null?yn=n:yn.push.apply(yn,n)}function mk(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!gr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Hs(n,e){for(e&=~E0,e&=~Pd,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-hr(e),r=1<<t;n[t]=-1,e&=~r}}function OE(n){if(De&6)throw Error(ne(327));ra();var e=Eh(n,0);if(!(e&1))return xn(n,vt()),null;var t=Fh(n,e);if(n.tag!==0&&t===2){var r=rg(n);r!==0&&(e=r,t=kg(n,r))}if(t===1)throw t=au,Xi(n,0),Hs(n,e),xn(n,vt()),t;if(t===6)throw Error(ne(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Gi(n,yn,ns),xn(n,vt()),null}function S0(n,e){var t=De;De|=1;try{return n(e)}finally{De=t,De===0&&(Sa=vt()+500,bd&&bi())}}function oo(n){Qs!==null&&Qs.tag===0&&!(De&6)&&ra();var e=De;De|=1;var t=Wn.transition,r=Ke;try{if(Wn.transition=null,Ke=1,n)return n()}finally{Ke=r,Wn.transition=t,De=e,!(De&6)&&bi()}}function _0(){Pn=Qo.current,nt(Qo)}function Xi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,KC(t)),xt!==null)for(t=xt.return;t!==null;){var r=t;switch(n0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ih();break;case 3:Ea(),nt(Sn),nt(rn),h0();break;case 5:c0(r);break;case 4:Ea();break;case 13:nt(ot);break;case 19:nt(ot);break;case 10:o0(r.type._context);break;case 22:case 23:_0()}t=t.return}if(Ut=n,xt=n=oi(n.current,null),Wt=Pn=e,kt=0,au=null,E0=Pd=io=0,yn=Dl=null,Wi!==null){for(e=0;e<Wi.length;e++)if(t=Wi[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Wi=null}return n}function nA(n,e){do{var t=xt;try{if(i0(),Hc.current=Dh,Ph){for(var r=lt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ph=!1}if(so=0,Ft=bt=lt=null,kl=!1,su=0,v0.current=null,t===null||t.return===null){kt=1,au=e,xt=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Wt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=_E(o);if(m!==null){m.flags&=-257,xE(m,o,a,i,e),m.mode&1&&SE(i,u,e),e=m,l=u;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){SE(i,u,e),x0();break e}l=Error(ne(426))}}else if(rt&&a.mode&1){var v=_E(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),xE(v,o,a,i,e),r0(Ta(l,a));break e}}i=l=Ta(l,a),kt!==4&&(kt=2),Dl===null?Dl=[i]:Dl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var E=BI(i,l,e);gE(i,E);break e;case 1:a=l;var p=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof p.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(si===null||!si.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var L=$I(i,a,e);gE(i,L);break e}}i=i.return}while(i!==null)}iA(t)}catch(D){e=D,xt===t&&t!==null&&(xt=t=t.return);continue}break}while(!0)}function rA(){var n=Nh.current;return Nh.current=Dh,n===null?Dh:n}function x0(){(kt===0||kt===3||kt===2)&&(kt=4),Ut===null||!(io&268435455)&&!(Pd&268435455)||Hs(Ut,Wt)}function Fh(n,e){var t=De;De|=2;var r=rA();(Ut!==n||Wt!==e)&&(ns=null,Xi(n,e));do try{gk();break}catch(s){nA(n,s)}while(!0);if(i0(),De=t,Nh.current=r,xt!==null)throw Error(ne(261));return Ut=null,Wt=0,kt}function gk(){for(;xt!==null;)sA(xt)}function pk(){for(;xt!==null&&!V1();)sA(xt)}function sA(n){var e=aA(n.alternate,n,Pn);n.memoizedProps=n.pendingProps,e===null?iA(n):xt=e,v0.current=null}function iA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=uk(t,e),t!==null){t.flags&=32767,xt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{kt=6,xt=null;return}}else if(t=lk(t,e,Pn),t!==null){xt=t;return}if(e=e.sibling,e!==null){xt=e;return}xt=e=n}while(e!==null);kt===0&&(kt=5)}function Gi(n,e,t){var r=Ke,s=Wn.transition;try{Wn.transition=null,Ke=1,yk(n,e,t,r)}finally{Wn.transition=s,Ke=r}return null}function yk(n,e,t,r){do ra();while(Qs!==null);if(De&6)throw Error(ne(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ne(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(X1(n,i),n===Ut&&(xt=Ut=null,Wt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||mc||(mc=!0,lA(vh,function(){return ra(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Wn.transition,Wn.transition=null;var o=Ke;Ke=1;var a=De;De|=4,v0.current=null,hk(n,t),ZI(t,n),FC(ug),Th=!!lg,ug=lg=null,n.current=t,dk(t),j1(),De=a,Ke=o,Wn.transition=i}else n.current=t;if(mc&&(mc=!1,Qs=n,Mh=s),i=n.pendingLanes,i===0&&(si=null),H1(t.stateNode),xn(n,vt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Oh)throw Oh=!1,n=Lg,Lg=null,n;return Mh&1&&n.tag!==0&&ra(),i=n.pendingLanes,i&1?n===Cg?Nl++:(Nl=0,Cg=n):Nl=0,bi(),null}function ra(){if(Qs!==null){var n=Bx(Mh),e=Wn.transition,t=Ke;try{if(Wn.transition=null,Ke=16>n?16:n,Qs===null)var r=!1;else{if(n=Qs,Qs=null,Mh=0,De&6)throw Error(ne(331));var s=De;for(De|=4,ue=n.current;ue!==null;){var i=ue,o=i.child;if(ue.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ue=u;ue!==null;){var c=ue;switch(c.tag){case 0:case 11:case 15:Pl(8,c,i)}var h=c.child;if(h!==null)h.return=c,ue=h;else for(;ue!==null;){c=ue;var d=c.sibling,m=c.return;if(QI(c),c===u){ue=null;break}if(d!==null){d.return=m,ue=d;break}ue=m}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}ue=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ue=o;else e:for(;ue!==null;){if(i=ue,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Pl(9,i,i.return)}var E=i.sibling;if(E!==null){E.return=i.return,ue=E;break e}ue=i.return}}var p=n.current;for(ue=p;ue!==null;){o=ue;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,ue=S;else e:for(o=p;ue!==null;){if(a=ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:kd(9,a)}}catch(D){gt(a,a.return,D)}if(a===o){ue=null;break e}var L=a.sibling;if(L!==null){L.return=a.return,ue=L;break e}ue=a.return}}if(De=s,bi(),Fr&&typeof Fr.onPostCommitFiberRoot=="function")try{Fr.onPostCommitFiberRoot(xd,n)}catch{}r=!0}return r}finally{Ke=t,Wn.transition=e}}return!1}function ME(n,e,t){e=Ta(t,e),e=BI(n,e,1),n=ri(n,e,1),e=hn(),n!==null&&(bu(n,1,e),xn(n,e))}function gt(n,e,t){if(n.tag===3)ME(n,n,t);else for(;e!==null;){if(e.tag===3){ME(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(si===null||!si.has(r))){n=Ta(t,n),n=$I(e,n,1),e=ri(e,n,1),n=hn(),e!==null&&(bu(e,1,n),xn(e,n));break}}e=e.return}}function vk(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=hn(),n.pingedLanes|=n.suspendedLanes&t,Ut===n&&(Wt&t)===t&&(kt===4||kt===3&&(Wt&130023424)===Wt&&500>vt()-T0?Xi(n,0):E0|=t),xn(n,e)}function oA(n,e){e===0&&(n.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var t=hn();n=ps(n,e),n!==null&&(bu(n,e,t),xn(n,t))}function Ek(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),oA(n,t)}function Tk(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(ne(314))}r!==null&&r.delete(e),oA(n,t)}var aA;aA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Sn.current)En=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return En=!1,ak(n,e,t);En=!!(n.flags&131072)}else En=!1,rt&&e.flags&1048576&&hI(e,Rh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Wc(n,e),n=e.pendingProps;var s=pa(e,rn.current);na(e,t),s=f0(null,e,r,n,s,t);var i=m0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_n(r)?(i=!0,Ah(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,l0(e),s.updater=Cd,e.stateNode=s,s._reactInternals=e,vg(e,r,n,t),e=Sg(null,e,r,!0,i,t)):(e.tag=0,rt&&i&&t0(e),ln(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Wc(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=_k(r),n=or(r,n),s){case 0:e=Tg(null,e,r,n,t);break e;case 1:e=wE(null,e,r,n,t);break e;case 11:e=IE(null,e,r,n,t);break e;case 14:e=AE(null,e,r,or(r.type,n),t);break e}throw Error(ne(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Tg(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),wE(n,e,r,s,t);case 3:e:{if(KI(e),n===null)throw Error(ne(387));r=e.pendingProps,i=e.memoizedState,s=i.element,yI(n,e),Ch(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ta(Error(ne(423)),e),e=RE(n,e,r,t,s);break e}else if(r!==s){s=Ta(Error(ne(424)),e),e=RE(n,e,r,t,s);break e}else for(Nn=ni(e.stateNode.containerInfo.firstChild),On=e,rt=!0,lr=null,t=gI(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ya(),r===s){e=ys(n,e,t);break e}ln(n,e,r,t)}e=e.child}return e;case 5:return vI(e),n===null&&gg(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,cg(r,s)?o=null:i!==null&&cg(r,i)&&(e.flags|=32),GI(n,e),ln(n,e,o,t),e.child;case 6:return n===null&&gg(e),null;case 13:return HI(n,e,t);case 4:return u0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=va(e,null,r,t):ln(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),IE(n,e,r,s,t);case 7:return ln(n,e,e.pendingProps,t),e.child;case 8:return ln(n,e,e.pendingProps.children,t),e.child;case 12:return ln(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Qe(bh,r._currentValue),r._currentValue=o,i!==null)if(gr(i.value,o)){if(i.children===s.children&&!Sn.current){e=ys(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=ds(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),pg(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ne(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),pg(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ln(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,na(e,t),s=qn(s),r=r(s),e.flags|=1,ln(n,e,r,t),e.child;case 14:return r=e.type,s=or(r,e.pendingProps),s=or(r.type,s),AE(n,e,r,s,t);case 15:return VI(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Wc(n,e),e.tag=1,_n(r)?(n=!0,Ah(e)):n=!1,na(e,t),UI(e,r,s),vg(e,r,s,t),Sg(null,e,r,!0,n,t);case 19:return zI(n,e,t);case 22:return jI(n,e,t)}throw Error(ne(156,e.tag))};function lA(n,e){return Ox(n,e)}function Sk(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(n,e,t,r){return new Sk(n,e,t,r)}function I0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function _k(n){if(typeof n=="function")return I0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Gp)return 11;if(n===Kp)return 14}return 2}function oi(n,e){var t=n.alternate;return t===null?(t=zn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Qc(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")I0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case $o:return Ji(t.children,s,i,e);case jp:o=8,s|=8;break;case jm:return n=zn(12,t,e,s|2),n.elementType=jm,n.lanes=i,n;case Gm:return n=zn(13,t,e,s),n.elementType=Gm,n.lanes=i,n;case Km:return n=zn(19,t,e,s),n.elementType=Km,n.lanes=i,n;case vx:return Dd(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case px:o=10;break e;case yx:o=9;break e;case Gp:o=11;break e;case Kp:o=14;break e;case $s:o=16,r=null;break e}throw Error(ne(130,n==null?n:typeof n,""))}return e=zn(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Ji(n,e,t,r){return n=zn(7,n,r,e),n.lanes=t,n}function Dd(n,e,t,r){return n=zn(22,n,r,e),n.elementType=vx,n.lanes=t,n.stateNode={isHidden:!1},n}function Qf(n,e,t){return n=zn(6,n,null,e),n.lanes=t,n}function Xf(n,e,t){return e=zn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function xk(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kf(0),this.expirationTimes=kf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function A0(n,e,t,r,s,i,o,a,l){return n=new xk(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=zn(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},l0(i),n}function Ik(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bo,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function uA(n){if(!n)return yi;n=n._reactInternals;e:{if(vo(n)!==n||n.tag!==1)throw Error(ne(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_n(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(n.tag===1){var t=n.type;if(_n(t))return uI(n,t,e)}return e}function cA(n,e,t,r,s,i,o,a,l){return n=A0(t,r,!0,n,s,i,o,a,l),n.context=uA(null),t=n.current,r=hn(),s=ii(t),i=ds(r,s),i.callback=e??null,ri(t,i,s),n.current.lanes=s,bu(n,s,r),xn(n,r),n}function Nd(n,e,t,r){var s=e.current,i=hn(),o=ii(s);return t=uA(t),e.context===null?e.context=t:e.pendingContext=t,e=ds(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=ri(s,e,o),n!==null&&(dr(n,s,o,i),Kc(n,s,o)),o}function Uh(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function FE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function w0(n,e){FE(n,e),(n=n.alternate)&&FE(n,e)}function Ak(){return null}var hA=typeof reportError=="function"?reportError:function(n){console.error(n)};function R0(n){this._internalRoot=n}Od.prototype.render=R0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ne(409));Nd(n,e,null,null)};Od.prototype.unmount=R0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;oo(function(){Nd(null,n,null,null)}),e[gs]=null}};function Od(n){this._internalRoot=n}Od.prototype.unstable_scheduleHydration=function(n){if(n){var e=jx();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ks.length&&e!==0&&e<Ks[t].priority;t++);Ks.splice(t,0,n),t===0&&Kx(n)}};function b0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Md(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function UE(){}function wk(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Uh(o);i.call(u)}}var o=cA(e,r,n,0,null,!1,!1,"",UE);return n._reactRootContainer=o,n[gs]=o.current,Zl(n.nodeType===8?n.parentNode:n),oo(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Uh(l);a.call(u)}}var l=A0(n,0,!1,null,null,!1,!1,"",UE);return n._reactRootContainer=l,n[gs]=l.current,Zl(n.nodeType===8?n.parentNode:n),oo(function(){Nd(e,l,t,r)}),l}function Fd(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Uh(o);a.call(l)}}Nd(e,o,n,s)}else o=wk(t,e,n,s,r);return Uh(o)}$x=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=gl(e.pendingLanes);t!==0&&(Wp(e,t|1),xn(e,vt()),!(De&6)&&(Sa=vt()+500,bi()))}break;case 13:oo(function(){var r=ps(n,1);if(r!==null){var s=hn();dr(r,n,1,s)}}),w0(n,1)}};qp=function(n){if(n.tag===13){var e=ps(n,134217728);if(e!==null){var t=hn();dr(e,n,134217728,t)}w0(n,134217728)}};Vx=function(n){if(n.tag===13){var e=ii(n),t=ps(n,e);if(t!==null){var r=hn();dr(t,n,e,r)}w0(n,e)}};jx=function(){return Ke};Gx=function(n,e){var t=Ke;try{return Ke=n,e()}finally{Ke=t}};eg=function(n,e,t){switch(e){case"input":if(Wm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Rd(r);if(!s)throw Error(ne(90));Tx(r),Wm(r,s)}}}break;case"textarea":_x(n,t);break;case"select":e=t.value,e!=null&&Jo(n,!!t.multiple,e,!1)}};Lx=S0;Cx=oo;var Rk={usingClientEntryPoint:!1,Events:[Cu,Ko,Rd,Rx,bx,S0]},cl={findFiberByHostInstance:zi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bk={bundleType:cl.bundleType,version:cl.version,rendererPackageName:cl.rendererPackageName,rendererConfig:cl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_s.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Dx(n),n===null?null:n.stateNode},findFiberByHostInstance:cl.findFiberByHostInstance||Ak,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gc.isDisabled&&gc.supportsFiber)try{xd=gc.inject(bk),Fr=gc}catch{}}Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rk;Bn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!b0(e))throw Error(ne(200));return Ik(n,e,null,t)};Bn.createRoot=function(n,e){if(!b0(n))throw Error(ne(299));var t=!1,r="",s=hA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=A0(n,1,!1,null,null,t,!1,r,s),n[gs]=e.current,Zl(n.nodeType===8?n.parentNode:n),new R0(e)};Bn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ne(188)):(n=Object.keys(n).join(","),Error(ne(268,n)));return n=Dx(e),n=n===null?null:n.stateNode,n};Bn.flushSync=function(n){return oo(n)};Bn.hydrate=function(n,e,t){if(!Md(e))throw Error(ne(200));return Fd(null,n,e,!0,t)};Bn.hydrateRoot=function(n,e,t){if(!b0(n))throw Error(ne(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=hA;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=cA(e,null,n,1,t??null,s,!1,i,o),n[gs]=e.current,Zl(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Od(e)};Bn.render=function(n,e,t){if(!Md(e))throw Error(ne(200));return Fd(null,n,e,!1,t)};Bn.unmountComponentAtNode=function(n){if(!Md(n))throw Error(ne(40));return n._reactRootContainer?(oo(function(){Fd(null,null,n,!1,function(){n._reactRootContainer=null,n[gs]=null})}),!0):!1};Bn.unstable_batchedUpdates=S0;Bn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Md(t))throw Error(ne(200));if(n==null||n._reactInternals===void 0)throw Error(ne(38));return Fd(n,e,t,!1,r)};Bn.version="18.3.1-next-f1338f8080-20240426";function dA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dA)}catch(n){console.error(n)}}dA(),dx.exports=Bn;var Lk=dx.exports,BE=Lk;$m.createRoot=BE.createRoot,$m.hydrateRoot=BE.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lu(){return lu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},lu.apply(this,arguments)}var Xs;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Xs||(Xs={}));const $E="popstate";function Ck(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Dg("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:Bh(s)}return Pk(e,t,null,n)}function ut(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function L0(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function kk(){return Math.random().toString(36).substr(2,8)}function VE(n,e){return{usr:n.state,key:n.key,idx:e}}function Dg(n,e,t,r){return t===void 0&&(t=null),lu({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Na(e):e,{state:t,key:e&&e.key||r||kk()})}function Bh(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Na(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function Pk(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=Xs.Pop,l=null,u=c();u==null&&(u=0,o.replaceState(lu({},o.state,{idx:u}),""));function c(){return(o.state||{idx:null}).idx}function h(){a=Xs.Pop;let v=c(),E=v==null?null:v-u;u=v,l&&l({action:a,location:y.location,delta:E})}function d(v,E){a=Xs.Push;let p=Dg(y.location,v,E);u=c()+1;let S=VE(p,u),L=y.createHref(p);try{o.pushState(S,"",L)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;s.location.assign(L)}i&&l&&l({action:a,location:y.location,delta:1})}function m(v,E){a=Xs.Replace;let p=Dg(y.location,v,E);u=c();let S=VE(p,u),L=y.createHref(p);o.replaceState(S,"",L),i&&l&&l({action:a,location:y.location,delta:0})}function g(v){let E=s.location.origin!=="null"?s.location.origin:s.location.href,p=typeof v=="string"?v:Bh(v);return p=p.replace(/ $/,"%20"),ut(E,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,E)}let y={get action(){return a},get location(){return n(s,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener($E,h),l=v,()=>{s.removeEventListener($E,h),l=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let E=g(v);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:d,replace:m,go(v){return o.go(v)}};return y}var jE;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(jE||(jE={}));function Dk(n,e,t){return t===void 0&&(t="/"),Nk(n,e,t)}function Nk(n,e,t,r){let s=typeof e=="string"?Na(e):e,i=_a(s.pathname||"/",t);if(i==null)return null;let o=fA(n);Ok(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=zk(i);a=Kk(o[l],u)}return a}function fA(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(ut(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=ai([r,l.relativePath]),c=t.concat(l);i.children&&i.children.length>0&&(ut(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),fA(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:jk(u,i.index),routesMeta:c})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of mA(i.path))s(i,o,l)}),e}function mA(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=mA(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function Ok(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Gk(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const Mk=/^:[\w-]+$/,Fk=3,Uk=2,Bk=1,$k=10,Vk=-2,GE=n=>n==="*";function jk(n,e){let t=n.split("/"),r=t.length;return t.some(GE)&&(r+=Vk),e&&(r+=Uk),t.filter(s=>!GE(s)).reduce((s,i)=>s+(Mk.test(i)?Fk:i===""?Bk:$k),r)}function Gk(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function Kk(n,e,t){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,c=i==="/"?e:e.slice(i.length)||"/",h=Ng({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:ai([i,h.pathname]),pathnameBase:Xk(ai([i,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(i=ai([i,h.pathnameBase]))}return o}function Ng(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=Hk(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((u,c,h)=>{let{paramName:d,isOptional:m}=c;if(d==="*"){let y=a[h]||"";o=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[h];return m&&!g?u[d]=void 0:u[d]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function Hk(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),L0(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function zk(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return L0(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function _a(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const Wk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qk=n=>Wk.test(n);function Yk(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Na(n):n,i;if(t)if(qk(t))i=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),L0(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?i=KE(t.substring(1),"/"):i=KE(t,e)}else i=e;return{pathname:i,search:Jk(r),hash:Zk(s)}}function KE(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Jf(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Qk(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function C0(n,e){let t=Qk(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function k0(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Na(n):(s=lu({},n),ut(!s.pathname||!s.pathname.includes("?"),Jf("?","pathname","search",s)),ut(!s.pathname||!s.pathname.includes("#"),Jf("#","pathname","hash",s)),ut(!s.search||!s.search.includes("#"),Jf("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;s.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=Yk(s,a),u=o&&o!=="/"&&o.endsWith("/"),c=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const ai=n=>n.join("/").replace(/\/\/+/g,"/"),Xk=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Jk=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Zk=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function eP(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const gA=["post","put","patch","delete"];new Set(gA);const tP=["get",...gA];new Set(tP);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uu(){return uu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},uu.apply(this,arguments)}const Ud=$.createContext(null),pA=$.createContext(null),xs=$.createContext(null),Bd=$.createContext(null),Is=$.createContext({outlet:null,matches:[],isDataRoute:!1}),yA=$.createContext(null);function nP(n,e){let{relative:t}=e===void 0?{}:e;Oa()||ut(!1);let{basename:r,navigator:s}=$.useContext(xs),{hash:i,pathname:o,search:a}=$d(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:ai([r,o])),s.createHref({pathname:l,search:a,hash:i})}function Oa(){return $.useContext(Bd)!=null}function qr(){return Oa()||ut(!1),$.useContext(Bd).location}function vA(n){$.useContext(xs).static||$.useLayoutEffect(n)}function Pu(){let{isDataRoute:n}=$.useContext(Is);return n?gP():rP()}function rP(){Oa()||ut(!1);let n=$.useContext(Ud),{basename:e,future:t,navigator:r}=$.useContext(xs),{matches:s}=$.useContext(Is),{pathname:i}=qr(),o=JSON.stringify(C0(s,t.v7_relativeSplatPath)),a=$.useRef(!1);return vA(()=>{a.current=!0}),$.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){r.go(u);return}let h=k0(u,JSON.parse(o),i,c.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:ai([e,h.pathname])),(c.replace?r.replace:r.push)(h,c.state,c)},[e,r,o,i,n])}function EA(){let{matches:n}=$.useContext(Is),e=n[n.length-1];return e?e.params:{}}function $d(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=$.useContext(xs),{matches:s}=$.useContext(Is),{pathname:i}=qr(),o=JSON.stringify(C0(s,r.v7_relativeSplatPath));return $.useMemo(()=>k0(n,JSON.parse(o),i,t==="path"),[n,o,i,t])}function sP(n,e){return iP(n,e)}function iP(n,e,t,r){Oa()||ut(!1);let{navigator:s}=$.useContext(xs),{matches:i}=$.useContext(Is),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let u=qr(),c;if(e){var h;let v=typeof e=="string"?Na(e):e;l==="/"||(h=v.pathname)!=null&&h.startsWith(l)||ut(!1),c=v}else c=u;let d=c.pathname||"/",m=d;if(l!=="/"){let v=l.replace(/^\//,"").split("/");m="/"+d.replace(/^\//,"").split("/").slice(v.length).join("/")}let g=Dk(n,{pathname:m}),y=cP(g&&g.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:ai([l,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:ai([l,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),i,t,r);return e&&y?$.createElement(Bd.Provider,{value:{location:uu({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Xs.Pop}},y):y}function oP(){let n=mP(),e=eP(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return $.createElement($.Fragment,null,$.createElement("h2",null,"Unexpected Application Error!"),$.createElement("h3",{style:{fontStyle:"italic"}},e),t?$.createElement("pre",{style:s},t):null,null)}const aP=$.createElement(oP,null);class lP extends $.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?$.createElement(Is.Provider,{value:this.props.routeContext},$.createElement(yA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function uP(n){let{routeContext:e,match:t,children:r}=n,s=$.useContext(Ud);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),$.createElement(Is.Provider,{value:e},r)}function cP(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let c=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);c>=0||ut(!1),o=o.slice(0,Math.min(o.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let h=o[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:d,errors:m}=t,g=h.route.loader&&d[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||g){l=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((c,h,d)=>{let m,g=!1,y=null,v=null;t&&(m=a&&h.route.id?a[h.route.id]:void 0,y=h.route.errorElement||aP,l&&(u<0&&d===0?(pP("route-fallback"),g=!0,v=null):u===d&&(g=!0,v=h.route.hydrateFallbackElement||null)));let E=e.concat(o.slice(0,d+1)),p=()=>{let S;return m?S=y:g?S=v:h.route.Component?S=$.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=c,$.createElement(uP,{match:h,routeContext:{outlet:c,matches:E,isDataRoute:t!=null},children:S})};return t&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?$.createElement(lP,{location:t.location,revalidation:t.revalidation,component:y,error:m,children:p(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):p()},null)}var TA=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(TA||{}),SA=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(SA||{});function hP(n){let e=$.useContext(Ud);return e||ut(!1),e}function dP(n){let e=$.useContext(pA);return e||ut(!1),e}function fP(n){let e=$.useContext(Is);return e||ut(!1),e}function _A(n){let e=fP(),t=e.matches[e.matches.length-1];return t.route.id||ut(!1),t.route.id}function mP(){var n;let e=$.useContext(yA),t=dP(),r=_A();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function gP(){let{router:n}=hP(TA.UseNavigateStable),e=_A(SA.UseNavigateStable),t=$.useRef(!1);return vA(()=>{t.current=!0}),$.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,uu({fromRouteId:e},i)))},[n,e])}const HE={};function pP(n,e,t){HE[n]||(HE[n]=!0)}function yP(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Vd(n){let{to:e,replace:t,state:r,relative:s}=n;Oa()||ut(!1);let{future:i,static:o}=$.useContext(xs),{matches:a}=$.useContext(Is),{pathname:l}=qr(),u=Pu(),c=k0(e,C0(a,i.v7_relativeSplatPath),l,s==="path"),h=JSON.stringify(c);return $.useEffect(()=>u(JSON.parse(h),{replace:t,state:r,relative:s}),[u,h,s,t,r]),null}function $t(n){ut(!1)}function vP(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Xs.Pop,navigator:i,static:o=!1,future:a}=n;Oa()&&ut(!1);let l=e.replace(/^\/*/,"/"),u=$.useMemo(()=>({basename:l,navigator:i,static:o,future:uu({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=Na(r));let{pathname:c="/",search:h="",hash:d="",state:m=null,key:g="default"}=r,y=$.useMemo(()=>{let v=_a(c,l);return v==null?null:{location:{pathname:v,search:h,hash:d,state:m,key:g},navigationType:s}},[l,c,h,d,m,g,s]);return y==null?null:$.createElement(xs.Provider,{value:u},$.createElement(Bd.Provider,{children:t,value:y}))}function EP(n){let{children:e,location:t}=n;return sP(Og(e),t)}new Promise(()=>{});function Og(n,e){e===void 0&&(e=[]);let t=[];return $.Children.forEach(n,(r,s)=>{if(!$.isValidElement(r))return;let i=[...e,s];if(r.type===$.Fragment){t.push.apply(t,Og(r.props.children,i));return}r.type!==$t&&ut(!1),!r.props.index||!r.props.children||ut(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Og(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $h(){return $h=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$h.apply(this,arguments)}function xA(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function TP(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function SP(n,e){return n.button===0&&(!e||e==="_self")&&!TP(n)}const _P=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],xP=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],IP="6";try{window.__reactRouterVersion=IP}catch{}const AP=$.createContext({isTransitioning:!1}),wP="startTransition",zE=v1[wP];function RP(n){let{basename:e,children:t,future:r,window:s}=n,i=$.useRef();i.current==null&&(i.current=Ck({window:s,v5Compat:!0}));let o=i.current,[a,l]=$.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},c=$.useCallback(h=>{u&&zE?zE(()=>l(h)):l(h)},[l,u]);return $.useLayoutEffect(()=>o.listen(c),[o,c]),$.useEffect(()=>yP(r),[r]),$.createElement(vP,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const bP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",LP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Pt=$.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:h}=e,d=xA(e,_P),{basename:m}=$.useContext(xs),g,y=!1;if(typeof u=="string"&&LP.test(u)&&(g=u,bP))try{let S=new URL(window.location.href),L=u.startsWith("//")?new URL(S.protocol+u):new URL(u),D=_a(L.pathname,m);L.origin===S.origin&&D!=null?u=D+L.search+L.hash:y=!0}catch{}let v=nP(u,{relative:s}),E=kP(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:s,viewTransition:h});function p(S){r&&r(S),S.defaultPrevented||E(S)}return $.createElement("a",$h({},d,{href:g||v,onClick:y||i?r:p,ref:t,target:l}))}),nr=$.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:s=!1,className:i="",end:o=!1,style:a,to:l,viewTransition:u,children:c}=e,h=xA(e,xP),d=$d(l,{relative:h.relative}),m=qr(),g=$.useContext(pA),{navigator:y,basename:v}=$.useContext(xs),E=g!=null&&PP(d)&&u===!0,p=y.encodeLocation?y.encodeLocation(d).pathname:d.pathname,S=m.pathname,L=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;s||(S=S.toLowerCase(),L=L?L.toLowerCase():null,p=p.toLowerCase()),L&&v&&(L=_a(L,v)||L);const D=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let F=S===p||!o&&S.startsWith(p)&&S.charAt(D)==="/",A=L!=null&&(L===p||!o&&L.startsWith(p)&&L.charAt(p.length)==="/"),x={isActive:F,isPending:A,isTransitioning:E},R=F?r:void 0,b;typeof i=="function"?b=i(x):b=[i,F?"active":null,A?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let C=typeof a=="function"?a(x):a;return $.createElement(Pt,$h({},h,{"aria-current":R,className:b,ref:t,style:C,to:l,viewTransition:u}),typeof c=="function"?c(x):c)});var Mg;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Mg||(Mg={}));var WE;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(WE||(WE={}));function CP(n){let e=$.useContext(Ud);return e||ut(!1),e}function kP(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=Pu(),u=qr(),c=$d(n,{relative:o});return $.useCallback(h=>{if(SP(h,t)){h.preventDefault();let d=r!==void 0?r:Bh(u)===Bh(c);l(n,{replace:d,state:s,preventScrollReset:i,relative:o,viewTransition:a})}},[u,l,c,r,s,t,n,i,o,a])}function PP(n,e){e===void 0&&(e={});let t=$.useContext(AP);t==null&&ut(!1);let{basename:r}=CP(Mg.useViewTransitionState),s=$d(n,{relative:e.relative});if(!t.isTransitioning)return!1;let i=_a(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=_a(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Ng(s.pathname,o)!=null||Ng(s.pathname,i)!=null}const DP=()=>{};var qE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},NP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},AA={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,c=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,m=u&63;l||(m=64,o||(d=64)),r.push(t[c],t[h],t[d],t[m])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(IA(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):NP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw new OP;const d=i<<2|a>>4;if(r.push(d),u!==64){const m=a<<4&240|u>>2;if(r.push(m),h!==64){const g=u<<6&192|h;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class OP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const MP=function(n){const e=IA(n);return AA.encodeByteArray(e,!0)},Vh=function(n){return MP(n).replace(/\./g,"")},wA=function(n){try{return AA.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP=()=>FP().__FIREBASE_DEFAULTS__,BP=()=>{if(typeof process>"u"||typeof qE>"u")return;const n=qE.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$P=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&wA(n[1]);return e&&JSON.parse(e)},jd=()=>{try{return DP()||UP()||BP()||$P()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},RA=n=>{var e,t;return(t=(e=jd())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},VP=n=>{const e=RA(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},bA=()=>{var n;return(n=jd())==null?void 0:n.config},LA=n=>{var e;return(e=jd())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function CA(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Vh(JSON.stringify(t)),Vh(JSON.stringify(o)),""].join(".")}const Ol={};function KP(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ol))Ol[e]?n.emulator.push(e):n.prod.push(e);return n}function HP(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let YE=!1;function kA(n,e){if(typeof window>"u"||typeof document>"u"||!Ma(window.location.host)||Ol[n]===e||Ol[n]||YE)return;Ol[n]=e;function t(d){return`__firebase__banner__${d}`}const r="__firebase__banner",i=KP().prod.length>0;function o(){const d=document.getElementById(r);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,m){d.setAttribute("width","24"),d.setAttribute("id",m),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function u(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{YE=!0,o()},d}function c(d,m){d.setAttribute("id",m),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=HP(r),m=t("text"),g=document.getElementById(m)||document.createElement("span"),y=t("learnmore"),v=document.getElementById(y)||document.createElement("a"),E=t("preprendIcon"),p=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const S=d.element;a(S),c(v,y);const L=u();l(p,E),S.append(p,g,v,L),document.body.appendChild(S)}i?(g.innerText="Preview backend disconnected.",p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function zP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(sn())}function WP(){var e;const n=(e=jd())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function YP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function QP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function XP(){const n=sn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function JP(){return!WP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ZP(){try{return typeof indexedDB=="object"}catch{return!1}}function eD(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD="FirebaseError";class As extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=tD,Object.setPrototypeOf(this,As.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Du.prototype.create)}}class Du{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?nD(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new As(s,a,r)}}function nD(n,e){return n.replace(rD,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const rD=/\{\$([^}]+)}/g;function sD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ao(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(QE(i)&&QE(o)){if(!ao(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function QE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function yl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function vl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function iD(n,e){const t=new oD(n,e);return t.subscribe.bind(t)}class oD{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");aD(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Zf),s.error===void 0&&(s.error=Zf),s.complete===void 0&&(s.complete=Zf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function aD(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Zf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(n){return n&&n._delegate?n._delegate:n}class lo{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new jP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cD(e))try{this.getOrInitializeService({instanceIdentifier:Ki})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ki){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ki){return this.instances.has(e)}getOptions(e=Ki){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:uD(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ki){return this.component?this.component.multipleInstances?e:Ki:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function uD(n){return n===Ki?void 0:n}function cD(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Le||(Le={}));const dD={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},fD=Le.INFO,mD={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},gD=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=mD[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let P0=class{constructor(e){this.name=e,this._logLevel=fD,this._logHandler=gD,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dD[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}};const pD=(n,e)=>e.some(t=>n instanceof t);let XE,JE;function yD(){return XE||(XE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vD(){return JE||(JE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const PA=new WeakMap,Fg=new WeakMap,DA=new WeakMap,em=new WeakMap,D0=new WeakMap;function ED(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(li(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&PA.set(t,n)}).catch(()=>{}),D0.set(e,n),e}function TD(n){if(Fg.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Fg.set(n,e)}let Ug={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Fg.get(n);if(e==="objectStoreNames")return n.objectStoreNames||DA.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return li(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function SD(n){Ug=n(Ug)}function _D(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(tm(this),e,...t);return DA.set(r,e.sort?e.sort():[e]),li(r)}:vD().includes(n)?function(...e){return n.apply(tm(this),e),li(PA.get(this))}:function(...e){return li(n.apply(tm(this),e))}}function xD(n){return typeof n=="function"?_D(n):(n instanceof IDBTransaction&&TD(n),pD(n,yD())?new Proxy(n,Ug):n)}function li(n){if(n instanceof IDBRequest)return ED(n);if(em.has(n))return em.get(n);const e=xD(n);return e!==n&&(em.set(n,e),D0.set(e,n)),e}const tm=n=>D0.get(n);function ID(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=li(o);return r&&o.addEventListener("upgradeneeded",l=>{r(li(o.result),l.oldVersion,l.newVersion,li(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const AD=["get","getKey","getAll","getAllKeys","count"],wD=["put","add","delete","clear"],nm=new Map;function ZE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(nm.get(e))return nm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=wD.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||AD.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return nm.set(e,i),i}SD(n=>({...n,get:(e,t,r)=>ZE(e,t)||n.get(e,t,r),has:(e,t)=>!!ZE(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bD(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function bD(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Bg="@firebase/app",eT="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vs=new P0("@firebase/app"),LD="@firebase/app-compat",CD="@firebase/analytics-compat",kD="@firebase/analytics",PD="@firebase/app-check-compat",DD="@firebase/app-check",ND="@firebase/auth",OD="@firebase/auth-compat",MD="@firebase/database",FD="@firebase/data-connect",UD="@firebase/database-compat",BD="@firebase/functions",$D="@firebase/functions-compat",VD="@firebase/installations",jD="@firebase/installations-compat",GD="@firebase/messaging",KD="@firebase/messaging-compat",HD="@firebase/performance",zD="@firebase/performance-compat",WD="@firebase/remote-config",qD="@firebase/remote-config-compat",YD="@firebase/storage",QD="@firebase/storage-compat",XD="@firebase/firestore",JD="@firebase/ai",ZD="@firebase/firestore-compat",eN="firebase",tN="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $g="[DEFAULT]",nN={[Bg]:"fire-core",[LD]:"fire-core-compat",[kD]:"fire-analytics",[CD]:"fire-analytics-compat",[DD]:"fire-app-check",[PD]:"fire-app-check-compat",[ND]:"fire-auth",[OD]:"fire-auth-compat",[MD]:"fire-rtdb",[FD]:"fire-data-connect",[UD]:"fire-rtdb-compat",[BD]:"fire-fn",[$D]:"fire-fn-compat",[VD]:"fire-iid",[jD]:"fire-iid-compat",[GD]:"fire-fcm",[KD]:"fire-fcm-compat",[HD]:"fire-perf",[zD]:"fire-perf-compat",[WD]:"fire-rc",[qD]:"fire-rc-compat",[YD]:"fire-gcs",[QD]:"fire-gcs-compat",[XD]:"fire-fst",[ZD]:"fire-fst-compat",[JD]:"fire-vertex","fire-js":"fire-js",[eN]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cu=new Map,rN=new Map,Vg=new Map;function tT(n,e){try{n.container.addComponent(e)}catch(t){vs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function xa(n){const e=n.name;if(Vg.has(e))return vs.debug(`There were multiple attempts to register component ${e}.`),!1;Vg.set(e,n);for(const t of cu.values())tT(t,n);for(const t of rN.values())tT(t,n);return!0}function N0(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function vn(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ui=new Du("app","Firebase",sN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new lo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ui.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa=tN;function NA(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:$g,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ui.create("bad-app-name",{appName:String(s)});if(t||(t=bA()),!t)throw ui.create("no-options");const i=cu.get(s);if(i){if(ao(t,i.options)&&ao(r,i.config))return i;throw ui.create("duplicate-app",{appName:s})}const o=new hD(s);for(const l of Vg.values())o.addComponent(l);const a=new iN(t,r,o);return cu.set(s,a),a}function O0(n=$g){const e=cu.get(n);if(!e&&n===$g&&bA())return NA();if(!e)throw ui.create("no-app",{appName:n});return e}function oN(){return Array.from(cu.values())}function ci(n,e,t){let r=nN[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),vs.warn(o.join(" "));return}xa(new lo(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN="firebase-heartbeat-database",lN=1,hu="firebase-heartbeat-store";let rm=null;function OA(){return rm||(rm=ID(aN,lN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(hu)}catch(t){console.warn(t)}}}}).catch(n=>{throw ui.create("idb-open",{originalErrorMessage:n.message})})),rm}async function uN(n){try{const t=(await OA()).transaction(hu),r=await t.objectStore(hu).get(MA(n));return await t.done,r}catch(e){if(e instanceof As)vs.warn(e.message);else{const t=ui.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});vs.warn(t.message)}}}async function nT(n,e){try{const r=(await OA()).transaction(hu,"readwrite");await r.objectStore(hu).put(e,MA(n)),await r.done}catch(t){if(t instanceof As)vs.warn(t.message);else{const r=ui.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});vs.warn(r.message)}}}function MA(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=1024,hN=30;class dN{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new mN(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=rT();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>hN){const o=gN(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){vs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=rT(),{heartbeatsToSend:r,unsentEntries:s}=fN(this._heartbeatsCache.heartbeats),i=Vh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return vs.warn(t),""}}}function rT(){return new Date().toISOString().substring(0,10)}function fN(n,e=cN){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),sT(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),sT(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class mN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ZP()?eD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await uN(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return nT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return nT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function sT(n){return Vh(JSON.stringify({version:2,heartbeats:n})).length}function gN(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pN(n){xa(new lo("platform-logger",e=>new RD(e),"PRIVATE")),xa(new lo("heartbeat",e=>new dN(e),"PRIVATE")),ci(Bg,eT,n),ci(Bg,eT,"esm2020"),ci("fire-js","")}pN("");function FA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const yN=FA,UA=new Du("auth","Firebase",FA());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh=new P0("@firebase/auth");function vN(n,...e){jh.logLevel<=Le.WARN&&jh.warn(`Auth (${Fa}): ${n}`,...e)}function Xc(n,...e){jh.logLevel<=Le.ERROR&&jh.error(`Auth (${Fa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(n,...e){throw F0(n,...e)}function fr(n,...e){return F0(n,...e)}function M0(n,e,t){const r={...yN(),[e]:t};return new Du("auth","Firebase",r).create(e,{appName:n.name})}function Br(n){return M0(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function BA(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Qn(n,"argument-error"),M0(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function F0(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return UA.create(n,...e)}function me(n,e,...t){if(!n)throw F0(e,...t)}function cs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xc(e),new Error(e)}function Es(n,e){n||cs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function EN(){return iT()==="http:"||iT()==="https:"}function iT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(EN()||YP()||"connection"in navigator)?navigator.onLine:!0}function SN(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,t){this.shortDelay=e,this.longDelay=t,Es(t>e,"Short delay should be less than long delay!"),this.isMobile=zP()||QP()}get(){return TN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U0(n,e){Es(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],IN=new Ou(3e4,6e4);function Li(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Yr(n,e,t,r,s={}){return VA(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Nu({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return qP()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Ma(n.emulatorConfig.host)&&(u.credentials="include"),$A.fetch()(await jA(n,n.config.apiHost,t,a),u)})}async function VA(n,e,t){n._canInitEmulator=!1;const r={..._N,...e};try{const s=new wN(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw pc(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw pc(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw pc(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw pc(n,"user-disabled",o);const c=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw M0(n,c,u);Qn(n,c)}}catch(s){if(s instanceof As)throw s;Qn(n,"network-request-failed",{message:String(s)})}}async function Mu(n,e,t,r,s={}){const i=await Yr(n,e,t,r,s);return"mfaPendingCredential"in i&&Qn(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function jA(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?U0(n.config,s):`${n.config.apiScheme}://${s}`;return xN.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function AN(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class wN{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(fr(this.auth,"network-request-failed")),IN.get())})}}function pc(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=fr(n,e,r);return s.customData._tokenResponse=t,s}function oT(n){return n!==void 0&&n.enterprise!==void 0}class RN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return AN(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bN(n,e){return Yr(n,"GET","/v2/recaptchaConfig",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LN(n,e){return Yr(n,"POST","/v1/accounts:delete",e)}async function Gh(n,e){return Yr(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ml(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function CN(n,e=!1){const t=Yt(n),r=await t.getIdToken(e),s=B0(r);me(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ml(sm(s.auth_time)),issuedAtTime:Ml(sm(s.iat)),expirationTime:Ml(sm(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function sm(n){return Number(n)*1e3}function B0(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xc("JWT malformed, contained fewer than 3 sections"),null;try{const s=wA(t);return s?JSON.parse(s):(Xc("Failed to decode base64 JWT payload"),null)}catch(s){return Xc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function aT(n){const e=B0(n);return me(e,"internal-error"),me(typeof e.exp<"u","internal-error"),me(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uo(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof As&&kN(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function kN({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ml(this.lastLoginAt),this.creationTime=Ml(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kh(n){var h;const e=n.auth,t=await n.getIdToken(),r=await uo(n,Gh(e,{idToken:t}));me(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?GA(s.providerUserInfo):[],o=NN(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Gg(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,c)}async function DN(n){const e=Yt(n);await Kh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function NN(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function GA(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ON(n,e){const t=await VA(n,{},async()=>{const r=Nu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await jA(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Ma(n.emulatorConfig.host)&&(l.credentials="include"),$A.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function MN(n,e){return Yr(n,"POST","/v2/accounts:revokeToken",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){me(e.idToken,"internal-error"),me(typeof e.idToken<"u","internal-error"),me(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):aT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){me(e.length!==0,"internal-error");const t=aT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(me(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await ON(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new sa;return r&&(me(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(me(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(me(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sa,this.toJSON())}_performRefresh(){return cs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ms(n,e){me(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ur{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new PN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Gg(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await uo(this,this.stsTokenManager.getToken(this.auth,e));return me(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return CN(this,e)}reload(){return DN(this)}_assign(e){this!==e&&(me(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ur({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){me(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Kh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vn(this.auth.app))return Promise.reject(Br(this.auth));const e=await this.getIdToken();return await uo(this,LN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:h,emailVerified:d,isAnonymous:m,providerData:g,stsTokenManager:y}=t;me(h&&y,e,"internal-error");const v=sa.fromJSON(this.name,y);me(typeof h=="string",e,"internal-error"),Ms(r,e.name),Ms(s,e.name),me(typeof d=="boolean",e,"internal-error"),me(typeof m=="boolean",e,"internal-error"),Ms(i,e.name),Ms(o,e.name),Ms(a,e.name),Ms(l,e.name),Ms(u,e.name),Ms(c,e.name);const E=new ur({uid:h,auth:e,email:s,emailVerified:d,displayName:r,isAnonymous:m,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:u,lastLoginAt:c});return g&&Array.isArray(g)&&(E.providerData=g.map(p=>({...p}))),l&&(E._redirectEventId=l),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new sa;s.updateFromServerResponse(t);const i=new ur({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Kh(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];me(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?GA(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new sa;a.updateFromIdToken(r);const l=new ur({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Gg(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=new Map;function hs(n){Es(n instanceof Function,"Expected a class definition");let e=lT.get(n);return e?(Es(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,lT.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}KA.type="NONE";const uT=KA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(n,e,t){return`firebase:${n}:${e}:${t}`}class ia{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Jc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Jc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Gh(this.auth,{idToken:e}).catch(()=>{});return t?ur._fromGetAccountInfoResponse(this.auth,t,e):null}return ur._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ia(hs(uT),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||hs(uT);const o=Jc(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const c=await u._get(o);if(c){let h;if(typeof c=="string"){const d=await Gh(e,{idToken:c}).catch(()=>{});if(!d)break;h=await ur._fromGetAccountInfoResponse(e,d,c)}else h=ur._fromJSON(e,c);u!==i&&(a=h),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ia(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new ia(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(HA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(QA(e))return"Blackberry";if(XA(e))return"Webos";if(zA(e))return"Safari";if((e.includes("chrome/")||WA(e))&&!e.includes("edge/"))return"Chrome";if(YA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function HA(n=sn()){return/firefox\//i.test(n)}function zA(n=sn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function WA(n=sn()){return/crios\//i.test(n)}function qA(n=sn()){return/iemobile/i.test(n)}function YA(n=sn()){return/android/i.test(n)}function QA(n=sn()){return/blackberry/i.test(n)}function XA(n=sn()){return/webos/i.test(n)}function $0(n=sn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function FN(n=sn()){var e;return $0(n)&&!!((e=window.navigator)!=null&&e.standalone)}function UN(){return XP()&&document.documentMode===10}function JA(n=sn()){return $0(n)||YA(n)||XA(n)||QA(n)||/windows phone/i.test(n)||qA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZA(n,e=[]){let t;switch(n){case"Browser":t=cT(sn());break;case"Worker":t=`${cT(sn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Fa}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $N(n,e={}){return Yr(n,"GET","/v2/passwordPolicy",Li(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN=6;class jN{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??VN,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hT(this),this.idTokenSubscription=new hT(this),this.beforeStateQueue=new BN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=UA,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=hs(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await ia.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Gh(this,{idToken:e}),r=await ur._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(vn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return me(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Kh(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=SN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vn(this.app))return Promise.reject(Br(this));const t=e?Yt(e):null;return t&&me(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&me(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vn(this.app)?Promise.reject(Br(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vn(this.app)?Promise.reject(Br(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(hs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $N(this),t=new jN(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Du("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await MN(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&hs(e)||this._popupRedirectResolver;me(t,this,"argument-error"),this.redirectPersistenceManager=await ia.create(this,[hs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(me(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return me(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ZA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(vn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&vN(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ws(n){return Yt(n)}class hT{constructor(e){this.auth=e,this.observer=null,this.addObserver=iD(t=>this.observer=t)}get next(){return me(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KN(n){Gd=n}function ew(n){return Gd.loadJS(n)}function HN(){return Gd.recaptchaEnterpriseScript}function zN(){return Gd.gapiScript}function WN(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class qN{constructor(){this.enterprise=new YN}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class YN{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const QN="recaptcha-enterprise",tw="NO_RECAPTCHA";class XN{constructor(e){this.type=QN,this.auth=ws(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{bN(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new RN(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;oT(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(tw)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new qN().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&oT(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=HN();l.length!==0&&(l+=a),ew(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function dT(n,e,t,r=!1,s=!1){const i=new XN(n);let o;if(s)o=tw;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Kg(n,e,t,r,s){var i;if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await dT(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await dT(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JN(n,e){const t=N0(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ao(i,e??{}))return s;Qn(s,"already-initialized")}return t.initialize({options:e})}function ZN(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(hs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function eO(n,e,t){const r=ws(n);me(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=nw(e),{host:o,port:a}=tO(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},c=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){me(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),me(ao(u,r.config.emulator)&&ao(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Ma(o)?(CA(`${i}//${o}${l}`),kA("Auth",!0)):nO()}function nw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function tO(n){const e=nw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:fT(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:fT(o)}}}function fT(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function nO(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return cs("not implemented")}_getIdTokenResponse(e){return cs("not implemented")}_linkToIdToken(e,t){return cs("not implemented")}_getReauthenticationResolver(e){return cs("not implemented")}}async function rO(n,e){return Yr(n,"POST","/v1/accounts:update",e)}async function sO(n,e){return Yr(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iO(n,e){return Mu(n,"POST","/v1/accounts:signInWithPassword",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oO(n,e){return Mu(n,"POST","/v1/accounts:signInWithEmailLink",Li(n,e))}async function aO(n,e){return Mu(n,"POST","/v1/accounts:signInWithEmailLink",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du extends V0{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new du(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new du(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Kg(e,t,"signInWithPassword",iO);case"emailLink":return oO(e,{email:this._email,oobCode:this._password});default:Qn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Kg(e,r,"signUpPassword",sO);case"emailLink":return aO(e,{idToken:t,email:this._email,oobCode:this._password});default:Qn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oa(n,e){return Mu(n,"POST","/v1/accounts:signInWithIdp",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lO="http://localhost";class co extends V0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new co(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new co(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return oa(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,oa(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,oa(e,t)}buildRequest(){const e={requestUri:lO,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Nu(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uO(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cO(n){const e=yl(vl(n)).link,t=e?yl(vl(e)).deep_link_id:null,r=yl(vl(n)).deep_link_id;return(r?yl(vl(r)).link:null)||r||t||e||n}class j0{constructor(e){const t=yl(vl(e)),r=t.apiKey??null,s=t.oobCode??null,i=uO(t.mode??null);me(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=cO(e);try{return new j0(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(){this.providerId=Ua.PROVIDER_ID}static credential(e,t){return du._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=j0.parseLink(t);return me(r,"argument-error"),du._fromEmailAndCode(e,r.code,r.tenantId)}}Ua.PROVIDER_ID="password";Ua.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ua.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu extends Kd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends Fu{constructor(){super("facebook.com")}static credential(e){return co._fromParams({providerId:zs.PROVIDER_ID,signInMethod:zs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zs.credentialFromTaggedObject(e)}static credentialFromError(e){return zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zs.credential(e.oauthAccessToken)}catch{return null}}}zs.FACEBOOK_SIGN_IN_METHOD="facebook.com";zs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as extends Fu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return co._fromParams({providerId:as.PROVIDER_ID,signInMethod:as.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return as.credentialFromTaggedObject(e)}static credentialFromError(e){return as.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return as.credential(t,r)}catch{return null}}}as.GOOGLE_SIGN_IN_METHOD="google.com";as.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws extends Fu{constructor(){super("github.com")}static credential(e){return co._fromParams({providerId:Ws.PROVIDER_ID,signInMethod:Ws.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ws.credentialFromTaggedObject(e)}static credentialFromError(e){return Ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ws.credential(e.oauthAccessToken)}catch{return null}}}Ws.GITHUB_SIGN_IN_METHOD="github.com";Ws.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Fu{constructor(){super("twitter.com")}static credential(e,t){return co._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return qs.credential(t,r)}catch{return null}}}qs.TWITTER_SIGN_IN_METHOD="twitter.com";qs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hO(n,e){return Mu(n,"POST","/v1/accounts:signUp",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ur._fromIdTokenResponse(e,r,s),o=mT(r);return new ho({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=mT(r);return new ho({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function mT(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh extends As{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Hh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Hh(e,t,r,s)}}function rw(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Hh._fromErrorAndOperation(n,i,e,r):i})}async function dO(n,e,t=!1){const r=await uo(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ho._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fO(n,e,t=!1){const{auth:r}=n;if(vn(r.app))return Promise.reject(Br(r));const s="reauthenticate";try{const i=await uo(n,rw(r,s,e,n),t);me(i.idToken,r,"internal-error");const o=B0(i.idToken);me(o,r,"internal-error");const{sub:a}=o;return me(n.uid===a,r,"user-mismatch"),ho._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Qn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sw(n,e,t=!1){if(vn(n.app))return Promise.reject(Br(n));const r="signIn",s=await rw(n,r,e),i=await ho._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function mO(n,e){return sw(ws(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iw(n){const e=ws(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function gO(n,e,t){if(vn(n.app))return Promise.reject(Br(n));const r=ws(n),o=await Kg(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",hO).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&iw(n),l}),a=await ho._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function pO(n,e,t){return vn(n.app)?Promise.reject(Br(n)):mO(Yt(n),Ua.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&iw(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yO(n,e){return Yr(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gT(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Yt(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await uo(r,yO(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function vO(n,e){return EO(Yt(n),null,e)}async function EO(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};t&&(i.password=t);const o=await uo(n,rO(r,i));await n._updateTokensIfNecessary(o,!0)}function TO(n,e,t,r){return Yt(n).onIdTokenChanged(e,t,r)}function SO(n,e,t){return Yt(n).beforeAuthStateChanged(e,t)}function _O(n,e,t,r){return Yt(n).onAuthStateChanged(e,t,r)}function xO(n){return Yt(n).signOut()}const zh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zh,"1"),this.storage.removeItem(zh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=1e3,AO=10;class aw extends ow{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=JA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);UN()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,AO):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},IO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}aw.type="LOCAL";const wO=aw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw extends ow{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}lw.type="SESSION";const uw=lw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Hd(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await RO(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G0(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=G0("",20);s.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(){return window}function LO(n){$r().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cw(){return typeof $r().WorkerGlobalScope<"u"&&typeof $r().importScripts=="function"}async function CO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function kO(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function PO(){return cw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw="firebaseLocalStorageDb",DO=1,Wh="firebaseLocalStorage",dw="fbase_key";class Uu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zd(n,e){return n.transaction([Wh],e?"readwrite":"readonly").objectStore(Wh)}function NO(){const n=indexedDB.deleteDatabase(hw);return new Uu(n).toPromise()}function Hg(){const n=indexedDB.open(hw,DO);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Wh,{keyPath:dw})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Wh)?e(r):(r.close(),await NO(),e(await Hg()))})})}async function pT(n,e,t){const r=zd(n,!0).put({[dw]:e,value:t});return new Uu(r).toPromise()}async function OO(n,e){const t=zd(n,!1).get(e),r=await new Uu(t).toPromise();return r===void 0?null:r.value}function yT(n,e){const t=zd(n,!0).delete(e);return new Uu(t).toPromise()}const MO=800,FO=3;class fw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Hg(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>FO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return cw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hd._getInstance(PO()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await CO(),!this.activeServiceWorker)return;this.sender=new bO(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||kO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Hg();return await pT(e,zh,"1"),await yT(e,zh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>pT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>OO(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>yT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=zd(s,!1).getAll();return new Uu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),MO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fw.type="LOCAL";const UO=fw;new Ou(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K0(n,e){return e?hs(e):(me(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0 extends V0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return oa(e,this._buildIdpRequest())}_linkToIdToken(e,t){return oa(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return oa(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function BO(n){return sw(n.auth,new H0(n),n.bypassAuthState)}function $O(n){const{auth:e,user:t}=n;return me(t,e,"internal-error"),fO(t,new H0(n),n.bypassAuthState)}async function VO(n){const{auth:e,user:t}=n;return me(t,e,"internal-error"),dO(t,new H0(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return BO;case"linkViaPopup":case"linkViaRedirect":return VO;case"reauthViaPopup":case"reauthViaRedirect":return $O;default:Qn(this.auth,"internal-error")}}resolve(e){Es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO=new Ou(2e3,1e4);async function GO(n,e,t){if(vn(n.app))return Promise.reject(fr(n,"operation-not-supported-in-this-environment"));const r=ws(n);BA(n,e,Kd);const s=K0(r,t);return new Yi(r,"signInViaPopup",e,s).executeNotNull()}class Yi extends mw{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Yi.currentPopupAction&&Yi.currentPopupAction.cancel(),Yi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return me(e,this.auth,"internal-error"),e}async onExecution(){Es(this.filter.length===1,"Popup operations only handle one event");const e=G0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(fr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(fr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,jO.get())};e()}}Yi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KO="pendingRedirect",Zc=new Map;class HO extends mw{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Zc.get(this.auth._key());if(!e){try{const r=await zO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Zc.set(this.auth._key(),e)}return this.bypassAuthState||Zc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function zO(n,e){const t=pw(e),r=gw(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function WO(n,e){return gw(n)._set(pw(e),"true")}function qO(n,e){Zc.set(n._key(),e)}function gw(n){return hs(n._redirectPersistence)}function pw(n){return Jc(KO,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YO(n,e,t){return QO(n,e,t)}async function QO(n,e,t){if(vn(n.app))return Promise.reject(Br(n));const r=ws(n);BA(n,e,Kd),await r._initializationPromise;const s=K0(r,t);return await WO(s,r),s._openRedirect(r,e,"signInViaRedirect")}async function XO(n,e,t=!1){if(vn(n.app))return Promise.reject(Br(n));const r=ws(n),s=K0(r,e),o=await new HO(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO=10*60*1e3;class ZO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!eM(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!yw(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(fr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=JO&&this.cachedEventUids.clear(),this.cachedEventUids.has(vT(e))}saveEventToCache(e){this.cachedEventUids.add(vT(e)),this.lastProcessedEventTime=Date.now()}}function vT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function yw({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function eM(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yw(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tM(n,e={}){return Yr(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rM=/^https?/;async function sM(n){if(n.config.emulator)return;const{authorizedDomains:e}=await tM(n);for(const t of e)try{if(iM(t))return}catch{}Qn(n,"unauthorized-domain")}function iM(n){const e=jg(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!rM.test(t))return!1;if(nM.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oM=new Ou(3e4,6e4);function ET(){const n=$r().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function aM(n){return new Promise((e,t)=>{var s,i,o;function r(){ET(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ET(),t(fr(n,"network-request-failed"))},timeout:oM.get()})}if((i=(s=$r().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=$r().gapi)!=null&&o.load)r();else{const a=WN("iframefcb");return $r()[a]=()=>{gapi.load?r():t(fr(n,"network-request-failed"))},ew(`${zN()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw eh=null,e})}let eh=null;function lM(n){return eh=eh||aM(n),eh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uM=new Ou(5e3,15e3),cM="__/auth/iframe",hM="emulator/auth/iframe",dM={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fM=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mM(n){const e=n.config;me(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?U0(e,hM):`https://${n.config.authDomain}/${cM}`,r={apiKey:e.apiKey,appName:n.name,v:Fa},s=fM.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Nu(r).slice(1)}`}async function gM(n){const e=await lM(n),t=$r().gapi;return me(t,n,"internal-error"),e.open({where:document.body,url:mM(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dM,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=fr(n,"network-request-failed"),a=$r().setTimeout(()=>{i(o)},uM.get());function l(){$r().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pM={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},yM=500,vM=600,EM="_blank",TM="http://localhost";class TT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function SM(n,e,t,r=yM,s=vM){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...pM,width:r.toString(),height:s.toString(),top:i,left:o},u=sn().toLowerCase();t&&(a=WA(u)?EM:t),HA(u)&&(e=e||TM,l.scrollbars="yes");const c=Object.entries(l).reduce((d,[m,g])=>`${d}${m}=${g},`,"");if(FN(u)&&a!=="_self")return _M(e||"",a),new TT(null);const h=window.open(e||"",a,c);me(h,n,"popup-blocked");try{h.focus()}catch{}return new TT(h)}function _M(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xM="__/auth/handler",IM="emulator/auth/handler",AM=encodeURIComponent("fac");async function ST(n,e,t,r,s,i){me(n.config.authDomain,n,"auth-domain-config-required"),me(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Fa,eventId:s};if(e instanceof Kd){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",sD(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))o[c]=h}if(e instanceof Fu){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];const l=await n._getAppCheckToken(),u=l?`#${AM}=${encodeURIComponent(l)}`:"";return`${wM(n)}?${Nu(a).slice(1)}${u}`}function wM({config:n}){return n.emulator?U0(n,IM):`https://${n.authDomain}/${xM}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const im="webStorageSupport";class RM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=uw,this._completeRedirectFn=XO,this._overrideRedirectResult=qO}async _openPopup(e,t,r,s){var o;Es((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await ST(e,t,r,jg(),s);return SM(e,i,G0())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await ST(e,t,r,jg(),s);return LO(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Es(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await gM(e),r=new ZO(e);return t.register("authEvent",s=>(me(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(im,{type:im},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[im];i!==void 0&&t(!!i),Qn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=sM(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return JA()||zA()||$0()}}const bM=RM;var _T="@firebase/auth",xT="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){me(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CM(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function kM(n){xa(new lo("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;me(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ZA(n)},u=new GN(r,s,i,l);return ZN(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),xa(new lo("auth-internal",e=>{const t=ws(e.getProvider("auth").getImmediate());return(r=>new LM(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ci(_T,xT,CM(n)),ci(_T,xT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=5*60,DM=LA("authIdTokenMaxAge")||PM;let IT=null;const NM=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>DM)return;const s=t==null?void 0:t.token;IT!==s&&(IT=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function OM(n=O0()){const e=N0(n,"auth");if(e.isInitialized())return e.getImmediate();const t=JN(n,{popupRedirectResolver:bM,persistence:[UO,wO,uw]}),r=LA("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=NM(i.toString());SO(t,o,()=>o(t.currentUser)),TO(t,a=>o(a))}}const s=RA("auth");return s&&eO(t,`http://${s}`),t}function MM(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}KN({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=fr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",MM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});kM("Browser");var AT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var hi,vw;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,x){function R(){}R.prototype=x.prototype,A.F=x.prototype,A.prototype=new R,A.prototype.constructor=A,A.D=function(b,C,M){for(var k=Array(arguments.length-2),re=2;re<arguments.length;re++)k[re-2]=arguments[re];return x.prototype[C].apply(b,k)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,x,R){R||(R=0);const b=Array(16);if(typeof x=="string")for(var C=0;C<16;++C)b[C]=x.charCodeAt(R++)|x.charCodeAt(R++)<<8|x.charCodeAt(R++)<<16|x.charCodeAt(R++)<<24;else for(C=0;C<16;++C)b[C]=x[R++]|x[R++]<<8|x[R++]<<16|x[R++]<<24;x=A.g[0],R=A.g[1],C=A.g[2];let M=A.g[3],k;k=x+(M^R&(C^M))+b[0]+3614090360&4294967295,x=R+(k<<7&4294967295|k>>>25),k=M+(C^x&(R^C))+b[1]+3905402710&4294967295,M=x+(k<<12&4294967295|k>>>20),k=C+(R^M&(x^R))+b[2]+606105819&4294967295,C=M+(k<<17&4294967295|k>>>15),k=R+(x^C&(M^x))+b[3]+3250441966&4294967295,R=C+(k<<22&4294967295|k>>>10),k=x+(M^R&(C^M))+b[4]+4118548399&4294967295,x=R+(k<<7&4294967295|k>>>25),k=M+(C^x&(R^C))+b[5]+1200080426&4294967295,M=x+(k<<12&4294967295|k>>>20),k=C+(R^M&(x^R))+b[6]+2821735955&4294967295,C=M+(k<<17&4294967295|k>>>15),k=R+(x^C&(M^x))+b[7]+4249261313&4294967295,R=C+(k<<22&4294967295|k>>>10),k=x+(M^R&(C^M))+b[8]+1770035416&4294967295,x=R+(k<<7&4294967295|k>>>25),k=M+(C^x&(R^C))+b[9]+2336552879&4294967295,M=x+(k<<12&4294967295|k>>>20),k=C+(R^M&(x^R))+b[10]+4294925233&4294967295,C=M+(k<<17&4294967295|k>>>15),k=R+(x^C&(M^x))+b[11]+2304563134&4294967295,R=C+(k<<22&4294967295|k>>>10),k=x+(M^R&(C^M))+b[12]+1804603682&4294967295,x=R+(k<<7&4294967295|k>>>25),k=M+(C^x&(R^C))+b[13]+4254626195&4294967295,M=x+(k<<12&4294967295|k>>>20),k=C+(R^M&(x^R))+b[14]+2792965006&4294967295,C=M+(k<<17&4294967295|k>>>15),k=R+(x^C&(M^x))+b[15]+1236535329&4294967295,R=C+(k<<22&4294967295|k>>>10),k=x+(C^M&(R^C))+b[1]+4129170786&4294967295,x=R+(k<<5&4294967295|k>>>27),k=M+(R^C&(x^R))+b[6]+3225465664&4294967295,M=x+(k<<9&4294967295|k>>>23),k=C+(x^R&(M^x))+b[11]+643717713&4294967295,C=M+(k<<14&4294967295|k>>>18),k=R+(M^x&(C^M))+b[0]+3921069994&4294967295,R=C+(k<<20&4294967295|k>>>12),k=x+(C^M&(R^C))+b[5]+3593408605&4294967295,x=R+(k<<5&4294967295|k>>>27),k=M+(R^C&(x^R))+b[10]+38016083&4294967295,M=x+(k<<9&4294967295|k>>>23),k=C+(x^R&(M^x))+b[15]+3634488961&4294967295,C=M+(k<<14&4294967295|k>>>18),k=R+(M^x&(C^M))+b[4]+3889429448&4294967295,R=C+(k<<20&4294967295|k>>>12),k=x+(C^M&(R^C))+b[9]+568446438&4294967295,x=R+(k<<5&4294967295|k>>>27),k=M+(R^C&(x^R))+b[14]+3275163606&4294967295,M=x+(k<<9&4294967295|k>>>23),k=C+(x^R&(M^x))+b[3]+4107603335&4294967295,C=M+(k<<14&4294967295|k>>>18),k=R+(M^x&(C^M))+b[8]+1163531501&4294967295,R=C+(k<<20&4294967295|k>>>12),k=x+(C^M&(R^C))+b[13]+2850285829&4294967295,x=R+(k<<5&4294967295|k>>>27),k=M+(R^C&(x^R))+b[2]+4243563512&4294967295,M=x+(k<<9&4294967295|k>>>23),k=C+(x^R&(M^x))+b[7]+1735328473&4294967295,C=M+(k<<14&4294967295|k>>>18),k=R+(M^x&(C^M))+b[12]+2368359562&4294967295,R=C+(k<<20&4294967295|k>>>12),k=x+(R^C^M)+b[5]+4294588738&4294967295,x=R+(k<<4&4294967295|k>>>28),k=M+(x^R^C)+b[8]+2272392833&4294967295,M=x+(k<<11&4294967295|k>>>21),k=C+(M^x^R)+b[11]+1839030562&4294967295,C=M+(k<<16&4294967295|k>>>16),k=R+(C^M^x)+b[14]+4259657740&4294967295,R=C+(k<<23&4294967295|k>>>9),k=x+(R^C^M)+b[1]+2763975236&4294967295,x=R+(k<<4&4294967295|k>>>28),k=M+(x^R^C)+b[4]+1272893353&4294967295,M=x+(k<<11&4294967295|k>>>21),k=C+(M^x^R)+b[7]+4139469664&4294967295,C=M+(k<<16&4294967295|k>>>16),k=R+(C^M^x)+b[10]+3200236656&4294967295,R=C+(k<<23&4294967295|k>>>9),k=x+(R^C^M)+b[13]+681279174&4294967295,x=R+(k<<4&4294967295|k>>>28),k=M+(x^R^C)+b[0]+3936430074&4294967295,M=x+(k<<11&4294967295|k>>>21),k=C+(M^x^R)+b[3]+3572445317&4294967295,C=M+(k<<16&4294967295|k>>>16),k=R+(C^M^x)+b[6]+76029189&4294967295,R=C+(k<<23&4294967295|k>>>9),k=x+(R^C^M)+b[9]+3654602809&4294967295,x=R+(k<<4&4294967295|k>>>28),k=M+(x^R^C)+b[12]+3873151461&4294967295,M=x+(k<<11&4294967295|k>>>21),k=C+(M^x^R)+b[15]+530742520&4294967295,C=M+(k<<16&4294967295|k>>>16),k=R+(C^M^x)+b[2]+3299628645&4294967295,R=C+(k<<23&4294967295|k>>>9),k=x+(C^(R|~M))+b[0]+4096336452&4294967295,x=R+(k<<6&4294967295|k>>>26),k=M+(R^(x|~C))+b[7]+1126891415&4294967295,M=x+(k<<10&4294967295|k>>>22),k=C+(x^(M|~R))+b[14]+2878612391&4294967295,C=M+(k<<15&4294967295|k>>>17),k=R+(M^(C|~x))+b[5]+4237533241&4294967295,R=C+(k<<21&4294967295|k>>>11),k=x+(C^(R|~M))+b[12]+1700485571&4294967295,x=R+(k<<6&4294967295|k>>>26),k=M+(R^(x|~C))+b[3]+2399980690&4294967295,M=x+(k<<10&4294967295|k>>>22),k=C+(x^(M|~R))+b[10]+4293915773&4294967295,C=M+(k<<15&4294967295|k>>>17),k=R+(M^(C|~x))+b[1]+2240044497&4294967295,R=C+(k<<21&4294967295|k>>>11),k=x+(C^(R|~M))+b[8]+1873313359&4294967295,x=R+(k<<6&4294967295|k>>>26),k=M+(R^(x|~C))+b[15]+4264355552&4294967295,M=x+(k<<10&4294967295|k>>>22),k=C+(x^(M|~R))+b[6]+2734768916&4294967295,C=M+(k<<15&4294967295|k>>>17),k=R+(M^(C|~x))+b[13]+1309151649&4294967295,R=C+(k<<21&4294967295|k>>>11),k=x+(C^(R|~M))+b[4]+4149444226&4294967295,x=R+(k<<6&4294967295|k>>>26),k=M+(R^(x|~C))+b[11]+3174756917&4294967295,M=x+(k<<10&4294967295|k>>>22),k=C+(x^(M|~R))+b[2]+718787259&4294967295,C=M+(k<<15&4294967295|k>>>17),k=R+(M^(C|~x))+b[9]+3951481745&4294967295,A.g[0]=A.g[0]+x&4294967295,A.g[1]=A.g[1]+(C+(k<<21&4294967295|k>>>11))&4294967295,A.g[2]=A.g[2]+C&4294967295,A.g[3]=A.g[3]+M&4294967295}r.prototype.v=function(A,x){x===void 0&&(x=A.length);const R=x-this.blockSize,b=this.C;let C=this.h,M=0;for(;M<x;){if(C==0)for(;M<=R;)s(this,A,M),M+=this.blockSize;if(typeof A=="string"){for(;M<x;)if(b[C++]=A.charCodeAt(M++),C==this.blockSize){s(this,b),C=0;break}}else for(;M<x;)if(b[C++]=A[M++],C==this.blockSize){s(this,b),C=0;break}}this.h=C,this.o+=x},r.prototype.A=function(){var A=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);A[0]=128;for(var x=1;x<A.length-8;++x)A[x]=0;x=this.o*8;for(var R=A.length-8;R<A.length;++R)A[R]=x&255,x/=256;for(this.v(A),A=Array(16),x=0,R=0;R<4;++R)for(let b=0;b<32;b+=8)A[x++]=this.g[R]>>>b&255;return A};function i(A,x){var R=a;return Object.prototype.hasOwnProperty.call(R,A)?R[A]:R[A]=x(A)}function o(A,x){this.h=x;const R=[];let b=!0;for(let C=A.length-1;C>=0;C--){const M=A[C]|0;b&&M==x||(R[C]=M,b=!1)}this.g=R}var a={};function l(A){return-128<=A&&A<128?i(A,function(x){return new o([x|0],x<0?-1:0)}):new o([A|0],A<0?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return h;if(A<0)return v(u(-A));const x=[];let R=1;for(let b=0;A>=R;b++)x[b]=A/R|0,R*=4294967296;return new o(x,0)}function c(A,x){if(A.length==0)throw Error("number format error: empty string");if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(A.charAt(0)=="-")return v(c(A.substring(1),x));if(A.indexOf("-")>=0)throw Error('number format error: interior "-" character');const R=u(Math.pow(x,8));let b=h;for(let M=0;M<A.length;M+=8){var C=Math.min(8,A.length-M);const k=parseInt(A.substring(M,M+C),x);C<8?(C=u(Math.pow(x,C)),b=b.j(C).add(u(k))):(b=b.j(R),b=b.add(u(k)))}return b}var h=l(0),d=l(1),m=l(16777216);n=o.prototype,n.m=function(){if(y(this))return-v(this).m();let A=0,x=1;for(let R=0;R<this.g.length;R++){const b=this.i(R);A+=(b>=0?b:4294967296+b)*x,x*=4294967296}return A},n.toString=function(A){if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(g(this))return"0";if(y(this))return"-"+v(this).toString(A);const x=u(Math.pow(A,6));var R=this;let b="";for(;;){const C=L(R,x).g;R=E(R,C.j(x));let M=((R.g.length>0?R.g[0]:R.h)>>>0).toString(A);if(R=C,g(R))return M+b;for(;M.length<6;)M="0"+M;b=M+b}},n.i=function(A){return A<0?0:A<this.g.length?this.g[A]:this.h};function g(A){if(A.h!=0)return!1;for(let x=0;x<A.g.length;x++)if(A.g[x]!=0)return!1;return!0}function y(A){return A.h==-1}n.l=function(A){return A=E(this,A),y(A)?-1:g(A)?0:1};function v(A){const x=A.g.length,R=[];for(let b=0;b<x;b++)R[b]=~A.g[b];return new o(R,~A.h).add(d)}n.abs=function(){return y(this)?v(this):this},n.add=function(A){const x=Math.max(this.g.length,A.g.length),R=[];let b=0;for(let C=0;C<=x;C++){let M=b+(this.i(C)&65535)+(A.i(C)&65535),k=(M>>>16)+(this.i(C)>>>16)+(A.i(C)>>>16);b=k>>>16,M&=65535,k&=65535,R[C]=k<<16|M}return new o(R,R[R.length-1]&-2147483648?-1:0)};function E(A,x){return A.add(v(x))}n.j=function(A){if(g(this)||g(A))return h;if(y(this))return y(A)?v(this).j(v(A)):v(v(this).j(A));if(y(A))return v(this.j(v(A)));if(this.l(m)<0&&A.l(m)<0)return u(this.m()*A.m());const x=this.g.length+A.g.length,R=[];for(var b=0;b<2*x;b++)R[b]=0;for(b=0;b<this.g.length;b++)for(let C=0;C<A.g.length;C++){const M=this.i(b)>>>16,k=this.i(b)&65535,re=A.i(C)>>>16,te=A.i(C)&65535;R[2*b+2*C]+=k*te,p(R,2*b+2*C),R[2*b+2*C+1]+=M*te,p(R,2*b+2*C+1),R[2*b+2*C+1]+=k*re,p(R,2*b+2*C+1),R[2*b+2*C+2]+=M*re,p(R,2*b+2*C+2)}for(A=0;A<x;A++)R[A]=R[2*A+1]<<16|R[2*A];for(A=x;A<2*x;A++)R[A]=0;return new o(R,0)};function p(A,x){for(;(A[x]&65535)!=A[x];)A[x+1]+=A[x]>>>16,A[x]&=65535,x++}function S(A,x){this.g=A,this.h=x}function L(A,x){if(g(x))throw Error("division by zero");if(g(A))return new S(h,h);if(y(A))return x=L(v(A),x),new S(v(x.g),v(x.h));if(y(x))return x=L(A,v(x)),new S(v(x.g),x.h);if(A.g.length>30){if(y(A)||y(x))throw Error("slowDivide_ only works with positive integers.");for(var R=d,b=x;b.l(A)<=0;)R=D(R),b=D(b);var C=F(R,1),M=F(b,1);for(b=F(b,2),R=F(R,2);!g(b);){var k=M.add(b);k.l(A)<=0&&(C=C.add(R),M=k),b=F(b,1),R=F(R,1)}return x=E(A,C.j(x)),new S(C,x)}for(C=h;A.l(x)>=0;){for(R=Math.max(1,Math.floor(A.m()/x.m())),b=Math.ceil(Math.log(R)/Math.LN2),b=b<=48?1:Math.pow(2,b-48),M=u(R),k=M.j(x);y(k)||k.l(A)>0;)R-=b,M=u(R),k=M.j(x);g(M)&&(M=d),C=C.add(M),A=E(A,k)}return new S(C,A)}n.B=function(A){return L(this,A).h},n.and=function(A){const x=Math.max(this.g.length,A.g.length),R=[];for(let b=0;b<x;b++)R[b]=this.i(b)&A.i(b);return new o(R,this.h&A.h)},n.or=function(A){const x=Math.max(this.g.length,A.g.length),R=[];for(let b=0;b<x;b++)R[b]=this.i(b)|A.i(b);return new o(R,this.h|A.h)},n.xor=function(A){const x=Math.max(this.g.length,A.g.length),R=[];for(let b=0;b<x;b++)R[b]=this.i(b)^A.i(b);return new o(R,this.h^A.h)};function D(A){const x=A.g.length+1,R=[];for(let b=0;b<x;b++)R[b]=A.i(b)<<1|A.i(b-1)>>>31;return new o(R,A.h)}function F(A,x){const R=x>>5;x%=32;const b=A.g.length-R,C=[];for(let M=0;M<b;M++)C[M]=x>0?A.i(M+R)>>>x|A.i(M+R+1)<<32-x:A.i(M+R);return new o(C,A.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,vw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=c,hi=o}).apply(typeof AT<"u"?AT:typeof self<"u"?self:typeof window<"u"?window:{});var yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ew,El,Tw,th,zg,Sw,_w,xw;(function(){var n,e=Object.defineProperty;function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof yc=="object"&&yc];for(var T=0;T<f.length;++T){var I=f[T];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var r=t(this);function s(f,T){if(T)e:{var I=r;f=f.split(".");for(var P=0;P<f.length-1;P++){var G=f[P];if(!(G in I))break e;I=I[G]}f=f[f.length-1],P=I[f],T=T(P),T!=P&&T!=null&&e(I,f,{configurable:!0,writable:!0,value:T})}}s("Symbol.dispose",function(f){return f||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(f){return f||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(f){return f||function(T){var I=[],P;for(P in T)Object.prototype.hasOwnProperty.call(T,P)&&I.push([P,T[P]]);return I}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(f){var T=typeof f;return T=="object"&&f!=null||T=="function"}function l(f,T,I){return f.call.apply(f.bind,arguments)}function u(f,T,I){return u=l,u.apply(null,arguments)}function c(f,T){var I=Array.prototype.slice.call(arguments,1);return function(){var P=I.slice();return P.push.apply(P,arguments),f.apply(this,P)}}function h(f,T){function I(){}I.prototype=T.prototype,f.Z=T.prototype,f.prototype=new I,f.prototype.constructor=f,f.Ob=function(P,G,z){for(var ie=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)ie[xe-2]=arguments[xe];return T.prototype[G].apply(P,ie)}}var d=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?f=>f&&AsyncContext.Snapshot.wrap(f):f=>f;function m(f){const T=f.length;if(T>0){const I=Array(T);for(let P=0;P<T;P++)I[P]=f[P];return I}return[]}function g(f,T){for(let P=1;P<arguments.length;P++){const G=arguments[P];var I=typeof G;if(I=I!="object"?I:G?Array.isArray(G)?"array":I:"null",I=="array"||I=="object"&&typeof G.length=="number"){I=f.length||0;const z=G.length||0;f.length=I+z;for(let ie=0;ie<z;ie++)f[I+ie]=G[ie]}else f.push(G)}}class y{constructor(T,I){this.i=T,this.j=I,this.h=0,this.g=null}get(){let T;return this.h>0?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function v(f){o.setTimeout(()=>{throw f},0)}function E(){var f=A;let T=null;return f.g&&(T=f.g,f.g=f.g.next,f.g||(f.h=null),T.next=null),T}class p{constructor(){this.h=this.g=null}add(T,I){const P=S.get();P.set(T,I),this.h?this.h.next=P:this.g=P,this.h=P}}var S=new y(()=>new L,f=>f.reset());class L{constructor(){this.next=this.g=this.h=null}set(T,I){this.h=T,this.g=I,this.next=null}reset(){this.next=this.g=this.h=null}}let D,F=!1,A=new p,x=()=>{const f=Promise.resolve(void 0);D=()=>{f.then(R)}};function R(){for(var f;f=E();){try{f.h.call(f.g)}catch(I){v(I)}var T=S;T.j(f),T.h<100&&(T.h++,f.next=T.g,T.g=f)}F=!1}function b(){this.u=this.u,this.C=this.C}b.prototype.u=!1,b.prototype.dispose=function(){this.u||(this.u=!0,this.N())},b.prototype[Symbol.dispose]=function(){this.dispose()},b.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function C(f,T){this.type=f,this.g=this.target=T,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var f=!1,T=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const I=()=>{};o.addEventListener("test",I,T),o.removeEventListener("test",I,T)}catch{}return f}();function k(f){return/^[\s\xa0]*$/.test(f)}function re(f,T){C.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f&&this.init(f,T)}h(re,C),re.prototype.init=function(f,T){const I=this.type=f.type,P=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;this.target=f.target||f.srcElement,this.g=T,T=f.relatedTarget,T||(I=="mouseover"?T=f.fromElement:I=="mouseout"&&(T=f.toElement)),this.relatedTarget=T,P?(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=f.pointerType,this.state=f.state,this.i=f,f.defaultPrevented&&re.Z.h.call(this)},re.prototype.h=function(){re.Z.h.call(this);const f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var te="closure_listenable_"+(Math.random()*1e6|0),J=0;function W(f,T,I,P,G){this.listener=f,this.proxy=null,this.src=T,this.type=I,this.capture=!!P,this.ha=G,this.key=++J,this.da=this.fa=!1}function U(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function H(f,T,I){for(const P in f)T.call(I,f[P],P,f)}function N(f,T){for(const I in f)T.call(void 0,f[I],I,f)}function B(f){const T={};for(const I in f)T[I]=f[I];return T}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function K(f,T){let I,P;for(let G=1;G<arguments.length;G++){P=arguments[G];for(I in P)f[I]=P[I];for(let z=0;z<O.length;z++)I=O[z],Object.prototype.hasOwnProperty.call(P,I)&&(f[I]=P[I])}}function Q(f){this.src=f,this.g={},this.h=0}Q.prototype.add=function(f,T,I,P,G){const z=f.toString();f=this.g[z],f||(f=this.g[z]=[],this.h++);const ie=ee(f,T,P,G);return ie>-1?(T=f[ie],I||(T.fa=!1)):(T=new W(T,this.src,z,!!P,G),T.fa=I,f.push(T)),T};function Y(f,T){const I=T.type;if(I in f.g){var P=f.g[I],G=Array.prototype.indexOf.call(P,T,void 0),z;(z=G>=0)&&Array.prototype.splice.call(P,G,1),z&&(U(T),f.g[I].length==0&&(delete f.g[I],f.h--))}}function ee(f,T,I,P){for(let G=0;G<f.length;++G){const z=f[G];if(!z.da&&z.listener==T&&z.capture==!!I&&z.ha==P)return G}return-1}var de="closure_lm_"+(Math.random()*1e6|0),Ae={};function _e(f,T,I,P,G){if(Array.isArray(T)){for(let z=0;z<T.length;z++)_e(f,T[z],I,P,G);return null}return I=Tt(I),f&&f[te]?f.J(T,I,a(P)?!!P.capture:!1,G):st(f,T,I,!1,P,G)}function st(f,T,I,P,G,z){if(!T)throw Error("Invalid event type");const ie=a(G)?!!G.capture:!!G;let xe=Ee(f);if(xe||(f[de]=xe=new Q(f)),I=xe.add(T,I,P,ie,z),I.proxy)return I;if(P=Fe(),I.proxy=P,P.src=f,P.listener=I,f.addEventListener)M||(G=ie),G===void 0&&(G=!1),f.addEventListener(T.toString(),P,G);else if(f.attachEvent)f.attachEvent(wn(T.toString()),P);else if(f.addListener&&f.removeListener)f.addListener(P);else throw Error("addEventListener and attachEvent are unavailable.");return I}function Fe(){function f(I){return T.call(f.src,f.listener,I)}const T=Ga;return f}function on(f,T,I,P,G){if(Array.isArray(T))for(var z=0;z<T.length;z++)on(f,T[z],I,P,G);else P=a(P)?!!P.capture:!!P,I=Tt(I),f&&f[te]?(f=f.i,z=String(T).toString(),z in f.g&&(T=f.g[z],I=ee(T,I,P,G),I>-1&&(U(T[I]),Array.prototype.splice.call(T,I,1),T.length==0&&(delete f.g[z],f.h--)))):f&&(f=Ee(f))&&(T=f.g[T.toString()],f=-1,T&&(f=ee(T,I,P,G)),(I=f>-1?T[f]:null)&&An(I))}function An(f){if(typeof f!="number"&&f&&!f.da){var T=f.src;if(T&&T[te])Y(T.i,f);else{var I=f.type,P=f.proxy;T.removeEventListener?T.removeEventListener(I,P,f.capture):T.detachEvent?T.detachEvent(wn(I),P):T.addListener&&T.removeListener&&T.removeListener(P),(I=Ee(T))?(Y(I,f),I.h==0&&(I.src=null,T[de]=null)):U(f)}}}function wn(f){return f in Ae?Ae[f]:Ae[f]="on"+f}function Ga(f,T){if(f.da)f=!0;else{T=new re(T,this);const I=f.listener,P=f.ha||f.src;f.fa&&An(f),f=I.call(P,T)}return f}function Ee(f){return f=f[de],f instanceof Q?f:null}var we="__closure_events_fn_"+(Math.random()*1e9>>>0);function Tt(f){return typeof f=="function"?f:(f[we]||(f[we]=function(T){return f.handleEvent(T)}),f[we])}function Ne(){b.call(this),this.i=new Q(this),this.M=this,this.G=null}h(Ne,b),Ne.prototype[te]=!0,Ne.prototype.removeEventListener=function(f,T,I,P){on(this,f,T,I,P)};function $e(f,T){var I,P=f.G;if(P)for(I=[];P;P=P.G)I.push(P);if(f=f.M,P=T.type||T,typeof T=="string")T=new C(T,f);else if(T instanceof C)T.target=T.target||f;else{var G=T;T=new C(P,f),K(T,G)}G=!0;let z,ie;if(I)for(ie=I.length-1;ie>=0;ie--)z=T.g=I[ie],G=an(z,P,!0,T)&&G;if(z=T.g=f,G=an(z,P,!0,T)&&G,G=an(z,P,!1,T)&&G,I)for(ie=0;ie<I.length;ie++)z=T.g=I[ie],G=an(z,P,!1,T)&&G}Ne.prototype.N=function(){if(Ne.Z.N.call(this),this.i){var f=this.i;for(const T in f.g){const I=f.g[T];for(let P=0;P<I.length;P++)U(I[P]);delete f.g[T],f.h--}}this.G=null},Ne.prototype.J=function(f,T,I,P){return this.i.add(String(f),T,!1,I,P)},Ne.prototype.K=function(f,T,I,P){return this.i.add(String(f),T,!0,I,P)};function an(f,T,I,P){if(T=f.i.g[String(T)],!T)return!0;T=T.concat();let G=!0;for(let z=0;z<T.length;++z){const ie=T[z];if(ie&&!ie.da&&ie.capture==I){const xe=ie.listener,wt=ie.ha||ie.src;ie.fa&&Y(f.i,ie),G=xe.call(wt,P)!==!1&&G}}return G&&!P.defaultPrevented}function Zn(f,T){if(typeof f!="function")if(f&&typeof f.handleEvent=="function")f=u(f.handleEvent,f);else throw Error("Invalid listener argument");return Number(T)>2147483647?-1:o.setTimeout(f,T||0)}function St(f){f.g=Zn(()=>{f.g=null,f.i&&(f.i=!1,St(f))},f.l);const T=f.h;f.h=null,f.m.apply(null,T)}class er extends b{constructor(T,I){super(),this.m=T,this.l=I,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:St(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pr(f){b.call(this),this.h=f,this.g={}}h(pr,b);var Rn=[];function Qr(f){H(f.g,function(T,I){this.g.hasOwnProperty(I)&&An(T)},f),f.g={}}pr.prototype.N=function(){pr.Z.N.call(this),Qr(this)},pr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yr=o.JSON.stringify,Ci=o.JSON.parse,Xr=class{stringify(f){return o.JSON.stringify(f,void 0)}parse(f){return o.JSON.parse(f,void 0)}};function Vn(){}function Ka(){}var Rs={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function xo(){C.call(this,"d")}h(xo,C);function Io(){C.call(this,"c")}h(Io,C);var se={},He=null;function Ue(){return He=He||new Ne}se.Ia="serverreachability";function dt(f){C.call(this,se.Ia,f)}h(dt,C);function Ve(f){const T=Ue();$e(T,new dt(T))}se.STAT_EVENT="statevent";function pt(f,T){C.call(this,se.STAT_EVENT,f),this.stat=T}h(pt,C);function Xe(f){const T=Ue();$e(T,new pt(T,f))}se.Ja="timingevent";function Bt(f,T){C.call(this,se.Ja,f),this.size=T}h(Bt,C);function Oe(f,T){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){f()},T)}function Me(){this.g=!0}Me.prototype.ua=function(){this.g=!1};function ki(f,T,I,P,G,z){f.info(function(){if(f.g)if(z){var ie="",xe=z.split("&");for(let We=0;We<xe.length;We++){var wt=xe[We].split("=");if(wt.length>1){const Nt=wt[0];wt=wt[1];const Er=Nt.split("_");ie=Er.length>=2&&Er[1]=="type"?ie+(Nt+"="+wt+"&"):ie+(Nt+"=redacted&")}}}else ie=null;else ie=z;return"XMLHTTP REQ ("+P+") [attempt "+G+"]: "+T+`
`+I+`
`+ie})}function bs(f,T,I,P,G,z,ie){f.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+G+"]: "+T+`
`+I+`
`+z+" "+ie})}function Jr(f,T,I,P){f.info(function(){return"XMLHTTP TEXT ("+T+"): "+Pi(f,I)+(P?" "+P:"")})}function Ha(f,T){f.info(function(){return"TIMEOUT: "+T})}Me.prototype.info=function(){};function Pi(f,T){if(!f.g)return T;if(!T)return null;try{const z=JSON.parse(T);if(z){for(f=0;f<z.length;f++)if(Array.isArray(z[f])){var I=z[f];if(!(I.length<2)){var P=I[1];if(Array.isArray(P)&&!(P.length<1)){var G=P[0];if(G!="noop"&&G!="stop"&&G!="close")for(let ie=1;ie<P.length;ie++)P[ie]=""}}}}return yr(z)}catch{return T}}var Di={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},zy={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Wy;function df(){}h(df,Vn),df.prototype.g=function(){return new XMLHttpRequest},Wy=new df;function za(f){return encodeURIComponent(String(f))}function FL(f){var T=1;f=f.split(":");const I=[];for(;T>0&&f.length;)I.push(f.shift()),T--;return f.length&&I.push(f.join(":")),I}function Ls(f,T,I,P){this.j=f,this.i=T,this.l=I,this.S=P||1,this.V=new pr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qy}function qy(){this.i=null,this.g="",this.h=!1}var Yy={},ff={};function mf(f,T,I){f.M=1,f.A=Hu(vr(T)),f.u=I,f.R=!0,Qy(f,null)}function Qy(f,T){f.F=Date.now(),Ku(f),f.B=vr(f.A);var I=f.B,P=f.S;Array.isArray(P)||(P=[String(P)]),uv(I.i,"t",P),f.C=0,I=f.j.L,f.h=new qy,f.g=Rv(f.j,I?T:null,!f.u),f.P>0&&(f.O=new er(u(f.Y,f,f.g),f.P)),T=f.V,I=f.g,P=f.ba;var G="readystatechange";Array.isArray(G)||(G&&(Rn[0]=G.toString()),G=Rn);for(let z=0;z<G.length;z++){const ie=_e(I,G[z],P||T.handleEvent,!1,T.h||T);if(!ie)break;T.g[ie.key]=ie}T=f.J?B(f.J):{},f.u?(f.v||(f.v="POST"),T["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.B,f.v,f.u,T)):(f.v="GET",f.g.ea(f.B,f.v,null,T)),Ve(),ki(f.i,f.v,f.B,f.l,f.S,f.u)}Ls.prototype.ba=function(f){f=f.target;const T=this.O;T&&Ps(f)==3?T.j():this.Y(f)},Ls.prototype.Y=function(f){try{if(f==this.g)e:{const xe=Ps(this.g),wt=this.g.ya(),We=this.g.ca();if(!(xe<3)&&(xe!=3||this.g&&(this.h.h||this.g.la()||pv(this.g)))){this.K||xe!=4||wt==7||(wt==8||We<=0?Ve(3):Ve(2)),gf(this);var T=this.g.ca();this.X=T;var I=UL(this);if(this.o=T==200,bs(this.i,this.v,this.B,this.l,this.S,xe,T),this.o){if(this.U&&!this.L){t:{if(this.g){var P,G=this.g;if((P=G.g?G.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(P)){var z=P;break t}}z=null}if(f=z)Jr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,pf(this,f);else{this.o=!1,this.m=3,Xe(12),Ni(this),Wa(this);break e}}if(this.R){f=!0;let Nt;for(;!this.K&&this.C<I.length;)if(Nt=BL(this,I),Nt==ff){xe==4&&(this.m=4,Xe(14),f=!1),Jr(this.i,this.l,null,"[Incomplete Response]");break}else if(Nt==Yy){this.m=4,Xe(15),Jr(this.i,this.l,I,"[Invalid Chunk]"),f=!1;break}else Jr(this.i,this.l,Nt,null),pf(this,Nt);if(Xy(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),xe!=4||I.length!=0||this.h.h||(this.m=1,Xe(16),f=!1),this.o=this.o&&f,!f)Jr(this.i,this.l,I,"[Invalid Chunked Response]"),Ni(this),Wa(this);else if(I.length>0&&!this.W){this.W=!0;var ie=this.j;ie.g==this&&ie.aa&&!ie.P&&(ie.j.info("Great, no buffering proxy detected. Bytes received: "+I.length),If(ie),ie.P=!0,Xe(11))}}else Jr(this.i,this.l,I,null),pf(this,I);xe==4&&Ni(this),this.o&&!this.K&&(xe==4?xv(this.j,this):(this.o=!1,Ku(this)))}else ZL(this.g),T==400&&I.indexOf("Unknown SID")>0?(this.m=3,Xe(12)):(this.m=0,Xe(13)),Ni(this),Wa(this)}}}catch{}finally{}};function UL(f){if(!Xy(f))return f.g.la();const T=pv(f.g);if(T==="")return"";let I="";const P=T.length,G=Ps(f.g)==4;if(!f.h.i){if(typeof TextDecoder>"u")return Ni(f),Wa(f),"";f.h.i=new o.TextDecoder}for(let z=0;z<P;z++)f.h.h=!0,I+=f.h.i.decode(T[z],{stream:!(G&&z==P-1)});return T.length=0,f.h.g+=I,f.C=0,f.h.g}function Xy(f){return f.g?f.v=="GET"&&f.M!=2&&f.j.Aa:!1}function BL(f,T){var I=f.C,P=T.indexOf(`
`,I);return P==-1?ff:(I=Number(T.substring(I,P)),isNaN(I)?Yy:(P+=1,P+I>T.length?ff:(T=T.slice(P,P+I),f.C=P+I,T)))}Ls.prototype.cancel=function(){this.K=!0,Ni(this)};function Ku(f){f.T=Date.now()+f.H,Jy(f,f.H)}function Jy(f,T){if(f.D!=null)throw Error("WatchDog timer not null");f.D=Oe(u(f.aa,f),T)}function gf(f){f.D&&(o.clearTimeout(f.D),f.D=null)}Ls.prototype.aa=function(){this.D=null;const f=Date.now();f-this.T>=0?(Ha(this.i,this.B),this.M!=2&&(Ve(),Xe(17)),Ni(this),this.m=2,Wa(this)):Jy(this,this.T-f)};function Wa(f){f.j.I==0||f.K||xv(f.j,f)}function Ni(f){gf(f);var T=f.O;T&&typeof T.dispose=="function"&&T.dispose(),f.O=null,Qr(f.V),f.g&&(T=f.g,f.g=null,T.abort(),T.dispose())}function pf(f,T){try{var I=f.j;if(I.I!=0&&(I.g==f||yf(I.h,f))){if(!f.L&&yf(I.h,f)&&I.I==3){try{var P=I.Ba.g.parse(T)}catch{P=null}if(Array.isArray(P)&&P.length==3){var G=P;if(G[0]==0){e:if(!I.v){if(I.g)if(I.g.F+3e3<f.F)Qu(I),qu(I);else break e;xf(I),Xe(18)}}else I.xa=G[1],0<I.xa-I.K&&G[2]<37500&&I.F&&I.A==0&&!I.C&&(I.C=Oe(u(I.Va,I),6e3));tv(I.h)<=1&&I.ta&&(I.ta=void 0)}else Mi(I,11)}else if((f.L||I.g==f)&&Qu(I),!k(T))for(G=I.Ba.g.parse(T),T=0;T<G.length;T++){let We=G[T];const Nt=We[0];if(!(Nt<=I.K))if(I.K=Nt,We=We[1],I.I==2)if(We[0]=="c"){I.M=We[1],I.ba=We[2];const Er=We[3];Er!=null&&(I.ka=Er,I.j.info("VER="+I.ka));const Fi=We[4];Fi!=null&&(I.za=Fi,I.j.info("SVER="+I.za));const Ds=We[5];Ds!=null&&typeof Ds=="number"&&Ds>0&&(P=1.5*Ds,I.O=P,I.j.info("backChannelRequestTimeoutMs_="+P)),P=I;const Ns=f.g;if(Ns){const Ju=Ns.g?Ns.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ju){var z=P.h;z.g||Ju.indexOf("spdy")==-1&&Ju.indexOf("quic")==-1&&Ju.indexOf("h2")==-1||(z.j=z.l,z.g=new Set,z.h&&(vf(z,z.h),z.h=null))}if(P.G){const Af=Ns.g?Ns.g.getResponseHeader("X-HTTP-Session-Id"):null;Af&&(P.wa=Af,Je(P.J,P.G,Af))}}I.I=3,I.l&&I.l.ra(),I.aa&&(I.T=Date.now()-f.F,I.j.info("Handshake RTT: "+I.T+"ms")),P=I;var ie=f;if(P.na=wv(P,P.L?P.ba:null,P.W),ie.L){nv(P.h,ie);var xe=ie,wt=P.O;wt&&(xe.H=wt),xe.D&&(gf(xe),Ku(xe)),P.g=ie}else Sv(P);I.i.length>0&&Yu(I)}else We[0]!="stop"&&We[0]!="close"||Mi(I,7);else I.I==3&&(We[0]=="stop"||We[0]=="close"?We[0]=="stop"?Mi(I,7):_f(I):We[0]!="noop"&&I.l&&I.l.qa(We),I.A=0)}}Ve(4)}catch{}}var $L=class{constructor(f,T){this.g=f,this.map=T}};function Zy(f){this.l=f||10,o.PerformanceNavigationTiming?(f=o.performance.getEntriesByType("navigation"),f=f.length>0&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ev(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function tv(f){return f.h?1:f.g?f.g.size:0}function yf(f,T){return f.h?f.h==T:f.g?f.g.has(T):!1}function vf(f,T){f.g?f.g.add(T):f.h=T}function nv(f,T){f.h&&f.h==T?f.h=null:f.g&&f.g.has(T)&&f.g.delete(T)}Zy.prototype.cancel=function(){if(this.i=rv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function rv(f){if(f.h!=null)return f.i.concat(f.h.G);if(f.g!=null&&f.g.size!==0){let T=f.i;for(const I of f.g.values())T=T.concat(I.G);return T}return m(f.i)}var sv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function VL(f,T){if(f){f=f.split("&");for(let I=0;I<f.length;I++){const P=f[I].indexOf("=");let G,z=null;P>=0?(G=f[I].substring(0,P),z=f[I].substring(P+1)):G=f[I],T(G,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function Cs(f){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let T;f instanceof Cs?(this.l=f.l,qa(this,f.j),this.o=f.o,this.g=f.g,Ya(this,f.u),this.h=f.h,Ef(this,cv(f.i)),this.m=f.m):f&&(T=String(f).match(sv))?(this.l=!1,qa(this,T[1]||"",!0),this.o=Qa(T[2]||""),this.g=Qa(T[3]||"",!0),Ya(this,T[4]),this.h=Qa(T[5]||"",!0),Ef(this,T[6]||"",!0),this.m=Qa(T[7]||"")):(this.l=!1,this.i=new Ja(null,this.l))}Cs.prototype.toString=function(){const f=[];var T=this.j;T&&f.push(Xa(T,iv,!0),":");var I=this.g;return(I||T=="file")&&(f.push("//"),(T=this.o)&&f.push(Xa(T,iv,!0),"@"),f.push(za(I).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I=this.u,I!=null&&f.push(":",String(I))),(I=this.h)&&(this.g&&I.charAt(0)!="/"&&f.push("/"),f.push(Xa(I,I.charAt(0)=="/"?KL:GL,!0))),(I=this.i.toString())&&f.push("?",I),(I=this.m)&&f.push("#",Xa(I,zL)),f.join("")},Cs.prototype.resolve=function(f){const T=vr(this);let I=!!f.j;I?qa(T,f.j):I=!!f.o,I?T.o=f.o:I=!!f.g,I?T.g=f.g:I=f.u!=null;var P=f.h;if(I)Ya(T,f.u);else if(I=!!f.h){if(P.charAt(0)!="/")if(this.g&&!this.h)P="/"+P;else{var G=T.h.lastIndexOf("/");G!=-1&&(P=T.h.slice(0,G+1)+P)}if(G=P,G==".."||G==".")P="";else if(G.indexOf("./")!=-1||G.indexOf("/.")!=-1){P=G.lastIndexOf("/",0)==0,G=G.split("/");const z=[];for(let ie=0;ie<G.length;){const xe=G[ie++];xe=="."?P&&ie==G.length&&z.push(""):xe==".."?((z.length>1||z.length==1&&z[0]!="")&&z.pop(),P&&ie==G.length&&z.push("")):(z.push(xe),P=!0)}P=z.join("/")}else P=G}return I?T.h=P:I=f.i.toString()!=="",I?Ef(T,cv(f.i)):I=!!f.m,I&&(T.m=f.m),T};function vr(f){return new Cs(f)}function qa(f,T,I){f.j=I?Qa(T,!0):T,f.j&&(f.j=f.j.replace(/:$/,""))}function Ya(f,T){if(T){if(T=Number(T),isNaN(T)||T<0)throw Error("Bad port number "+T);f.u=T}else f.u=null}function Ef(f,T,I){T instanceof Ja?(f.i=T,WL(f.i,f.l)):(I||(T=Xa(T,HL)),f.i=new Ja(T,f.l))}function Je(f,T,I){f.i.set(T,I)}function Hu(f){return Je(f,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),f}function Qa(f,T){return f?T?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Xa(f,T,I){return typeof f=="string"?(f=encodeURI(f).replace(T,jL),I&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function jL(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var iv=/[#\/\?@]/g,GL=/[#\?:]/g,KL=/[#\?]/g,HL=/[#\?@]/g,zL=/#/g;function Ja(f,T){this.h=this.g=null,this.i=f||null,this.j=!!T}function Oi(f){f.g||(f.g=new Map,f.h=0,f.i&&VL(f.i,function(T,I){f.add(decodeURIComponent(T.replace(/\+/g," ")),I)}))}n=Ja.prototype,n.add=function(f,T){Oi(this),this.i=null,f=Ao(this,f);let I=this.g.get(f);return I||this.g.set(f,I=[]),I.push(T),this.h+=1,this};function ov(f,T){Oi(f),T=Ao(f,T),f.g.has(T)&&(f.i=null,f.h-=f.g.get(T).length,f.g.delete(T))}function av(f,T){return Oi(f),T=Ao(f,T),f.g.has(T)}n.forEach=function(f,T){Oi(this),this.g.forEach(function(I,P){I.forEach(function(G){f.call(T,G,P,this)},this)},this)};function lv(f,T){Oi(f);let I=[];if(typeof T=="string")av(f,T)&&(I=I.concat(f.g.get(Ao(f,T))));else for(f=Array.from(f.g.values()),T=0;T<f.length;T++)I=I.concat(f[T]);return I}n.set=function(f,T){return Oi(this),this.i=null,f=Ao(this,f),av(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[T]),this.h+=1,this},n.get=function(f,T){return f?(f=lv(this,f),f.length>0?String(f[0]):T):T};function uv(f,T,I){ov(f,T),I.length>0&&(f.i=null,f.g.set(Ao(f,T),m(I)),f.h+=I.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],T=Array.from(this.g.keys());for(let P=0;P<T.length;P++){var I=T[P];const G=za(I);I=lv(this,I);for(let z=0;z<I.length;z++){let ie=G;I[z]!==""&&(ie+="="+za(I[z])),f.push(ie)}}return this.i=f.join("&")};function cv(f){const T=new Ja;return T.i=f.i,f.g&&(T.g=new Map(f.g),T.h=f.h),T}function Ao(f,T){return T=String(T),f.j&&(T=T.toLowerCase()),T}function WL(f,T){T&&!f.j&&(Oi(f),f.i=null,f.g.forEach(function(I,P){const G=P.toLowerCase();P!=G&&(ov(this,P),uv(this,G,I))},f)),f.j=T}function qL(f,T){const I=new Me;if(o.Image){const P=new Image;P.onload=c(ks,I,"TestLoadImage: loaded",!0,T,P),P.onerror=c(ks,I,"TestLoadImage: error",!1,T,P),P.onabort=c(ks,I,"TestLoadImage: abort",!1,T,P),P.ontimeout=c(ks,I,"TestLoadImage: timeout",!1,T,P),o.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=f}else T(!1)}function YL(f,T){const I=new Me,P=new AbortController,G=setTimeout(()=>{P.abort(),ks(I,"TestPingServer: timeout",!1,T)},1e4);fetch(f,{signal:P.signal}).then(z=>{clearTimeout(G),z.ok?ks(I,"TestPingServer: ok",!0,T):ks(I,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(G),ks(I,"TestPingServer: error",!1,T)})}function ks(f,T,I,P,G){try{G&&(G.onload=null,G.onerror=null,G.onabort=null,G.ontimeout=null),P(I)}catch{}}function QL(){this.g=new Xr}function Tf(f){this.i=f.Sb||null,this.h=f.ab||!1}h(Tf,Vn),Tf.prototype.g=function(){return new zu(this.i,this.h)};function zu(f,T){Ne.call(this),this.H=f,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(zu,Ne),n=zu.prototype,n.open=function(f,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=f,this.D=T,this.readyState=1,el(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const T={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};f&&(T.body=f),(this.H||o).fetch(new Request(this.D,T)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Za(this)),this.readyState=0},n.Pa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,el(this)),this.g&&(this.readyState=3,el(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;hv(this)}else f.text().then(this.Oa.bind(this),this.ga.bind(this))};function hv(f){f.j.read().then(f.Ma.bind(f)).catch(f.ga.bind(f))}n.Ma=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var T=f.value?f.value:new Uint8Array(0);(T=this.B.decode(T,{stream:!f.done}))&&(this.response=this.responseText+=T)}f.done?Za(this):el(this),this.readyState==3&&hv(this)}},n.Oa=function(f){this.g&&(this.response=this.responseText=f,Za(this))},n.Na=function(f){this.g&&(this.response=f,Za(this))},n.ga=function(){this.g&&Za(this)};function Za(f){f.readyState=4,f.l=null,f.j=null,f.B=null,el(f)}n.setRequestHeader=function(f,T){this.A.append(f,T)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],T=this.h.entries();for(var I=T.next();!I.done;)I=I.value,f.push(I[0]+": "+I[1]),I=T.next();return f.join(`\r
`)};function el(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(zu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function dv(f){let T="";return H(f,function(I,P){T+=P,T+=":",T+=I,T+=`\r
`}),T}function Sf(f,T,I){e:{for(P in I){var P=!1;break e}P=!0}P||(I=dv(I),typeof f=="string"?I!=null&&za(I):Je(f,T,I))}function ft(f){Ne.call(this),this.headers=new Map,this.L=f||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(ft,Ne);var XL=/^https?$/i,JL=["POST","PUT"];n=ft.prototype,n.Fa=function(f){this.H=f},n.ea=function(f,T,I,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);T=T?T.toUpperCase():"GET",this.D=f,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Wy.g(),this.g.onreadystatechange=d(u(this.Ca,this));try{this.B=!0,this.g.open(T,String(f),!0),this.B=!1}catch(z){fv(this,z);return}if(f=I||"",I=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var G in P)I.set(G,P[G]);else if(typeof P.keys=="function"&&typeof P.get=="function")for(const z of P.keys())I.set(z,P.get(z));else throw Error("Unknown input type for opt_headers: "+String(P));P=Array.from(I.keys()).find(z=>z.toLowerCase()=="content-type"),G=o.FormData&&f instanceof o.FormData,!(Array.prototype.indexOf.call(JL,T,void 0)>=0)||P||G||I.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[z,ie]of I)this.g.setRequestHeader(z,ie);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(f),this.v=!1}catch(z){fv(this,z)}};function fv(f,T){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=T,f.o=5,mv(f),Wu(f)}function mv(f){f.A||(f.A=!0,$e(f,"complete"),$e(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=f||7,$e(this,"complete"),$e(this,"abort"),Wu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Wu(this,!0)),ft.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?gv(this):this.Xa())},n.Xa=function(){gv(this)};function gv(f){if(f.h&&typeof i<"u"){if(f.v&&Ps(f)==4)setTimeout(f.Ca.bind(f),0);else if($e(f,"readystatechange"),Ps(f)==4){f.h=!1;try{const z=f.ca();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var I;if(!(I=T)){var P;if(P=z===0){let ie=String(f.D).match(sv)[1]||null;!ie&&o.self&&o.self.location&&(ie=o.self.location.protocol.slice(0,-1)),P=!XL.test(ie?ie.toLowerCase():"")}I=P}if(I)$e(f,"complete"),$e(f,"success");else{f.o=6;try{var G=Ps(f)>2?f.g.statusText:""}catch{G=""}f.l=G+" ["+f.ca()+"]",mv(f)}}finally{Wu(f)}}}}function Wu(f,T){if(f.g){f.m&&(clearTimeout(f.m),f.m=null);const I=f.g;f.g=null,T||$e(f,"ready");try{I.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ps(f){return f.g?f.g.readyState:0}n.ca=function(){try{return Ps(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(f){if(this.g){var T=this.g.responseText;return f&&T.indexOf(f)==0&&(T=T.substring(f.length)),Ci(T)}};function pv(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.F){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function ZL(f){const T={};f=(f.g&&Ps(f)>=2&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let P=0;P<f.length;P++){if(k(f[P]))continue;var I=FL(f[P]);const G=I[0];if(I=I[1],typeof I!="string")continue;I=I.trim();const z=T[G]||[];T[G]=z,z.push(I)}N(T,function(P){return P.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function tl(f,T,I){return I&&I.internalChannelParams&&I.internalChannelParams[f]||T}function yv(f){this.za=0,this.i=[],this.j=new Me,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tl("failFast",!1,f),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tl("baseRetryDelayMs",5e3,f),this.Za=tl("retryDelaySeedMs",1e4,f),this.Ta=tl("forwardChannelMaxRetries",2,f),this.va=tl("forwardChannelRequestTimeoutMs",2e4,f),this.ma=f&&f.xmlHttpFactory||void 0,this.Ua=f&&f.Rb||void 0,this.Aa=f&&f.useFetchStreams||!1,this.O=void 0,this.L=f&&f.supportsCrossDomainXhr||!1,this.M="",this.h=new Zy(f&&f.concurrentRequestLimit),this.Ba=new QL,this.S=f&&f.fastHandshake||!1,this.R=f&&f.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=f&&f.Pb||!1,f&&f.ua&&this.j.ua(),f&&f.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&f&&f.detectBufferingProxy||!1,this.ia=void 0,f&&f.longPollingTimeout&&f.longPollingTimeout>0&&(this.ia=f.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=yv.prototype,n.ka=8,n.I=1,n.connect=function(f,T,I,P){Xe(0),this.W=f,this.H=T||{},I&&P!==void 0&&(this.H.OSID=I,this.H.OAID=P),this.F=this.X,this.J=wv(this,null,this.W),Yu(this)};function _f(f){if(vv(f),f.I==3){var T=f.V++,I=vr(f.J);if(Je(I,"SID",f.M),Je(I,"RID",T),Je(I,"TYPE","terminate"),nl(f,I),T=new Ls(f,f.j,T),T.M=2,T.A=Hu(vr(I)),I=!1,o.navigator&&o.navigator.sendBeacon)try{I=o.navigator.sendBeacon(T.A.toString(),"")}catch{}!I&&o.Image&&(new Image().src=T.A,I=!0),I||(T.g=Rv(T.j,null),T.g.ea(T.A)),T.F=Date.now(),Ku(T)}Av(f)}function qu(f){f.g&&(If(f),f.g.cancel(),f.g=null)}function vv(f){qu(f),f.v&&(o.clearTimeout(f.v),f.v=null),Qu(f),f.h.cancel(),f.m&&(typeof f.m=="number"&&o.clearTimeout(f.m),f.m=null)}function Yu(f){if(!ev(f.h)&&!f.m){f.m=!0;var T=f.Ea;D||x(),F||(D(),F=!0),A.add(T,f),f.D=0}}function e1(f,T){return tv(f.h)>=f.h.j-(f.m?1:0)?!1:f.m?(f.i=T.G.concat(f.i),!0):f.I==1||f.I==2||f.D>=(f.Sa?0:f.Ta)?!1:(f.m=Oe(u(f.Ea,f,T),Iv(f,f.D)),f.D++,!0)}n.Ea=function(f){if(this.m)if(this.m=null,this.I==1){if(!f){this.V=Math.floor(Math.random()*1e5),f=this.V++;const G=new Ls(this,this.j,f);let z=this.o;if(this.U&&(z?(z=B(z),K(z,this.U)):z=this.U),this.u!==null||this.R||(G.J=z,z=null),this.S)e:{for(var T=0,I=0;I<this.i.length;I++){t:{var P=this.i[I];if("__data__"in P.map&&(P=P.map.__data__,typeof P=="string")){P=P.length;break t}P=void 0}if(P===void 0)break;if(T+=P,T>4096){T=I;break e}if(T===4096||I===this.i.length-1){T=I+1;break e}}T=1e3}else T=1e3;T=Tv(this,G,T),I=vr(this.J),Je(I,"RID",f),Je(I,"CVER",22),this.G&&Je(I,"X-HTTP-Session-Id",this.G),nl(this,I),z&&(this.R?T="headers="+za(dv(z))+"&"+T:this.u&&Sf(I,this.u,z)),vf(this.h,G),this.Ra&&Je(I,"TYPE","init"),this.S?(Je(I,"$req",T),Je(I,"SID","null"),G.U=!0,mf(G,I,null)):mf(G,I,T),this.I=2}}else this.I==3&&(f?Ev(this,f):this.i.length==0||ev(this.h)||Ev(this))};function Ev(f,T){var I;T?I=T.l:I=f.V++;const P=vr(f.J);Je(P,"SID",f.M),Je(P,"RID",I),Je(P,"AID",f.K),nl(f,P),f.u&&f.o&&Sf(P,f.u,f.o),I=new Ls(f,f.j,I,f.D+1),f.u===null&&(I.J=f.o),T&&(f.i=T.G.concat(f.i)),T=Tv(f,I,1e3),I.H=Math.round(f.va*.5)+Math.round(f.va*.5*Math.random()),vf(f.h,I),mf(I,P,T)}function nl(f,T){f.H&&H(f.H,function(I,P){Je(T,P,I)}),f.l&&H({},function(I,P){Je(T,P,I)})}function Tv(f,T,I){I=Math.min(f.i.length,I);const P=f.l?u(f.l.Ka,f.l,f):null;e:{var G=f.i;let xe=-1;for(;;){const wt=["count="+I];xe==-1?I>0?(xe=G[0].g,wt.push("ofs="+xe)):xe=0:wt.push("ofs="+xe);let We=!0;for(let Nt=0;Nt<I;Nt++){var z=G[Nt].g;const Er=G[Nt].map;if(z-=xe,z<0)xe=Math.max(0,G[Nt].g-100),We=!1;else try{z="req"+z+"_"||"";try{var ie=Er instanceof Map?Er:Object.entries(Er);for(const[Fi,Ds]of ie){let Ns=Ds;a(Ds)&&(Ns=yr(Ds)),wt.push(z+Fi+"="+encodeURIComponent(Ns))}}catch(Fi){throw wt.push(z+"type="+encodeURIComponent("_badmap")),Fi}}catch{P&&P(Er)}}if(We){ie=wt.join("&");break e}}ie=void 0}return f=f.i.splice(0,I),T.G=f,ie}function Sv(f){if(!f.g&&!f.v){f.Y=1;var T=f.Da;D||x(),F||(D(),F=!0),A.add(T,f),f.A=0}}function xf(f){return f.g||f.v||f.A>=3?!1:(f.Y++,f.v=Oe(u(f.Da,f),Iv(f,f.A)),f.A++,!0)}n.Da=function(){if(this.v=null,_v(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var f=4*this.T;this.j.info("BP detection timer enabled: "+f),this.B=Oe(u(this.Wa,this),f)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Xe(10),qu(this),_v(this))};function If(f){f.B!=null&&(o.clearTimeout(f.B),f.B=null)}function _v(f){f.g=new Ls(f,f.j,"rpc",f.Y),f.u===null&&(f.g.J=f.o),f.g.P=0;var T=vr(f.na);Je(T,"RID","rpc"),Je(T,"SID",f.M),Je(T,"AID",f.K),Je(T,"CI",f.F?"0":"1"),!f.F&&f.ia&&Je(T,"TO",f.ia),Je(T,"TYPE","xmlhttp"),nl(f,T),f.u&&f.o&&Sf(T,f.u,f.o),f.O&&(f.g.H=f.O);var I=f.g;f=f.ba,I.M=1,I.A=Hu(vr(T)),I.u=null,I.R=!0,Qy(I,f)}n.Va=function(){this.C!=null&&(this.C=null,qu(this),xf(this),Xe(19))};function Qu(f){f.C!=null&&(o.clearTimeout(f.C),f.C=null)}function xv(f,T){var I=null;if(f.g==T){Qu(f),If(f),f.g=null;var P=2}else if(yf(f.h,T))I=T.G,nv(f.h,T),P=1;else return;if(f.I!=0){if(T.o)if(P==1){I=T.u?T.u.length:0,T=Date.now()-T.F;var G=f.D;P=Ue(),$e(P,new Bt(P,I)),Yu(f)}else Sv(f);else if(G=T.m,G==3||G==0&&T.X>0||!(P==1&&e1(f,T)||P==2&&xf(f)))switch(I&&I.length>0&&(T=f.h,T.i=T.i.concat(I)),G){case 1:Mi(f,5);break;case 4:Mi(f,10);break;case 3:Mi(f,6);break;default:Mi(f,2)}}}function Iv(f,T){let I=f.Qa+Math.floor(Math.random()*f.Za);return f.isActive()||(I*=2),I*T}function Mi(f,T){if(f.j.info("Error code "+T),T==2){var I=u(f.bb,f),P=f.Ua;const G=!P;P=new Cs(P||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||qa(P,"https"),Hu(P),G?qL(P.toString(),I):YL(P.toString(),I)}else Xe(2);f.I=0,f.l&&f.l.pa(T),Av(f),vv(f)}n.bb=function(f){f?(this.j.info("Successfully pinged google.com"),Xe(2)):(this.j.info("Failed to ping google.com"),Xe(1))};function Av(f){if(f.I=0,f.ja=[],f.l){const T=rv(f.h);(T.length!=0||f.i.length!=0)&&(g(f.ja,T),g(f.ja,f.i),f.h.i.length=0,m(f.i),f.i.length=0),f.l.oa()}}function wv(f,T,I){var P=I instanceof Cs?vr(I):new Cs(I);if(P.g!="")T&&(P.g=T+"."+P.g),Ya(P,P.u);else{var G=o.location;P=G.protocol,T=T?T+"."+G.hostname:G.hostname,G=+G.port;const z=new Cs(null);P&&qa(z,P),T&&(z.g=T),G&&Ya(z,G),I&&(z.h=I),P=z}return I=f.G,T=f.wa,I&&T&&Je(P,I,T),Je(P,"VER",f.ka),nl(f,P),P}function Rv(f,T,I){if(T&&!f.L)throw Error("Can't create secondary domain capable XhrIo object.");return T=f.Aa&&!f.ma?new ft(new Tf({ab:I})):new ft(f.ma),T.Fa(f.L),T}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function bv(){}n=bv.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Xu(){}Xu.prototype.g=function(f,T){return new bn(f,T)};function bn(f,T){Ne.call(this),this.g=new yv(T),this.l=f,this.h=T&&T.messageUrlParams||null,f=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(f?f["X-WebChannel-Content-Type"]=T.messageContentType:f={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.sa&&(f?f["X-WebChannel-Client-Profile"]=T.sa:f={"X-WebChannel-Client-Profile":T.sa}),this.g.U=f,(f=T&&T.Qb)&&!k(f)&&(this.g.u=f),this.A=T&&T.supportsCrossDomainXhr||!1,this.v=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!k(T)&&(this.g.G=T,f=this.h,f!==null&&T in f&&(f=this.h,T in f&&delete f[T])),this.j=new wo(this)}h(bn,Ne),bn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},bn.prototype.close=function(){_f(this.g)},bn.prototype.o=function(f){var T=this.g;if(typeof f=="string"){var I={};I.__data__=f,f=I}else this.v&&(I={},I.__data__=yr(f),f=I);T.i.push(new $L(T.Ya++,f)),T.I==3&&Yu(T)},bn.prototype.N=function(){this.g.l=null,delete this.j,_f(this.g),delete this.g,bn.Z.N.call(this)};function Lv(f){xo.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var T=f.__sm__;if(T){e:{for(const I in T){f=I;break e}f=void 0}(this.i=f)&&(f=this.i,T=T!==null&&f in T?T[f]:void 0),this.data=T}else this.data=f}h(Lv,xo);function Cv(){Io.call(this),this.status=1}h(Cv,Io);function wo(f){this.g=f}h(wo,bv),wo.prototype.ra=function(){$e(this.g,"a")},wo.prototype.qa=function(f){$e(this.g,new Lv(f))},wo.prototype.pa=function(f){$e(this.g,new Cv)},wo.prototype.oa=function(){$e(this.g,"b")},Xu.prototype.createWebChannel=Xu.prototype.g,bn.prototype.send=bn.prototype.o,bn.prototype.open=bn.prototype.m,bn.prototype.close=bn.prototype.close,xw=function(){return new Xu},_w=function(){return Ue()},Sw=se,zg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Di.NO_ERROR=0,Di.TIMEOUT=8,Di.HTTP_ERROR=6,th=Di,zy.COMPLETE="complete",Tw=zy,Ka.EventType=Rs,Rs.OPEN="a",Rs.CLOSE="b",Rs.ERROR="c",Rs.MESSAGE="d",Ne.prototype.listen=Ne.prototype.J,El=Ka,ft.prototype.listenOnce=ft.prototype.K,ft.prototype.getLastError=ft.prototype.Ha,ft.prototype.getLastErrorCode=ft.prototype.ya,ft.prototype.getStatus=ft.prototype.ca,ft.prototype.getResponseJson=ft.prototype.La,ft.prototype.getResponseText=ft.prototype.la,ft.prototype.send=ft.prototype.ea,ft.prototype.setWithCredentials=ft.prototype.Fa,Ew=ft}).apply(typeof yc<"u"?yc:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}en.UNAUTHENTICATED=new en(null),en.GOOGLE_CREDENTIALS=new en("google-credentials-uid"),en.FIRST_PARTY=new en("first-party-uid"),en.MOCK_USER=new en("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ba="12.9.0";function FM(n){Ba=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fo=new P0("@firebase/firestore");function No(){return fo.logLevel}function ae(n,...e){if(fo.logLevel<=Le.DEBUG){const t=e.map(z0);fo.debug(`Firestore (${Ba}): ${n}`,...t)}}function Ts(n,...e){if(fo.logLevel<=Le.ERROR){const t=e.map(z0);fo.error(`Firestore (${Ba}): ${n}`,...t)}}function mo(n,...e){if(fo.logLevel<=Le.WARN){const t=e.map(z0);fo.warn(`Firestore (${Ba}): ${n}`,...t)}}function z0(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Iw(n,r,t)}function Iw(n,e,t){let r=`FIRESTORE (${Ba}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ts(r),new Error(r)}function Be(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Iw(e,s,r)}function Te(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends As{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class UM{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(en.UNAUTHENTICATED))}shutdown(){}}class BM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class $M{constructor(e){this.t=e,this.currentUser=en.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Be(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new di;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new di,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new di)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Be(typeof r.accessToken=="string",31837,{l:r}),new Aw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Be(e===null||typeof e=="string",2055,{h:e}),new en(e)}}class VM{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=en.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class jM{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new VM(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(en.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class GM{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Be(this.o===void 0,3512);const r=i=>{i.error!=null&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,ae("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new wT(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Be(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new wT(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=KM(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Ce(n,e){return n<e?-1:n>e?1:0}function Wg(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return om(s)===om(i)?Ce(s,i):om(s)?1:-1}return Ce(n.length,e.length)}const HM=55296,zM=57343;function om(n){const e=n.charCodeAt(0);return e>=HM&&e<=zM}function Ia(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RT="__name__";class br{constructor(e,t,r){t===void 0?t=0:t>e.length&&ge(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ge(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return br.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof br?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=br.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Ce(e.length,t.length)}static compareSegments(e,t){const r=br.isNumericId(e),s=br.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?br.extractNumericId(e).compare(br.extractNumericId(t)):Wg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return hi.fromString(e.substring(4,e.length-2))}}class et extends br{construct(e,t,r){return new et(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new he(Z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new et(t)}static emptyPath(){return new et([])}}const WM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zt extends br{construct(e,t,r){return new zt(e,t,r)}static isValidIdentifier(e){return WM.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===RT}static keyField(){return new zt([RT])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new he(Z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new he(Z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new he(Z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new he(Z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zt(t)}static emptyPath(){return new zt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e){this.path=e}static fromPath(e){return new fe(et.fromString(e))}static fromName(e){return new fe(et.fromString(e).popFirst(5))}static empty(){return new fe(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&et.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fe(new et(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ww(n,e,t){if(!t)throw new he(Z.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qM(n,e,t,r){if(e===!0&&r===!0)throw new he(Z.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bT(n){if(!fe.isDocumentKey(n))throw new he(Z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function LT(n){if(fe.isDocumentKey(n))throw new he(Z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Rw(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function q0(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ge(12329,{type:typeof n})}function fi(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new he(Z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=q0(n);throw new he(Z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function It(n,e){const t={typeString:n};return e&&(t.value=e),t}function Bu(n,e){if(!Rw(n))throw new he(Z.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new he(Z.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT=-62135596800,kT=1e6;class tt{static now(){return tt.fromMillis(Date.now())}static fromDate(e){return tt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*kT);return new tt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(Z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(Z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<CT)throw new he(Z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(Z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kT}_compareTo(e){return this.seconds===e.seconds?Ce(this.nanoseconds,e.nanoseconds):Ce(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:tt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Bu(e,tt._jsonSchema))return new tt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-CT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}tt._jsonSchemaVersion="firestore/timestamp/1.0",tt._jsonSchema={type:It("string",tt._jsonSchemaVersion),seconds:It("number"),nanoseconds:It("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new tt(0,0))}static max(){return new ye(new tt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=-1;function YM(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(r===1e9?new tt(t+1,0):new tt(t,r));return new vi(s,fe.empty(),e)}function QM(n){return new vi(n.readTime,n.key,fu)}class vi{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new vi(ye.min(),fe.empty(),fu)}static max(){return new vi(ye.max(),fe.empty(),fu)}}function XM(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=fe.comparator(n.documentKey,e.documentKey),t!==0?t:Ce(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ZM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $a(n){if(n.code!==Z.FAILED_PRECONDITION||n.message!==JM)throw n;ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ge(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new X((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof X?t:X.resolve(t)}catch(t){return X.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):X.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):X.reject(t)}static resolve(e){return new X((t,r)=>{t(e)})}static reject(e){return new X((t,r)=>{r(e)})}static waitFor(e){return new X((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=X.resolve(!1);for(const r of e)t=t.next(s=>s?X.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new X((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(c=>{o[u]=c,++a,a===i&&r(o)},c=>s(c))}})}static doWhile(e,t){return new X((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function eF(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Va(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Wd.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y0=-1;function qd(n){return n==null}function qh(n){return n===0&&1/n==-1/0}function tF(n){return typeof n=="number"&&Number.isInteger(n)&&!qh(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw="";function nF(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=PT(e)),e=rF(n.get(t),e);return PT(e)}function rF(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case bw:t+="";break;default:t+=i}}return t}function PT(n){return n+bw+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Eo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Lw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,t){this.comparator=e,this.root=t||Gt.EMPTY}insert(e,t){return new ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(e){return new ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vc(this.root,e,this.comparator,!0)}}class vc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gt{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Gt.RED,this.left=s??Gt.EMPTY,this.right=i??Gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Gt(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Gt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ge(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ge(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ge(27949);return e+(this.isRed()?0:1)}}Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw ge(57766)}get value(){throw ge(16141)}get color(){throw ge(16727)}get left(){throw ge(29726)}get right(){throw ge(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Gt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.comparator=e,this.data=new ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new NT(this.data.getIterator())}getIteratorFrom(e){return new NT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Dt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Dt(this.comparator);return t.data=e,t}}class NT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e){this.fields=e,e.sort(zt.comparator)}static empty(){return new cr([])}unionWith(e){let t=new Dt(zt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new cr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ia(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Cw("Invalid base64 string: "+i):i}}(e);return new Qt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ce(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const sF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ei(n){if(Be(!!n,39018),typeof n=="string"){let e=0;const t=sF.exec(n);if(Be(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:yt(n.seconds),nanos:yt(n.nanos)}}function yt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ti(n){return typeof n=="string"?Qt.fromBase64String(n):Qt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw="server_timestamp",Pw="__type__",Dw="__previous_value__",Nw="__local_write_time__";function Q0(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Pw])==null?void 0:r.stringValue)===kw}function Yd(n){const e=n.mapValue.fields[Dw];return Q0(e)?Yd(e):e}function mu(n){const e=Ei(n.mapValue.fields[Nw].timestampValue);return new tt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(e,t,r,s,i,o,a,l,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=c,this.apiKey=h}}const Yh="(default)";class gu{constructor(e,t){this.projectId=e,this.database=t||Yh}static empty(){return new gu("","")}get isDefaultDatabase(){return this.database===Yh}isEqual(e){return e instanceof gu&&e.projectId===this.projectId&&e.database===this.database}}function oF(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new he(Z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gu(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ow="__type__",aF="__max__",Ec={mapValue:{}},Mw="__vector__",Qh="value";function Si(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Q0(n)?4:uF(n)?9007199254740991:lF(n)?10:11:ge(28295,{value:n})}function Kr(n,e){if(n===e)return!0;const t=Si(n);if(t!==Si(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return mu(n).isEqual(mu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ei(s.timestampValue),a=Ei(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ti(s.bytesValue).isEqual(Ti(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return yt(s.geoPointValue.latitude)===yt(i.geoPointValue.latitude)&&yt(s.geoPointValue.longitude)===yt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return yt(s.integerValue)===yt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=yt(s.doubleValue),a=yt(i.doubleValue);return o===a?qh(o)===qh(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ia(n.arrayValue.values||[],e.arrayValue.values||[],Kr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(DT(o)!==DT(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Kr(o[l],a[l])))return!1;return!0}(n,e);default:return ge(52216,{left:n})}}function pu(n,e){return(n.values||[]).find(t=>Kr(t,e))!==void 0}function Aa(n,e){if(n===e)return 0;const t=Si(n),r=Si(e);if(t!==r)return Ce(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ce(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=yt(i.integerValue||i.doubleValue),l=yt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return OT(n.timestampValue,e.timestampValue);case 4:return OT(mu(n),mu(e));case 5:return Wg(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ti(i),l=Ti(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const c=Ce(a[u],l[u]);if(c!==0)return c}return Ce(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ce(yt(i.latitude),yt(o.latitude));return a!==0?a:Ce(yt(i.longitude),yt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return MT(n.arrayValue,e.arrayValue);case 10:return function(i,o){var d,m,g,y;const a=i.fields||{},l=o.fields||{},u=(d=a[Qh])==null?void 0:d.arrayValue,c=(m=l[Qh])==null?void 0:m.arrayValue,h=Ce(((g=u==null?void 0:u.values)==null?void 0:g.length)||0,((y=c==null?void 0:c.values)==null?void 0:y.length)||0);return h!==0?h:MT(u,c)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ec.mapValue&&o===Ec.mapValue)return 0;if(i===Ec.mapValue)return 1;if(o===Ec.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const d=Wg(l[h],c[h]);if(d!==0)return d;const m=Aa(a[l[h]],u[c[h]]);if(m!==0)return m}return Ce(l.length,c.length)}(n.mapValue,e.mapValue);default:throw ge(23264,{he:t})}}function OT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ce(n,e);const t=Ei(n),r=Ei(e),s=Ce(t.seconds,r.seconds);return s!==0?s:Ce(t.nanos,r.nanos)}function MT(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Aa(t[s],r[s]);if(i)return i}return Ce(t.length,r.length)}function wa(n){return qg(n)}function qg(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ei(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ti(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return fe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=qg(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${qg(t.fields[o])}`;return s+"}"}(n.mapValue):ge(61005,{value:n})}function nh(n){switch(Si(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Yd(n);return e?16+nh(e):16;case 5:return 2*n.stringValue.length;case 6:return Ti(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+nh(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Eo(r.fields,(i,o)=>{s+=i.length+nh(o)}),s}(n.mapValue);default:throw ge(13486,{value:n})}}function Yg(n){return!!n&&"integerValue"in n}function X0(n){return!!n&&"arrayValue"in n}function FT(n){return!!n&&"nullValue"in n}function UT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function rh(n){return!!n&&"mapValue"in n}function lF(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Ow])==null?void 0:r.stringValue)===Mw}function Fl(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Eo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Fl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Fl(n.arrayValue.values[t]);return e}return{...n}}function uF(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===aF}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e){this.value=e}static empty(){return new Kn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!rh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fl(t)}setAll(e){let t=zt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Fl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());rh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];rh(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Eo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Kn(Fl(this.value))}}function Fw(n){const e=[];return Eo(n.fields,(t,r)=>{const s=new zt([t]);if(rh(r)){const i=Fw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new cr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new nn(e,0,ye.min(),ye.min(),ye.min(),Kn.empty(),0)}static newFoundDocument(e,t,r,s){return new nn(e,1,t,ye.min(),r,s,0)}static newNoDocument(e,t){return new nn(e,2,t,ye.min(),ye.min(),Kn.empty(),0)}static newUnknownDocument(e,t){return new nn(e,3,t,ye.min(),ye.min(),Kn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ye.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof nn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(e,t){this.position=e,this.inclusive=t}}function BT(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=fe.comparator(fe.fromName(o.referenceValue),t.key):r=Aa(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function $T(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e,t="asc"){this.field=e,this.dir=t}}function cF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{}class Ct extends Uw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new dF(e,t,r):t==="array-contains"?new gF(e,r):t==="in"?new pF(e,r):t==="not-in"?new yF(e,r):t==="array-contains-any"?new vF(e,r):new Ct(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new fF(e,r):new mF(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Aa(t,this.value)):t!==null&&Si(this.value)===Si(t)&&this.matchesComparison(Aa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ge(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hr extends Uw{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Hr(e,t)}matches(e){return Bw(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Bw(n){return n.op==="and"}function $w(n){return hF(n)&&Bw(n)}function hF(n){for(const e of n.filters)if(e instanceof Hr)return!1;return!0}function Qg(n){if(n instanceof Ct)return n.field.canonicalString()+n.op.toString()+wa(n.value);if($w(n))return n.filters.map(e=>Qg(e)).join(",");{const e=n.filters.map(t=>Qg(t)).join(",");return`${n.op}(${e})`}}function Vw(n,e){return n instanceof Ct?function(r,s){return s instanceof Ct&&r.op===s.op&&r.field.isEqual(s.field)&&Kr(r.value,s.value)}(n,e):n instanceof Hr?function(r,s){return s instanceof Hr&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Vw(o,s.filters[a]),!0):!1}(n,e):void ge(19439)}function jw(n){return n instanceof Ct?function(t){return`${t.field.canonicalString()} ${t.op} ${wa(t.value)}`}(n):n instanceof Hr?function(t){return t.op.toString()+" {"+t.getFilters().map(jw).join(" ,")+"}"}(n):"Filter"}class dF extends Ct{constructor(e,t,r){super(e,t,r),this.key=fe.fromName(r.referenceValue)}matches(e){const t=fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class fF extends Ct{constructor(e,t){super(e,"in",t),this.keys=Gw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class mF extends Ct{constructor(e,t){super(e,"not-in",t),this.keys=Gw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Gw(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>fe.fromName(r.referenceValue))}class gF extends Ct{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return X0(t)&&pu(t.arrayValue,this.value)}}class pF extends Ct{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&pu(this.value.arrayValue,t)}}class yF extends Ct{constructor(e,t){super(e,"not-in",t)}matches(e){if(pu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!pu(this.value.arrayValue,t)}}class vF extends Ct{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!X0(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>pu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function VT(n,e=null,t=[],r=[],s=null,i=null,o=null){return new EF(n,e,t,r,s,i,o)}function J0(n){const e=Te(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Qg(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),qd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>wa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>wa(r)).join(",")),e.Te=t}return e.Te}function Z0(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!cF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Vw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$T(n.startAt,e.startAt)&&$T(n.endAt,e.endAt)}function Xg(n){return fe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function TF(n,e,t,r,s,i,o,a){return new Qd(n,e,t,r,s,i,o,a)}function Xd(n){return new Qd(n)}function jT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function SF(n){return fe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function _F(n){return n.collectionGroup!==null}function Ul(n){const e=Te(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Dt(zt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Jh(i,r))}),t.has(zt.keyField().canonicalString())||e.Ie.push(new Jh(zt.keyField(),r))}return e.Ie}function Vr(n){const e=Te(n);return e.Ee||(e.Ee=xF(e,Ul(n))),e.Ee}function xF(n,e){if(n.limitType==="F")return VT(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Jh(s.field,i)});const t=n.endAt?new Xh(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Xh(n.startAt.position,n.startAt.inclusive):null;return VT(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Jg(n,e,t){return new Qd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Jd(n,e){return Z0(Vr(n),Vr(e))&&n.limitType===e.limitType}function Kw(n){return`${J0(Vr(n))}|lt:${n.limitType}`}function Oo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>jw(s)).join(", ")}]`),qd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>wa(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>wa(s)).join(",")),`Target(${r})`}(Vr(n))}; limitType=${n.limitType})`}function Zd(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):fe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Ul(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=BT(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Ul(r),s)||r.endAt&&!function(o,a,l){const u=BT(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Ul(r),s))}(n,e)}function IF(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Hw(n){return(e,t)=>{let r=!1;for(const s of Ul(n)){const i=AF(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function AF(n,e,t){const r=n.field.isKeyField()?fe.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Aa(l,u):ge(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ge(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Eo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Lw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=new ht(fe.comparator);function Ss(){return wF}const zw=new ht(fe.comparator);function Tl(...n){let e=zw;for(const t of n)e=e.insert(t.key,t);return e}function Ww(n){let e=zw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Qi(){return Bl()}function qw(){return Bl()}function Bl(){return new To(n=>n.toString(),(n,e)=>n.isEqual(e))}const RF=new ht(fe.comparator),bF=new Dt(fe.comparator);function ke(...n){let e=bF;for(const t of n)e=e.add(t);return e}const LF=new Dt(Ce);function CF(){return LF}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ey(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qh(e)?"-0":e}}function Yw(n){return{integerValue:""+n}}function kF(n,e){return tF(e)?Yw(e):ey(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(){this._=void 0}}function PF(n,e,t){return n instanceof Zh?function(s,i){const o={fields:{[Pw]:{stringValue:kw},[Nw]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Q0(i)&&(i=Yd(i)),i&&(o.fields[Dw]=i),{mapValue:o}}(t,e):n instanceof yu?Xw(n,e):n instanceof vu?Jw(n,e):function(s,i){const o=Qw(s,i),a=GT(o)+GT(s.Ae);return Yg(o)&&Yg(s.Ae)?Yw(a):ey(s.serializer,a)}(n,e)}function DF(n,e,t){return n instanceof yu?Xw(n,e):n instanceof vu?Jw(n,e):t}function Qw(n,e){return n instanceof ed?function(r){return Yg(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Zh extends ef{}class yu extends ef{constructor(e){super(),this.elements=e}}function Xw(n,e){const t=Zw(e);for(const r of n.elements)t.some(s=>Kr(s,r))||t.push(r);return{arrayValue:{values:t}}}class vu extends ef{constructor(e){super(),this.elements=e}}function Jw(n,e){let t=Zw(e);for(const r of n.elements)t=t.filter(s=>!Kr(s,r));return{arrayValue:{values:t}}}class ed extends ef{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function GT(n){return yt(n.integerValue||n.doubleValue)}function Zw(n){return X0(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function NF(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof yu&&s instanceof yu||r instanceof vu&&s instanceof vu?Ia(r.elements,s.elements,Kr):r instanceof ed&&s instanceof ed?Kr(r.Ae,s.Ae):r instanceof Zh&&s instanceof Zh}(n.transform,e.transform)}class OF{constructor(e,t){this.version=e,this.transformResults=t}}class fs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fs}static exists(e){return new fs(void 0,e)}static updateTime(e){return new fs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class tf{}function eR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new nR(n.key,fs.none()):new $u(n.key,n.data,fs.none());{const t=n.data,r=Kn.empty();let s=new Dt(zt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new So(n.key,r,new cr(s.toArray()),fs.none())}}function MF(n,e,t){n instanceof $u?function(s,i,o){const a=s.value.clone(),l=HT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof So?function(s,i,o){if(!sh(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=HT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(tR(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function $l(n,e,t,r){return n instanceof $u?function(i,o,a,l){if(!sh(i.precondition,o))return a;const u=i.value.clone(),c=zT(i.fieldTransforms,l,o);return u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof So?function(i,o,a,l){if(!sh(i.precondition,o))return a;const u=zT(i.fieldTransforms,l,o),c=o.data;return c.setAll(tR(i)),c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(i,o,a){return sh(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function FF(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Qw(r.transform,s||null);i!=null&&(t===null&&(t=Kn.empty()),t.set(r.field,i))}return t||null}function KT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ia(r,s,(i,o)=>NF(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class $u extends tf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class So extends tf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function tR(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function HT(n,e,t){const r=new Map;Be(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,DF(o,a,t[s]))}return r}function zT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,PF(i,o,e))}return r}class nR extends tf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class UF extends tf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&MF(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=$l(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=$l(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=qw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=eR(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ye.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ke())}isEqual(e){return this.batchId===e.batchId&&Ia(this.mutations,e.mutations,(t,r)=>KT(t,r))&&Ia(this.baseMutations,e.baseMutations,(t,r)=>KT(t,r))}}class ty{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Be(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return RF}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ty(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t,Pe;function jF(n){switch(n){case Z.OK:return ge(64938);case Z.CANCELLED:case Z.UNKNOWN:case Z.DEADLINE_EXCEEDED:case Z.RESOURCE_EXHAUSTED:case Z.INTERNAL:case Z.UNAVAILABLE:case Z.UNAUTHENTICATED:return!1;case Z.INVALID_ARGUMENT:case Z.NOT_FOUND:case Z.ALREADY_EXISTS:case Z.PERMISSION_DENIED:case Z.FAILED_PRECONDITION:case Z.ABORTED:case Z.OUT_OF_RANGE:case Z.UNIMPLEMENTED:case Z.DATA_LOSS:return!0;default:return ge(15467,{code:n})}}function rR(n){if(n===void 0)return Ts("GRPC error has no .code"),Z.UNKNOWN;switch(n){case _t.OK:return Z.OK;case _t.CANCELLED:return Z.CANCELLED;case _t.UNKNOWN:return Z.UNKNOWN;case _t.DEADLINE_EXCEEDED:return Z.DEADLINE_EXCEEDED;case _t.RESOURCE_EXHAUSTED:return Z.RESOURCE_EXHAUSTED;case _t.INTERNAL:return Z.INTERNAL;case _t.UNAVAILABLE:return Z.UNAVAILABLE;case _t.UNAUTHENTICATED:return Z.UNAUTHENTICATED;case _t.INVALID_ARGUMENT:return Z.INVALID_ARGUMENT;case _t.NOT_FOUND:return Z.NOT_FOUND;case _t.ALREADY_EXISTS:return Z.ALREADY_EXISTS;case _t.PERMISSION_DENIED:return Z.PERMISSION_DENIED;case _t.FAILED_PRECONDITION:return Z.FAILED_PRECONDITION;case _t.ABORTED:return Z.ABORTED;case _t.OUT_OF_RANGE:return Z.OUT_OF_RANGE;case _t.UNIMPLEMENTED:return Z.UNIMPLEMENTED;case _t.DATA_LOSS:return Z.DATA_LOSS;default:return ge(39323,{code:n})}}(Pe=_t||(_t={}))[Pe.OK=0]="OK",Pe[Pe.CANCELLED=1]="CANCELLED",Pe[Pe.UNKNOWN=2]="UNKNOWN",Pe[Pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pe[Pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pe[Pe.NOT_FOUND=5]="NOT_FOUND",Pe[Pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pe[Pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pe[Pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pe[Pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pe[Pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pe[Pe.ABORTED=10]="ABORTED",Pe[Pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pe[Pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pe[Pe.INTERNAL=13]="INTERNAL",Pe[Pe.UNAVAILABLE=14]="UNAVAILABLE",Pe[Pe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GF(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KF=new hi([4294967295,4294967295],0);function WT(n){const e=GF().encode(n),t=new vw;return t.update(e),new Uint8Array(t.digest())}function qT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new hi([t,r],0),new hi([s,i],0)]}class ny{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Sl(`Invalid padding: ${t}`);if(r<0)throw new Sl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Sl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Sl(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=hi.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(hi.fromNumber(r)));return s.compare(KF)===1&&(s=new hi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=WT(e),[r,s]=qT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new ny(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=WT(e),[r,s]=qT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.be(o)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Sl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Vu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new nf(ye.min(),s,new ht(Ce),Ss(),ke())}}class Vu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Vu(r,t,ke(),ke(),ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class sR{constructor(e,t){this.targetId=e,this.Ce=t}}class iR{constructor(e,t,r=Qt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class YT{constructor(){this.ve=0,this.Fe=QT(),this.Me=Qt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ke(),t=ke(),r=ke();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ge(38017,{changeType:i})}}),new Vu(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=QT()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Be(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class HF{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ss(),this.He=Tc(),this.Je=Tc(),this.Ze=new ht(Ce)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ge(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Xg(i))if(r===0){const o=new fe(i.path);this.et(t,o,nn.newNoDocument(o,ye.min()))}else Be(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ti(r).toUint8Array()}catch(l){if(l instanceof Cw)return mo("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new ny(o,s,i)}catch(l){return mo(l instanceof Sl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Xg(a.target)){const l=new fe(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,nn.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.Ke())}});let r=ke();this.Je.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new nf(e,t,this.Ze,this.je,r);return this.je=Ss(),this.He=Tc(),this.Je=Tc(),this.Ze=new ht(Ce),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new YT,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Dt(Ce),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Dt(Ce),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new YT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Tc(){return new ht(fe.comparator)}function QT(){return new ht(fe.comparator)}const zF={asc:"ASCENDING",desc:"DESCENDING"},WF={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qF={and:"AND",or:"OR"};class YF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Zg(n,e){return n.useProto3Json||qd(e)?e:{value:e}}function td(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function oR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function QF(n,e){return td(n,e.toTimestamp())}function jr(n){return Be(!!n,49232),ye.fromTimestamp(function(t){const r=Ei(t);return new tt(r.seconds,r.nanos)}(n))}function ry(n,e){return ep(n,e).canonicalString()}function ep(n,e){const t=function(s){return new et(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function aR(n){const e=et.fromString(n);return Be(dR(e),10190,{key:e.toString()}),e}function tp(n,e){return ry(n.databaseId,e.path)}function am(n,e){const t=aR(e);if(t.get(1)!==n.databaseId.projectId)throw new he(Z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new he(Z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new fe(uR(t))}function lR(n,e){return ry(n.databaseId,e)}function XF(n){const e=aR(n);return e.length===4?et.emptyPath():uR(e)}function np(n){return new et(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function uR(n){return Be(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function XT(n,e,t){return{name:tp(n,e),fields:t.value.mapValue.fields}}function JF(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ge(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,c){return u.useProto3Json?(Be(c===void 0||typeof c=="string",58123),Qt.fromBase64String(c||"")):(Be(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),Qt.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=u.code===void 0?Z.UNKNOWN:rR(u.code);return new he(c,u.message||"")}(o);t=new iR(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=am(n,r.document.name),i=jr(r.document.updateTime),o=r.document.createTime?jr(r.document.createTime):ye.min(),a=new Kn({mapValue:{fields:r.document.fields}}),l=nn.newFoundDocument(s,i,o,a),u=r.targetIds||[],c=r.removedTargetIds||[];t=new ih(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=am(n,r.document),i=r.readTime?jr(r.readTime):ye.min(),o=nn.newNoDocument(s,i),a=r.removedTargetIds||[];t=new ih([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=am(n,r.document),i=r.removedTargetIds||[];t=new ih([],i,s,null)}else{if(!("filter"in e))return ge(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new VF(s,i),a=r.targetId;t=new sR(a,o)}}return t}function ZF(n,e){let t;if(e instanceof $u)t={update:XT(n,e.key,e.value)};else if(e instanceof nR)t={delete:tp(n,e.key)};else if(e instanceof So)t={update:XT(n,e.key,e.data),updateMask:l2(e.fieldMask)};else{if(!(e instanceof UF))return ge(16599,{dt:e.type});t={verify:tp(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Zh)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof yu)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof vu)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ed)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ge(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:QF(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ge(27497)}(n,e.precondition)),t}function e2(n,e){return n&&n.length>0?(Be(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?jr(s.updateTime):jr(i);return o.isEqual(ye.min())&&(o=jr(i)),new OF(o,s.transformResults||[])}(t,e))):[]}function t2(n,e){return{documents:[lR(n,e.path)]}}function n2(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=lR(n,s);const i=function(u){if(u.length!==0)return hR(Hr.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(c=>function(d){return{field:Mo(d.field),direction:i2(d.dir)}}(c))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Zg(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function r2(n){let e=XF(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Be(r===1,65062);const c=t.from[0];c.allDescendants?s=c.collectionId:e=e.child(c.collectionId)}let i=[];t.where&&(i=function(h){const d=cR(h);return d instanceof Hr&&$w(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(g){return new Jh(Fo(g.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,qd(d)?null:d}(t.limit));let l=null;t.startAt&&(l=function(h){const d=!!h.before,m=h.values||[];return new Xh(m,d)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const d=!h.before,m=h.values||[];return new Xh(m,d)}(t.endAt)),TF(e,s,o,i,a,"F",l,u)}function s2(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ge(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cR(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Fo(t.unaryFilter.field);return Ct.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fo(t.unaryFilter.field);return Ct.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Fo(t.unaryFilter.field);return Ct.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Fo(t.unaryFilter.field);return Ct.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ge(61313);default:return ge(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ct.create(Fo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ge(58110);default:return ge(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Hr.create(t.compositeFilter.filters.map(r=>cR(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ge(1026)}}(t.compositeFilter.op))}(n):ge(30097,{filter:n})}function i2(n){return zF[n]}function o2(n){return WF[n]}function a2(n){return qF[n]}function Mo(n){return{fieldPath:n.canonicalString()}}function Fo(n){return zt.fromServerFormat(n.fieldPath)}function hR(n){return n instanceof Ct?function(t){if(t.op==="=="){if(UT(t.value))return{unaryFilter:{field:Mo(t.field),op:"IS_NAN"}};if(FT(t.value))return{unaryFilter:{field:Mo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(UT(t.value))return{unaryFilter:{field:Mo(t.field),op:"IS_NOT_NAN"}};if(FT(t.value))return{unaryFilter:{field:Mo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mo(t.field),op:o2(t.op),value:t.value}}}(n):n instanceof Hr?function(t){const r=t.getFilters().map(s=>hR(s));return r.length===1?r[0]:{compositeFilter:{op:a2(t.op),filters:r}}}(n):ge(54877,{filter:n})}function l2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function dR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function fR(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t,r,s,i=ye.min(),o=ye.min(),a=Qt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Js(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(e){this.yt=e}}function c2(n){const e=r2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Jg(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2{constructor(){this.Sn=new d2}addToCollectionParentIndex(e,t){return this.Sn.add(t),X.resolve()}getCollectionParents(e,t){return X.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return X.resolve()}deleteFieldIndex(e,t){return X.resolve()}deleteAllFieldIndexes(e){return X.resolve()}createTargetIndexes(e,t){return X.resolve()}getDocumentsMatchingTarget(e,t){return X.resolve(null)}getIndexType(e,t){return X.resolve(0)}getFieldIndexes(e,t){return X.resolve([])}getNextCollectionGroupToUpdate(e){return X.resolve(null)}getMinOffset(e,t){return X.resolve(vi.min())}getMinOffsetFromCollectionGroup(e,t){return X.resolve(vi.min())}updateCollectionGroup(e,t,r){return X.resolve()}updateIndexEntries(e,t){return X.resolve()}}class d2{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Dt(et.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Dt(et.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},mR=41943040;class pn{static withCacheSize(e){return new pn(e,pn.DEFAULT_COLLECTION_PERCENTILE,pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pn.DEFAULT_COLLECTION_PERCENTILE=10,pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pn.DEFAULT=new pn(mR,pn.DEFAULT_COLLECTION_PERCENTILE,pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pn.DISABLED=new pn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Ra(0)}static ar(){return new Ra(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZT="LruGarbageCollector",f2=1048576;function eS([n,e],[t,r]){const s=Ce(n,t);return s===0?Ce(e,r):s}class m2{constructor(e){this.Pr=e,this.buffer=new Dt(eS),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();eS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class g2{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){ae(ZT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Va(t)?ae(ZT,"Ignoring IndexedDB error during garbage collection: ",t):await $a(t)}await this.Ar(3e5)})}}class p2{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return X.resolve(Wd.ce);const r=new m2(t);return this.Vr.forEachTarget(e,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ae("LruGarbageCollector","Garbage collection skipped; disabled"),X.resolve(JT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),JT):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,o,a,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(u=Date.now(),No()<=Le.DEBUG&&ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-c}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),X.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function y2(n,e){return new p2(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2{constructor(){this.changes=new To(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?X.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T2{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&$l(r.mutation,s,cr.empty(),tt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ke()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ke()){const s=Qi();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Tl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Qi();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ke()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Ss();const o=Bl(),a=function(){return Bl()}();return t.forEach((l,u)=>{const c=r.get(u.key);s.has(u.key)&&(c===void 0||c.mutation instanceof So)?i=i.insert(u.key,u):c!==void 0?(o.set(u.key,c.mutation.getFieldMask()),$l(c.mutation,u,c.mutation.getFieldMask(),tt.now())):o.set(u.key,cr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,c)=>o.set(u,c)),t.forEach((u,c)=>a.set(u,new E2(c,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Bl();let s=new ht((o,a)=>o-a),i=ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let c=r.get(l)||cr.empty();c=a.applyToLocalView(u,c),r.set(l,c);const h=(s.get(a.batchId)||ke()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,c=l.value,h=qw();c.forEach(d=>{if(!i.has(d)){const m=eR(t.get(d),r.get(d));m!==null&&h.set(d,m),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return X.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return SF(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):_F(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):X.resolve(Qi());let a=fu,l=i;return o.next(u=>X.forEach(u,(c,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(c)?X.resolve():this.remoteDocumentCache.getEntry(e,c).next(d=>{l=l.insert(c,d)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,ke())).next(c=>({batchId:a,changes:Ww(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new fe(t)).next(r=>{let s=Tl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Tl();return this.indexManager.getCollectionParents(e,i).next(a=>X.forEach(a,l=>{const u=function(h,d){return new Qd(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(c=>{c.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const c=u.getKey();o.get(c)===null&&(o=o.insert(c,nn.newInvalidDocument(c)))});let a=Tl();return o.forEach((l,u)=>{const c=i.get(l);c!==void 0&&$l(c.mutation,u,cr.empty(),tt.now()),Zd(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S2{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return X.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:jr(s.createTime)}}(t)),X.resolve()}getNamedQuery(e,t){return X.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:c2(s.bundledQuery),readTime:jr(s.readTime)}}(t)),X.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _2{constructor(){this.overlays=new ht(fe.comparator),this.Lr=new Map}getOverlay(e,t){return X.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Qi();return X.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.bt(e,t,i)}),X.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Lr.delete(r)),X.resolve()}getOverlaysForCollection(e,t,r){const s=Qi(),i=t.length+1,o=new fe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return X.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ht((u,c)=>u-c);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let c=i.get(u.largestBatchId);c===null&&(c=Qi(),i=i.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const a=Qi(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>a.set(u,c)),!(a.size()>=s)););return X.resolve(a)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new $F(t,r));let i=this.Lr.get(t);i===void 0&&(i=ke(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x2{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return X.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,X.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(){this.kr=new Dt(Mt.Kr),this.qr=new Dt(Mt.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new Mt(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Mt(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){const t=new fe(new et([])),r=new Mt(t,e),s=new Mt(t,e+1),i=[];return this.qr.forEachInRange([r,s],o=>{this.Wr(o),i.push(o.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new fe(new et([])),r=new Mt(t,e),s=new Mt(t,e+1);let i=ke();return this.qr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Mt(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Mt{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return fe.comparator(e.key,t.key)||Ce(e.Hr,t.Hr)}static Ur(e,t){return Ce(e.Hr,t.Hr)||fe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Dt(Mt.Kr)}checkEmpty(e){return X.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new BF(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Jr=this.Jr.add(new Mt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return X.resolve(o)}lookupMutationBatch(e,t){return X.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),i=s<0?0:s;return X.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return X.resolve(this.mutationQueue.length===0?Y0:this.Yn-1)}getAllMutationBatches(e){return X.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Mt(t,0),s=new Mt(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],o=>{const a=this.Zr(o.Hr);i.push(a)}),X.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Dt(Ce);return t.forEach(s=>{const i=new Mt(s,0),o=new Mt(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,o],a=>{r=r.add(a.Hr)})}),X.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;fe.isDocumentKey(i)||(i=i.child(""));const o=new Mt(new fe(i),0);let a=new Dt(Ce);return this.Jr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Hr)),!0)},o),X.resolve(this.Yr(a))}Yr(e){const t=[];return e.forEach(r=>{const s=this.Zr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Be(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return X.forEach(t.mutations,s=>{const i=new Mt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){const r=new Mt(t,0),s=this.Jr.firstAfterOrEqual(r);return X.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,X.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A2{constructor(e){this.ti=e,this.docs=function(){return new ht(fe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return X.resolve(r?r.document.mutableCopy():nn.newInvalidDocument(t))}getEntries(e,t){let r=Ss();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():nn.newInvalidDocument(s))}),X.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Ss();const o=t.path,a=new fe(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||XM(QM(c),r)<=0||(s.has(c.key)||Zd(t,c))&&(i=i.insert(c.key,c.mutableCopy()))}return X.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ge(9500)}ni(e,t){return X.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new w2(this)}getSize(e){return X.resolve(this.size)}}class w2 extends v2{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)}),X.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2{constructor(e){this.persistence=e,this.ri=new To(t=>J0(t),Z0),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.ii=0,this.si=new sy,this.targetCount=0,this.oi=Ra._r()}forEachTarget(e,t){return this.ri.forEach((r,s)=>t(s)),X.resolve()}getLastRemoteSnapshotVersion(e){return X.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return X.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),X.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),X.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Ra(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,X.resolve()}updateTargetData(e,t){return this.lr(t),X.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,X.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.ri.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.ri.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),X.waitFor(i).next(()=>s)}getTargetCount(e){return X.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return X.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),X.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),X.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),X.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return X.resolve(r)}containsKey(e,t){return X.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t){this._i={},this.overlays={},this.ai=new Wd(0),this.ui=!1,this.ui=!0,this.ci=new x2,this.referenceDelegate=e(this),this.li=new R2(this),this.indexManager=new h2,this.remoteDocumentCache=function(s){return new A2(s)}(r=>this.referenceDelegate.hi(r)),this.serializer=new u2(t),this.Pi=new S2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new I2(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){ae("MemoryPersistence","Starting transaction:",e);const s=new b2(this.ai.next());return this.referenceDelegate.Ti(),r(s).next(i=>this.referenceDelegate.Ii(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ei(e,t){return X.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class b2 extends ZM{constructor(e){super(),this.currentSequenceNumber=e}}class iy{constructor(e){this.persistence=e,this.Ri=new sy,this.Ai=null}static Vi(e){return new iy(e)}get di(){if(this.Ai)return this.Ai;throw ge(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),X.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),X.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),X.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.di.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return X.forEach(this.di,r=>{const s=fe.fromPath(r);return this.mi(e,s).next(i=>{i||t.removeEntry(s,ye.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return X.or([()=>X.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class nd{constructor(e,t){this.persistence=e,this.fi=new To(r=>nF(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=y2(this,t)}static Vi(e,t){return new nd(e,t)}Ti(){}Ii(e){return X.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return X.forEach(this.fi,(r,s)=>this.wr(e,r,s).next(i=>i?X.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,o=>this.wr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ye.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),X.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),X.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),X.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),X.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=nh(e.data.value)),t}wr(e,t,r){return X.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return X.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=ke(),s=ke();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new oy(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return JP()?8:eF(sn())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.gs(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ps(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new L2;return this.ys(e,t,o).next(a=>{if(i.result=a,this.As)return this.ws(e,t,o,a.size)})}).next(()=>i.result)}ws(e,t,r,s){return r.documentReadCount<this.Vs?(No()<=Le.DEBUG&&ae("QueryEngine","SDK will not create cache indexes for query:",Oo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),X.resolve()):(No()<=Le.DEBUG&&ae("QueryEngine","Query:",Oo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(No()<=Le.DEBUG&&ae("QueryEngine","The SDK decides to create cache indexes for query:",Oo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vr(t))):X.resolve())}gs(e,t){if(jT(t))return X.resolve(null);let r=Vr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Jg(t,null,"F"),r=Vr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ke(...i);return this.fs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.bs(t,a);return this.Ss(t,u,o,l.readTime)?this.gs(e,Jg(t,null,"F")):this.Ds(e,u,t,l)}))})))}ps(e,t,r,s){return jT(t)||s.isEqual(ye.min())?X.resolve(null):this.fs.getDocuments(e,r).next(i=>{const o=this.bs(t,i);return this.Ss(t,o,r,s)?X.resolve(null):(No()<=Le.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Oo(t)),this.Ds(e,o,t,YM(s,fu)).next(a=>a))})}bs(e,t){let r=new Dt(Hw(e));return t.forEach((s,i)=>{Zd(e,i)&&(r=r.add(i))}),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return No()<=Le.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",Oo(t)),this.fs.getDocumentsMatchingQuery(e,t,vi.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay="LocalStore",k2=3e8;class P2{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new ht(Ce),this.Fs=new To(i=>J0(i),Z0),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new T2(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function D2(n,e,t,r){return new P2(n,e,t,r)}async function pR(n,e){const t=Te(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ke();for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of i){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ns:u,removedBatchIds:o,addedBatchIds:a}))})})}function N2(n,e){const t=Te(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.xs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,c){const h=u.batch,d=h.keys();let m=X.resolve();return d.forEach(g=>{m=m.next(()=>c.getEntry(l,g)).next(y=>{const v=u.docVersions.get(g);Be(v!==null,48541),y.version.compareTo(v)<0&&(h.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),c.addEntry(y)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ke();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function yR(n){const e=Te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function O2(n,e){const t=Te(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const a=[];e.targetChanges.forEach((c,h)=>{const d=s.get(h);if(!d)return;a.push(t.li.removeMatchingKeys(i,c.removedDocuments,h).next(()=>t.li.addMatchingKeys(i,c.addedDocuments,h)));let m=d.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(Qt.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):c.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(c.resumeToken,r)),s=s.insert(h,m),function(y,v,E){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=k2?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(d,m,c)&&a.push(t.li.updateTargetData(i,m))});let l=Ss(),u=ke();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push(M2(i,o,e.documentUpdates).next(c=>{l=c.Bs,u=c.Ls})),!r.isEqual(ye.min())){const c=t.li.getLastRemoteSnapshotVersion(i).next(h=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(c)}return X.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.vs=s,i))}function M2(n,e,t){let r=ke(),s=ke();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Ss();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ye.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ae(ay,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Bs:o,Ls:s}})}function F2(n,e){const t=Te(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Y0),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function U2(n,e){const t=Te(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.li.getTargetData(r,e).next(i=>i?(s=i,X.resolve(s)):t.li.allocateTargetId(r).next(o=>(s=new Js(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}async function rp(n,e,t){const r=Te(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Va(o))throw o;ae(ay,`Failed to update sequence numbers for target ${e}: ${o}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function tS(n,e,t){const r=Te(n);let s=ye.min(),i=ke();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,c){const h=Te(l),d=h.Fs.get(c);return d!==void 0?X.resolve(h.vs.get(d)):h.li.getTargetData(u,c)}(r,o,Vr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?s:ye.min(),t?i:ke())).next(a=>(B2(r,IF(e),a),{documents:a,ks:i})))}function B2(n,e,t){let r=n.Ms.get(e)||ye.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ms.set(e,r)}class nS{constructor(){this.activeTargetIds=CF()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $2{constructor(){this.vo=new nS,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new nS,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rS="ConnectivityMonitor";class sS{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){ae(rS,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){ae(rS,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sc=null;function sp(){return Sc===null?Sc=function(){return 268435456+Math.round(2147483648*Math.random())}():Sc++,"0x"+Sc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm="RestConnection",j2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class G2{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===Yh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){const o=sp(),a=this.Qo(e,t.toUriEncodedString());ae(lm,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,s,i);const{host:u}=new URL(a),c=Ma(u);return this.zo(e,a,l,r,c).then(h=>(ae(lm,`Received RPC '${e}' ${o}: `,h),h),h=>{throw mo(lm,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",r),h})}jo(e,t,r,s,i,o){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ba}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}Qo(e,t){const r=j2[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt="WebChannelConnection",hl=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(s){setTimeout(()=>{throw s},0)}})};class aa extends G2{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!aa.c_){const e=_w();hl(e,Sw.STAT_EVENT,t=>{t.stat===zg.PROXY?ae(Zt,"STAT_EVENT: detected buffering proxy"):t.stat===zg.NOPROXY&&ae(Zt,"STAT_EVENT: detected no buffering proxy")}),aa.c_=!0}}zo(e,t,r,s,i){const o=sp();return new Promise((a,l)=>{const u=new Ew;u.setWithCredentials(!0),u.listenOnce(Tw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case th.NO_ERROR:const h=u.getResponseJson();ae(Zt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case th.TIMEOUT:ae(Zt,`RPC '${e}' ${o} timed out`),l(new he(Z.DEADLINE_EXCEEDED,"Request time out"));break;case th.HTTP_ERROR:const d=u.getStatus();if(ae(Zt,`RPC '${e}' ${o} failed with status:`,d,"response text:",u.getResponseText()),d>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const g=m==null?void 0:m.error;if(g&&g.status&&g.message){const y=function(E){const p=E.toLowerCase().replace(/_/g,"-");return Object.values(Z).indexOf(p)>=0?p:Z.UNKNOWN}(g.status);l(new he(y,g.message))}else l(new he(Z.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new he(Z.UNAVAILABLE,"Connection failed."));break;default:ge(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{ae(Zt,`RPC '${e}' ${o} completed.`)}});const c=JSON.stringify(s);ae(Zt,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",c,r,15)})}T_(e,t,r){const s=sp(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=i.join("");ae(Zt,`Creating RPC '${e}' stream ${s}: ${u}`,a);const c=o.createWebChannel(u,a);this.I_(c);let h=!1,d=!1;const m=new K2({Ho:g=>{d?ae(Zt,`Not sending because RPC '${e}' stream ${s} is closed:`,g):(h||(ae(Zt,`Opening RPC '${e}' stream ${s} transport.`),c.open(),h=!0),ae(Zt,`RPC '${e}' stream ${s} sending:`,g),c.send(g))},Jo:()=>c.close()});return hl(c,El.EventType.OPEN,()=>{d||(ae(Zt,`RPC '${e}' stream ${s} transport opened.`),m.i_())}),hl(c,El.EventType.CLOSE,()=>{d||(d=!0,ae(Zt,`RPC '${e}' stream ${s} transport closed`),m.o_(),this.E_(c))}),hl(c,El.EventType.ERROR,g=>{d||(d=!0,mo(Zt,`RPC '${e}' stream ${s} transport errored. Name:`,g.name,"Message:",g.message),m.o_(new he(Z.UNAVAILABLE,"The operation could not be completed")))}),hl(c,El.EventType.MESSAGE,g=>{var y;if(!d){const v=g.data[0];Be(!!v,16349);const E=v,p=(E==null?void 0:E.error)||((y=E[0])==null?void 0:y.error);if(p){ae(Zt,`RPC '${e}' stream ${s} received error:`,p);const S=p.status;let L=function(A){const x=_t[A];if(x!==void 0)return rR(x)}(S),D=p.message;S==="NOT_FOUND"&&D.includes("database")&&D.includes("does not exist")&&D.includes(this.databaseId.database)&&mo(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),L===void 0&&(L=Z.INTERNAL,D="Unknown error status: "+S+" with message "+p.message),d=!0,m.o_(new he(L,D)),c.close()}else ae(Zt,`RPC '${e}' stream ${s} received:`,v),m.__(v)}}),aa.u_(),setTimeout(()=>{m.s_()},0),m}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return xw()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H2(n){return new aa(n)}function um(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n){return new YF(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */aa.c_=!1;class vR{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&ae("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS="PersistentStream";class ER{constructor(e,t,r,s,i,o,a,l){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new vR(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Z.RESOURCE_EXHAUSTED?(Ts(t.toString()),Ts("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new he(Z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ae(iS,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(ae(iS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class z2 extends ER{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=JF(this.serializer,e),r=function(i){if(!("targetChange"in i))return ye.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ye.min():o.readTime?jr(o.readTime):ye.min()}(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=np(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Xg(l)?{documents:t2(i,l)}:{query:n2(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=oR(i,o.resumeToken);const u=Zg(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ye.min())>0){a.readTime=td(i,o.snapshotVersion.toTimestamp());const u=Zg(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=s2(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=np(this.serializer),t.removeTarget=e,this.K_(t)}}class W2 extends ER{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Be(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Be(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Be(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=e2(e.writeResults,e.commitTime),r=jr(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=np(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ZF(this.serializer,r))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{}class Y2 extends q2{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new he(Z.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Wo(e,ep(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new he(Z.UNKNOWN,i.toString())})}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.jo(e,ep(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new he(Z.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function Q2(n,e,t,r){return new Y2(n,e,t,r)}class X2{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ts(t),this.aa=!1):ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const go="RemoteStore";class J2{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(o=>{r.enqueueAndForget(async()=>{_o(this)&&(ae(go,"Restarting streams for network reachability change."),await async function(l){const u=Te(l);u.Ea.add(4),await ju(u),u.Va.set("Unknown"),u.Ea.delete(4),await sf(u)}(this))})}),this.Va=new X2(r,s)}}async function sf(n){if(_o(n))for(const e of n.Ra)await e(!0)}async function ju(n){for(const e of n.Ra)await e(!1)}function TR(n,e){const t=Te(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),hy(t)?cy(t):ja(t).O_()&&uy(t,e))}function ly(n,e){const t=Te(n),r=ja(t);t.Ia.delete(e),r.O_()&&SR(t,e),t.Ia.size===0&&(r.O_()?r.L_():_o(t)&&t.Va.set("Unknown"))}function uy(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ye.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ja(n).Z_(e)}function SR(n,e){n.da.$e(e),ja(n).X_(e)}function cy(n){n.da=new HF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),ja(n).start(),n.Va.ua()}function hy(n){return _o(n)&&!ja(n).x_()&&n.Ia.size>0}function _o(n){return Te(n).Ea.size===0}function _R(n){n.da=void 0}async function Z2(n){n.Va.set("Online")}async function eU(n){n.Ia.forEach((e,t)=>{uy(n,e)})}async function tU(n,e){_R(n),hy(n)?(n.Va.ha(e),cy(n)):n.Va.set("Unknown")}async function nU(n,e,t){if(n.Va.set("Online"),e instanceof iR&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.da.removeTarget(a))}(n,e)}catch(r){ae(go,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await rd(n,r)}else if(e instanceof ih?n.da.Xe(e):e instanceof sR?n.da.st(e):n.da.tt(e),!t.isEqual(ye.min()))try{const r=await yR(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.da.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=i.Ia.get(u);c&&i.Ia.set(u,c.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const c=i.Ia.get(l);if(!c)return;i.Ia.set(l,c.withResumeToken(Qt.EMPTY_BYTE_STRING,c.snapshotVersion)),SR(i,l);const h=new Js(c.target,l,u,c.sequenceNumber);uy(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ae(go,"Failed to raise snapshot:",r),await rd(n,r)}}async function rd(n,e,t){if(!Va(e))throw e;n.Ea.add(1),await ju(n),n.Va.set("Offline"),t||(t=()=>yR(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ae(go,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await sf(n)})}function xR(n,e){return e().catch(t=>rd(n,t,e))}async function of(n){const e=Te(n),t=_i(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Y0;for(;rU(e);)try{const s=await F2(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,sU(e,s)}catch(s){await rd(e,s)}IR(e)&&AR(e)}function rU(n){return _o(n)&&n.Ta.length<10}function sU(n,e){n.Ta.push(e);const t=_i(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function IR(n){return _o(n)&&!_i(n).x_()&&n.Ta.length>0}function AR(n){_i(n).start()}async function iU(n){_i(n).ra()}async function oU(n){const e=_i(n);for(const t of n.Ta)e.ea(t.mutations)}async function aU(n,e,t){const r=n.Ta.shift(),s=ty.from(r,e,t);await xR(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await of(n)}async function lU(n,e){e&&_i(n).Y_&&await async function(r,s){if(function(o){return jF(o)&&o!==Z.ABORTED}(s.code)){const i=r.Ta.shift();_i(r).B_(),await xR(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await of(r)}}(n,e),IR(n)&&AR(n)}async function oS(n,e){const t=Te(n);t.asyncQueue.verifyOperationInProgress(),ae(go,"RemoteStore received new credentials");const r=_o(t);t.Ea.add(3),await ju(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await sf(t)}async function uU(n,e){const t=Te(n);e?(t.Ea.delete(2),await sf(t)):e||(t.Ea.add(2),await ju(t),t.Va.set("Unknown"))}function ja(n){return n.ma||(n.ma=function(t,r,s){const i=Te(t);return i.sa(),new z2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Zo:Z2.bind(null,n),Yo:eU.bind(null,n),t_:tU.bind(null,n),J_:nU.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),hy(n)?cy(n):n.Va.set("Unknown")):(await n.ma.stop(),_R(n))})),n.ma}function _i(n){return n.fa||(n.fa=function(t,r,s){const i=Te(t);return i.sa(),new W2(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:iU.bind(null,n),t_:lU.bind(null,n),ta:oU.bind(null,n),na:aU.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await of(n)):(await n.fa.stop(),n.Ta.length>0&&(ae(go,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new di,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new dy(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(Z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fy(n,e){if(Ts("AsyncQueue",`${e}: ${n}`),Va(n))return new he(Z.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{static emptySet(e){return new la(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||fe.comparator(t.key,r.key):(t,r)=>fe.comparator(t.key,r.key),this.keyedMap=Tl(),this.sortedSet=new ht(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof la)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new la;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(){this.ga=new ht(fe.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ge(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ba{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ba(e,t,la.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cU{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class hU{constructor(){this.queries=lS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Te(t),i=s.queries;s.queries=lS(),i.forEach((o,a)=>{for(const l of a.ba)l.onError(r)})})(this,new he(Z.ABORTED,"Firestore shutting down"))}}function lS(){return new To(n=>Kw(n),Jd)}async function wR(n,e){const t=Te(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new cU,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=fy(o,`Initialization of query '${Oo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&my(t)}async function RR(n,e){const t=Te(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.ba.indexOf(e);o>=0&&(i.ba.splice(o,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function dU(n,e){const t=Te(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.ba)a.Fa(s)&&(r=!0);o.wa=s}}r&&my(t)}function fU(n,e,t){const r=Te(n),s=r.queries.get(e);if(s)for(const i of s.ba)i.onError(t);r.queries.delete(e)}function my(n){n.Ca.forEach(e=>{e.next()})}var ip,uS;(uS=ip||(ip={})).Ma="default",uS.Cache="cache";class bR{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ba(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ip.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this.key=e}}class CR{constructor(e){this.key=e}}class mU{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ke(),this.mutatedKeys=ke(),this.eu=Hw(e),this.tu=new la(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new aS,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((c,h)=>{const d=s.get(c),m=Zd(this.query,h)?h:null,g=!!d&&this.mutatedKeys.has(d.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let v=!1;d&&m?d.data.isEqual(m.data)?g!==y&&(r.track({type:3,doc:m}),v=!0):this.su(d,m)||(r.track({type:2,doc:m}),v=!0,(l&&this.eu(m,l)>0||u&&this.eu(m,u)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),v=!0):d&&!m&&(r.track({type:1,doc:d}),v=!0,(l||u)&&(a=!0)),v&&(m?(o=o.add(m),i=y?i.add(c):i.delete(c)):(o=o.delete(c),i=i.delete(c)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const c=this.query.limitType==="F"?o.last():o.first();o=o.delete(c.key),i=i.delete(c.key),r.track({type:1,doc:c})}return{tu:o,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((c,h)=>function(m,g){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ge(20277,{Vt:v})}};return y(m)-y(g)}(c.type,h.type)||this.eu(c.doc,h.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Ya.size===0&&this.current&&!s?1:0,u=l!==this.Xa;return this.Xa=l,o.length!==0||u?{snapshot:new ba(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new aS,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ke(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new CR(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new LR(r))}),t}cu(e){this.Za=e.ks,this.Ya=ke();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ba.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const gy="SyncEngine";class gU{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class pU{constructor(e){this.key=e,this.hu=!1}}class yU{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new To(a=>Kw(a),Jd),this.Iu=new Map,this.Eu=new Set,this.Ru=new ht(fe.comparator),this.Au=new Map,this.Vu=new sy,this.du={},this.mu=new Map,this.fu=Ra.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function vU(n,e,t=!0){const r=MR(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await kR(r,e,t,!0),s}async function EU(n,e){const t=MR(n);await kR(t,e,!0,!1)}async function kR(n,e,t,r){const s=await U2(n.localStore,Vr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await TU(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&TR(n.remoteStore,s),a}async function TU(n,e,t,r,s){n.pu=(h,d,m)=>async function(y,v,E,p){let S=v.view.ru(E);S.Ss&&(S=await tS(y.localStore,v.query,!1).then(({documents:A})=>v.view.ru(A,S)));const L=p&&p.targetChanges.get(v.targetId),D=p&&p.targetMismatches.get(v.targetId)!=null,F=v.view.applyChanges(S,y.isPrimaryClient,L,D);return hS(y,v.targetId,F.au),F.snapshot}(n,h,d,m);const i=await tS(n.localStore,e,!0),o=new mU(e,i.ks),a=o.ru(i.documents),l=Vu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);hS(n,t,u.au);const c=new gU(e,t,o);return n.Tu.set(e,c),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function SU(n,e,t){const r=Te(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Jd(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await rp(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ly(r.remoteStore,s.targetId),op(r,s.targetId)}).catch($a)):(op(r,s.targetId),await rp(r.localStore,s.targetId,!0))}async function _U(n,e){const t=Te(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ly(t.remoteStore,r.targetId))}async function xU(n,e,t){const r=CU(n);try{const s=await function(o,a){const l=Te(o),u=tt.now(),c=a.reduce((m,g)=>m.add(g.key),ke());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let g=Ss(),y=ke();return l.xs.getEntries(m,c).next(v=>{g=v,g.forEach((E,p)=>{p.isValidDocument()||(y=y.add(E))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,g)).next(v=>{h=v;const E=[];for(const p of a){const S=FF(p,h.get(p.key).overlayedDocument);S!=null&&E.push(new So(p.key,S,Fw(S.value.mapValue),fs.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,E,a)}).next(v=>{d=v;const E=v.applyToLocalDocumentSet(h,y);return l.documentOverlayCache.saveOverlays(m,v.batchId,E)})}).then(()=>({batchId:d.batchId,changes:Ww(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.du[o.currentUser.toKey()];u||(u=new ht(Ce)),u=u.insert(a,l),o.du[o.currentUser.toKey()]=u}(r,s.batchId,t),await Gu(r,s.changes),await of(r.remoteStore)}catch(s){const i=fy(s,"Failed to persist write");t.reject(i)}}async function PR(n,e){const t=Te(n);try{const r=await O2(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(Be(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?Be(o.hu,14607):s.removedDocuments.size>0&&(Be(o.hu,42227),o.hu=!1))}),await Gu(t,r,e)}catch(r){await $a(r)}}function cS(n,e,t){const r=Te(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Te(o);l.onlineState=a;let u=!1;l.queries.forEach((c,h)=>{for(const d of h.ba)d.va(a)&&(u=!0)}),u&&my(l)}(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function IU(n,e,t){const r=Te(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new ht(fe.comparator);o=o.insert(i,nn.newNoDocument(i,ye.min()));const a=ke().add(i),l=new nf(ye.min(),new Map,new ht(Ce),o,a);await PR(r,l),r.Ru=r.Ru.remove(i),r.Au.delete(e),py(r)}else await rp(r.localStore,e,!1).then(()=>op(r,e,t)).catch($a)}async function AU(n,e){const t=Te(n),r=e.batch.batchId;try{const s=await N2(t.localStore,e);NR(t,r,null),DR(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Gu(t,s)}catch(s){await $a(s)}}async function wU(n,e,t){const r=Te(n);try{const s=await function(o,a){const l=Te(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,a).next(h=>(Be(h!==null,37113),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(r.localStore,e);NR(r,e,t),DR(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Gu(r,s)}catch(s){await $a(s)}}function DR(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function NR(n,e,t){const r=Te(n);let s=r.du[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function op(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||OR(n,r)})}function OR(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(ly(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),py(n))}function hS(n,e,t){for(const r of t)r instanceof LR?(n.Vu.addReference(r.key,e),RU(n,r)):r instanceof CR?(ae(gy,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||OR(n,r.key)):ge(19791,{wu:r})}function RU(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(ae(gy,"New document in limbo: "+t),n.Eu.add(r),py(n))}function py(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new fe(et.fromString(e)),r=n.fu.next();n.Au.set(r,new pU(t)),n.Ru=n.Ru.insert(t,r),TR(n.remoteStore,new Js(Vr(Xd(t.path)),r,"TargetPurposeLimboResolution",Wd.ce))}}async function Gu(n,e,t){const r=Te(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var c;if((u||t)&&r.isPrimaryClient){const h=u?!u.fromCache:(c=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:c.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){s.push(u);const h=oy.Es(l.targetId,u);i.push(h)}}))}),await Promise.all(o),r.Pu.J_(s),await async function(l,u){const c=Te(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>X.forEach(u,d=>X.forEach(d.Ts,m=>c.persistence.referenceDelegate.addReference(h,d.targetId,m)).next(()=>X.forEach(d.Is,m=>c.persistence.referenceDelegate.removeReference(h,d.targetId,m)))))}catch(h){if(!Va(h))throw h;ae(ay,"Failed to update sequence numbers: "+h)}for(const h of u){const d=h.targetId;if(!h.fromCache){const m=c.vs.get(d),g=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(g);c.vs=c.vs.insert(d,y)}}}(r.localStore,i))}async function bU(n,e){const t=Te(n);if(!t.currentUser.isEqual(e)){ae(gy,"User change. New user:",e.toKey());const r=await pR(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new he(Z.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Gu(t,r.Ns)}}function LU(n,e){const t=Te(n),r=t.Au.get(e);if(r&&r.hu)return ke().add(r.key);{let s=ke();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function MR(n){const e=Te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=PR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=LU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=IU.bind(null,e),e.Pu.J_=dU.bind(null,e.eventManager),e.Pu.yu=fU.bind(null,e.eventManager),e}function CU(n){const e=Te(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=AU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wU.bind(null,e),e}class sd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=rf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return D2(this.persistence,new C2,e.initialUser,this.serializer)}Cu(e){return new gR(iy.Vi,this.serializer)}Du(e){return new $2}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sd.provider={build:()=>new sd};class kU extends sd{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Be(this.persistence.referenceDelegate instanceof nd,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new g2(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?pn.withCacheSize(this.cacheSizeBytes):pn.DEFAULT;return new gR(r=>nd.Vi(r,t),this.serializer)}}class ap{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>cS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=bU.bind(null,this.syncEngine),await uU(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new hU}()}createDatastore(e){const t=rf(e.databaseInfo.databaseId),r=H2(e.databaseInfo);return Q2(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new J2(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>cS(this.syncEngine,t,0),function(){return sS.v()?new sS:new V2}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,c){const h=new yU(s,i,o,a,l,u);return c&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Te(s);ae(go,"RemoteStore shutting down."),i.Ea.add(5),await ju(i),i.Aa.shutdown(),i.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}ap.provider={build:()=>new ap};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ts("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xi="FirestoreClient";class PU{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=en.UNAUTHENTICATED,this.clientId=W0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ae(xi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ae(xi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new di;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=fy(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function cm(n,e){n.asyncQueue.verifyOperationInProgress(),ae(xi,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await pR(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function dS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await DU(n);ae(xi,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>oS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>oS(e.remoteStore,s)),n._onlineComponents=e}async function DU(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ae(xi,"Using user provided OfflineComponentProvider");try{await cm(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Z.FAILED_PRECONDITION||s.code===Z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;mo("Error using user provided cache. Falling back to memory cache: "+t),await cm(n,new sd)}}else ae(xi,"Using default OfflineComponentProvider"),await cm(n,new kU(void 0));return n._offlineComponents}async function UR(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ae(xi,"Using user provided OnlineComponentProvider"),await dS(n,n._uninitializedComponentsProvider._online)):(ae(xi,"Using default OnlineComponentProvider"),await dS(n,new ap))),n._onlineComponents}function NU(n){return UR(n).then(e=>e.syncEngine)}async function lp(n){const e=await UR(n),t=e.eventManager;return t.onListen=vU.bind(null,e.syncEngine),t.onUnlisten=SU.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=EU.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=_U.bind(null,e.syncEngine),t}function OU(n,e,t,r){const s=new FR(r),i=new bR(e,s,t);return n.asyncQueue.enqueueAndForget(async()=>wR(await lp(n),i)),()=>{s.Nu(),n.asyncQueue.enqueueAndForget(async()=>RR(await lp(n),i))}}function MU(n,e,t={}){const r=new di;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const c=new FR({next:d=>{c.Nu(),o.enqueueAndForget(()=>RR(i,h));const m=d.docs.has(a);!m&&d.fromCache?u.reject(new he(Z.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&l&&l.source==="server"?u.reject(new he(Z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new bR(Xd(a.path),c,{includeMetadataChanges:!0,Ka:!0});return wR(i,h)}(await lp(n),n.asyncQueue,e,t,r)),r.promise}function FU(n,e){const t=new di;return n.asyncQueue.enqueueAndForget(async()=>xU(await NU(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BR(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UU="ComponentProvider",fS=new Map;function BU(n,e,t,r,s){return new iF(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,BR(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $R="firestore.googleapis.com",mS=!0;class gS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new he(Z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$R,this.ssl=mS}else this.host=e.host,this.ssl=e.ssl??mS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=mR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<f2)throw new he(Z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BR(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new he(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new he(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new he(Z.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class af{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(Z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(Z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new UM;switch(r.type){case"firstParty":return new jM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new he(Z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=fS.get(t);r&&(ae(UU,"Removing Datastore"),fS.delete(t),r.terminate())}(this),Promise.resolve()}}function $U(n,e,t,r={}){var u;n=fi(n,af);const s=Ma(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(CA(`https://${a}`),kA("Firestore",!0)),i.host!==$R&&i.host!==a&&mo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!ao(l,o)&&(n._setSettings(l),r.mockUserToken)){let c,h;if(typeof r.mockUserToken=="string")c=r.mockUserToken,h=en.MOCK_USER;else{c=GP(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new he(Z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new en(d)}n._authCredentials=new BM(new Aw(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new lf(this.firestore,e,this._query)}}class At{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}toJSON(){return{type:At._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Bu(t,At._jsonSchema))return new At(e,r||null,new fe(et.fromString(t.referencePath)))}}At._jsonSchemaVersion="firestore/documentReference/1.0",At._jsonSchema={type:It("string",At._jsonSchemaVersion),referencePath:It("string")};class mi extends lf{constructor(e,t,r){super(e,t,Xd(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new fe(e))}withConverter(e){return new mi(this.firestore,e,this._path)}}function VU(n,e,...t){if(n=Yt(n),ww("collection","path",e),n instanceof af){const r=et.fromString(e,...t);return LT(r),new mi(n,null,r)}{if(!(n instanceof At||n instanceof mi))throw new he(Z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(et.fromString(e,...t));return LT(r),new mi(n.firestore,null,r)}}function hm(n,e,...t){if(n=Yt(n),arguments.length===1&&(e=W0.newId()),ww("doc","path",e),n instanceof af){const r=et.fromString(e,...t);return bT(r),new At(n,null,new fe(r))}{if(!(n instanceof At||n instanceof mi))throw new he(Z.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(et.fromString(e,...t));return bT(r),new At(n.firestore,n instanceof mi?n.converter:null,new fe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS="AsyncQueue";class yS{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new vR(this,"async_queue_retry"),this._c=()=>{const r=um();r&&ae(pS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=um();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=um();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new di;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Va(e))throw e;ae(pS,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Ts("INTERNAL UNHANDLED ERROR: ",vS(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=dy.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ge(47125,{Pc:vS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function vS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Eu extends af{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new yS,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yS(e),this._firestoreClient=void 0,await e}}}function jU(n,e){const t=typeof n=="object"?n:O0(),r=typeof n=="string"?n:Yh,s=N0(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=VP("firestore");i&&$U(s,...i)}return s}function yy(n){if(n._terminated)throw new he(Z.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||GU(n),n._firestoreClient}function GU(n){var r,s,i,o;const e=n._freezeSettings(),t=BU(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,(s=n._app)==null?void 0:s.options.apiKey,e);n._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new PU(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hn(Qt.fromBase64String(e))}catch(t){throw new he(Z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Hn(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Hn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Bu(e,Hn._jsonSchema))return Hn.fromBase64String(e.bytes)}}Hn._jsonSchemaVersion="firestore/bytes/1.0",Hn._jsonSchema={type:It("string",Hn._jsonSchemaVersion),bytes:It("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(Z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(Z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(Z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ce(this._lat,e._lat)||Ce(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gr._jsonSchemaVersion}}static fromJSON(e){if(Bu(e,Gr._jsonSchema))return new Gr(e.latitude,e.longitude)}}Gr._jsonSchemaVersion="firestore/geoPoint/1.0",Gr._jsonSchema={type:It("string",Gr._jsonSchemaVersion),latitude:It("number"),longitude:It("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:mr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Bu(e,mr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new mr(e.vectorValues);throw new he(Z.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}mr._jsonSchemaVersion="firestore/vectorValue/1.0",mr._jsonSchema={type:It("string",mr._jsonSchemaVersion),vectorValues:It("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KU=/^__.*__$/;class HU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new So(e,this.data,this.fieldMask,t,this.fieldTransforms):new $u(e,this.data,t,this.fieldTransforms)}}function GR(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ge(40011,{dataSource:n})}}class vy{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new vy({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return id(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(GR(this.dataSource)&&KU.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class zU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||rf(e)}createContext(e,t,r,s=!1){return new vy({dataSource:e,methodName:t,targetDoc:r,path:zt.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function WU(n){const e=n._freezeSettings(),t=rf(n._databaseId);return new zU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function qU(n,e,t,r,s,i={}){const o=n.createContext(i.merge||i.mergeFields?2:0,e,t,s);WR("Data must be an object, but it was:",o,r);const a=HR(r,o);let l,u;if(i.merge)l=new cr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const c=[];for(const h of i.mergeFields){const d=Ey(e,h,t);if(!o.contains(d))throw new he(Z.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);XU(c,d)||c.push(d)}l=new cr(c),u=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=o.fieldTransforms;return new HU(new Kn(a),l,u)}function KR(n,e){if(zR(n=Yt(n)))return WR("Unsupported field value:",e,n),HR(n,e);if(n instanceof jR)return function(r,s){if(!GR(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=KR(a,s.childContextForArray(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Yt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return kF(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=tt.fromDate(r);return{timestampValue:td(s.serializer,i)}}if(r instanceof tt){const i=new tt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:td(s.serializer,i)}}if(r instanceof Gr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Hn)return{bytesValue:oR(s.serializer,r._byteString)};if(r instanceof At){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.createError(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ry(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof mr)return function(o,a){const l=o instanceof mr?o.toArray():o;return{mapValue:{fields:{[Ow]:{stringValue:Mw},[Qh]:{arrayValue:{values:l.map(c=>{if(typeof c!="number")throw a.createError("VectorValues must only contain numeric values.");return ey(a.serializer,c)})}}}}}}(r,s);if(fR(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${q0(r)}`)}(n,e)}function HR(n,e){const t={};return Lw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Eo(n,(r,s)=>{const i=KR(s,e.childContextForField(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function zR(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof tt||n instanceof Gr||n instanceof Hn||n instanceof At||n instanceof jR||n instanceof mr||fR(n))}function WR(n,e,t){if(!zR(t)||!Rw(t)){const r=q0(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Ey(n,e,t){if((e=Yt(e))instanceof VR)return e._internalPath;if(typeof e=="string")return QU(n,e);throw id("Field path arguments must be of type string or ",n,!1,void 0,t)}const YU=new RegExp("[~\\*/\\[\\]]");function QU(n,e,t){if(e.search(YU)>=0)throw id(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new VR(...e.split("."))._internalPath}catch{throw id(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function id(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new he(Z.INVALID_ARGUMENT,a+n+l)}function XU(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{convertValue(e,t="none"){switch(Si(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ti(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ge(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Eo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Qh].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>yt(o.doubleValue));return new mr(t)}convertGeoPoint(e){return new Gr(yt(e.latitude),yt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Yd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(mu(e));default:return null}}convertTimestamp(e){const t=Ei(e);return new tt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=et.fromString(e);Be(dR(r),9688,{name:e});const s=new gu(r.get(1),r.get(3)),i=new fe(r.popFirst(5));return s.isEqual(t)||Ts(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR extends JU{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}const ES="@firebase/firestore",TS="4.11.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SS(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ZU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(Ey("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ZU extends YR{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eB(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new he(Z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function tB(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class _l{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zi extends YR{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new oh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ey("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new he(Z.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Zi._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Zi._jsonSchemaVersion="firestore/documentSnapshot/1.0",Zi._jsonSchema={type:It("string",Zi._jsonSchemaVersion),bundleSource:It("string","DocumentSnapshot"),bundleName:It("string"),bundle:It("string")};class oh extends Zi{data(e={}){return super.data(e)}}class ua{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new _l(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new oh(this._firestore,this._userDataWriter,r.key,r,new _l(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(Z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new oh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _l(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new oh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _l(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,c=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),c=o.indexOf(a.doc.key)),{type:nB(a.type),doc:l,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new he(Z.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ua._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=W0.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function nB(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ge(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ua._jsonSchemaVersion="firestore/querySnapshot/1.0",ua._jsonSchema={type:It("string",ua._jsonSchemaVersion),bundleSource:It("string","QuerySnapshot"),bundleName:It("string"),bundle:It("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rB(n){n=fi(n,At);const e=fi(n.firestore,Eu),t=yy(e);return MU(t,n._key).then(r=>QR(e,n,r))}function sB(n,e,t){n=fi(n,At);const r=fi(n.firestore,Eu),s=tB(n.converter,e,t),i=WU(r);return iB(r,[qU(i,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,fs.none())])}function _S(n,...e){var u,c,h;n=Yt(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||SS(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(SS(e[r])){const d=e[r];e[r]=(u=d.next)==null?void 0:u.bind(d),e[r+1]=(c=d.error)==null?void 0:c.bind(d),e[r+2]=(h=d.complete)==null?void 0:h.bind(d)}let i,o,a;if(n instanceof At)o=fi(n.firestore,Eu),a=Xd(n._key.path),i={next:d=>{e[r]&&e[r](QR(o,n,d))},error:e[r+1],complete:e[r+2]};else{const d=fi(n,lf);o=fi(d.firestore,Eu),a=d._query;const m=new qR(o);i={next:g=>{e[r]&&e[r](new ua(o,m,d,g))},error:e[r+1],complete:e[r+2]},eB(n._query)}const l=yy(o);return OU(l,a,s,i)}function iB(n,e){const t=yy(n);return FU(t,e)}function QR(n,e,t){const r=t.docs.get(e._key),s=new qR(n);return new Zi(n,s,e._key,r,new _l(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){FM(Fa),xa(new lo("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Eu(new $M(r.getProvider("auth-internal")),new GM(o,r.getProvider("app-check-internal")),oF(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ci(ES,TS,e),ci(ES,TS,"esm2020")})();var oB="firebase",aB="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ci(oB,aB,"app");const xl={apiKey:"AIzaSyAXwrTMoVbw4O4ExiP1DjEKrq7ERZC4ncs",authDomain:"webanime-b4e20.firebaseapp.com",projectId:"webanime-b4e20",storageBucket:"webanime-b4e20.firebasestorage.app",messagingSenderId:"545359272392",appId:"1:545359272392:web:069bed61b416cbf75d88fd"},up=!!(xl.apiKey&&xl.authDomain&&xl.projectId&&xl.appId),od=up?oN().length?O0():NA(xl):null,Zr=od?OM(od):null,Fs=od?jU(od):null,xS=new as;function lB(n){return!Array.isArray(n)||n.length===0?"":n[Math.floor(Math.random()*n.length)]}const uB=["anime-boy-kaito","anime-boy-ren","anime-boy-haruto","anime-boy-shin","anime-boy-yuki","anime-boy-riku"],cB=["anime-girl-akari","anime-girl-hina","anime-girl-mio","anime-girl-yuna","anime-girl-sora","anime-girl-rin"];function hB(){const n=Math.random()<.5,e=lB(n?uB:cB);return`https://api.dicebear.com/7.x/adventurer/svg?seed=${encodeURIComponent(e)}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`}const XR=$.createContext(null),_c="users",dB="animex_users",JR="animex_ad_slot",ZR="animex_ad_link",eb="animex_ad_links",tb=10,Ty=new Set(["top-center","bottom-right","bottom-left","middle-right","middle-left"]);function eo(n){const e=String(n||"").trim();return e?/^https?:\/\//i.test(e)?e:`https://${e}`:""}function nb(n){return{id:`slot-${n+1}`,slot:n+1,url:"",imageUrl:"",durationDays:7,startAt:"",endAt:""}}function Il(n,e=0){const t=nb(e),r=Number((n==null?void 0:n.slot)||t.slot),s=Number.isInteger(r)&&r>0?r:t.slot,i=eo((n==null?void 0:n.url)||""),o=eo((n==null?void 0:n.imageUrl)||""),a=Number(n==null?void 0:n.durationDays),l=Number.isFinite(a)?Math.max(1,Math.min(3650,Math.floor(a))):7,u=String((n==null?void 0:n.startAt)||""),c=String((n==null?void 0:n.endAt)||""),h=new Date(u).getTime(),d=new Date(c).getTime();return{id:String((n==null?void 0:n.id)||t.id),slot:s,url:i,imageUrl:o,durationDays:l,startAt:Number.isFinite(h)?new Date(h).toISOString():"",endAt:Number.isFinite(d)?new Date(d).toISOString():""}}function ca(n){const e=Array.isArray(n)?n:[];return Array.from({length:tb},(t,r)=>{const s=e.find(i=>Number(i==null?void 0:i.slot)===r+1);return Il(s||nb(r),r)})}function IS(n){if(!(n!=null&&n.url)||!(n!=null&&n.endAt))return!1;const e=new Date(n.endAt).getTime();return Number.isFinite(e)&&e>Date.now()}function fB(){const n="admin@animex.local";return new Set(n.split(",").map(e=>e.trim().toLowerCase()).filter(Boolean))}function mB(n){return!(n!=null&&n.active)||!(n!=null&&n.expireAt)?!1:new Date(n.expireAt).getTime()>Date.now()}function Ar(n){var t,r,s;const e=mB(n==null?void 0:n.premium);return{id:String((n==null?void 0:n.id)||""),email:String((n==null?void 0:n.email)||"").trim().toLowerCase(),username:String((n==null?void 0:n.username)||"User"),photoUrl:String((n==null?void 0:n.photoUrl)||""),role:(n==null?void 0:n.role)==="admin"?"admin":"user",premium:{active:e,plan:e&&((t=n==null?void 0:n.premium)==null?void 0:t.plan)||"",days:e?Number(((r=n==null?void 0:n.premium)==null?void 0:r.days)||0):0,expireAt:e&&((s=n==null?void 0:n.premium)==null?void 0:s.expireAt)||""},watchHistory:Array.isArray(n==null?void 0:n.watchHistory)?n.watchHistory.slice(0,200):[],watchlist:Array.isArray(n==null?void 0:n.watchlist)?n.watchlist.slice(0,200):[],watchedEpisodes:n!=null&&n.watchedEpisodes&&typeof n.watchedEpisodes=="object"?n.watchedEpisodes:{}}}function gB(){try{const n=localStorage.getItem(dB),e=n?JSON.parse(n):[];return Array.isArray(e)?e.map(Ar):[]}catch{return[]}}function pB(n,e){const t=String(e||"").trim().toLowerCase(),r=gB();return r.find(s=>s.id===n)||r.find(s=>String(s.email||"").toLowerCase()===t)||null}function yB(){const n=localStorage.getItem(JR)||"top-center";return Ty.has(n)?n:"top-center"}function vB(n){Ty.has(n)&&localStorage.setItem(JR,n)}function EB(){return eo(localStorage.getItem(ZR)||"")}function AS(n){localStorage.setItem(ZR,eo(n))}function TB(){try{const n=localStorage.getItem(eb),e=n?JSON.parse(n):[],t=ca(e);if(t.some(i=>i.url))return t;const s=EB();return s?ca([{id:"slot-1",slot:1,url:s,durationDays:30,startAt:new Date().toISOString(),endAt:new Date(Date.now()+2592e6).toISOString()}]):t}catch{return ca([])}}function wS(n){localStorage.setItem(eb,JSON.stringify(ca(n)))}function dm(n,e){const t=String((n==null?void 0:n.code)||"");return t==="auth/invalid-credential"?"Mungkin Email/Password yang kamu masukkan salah":t==="auth/operation-not-supported-in-this-environment"?"Browser tidak mendukung popup login. Coba lagi, nanti otomatis pakai redirect.":(n==null?void 0:n.message)||e}function SB(){if(typeof window>"u"||typeof navigator>"u")return!1;const n=String(navigator.userAgent||"").toLowerCase(),e=n.includes("wv")||n.includes("android")&&n.includes("version/"),t=/iphone|ipad|ipod/.test(n)&&!n.includes("safari"),r=n.includes("; wv")||n.includes("webview");return e||t||r}function _B({children:n}){const[e,t]=$.useState([]),[r,s]=$.useState(null),[i,o]=$.useState(!1),[a,l]=$.useState(()=>yB()),[u,c]=$.useState(()=>TB()),h=$.useMemo(()=>fB(),[]),d=$.useMemo(()=>SB(),[]),m=!d,g=$.useMemo(()=>u.filter(O=>IS(O)),[u]),y=$.useMemo(()=>{var O,K;return((O=g[0])==null?void 0:O.url)||((K=u.find(Q=>Q.url))==null?void 0:K.url)||""},[g,u]),v=O=>{t(K=>K.findIndex(Y=>Y.id===O.id)<0?[...K,O]:K.map(Y=>Y.id===O.id?O:Y))},E=O=>{!Fs||!(O!=null&&O.id)||sB(hm(Fs,_c,O.id),Ar(O),{merge:!0}).catch(()=>{})};$.useEffect(()=>{if(!up||!Zr){o(!0);return}const O=_O(Zr,K=>{if(s(K||null),!K){t([]),o(!0);return}const Q=String(K.email||"").toLowerCase(),Y=h.has(Q)?"admin":"user";(async()=>{let ee=null;if(Fs)try{const st=await rB(hm(Fs,_c,K.uid));st.exists()&&(ee=Ar({...st.data(),id:K.uid}))}catch{ee=null}const de=pB(K.uid,Q),Ae=Ar({id:K.uid,email:Q,username:K.displayName||Q.split("@")[0]||"User",photoUrl:hB(),role:Y,premium:{active:!1,plan:"",days:0,expireAt:""},watchHistory:[],watchlist:[],watchedEpisodes:{}}),_e=Ar({...Ae,...de||{},...ee||{},id:K.uid,email:Q,username:K.displayName||(ee==null?void 0:ee.username)||(de==null?void 0:de.username)||Ae.username,role:(ee==null?void 0:ee.role)==="admin"||(de==null?void 0:de.role)==="admin"||Y==="admin"?"admin":"user"});v(_e),E(_e),o(!0)})()});return()=>O()},[h]);const p=$.useMemo(()=>r&&e.find(O=>O.id===r.uid)||null,[e,r]);$.useEffect(()=>{if(!Fs||!(r!=null&&r.uid))return;const O=String(r.email||"").toLowerCase();return h.has(O)||(p==null?void 0:p.role)==="admin"?_S(VU(Fs,_c),Y=>{const ee=Y.docs.map(de=>Ar({...de.data(),id:de.id})).filter(de=>de.id);t(ee)},()=>{}):_S(hm(Fs,_c,r.uid),Y=>{Y.exists()&&t([Ar({...Y.data(),id:r.uid})])},()=>{})},[r==null?void 0:r.uid,r==null?void 0:r.email,p==null?void 0:p.role,h]);const S=()=>!up||!Zr?{ok:!1,error:"Layanan autentikasi belum tersedia. Coba lagi beberapa saat."}:Fs?null:{ok:!1,error:"Firestore belum aktif di aplikasi."},L=async({email:O,username:K,password:Q})=>{const Y=S();if(Y)return Y;try{const ee=await gO(Zr,String(O||"").trim(),String(Q||""));return K&&await gT(ee.user,{displayName:String(K).trim()}),s(ee.user),{ok:!0}}catch(ee){return{ok:!1,error:(ee==null?void 0:ee.message)||"Signup gagal."}}},D=async({email:O,password:K})=>{const Q=S();if(Q)return Q;try{const Y=await pO(Zr,String(O||"").trim(),String(K||""));return await Y.user.reload(),s(Zr.currentUser||Y.user),{ok:!0}}catch(Y){return{ok:!1,error:dm(Y,"Login gagal.")}}},F=async()=>{const O=S();if(O)return O;if(!m)return{ok:!1,error:"Google login tidak didukung di APK/WebView. Buka di browser eksternal."};try{const K=await GO(Zr,xS);return s(K.user),{ok:!0}}catch(K){const Q=String((K==null?void 0:K.code)||"");if(Q==="auth/operation-not-supported-in-this-environment"||Q==="auth/popup-blocked"||Q==="auth/popup-closed-by-user")try{return await YO(Zr,xS),{ok:!0}}catch(ee){return{ok:!1,error:dm(ee,"Login Google gagal.")}}return{ok:!1,error:dm(K,"Login Google gagal.")}}},A=async()=>{S()||await xO(Zr)},x=O=>{if(!p)return{ok:!1,error:"User tidak ditemukan."};const K=Ar(O(p));return v(K),E(K),{ok:!0}},R=async O=>{if(!p||!r)return{ok:!1,error:"User tidak ditemukan."};try{if(await gT(r,{displayName:(O==null?void 0:O.username)??p.username}),O!=null&&O.password)try{await vO(r,String(O.password))}catch{return{ok:!1,error:"Gagal update password. Login ulang lalu coba lagi."}}return x(K=>({...K,username:(O==null?void 0:O.username)??K.username}))}catch(K){return{ok:!1,error:(K==null?void 0:K.message)||"Update profile gagal."}}},b=(O,K)=>{if(!p||p.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const Q=e.find(ee=>ee.id===O);if(!Q)return{ok:!1,error:"User tidak ditemukan."};const Y=Ar({...Q,username:(K==null?void 0:K.username)??Q.username});return v(Y),E(Y),{ok:!0}},C=(O,{plan:K,days:Q})=>{if(!p||p.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const Y=e.find(st=>st.id===O);if(!Y)return{ok:!1,error:"User tidak ditemukan."};const ee=Math.max(0,Number(Q||0)),de=new Date(Date.now()+ee*864e5).toISOString(),Ae=ee>0?{active:!0,plan:String(K||"Premium"),days:ee,expireAt:de}:{active:!1,plan:"",days:0,expireAt:""},_e=Ar({...Y,premium:Ae});return v(_e),E(_e),{ok:!0}},M=({email:O,days:K})=>{if(!p||p.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const Q=String(O||"").trim().toLowerCase(),Y=e.find(ee=>String(ee.email).toLowerCase()===Q);return Y?C(Y.id,{plan:"Premium Plan",days:K}):{ok:!1,error:"Email user tidak ditemukan."}},k=O=>{const K=String((O==null?void 0:O.animeId)||"").trim();return K?x(Q=>{const ee=(Array.isArray(Q.watchlist)?Q.watchlist:[]).filter(de=>String(de==null?void 0:de.animeId)!==K);return{...Q,watchlist:[{animeId:K,title:(O==null?void 0:O.title)||"Untitled Donghua",poster:(O==null?void 0:O.poster)||"",source:(O==null?void 0:O.source)||"anichin",slug:(O==null?void 0:O.slug)||"",addedAt:new Date().toISOString()},...ee].slice(0,200)}}):{ok:!1,error:"animeId wajib ada."}},re=O=>{const K=String(O||"").trim();return K?x(Q=>({...Q,watchlist:(Array.isArray(Q.watchlist)?Q.watchlist:[]).filter(Y=>String(Y==null?void 0:Y.animeId)!==K)})):{ok:!1,error:"animeId wajib ada."}},te=O=>{const K=String((O==null?void 0:O.animeId)||"").trim();if(!K)return{ok:!1,error:"animeId wajib ada."};const Q=String((O==null?void 0:O.episodeId)||(O==null?void 0:O.episodeNumber)||"").trim();return Q?x(Y=>{const ee={...(Y==null?void 0:Y.watchedEpisodes)||{}},de=Array.isArray(ee[K])?ee[K]:[];de.includes(Q)||(ee[K]=[Q,...de].slice(0,300));const Ae=Array.isArray(Y==null?void 0:Y.watchHistory)?Y.watchHistory:[],_e=`${K}:${Q}`,st={id:_e,animeId:K,episodeId:(O==null?void 0:O.episodeId)||"",episodeNumber:(O==null?void 0:O.episodeNumber)||null,title:(O==null?void 0:O.title)||"Untitled Donghua",episodeTitle:(O==null?void 0:O.episodeTitle)||"",poster:(O==null?void 0:O.poster)||"",source:(O==null?void 0:O.source)||"anichin",slug:(O==null?void 0:O.slug)||"",watchedAt:new Date().toISOString()};return{...Y,watchedEpisodes:ee,watchHistory:[st,...Ae.filter(Fe=>(Fe==null?void 0:Fe.id)!==_e)].slice(0,200)}}):{ok:!1,error:"episodeId/episodeNumber wajib ada."}},J=O=>!p||p.role!=="admin"?{ok:!1,error:"Akses admin dibutuhkan."}:Ty.has(O)?(l(O),vB(O),{ok:!0}):{ok:!1,error:"Posisi slot tidak valid."},W=O=>{if(!p||p.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const K=eo(O);return K&&!/^https?:\/\/[^\s]+$/i.test(K)?{ok:!1,error:"Format link iklan tidak valid."}:(c(Q=>{var ee,de;const Y=ca(Q);if(!K)Y[0]=Il({...Y[0],url:"",startAt:"",endAt:""},0);else{const Ae=Date.now();Y[0]=Il({...Y[0],url:K,durationDays:((ee=Y[0])==null?void 0:ee.durationDays)||30,startAt:new Date(Ae).toISOString(),endAt:new Date(Ae+Number(((de=Y[0])==null?void 0:de.durationDays)||30)*864e5).toISOString()},0)}return wS(Y),AS(K),Y}),{ok:!0})},U=({slot:O,link:K,imageUrl:Q,durationDays:Y})=>{if(!p||p.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const ee=Number(O);if(!Number.isInteger(ee)||ee<1||ee>tb)return{ok:!1,error:"Slot iklan harus 1-10."};const de=eo(K);if(de&&!/^https?:\/\/[^\s]+$/i.test(de))return{ok:!1,error:"Format link iklan tidak valid."};const Ae=eo(Q);if(Ae&&!/^https?:\/\/[^\s]+$/i.test(Ae))return{ok:!1,error:"Format URL gambar iklan tidak valid."};const _e=Math.max(1,Math.min(3650,Math.floor(Number(Y)||0)));return de&&!_e?{ok:!1,error:"Durasi iklan harus lebih dari 0 hari."}:(c(st=>{var An;const Fe=ca(st),on=ee-1;if(!de)Fe[on]=Il({...Fe[on],url:"",imageUrl:"",startAt:"",endAt:"",durationDays:_e},on);else{const wn=Date.now();Fe[on]=Il({...Fe[on],slot:ee,url:de,imageUrl:Ae,durationDays:_e,startAt:new Date(wn).toISOString(),endAt:new Date(wn+_e*864e5).toISOString()},on)}return wS(Fe),ee===1&&AS(((An=Fe[on])==null?void 0:An.url)||""),Fe}),{ok:!0})},H=$.useCallback(()=>{const O=u.filter(K=>IS(K)&&K.url);return O.length?O.length===1?O[0]:O[Math.floor(Math.random()*O.length)]||null:null},[u]),N=$.useCallback(()=>{var O;return((O=H())==null?void 0:O.url)||""},[H]),B=$.useMemo(()=>({user:p,users:e,ready:i,isLoggedIn:!!(r!=null&&r.uid),isAdmin:(p==null?void 0:p.role)==="admin",isWebView:d,canUseGoogleAuth:m,signUp:L,signIn:D,signInWithGoogle:F,signOut:A,updateProfile:R,adminUpdateUser:b,adminSetPremium:C,adminSetPremiumByEmail:M,watchHistory:Array.isArray(p==null?void 0:p.watchHistory)?p.watchHistory:[],watchlist:Array.isArray(p==null?void 0:p.watchlist)?p.watchlist:[],watchedEpisodes:(p==null?void 0:p.watchedEpisodes)||{},addToWatchlist:k,removeFromWatchlist:re,markEpisodeWatched:te,adSlot:a,adminSetAdSlot:J,adLinks:u,adLink:y,adminSetAdLink:W,adminSetAdLinkSlot:U,getRandomActiveAdEntry:H,getRandomActiveAdLink:N}),[p,e,i,a,u,y,r,d,m,H,N]);return w.jsx(XR.Provider,{value:B,children:n})}function In(){const n=$.useContext(XR);if(!n)throw new Error("useAuth must be used inside AuthProvider");return n}function xB(){var h;const{user:n,isLoggedIn:e,isAdmin:t,signOut:r}=In(),s=Pu(),i=qr(),[o,a]=$.useState(!1),l=$.useRef(null),u=()=>{a(!1),l.current&&l.current.removeAttribute("open")};$.useEffect(()=>{a(!1),l.current&&l.current.removeAttribute("open")},[i.pathname]);const c=({isActive:d})=>`rounded-full px-3 py-1.5 text-sm transition ${d?"bg-white/10 text-white":"text-slate-300 hover:text-white"}`;return w.jsxs("header",{className:"sticky top-0 z-40 border-b border-white/10 bg-slate-950/75 backdrop-blur-xl",children:[w.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8",children:[w.jsxs(Pt,{to:"/",className:"font-heading text-xl font-bold tracking-tight text-white",children:["Donghua",w.jsx("span",{className:"bg-gradient-to-r from-fuchsia-400 to-cyan-300 bg-clip-text text-transparent",children:"X"})]}),w.jsxs("button",{type:"button",className:"rounded-lg border border-white/15 p-2 text-slate-300 md:hidden",onClick:()=>a(d=>!d),"aria-expanded":o,"aria-controls":"mobile-nav",children:[w.jsx("span",{className:"sr-only",children:"Toggle menu"}),o?w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:w.jsx("path",{d:"M6 6L18 18M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}):w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:w.jsx("path",{d:"M4 7H20M4 12H20M4 17H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),w.jsxs("nav",{className:"hidden items-center gap-2 md:flex",children:[w.jsx(nr,{to:"/",className:c,children:"Home"}),w.jsx(nr,{to:"/history",className:c,children:"Riwayat"}),w.jsx(nr,{to:"/watchlist",className:c,children:"Watchlist"}),e?w.jsxs("details",{ref:l,className:"relative ml-2",children:[w.jsxs("summary",{className:"flex cursor-pointer list-none items-center gap-2 rounded-full border border-white/15 bg-white/5 px-2 py-1.5",children:[w.jsx("div",{className:"h-8 w-8 overflow-hidden rounded-full border border-white/20 bg-slate-800",children:n!=null&&n.photoUrl?w.jsx("img",{src:n.photoUrl,alt:n.username||"Profile",className:"h-full w-full object-cover"}):null}),w.jsx("span",{className:"max-w-40 truncate text-sm font-semibold text-white",children:(n==null?void 0:n.username)||(n==null?void 0:n.email)})]}),w.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-2xl border border-white/15 bg-slate-950/95 p-2 shadow-xl",children:[w.jsxs("div",{className:"mb-1 rounded-xl bg-white/5 px-3 py-2",children:[w.jsx("p",{className:"text-xs text-slate-300",children:n==null?void 0:n.email}),(h=n==null?void 0:n.premium)!=null&&h.active?w.jsx("p",{className:"mt-1 text-xs font-semibold text-amber-300",children:n.premium.plan}):w.jsx("p",{className:"mt-1 text-xs font-semibold text-slate-400",children:"Free Plan"})]}),w.jsx(Pt,{to:"/account",onClick:u,className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Account"}),w.jsx(Pt,{to:"/premium",onClick:u,className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Premium"}),t?w.jsx(Pt,{to:"/admin",onClick:u,className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Admin Panel"}):null,w.jsx("button",{onClick:()=>{u(),r(),s("/login")},className:"mt-1 block w-full rounded-xl px-3 py-2 text-left text-sm text-slate-200 hover:bg-white/10",type:"button",children:"Logout"})]})]}):w.jsx(nr,{to:"/login",className:"rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Login"})]})]}),o?w.jsx("div",{id:"mobile-nav",className:"border-t border-white/10 bg-slate-950/95 px-4 py-3 md:hidden",children:w.jsxs("div",{className:"flex flex-col gap-2",children:[w.jsx(nr,{to:"/",className:c,onClick:()=>a(!1),children:"Home"}),w.jsx(nr,{to:"/history",className:c,onClick:()=>a(!1),children:"Riwayat"}),w.jsx(nr,{to:"/watchlist",className:c,onClick:()=>a(!1),children:"Watchlist"}),e?w.jsxs(w.Fragment,{children:[w.jsx(nr,{to:"/account",className:c,onClick:()=>a(!1),children:"Account"}),w.jsx(nr,{to:"/premium",className:c,onClick:()=>a(!1),children:"Premium"}),t?w.jsx(nr,{to:"/admin",className:c,onClick:()=>a(!1),children:"Admin Panel"}):null,w.jsx("button",{type:"button",onClick:()=>{a(!1),r(),s("/login")},className:"rounded-full border border-white/15 bg-white/5 px-3 py-1.5 text-left text-sm text-slate-200 transition hover:bg-white/10",children:"Logout"})]}):w.jsx(nr,{to:"/login",onClick:()=>a(!1),className:"rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Login"})]})}):null]})}function IB(){return w.jsx("footer",{className:"mt-8 border-t border-white/10 bg-slate-950/70",children:w.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-col gap-3 px-3 py-5 text-sm text-slate-300 sm:px-5 md:flex-row md:items-center md:justify-between lg:px-8",children:[w.jsxs("p",{className:"text-xs text-slate-400",children:[" ",new Date().getFullYear()," DonghuaX. All rights reserved."]}),w.jsxs("nav",{className:"flex flex-wrap items-center gap-3",children:[w.jsx(Pt,{to:"/about",className:"transition hover:text-white",children:"About"}),w.jsx(Pt,{to:"/contact",className:"transition hover:text-white",children:"Contact"}),w.jsx(Pt,{to:"/privacy-policy",className:"transition hover:text-white",children:"Privacy Policy"})]})]})})}function AB(){var h;const{user:n,updateProfile:e}=In(),[t,r]=$.useState(n.username||""),[s,i]=$.useState(n.email||""),[o,a]=$.useState(n.password||""),[l,u]=$.useState(""),c=d=>{d.preventDefault();const m=e({username:t,email:s,password:o});u(m.ok?"Profile berhasil diupdate.":m.error)};return w.jsxs("section",{className:"mx-auto max-w-3xl rounded-3xl border border-cyan-400/20 bg-zinc-950/90 p-5 sm:p-6",children:[w.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Account"}),w.jsx("p",{className:"mt-1 text-sm text-zinc-300",children:"Ubah profil akun kapan saja."})]}),w.jsxs("div",{className:"relative h-16 w-16 overflow-hidden rounded-2xl border border-cyan-400/20 bg-zinc-900",children:[n!=null&&n.photoUrl?w.jsx("img",{src:n.photoUrl,alt:t||"Profile",className:"h-full w-full object-cover"}):null,w.jsx("span",{className:"absolute bottom-1 left-1 rounded-full bg-black/70 px-2 py-0.5 text-[10px] font-semibold text-amber-300",children:(h=n==null?void 0:n.premium)!=null&&h.active?n.premium.plan:"Free"})]})]}),w.jsxs("form",{onSubmit:c,className:"mt-5 space-y-3",children:[w.jsxs("label",{className:"block text-sm text-zinc-300",children:["Username",w.jsx("input",{className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:t,onChange:d=>r(d.target.value),required:!0})]}),w.jsxs("label",{className:"block text-sm text-zinc-300",children:["Email",w.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:s,onChange:d=>i(d.target.value),required:!0})]}),w.jsxs("label",{className:"block text-sm text-zinc-300",children:["Password",w.jsx("input",{type:"text",className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:o,onChange:d=>a(d.target.value),required:!0})]}),w.jsx("p",{className:"text-xs text-zinc-400",children:"Foto profil dikunci otomatis oleh sistem avatar random donghua."}),l?w.jsx("p",{className:"text-sm text-cyan-200",children:l}):null,w.jsx("button",{className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",type:"submit",children:"Save Changes"})]})]})}function Vl(n){return String(n||"").toLowerCase().trim().replace(/\s+/g," ")}function wB(n,e){const t=Vl(n),r=Vl(e);if(!t)return r.length;if(!r)return t.length;const s=Array.from({length:t.length+1},()=>Array(r.length+1).fill(0));for(let i=0;i<=t.length;i+=1)s[i][0]=i;for(let i=0;i<=r.length;i+=1)s[0][i]=i;for(let i=1;i<=t.length;i+=1)for(let o=1;o<=r.length;o+=1){const a=t[i-1]===r[o-1]?0:1;s[i][o]=Math.min(s[i-1][o]+1,s[i][o-1]+1,s[i-1][o-1]+a)}return s[t.length][r.length]}function RB(n){const e=new Date(n).getTime();if(!Number.isFinite(e))return 0;const t=e-Date.now();return t>0?Math.ceil(t/864e5):0}function bB(){var H;const{users:n,user:e,adminUpdateUser:t,adminSetPremiumByEmail:r,adSlot:s,adminSetAdSlot:i,adLinks:o,adminSetAdLink:a,adminSetAdLinkSlot:l}=In(),u=$.useMemo(()=>n.filter(N=>N.role!=="admin"||N.id===(e==null?void 0:e.id)),[n,e==null?void 0:e.id]),[c,h]=$.useState(((H=u[0])==null?void 0:H.id)||""),[d,m]=$.useState(""),[g,y]=$.useState({email:"",days:30}),[v,E]=$.useState(""),[p,S]=$.useState([]),L=$.useMemo(()=>Vl(v),[v]),D=$.useMemo(()=>L.split(" ").map(N=>N.trim()).filter(Boolean),[L]),F=D.length>=2&&D.length<=3,A=$.useMemo(()=>L?u.filter(N=>{const B=Vl(N.username);return B?D.every(O=>B.includes(O)):!1}):u,[u,L,D]),x=$.useMemo(()=>{if(!L||A.length>0)return[];const N=L.replace(/\s+/g,""),B=Math.max(2,Math.floor(N.length*.4));return u.map(O=>{const K=Vl(O.username),Q=K.replace(/\s+/g,""),Y=K.includes(L)||K.startsWith(L),ee=wB(N,Q);return{item:O,distance:ee,directMatch:Y}}).filter(O=>O.directMatch||O.distance<=B).sort((O,K)=>O.directMatch&&!K.directMatch?-1:!O.directMatch&&K.directMatch?1:O.distance-K.distance).slice(0,5).map(O=>O.item)},[u,L,A.length]),R=L?A:u,b=$.useMemo(()=>u.find(N=>N.id===c)||null,[u,c]),[C,M]=$.useState({username:"",email:"",password:""}),k=N=>{var B;M({username:(N==null?void 0:N.username)||"",email:(N==null?void 0:N.email)||"",password:(N==null?void 0:N.password)||""}),y({email:(N==null?void 0:N.email)||"",days:Number(((B=N==null?void 0:N.premium)==null?void 0:B.days)||30)})},re=N=>{h(N),m("")};$.useEffect(()=>{if(!u.length)return;if(!c||!u.some(B=>B.id===c)){const B=R[0]||u[0];B!=null&&B.id&&h(B.id);return}const N=u.find(B=>B.id===c);k(N)},[u,c,R]),$.useEffect(()=>{S((Array.isArray(o)?o:[]).map(N=>({slot:Number((N==null?void 0:N.slot)||0),link:(N==null?void 0:N.url)||"",imageUrl:(N==null?void 0:N.imageUrl)||"",durationDays:Number((N==null?void 0:N.durationDays)||7)})))},[o]);const te=N=>{if(N.preventDefault(),!b)return;const B=t(b.id,{username:C.username,email:C.email,password:C.password});m(B.ok?"User berhasil diupdate.":B.error)},J=()=>{const N=r({email:g.email,days:Number(g.days)});m(N.ok?"Premium plan berhasil diupdate.":N.error)},W=(N,B)=>{S(O=>O.map(K=>K.slot===N?{...K,...B}:K))},U=[{value:"top-center",label:"Atas Tengah"},{value:"bottom-right",label:"Kanan Bawah"},{value:"bottom-left",label:"Kiri Bawah"},{value:"middle-right",label:"Kanan Tengah"},{value:"middle-left",label:"Kiri Tengah"}];return w.jsxs("section",{className:"space-y-6",children:[w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-5 backdrop-blur xl:p-7",children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Admin Panel"}),w.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Kelola user, premium plan, dan 10 slot link iklan dengan durasi aktif."})]}),w.jsxs("div",{className:"grid gap-6 lg:grid-cols-[320px,1fr]",children:[w.jsxs("aside",{className:"rounded-3xl border border-white/10 bg-slate-950/60 p-4",children:[w.jsx("p",{className:"mb-3 text-xs uppercase tracking-[0.2em] text-slate-400",children:"User List"}),w.jsx("input",{value:v,onChange:N=>E(N.target.value),placeholder:"Search nickname (2-3 kata)",className:"mb-3 w-full rounded-xl border border-white/10 bg-slate-900 px-3 py-2.5 text-sm text-white outline-none focus:border-cyan-300/60"}),L&&!F?w.jsx("p",{className:"mb-3 text-xs text-amber-300",children:"Rekomendasi optimal: pakai 2-3 kata pencarian."}):null,w.jsxs("div",{className:"space-y-2",children:[R.map(N=>{var B;return w.jsxs("button",{type:"button",onClick:()=>re(N.id),className:`w-full rounded-2xl border px-3 py-3 text-left transition ${c===N.id?"border-cyan-300/60 bg-cyan-400/10":"border-white/10 bg-white/5 hover:border-white/20"}`,children:[w.jsx("p",{className:"font-semibold text-white",children:N.username}),w.jsx("p",{className:"text-xs text-slate-400",children:N.email}),w.jsx("p",{className:"mt-1 text-[11px] text-amber-300",children:(B=N.premium)!=null&&B.active?`${N.premium.plan} (${N.premium.days} hari)`:"Free Plan"})]},N.id)}),L&&!R.length?w.jsx("p",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-300",children:"Tidak ada user yang cocok."}):null]}),x.length?w.jsxs("div",{className:"mt-3 rounded-2xl border border-cyan-400/20 bg-cyan-500/5 p-3",children:[w.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-cyan-200",children:"Rekomendasi Search"}),w.jsx("div",{className:"mt-2 space-y-2",children:x.map(N=>w.jsx("button",{type:"button",onClick:()=>{E(N.username||""),re(N.id)},className:"w-full rounded-lg border border-white/10 bg-white/5 px-2 py-2 text-left text-xs text-slate-200 hover:border-cyan-300/50",children:N.username},`suggest-${N.id}`))})]}):null]}),w.jsx("div",{className:"rounded-3xl border border-white/10 bg-slate-950/60 p-5",children:b?w.jsxs("form",{onSubmit:te,className:"space-y-4",children:[w.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[w.jsxs("label",{className:"text-sm text-slate-300",children:["Username",w.jsx("input",{value:C.username,onChange:N=>M(B=>({...B,username:N.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]}),w.jsxs("label",{className:"text-sm text-slate-300",children:["Email",w.jsx("input",{type:"email",value:C.email,onChange:N=>M(B=>({...B,email:N.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]}),w.jsxs("label",{className:"text-sm text-slate-300",children:["Password",w.jsx("input",{value:C.password,onChange:N=>M(B=>({...B,password:N.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]})]}),w.jsx("p",{className:"text-xs text-slate-400",children:"Foto profil dikunci otomatis (random donghua avatar) dan tidak bisa diubah admin."}),w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-sm font-semibold text-white",children:"Premium Plan"}),w.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-[1fr,120px,auto]",children:[w.jsx("input",{value:g.email,onChange:N=>y(B=>({...B,email:N.target.value})),className:"rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",placeholder:"email user"}),w.jsx("input",{type:"number",min:"0",value:g.days,onChange:N=>y(B=>({...B,days:N.target.value})),className:"rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60"}),w.jsx("button",{type:"button",onClick:J,className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Set Premium"})]})]}),w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-sm font-semibold text-white",children:"Advertisement Slot Position"}),w.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Posisi overlay iklan untuk user Free Plan di halaman watch."}),w.jsxs("div",{className:"mt-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[w.jsx("select",{value:s,onChange:N=>{const B=i(N.target.value);m(B.ok?"Posisi iklan berhasil diupdate.":B.error)},className:"w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60 sm:max-w-xs",children:U.map(N=>w.jsx("option",{value:N.value,children:N.label},N.value))}),w.jsxs("p",{className:"text-xs text-slate-300",children:["Posisi aktif: ",s]})]})]}),w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-sm font-semibold text-white",children:"10 Slot Link Ads (Random + Durasi)"}),w.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Saat user klik iklan di Watch Page, sistem memilih random dari slot yang masih aktif."}),w.jsx("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:p.map(N=>{const B=(o||[]).find(Q=>Q.slot===N.slot),O=RB(B==null?void 0:B.endAt),K=!!(B!=null&&B.url)&&O>0;return w.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 p-3",children:[w.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wider text-cyan-200",children:["Slot ",N.slot]}),w.jsx("input",{value:N.link,onChange:Q=>W(N.slot,{link:Q.target.value}),className:"mt-2 w-full rounded-lg border border-white/10 bg-slate-950 px-3 py-2 text-sm outline-none focus:border-cyan-300/60",placeholder:"https://sponsor.com/promo"}),w.jsx("input",{value:N.imageUrl||"",onChange:Q=>W(N.slot,{imageUrl:Q.target.value}),className:"mt-2 w-full rounded-lg border border-white/10 bg-slate-950 px-3 py-2 text-sm outline-none focus:border-cyan-300/60",placeholder:"https://cdn.sponsor.com/banner.jpg"}),w.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[w.jsx("input",{type:"number",min:"1",value:N.durationDays,onChange:Q=>W(N.slot,{durationDays:Q.target.value}),className:"w-24 rounded-lg border border-white/10 bg-slate-950 px-3 py-2 text-sm outline-none focus:border-cyan-300/60"}),w.jsx("span",{className:"text-xs text-slate-300",children:"hari"}),w.jsx("button",{type:"button",onClick:()=>{const Q=l({slot:N.slot,link:N.link,imageUrl:N.imageUrl,durationDays:Number(N.durationDays)});m(Q.ok?`Slot ${N.slot} tersimpan.`:Q.error)},className:"ml-auto rounded-lg bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-3 py-2 text-xs font-semibold text-white transition hover:brightness-110",children:"Simpan"})]}),w.jsx("p",{className:`mt-2 text-xs ${K?"text-emerald-300":"text-slate-400"}`,children:K?`Aktif (${O} hari lagi)`:B!=null&&B.url?"Expired":"Belum diisi"})]},`ad-slot-${N.slot}`)})}),w.jsxs("div",{className:"mt-4 rounded-xl border border-cyan-400/20 bg-cyan-500/5 p-3",children:[w.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-cyan-200",children:"Tutorial"}),w.jsxs("ol",{className:"mt-2 list-decimal space-y-1 pl-4 text-xs text-slate-300",children:[w.jsx("li",{children:"Isi URL iklan pada slot 1-10."}),w.jsx("li",{children:"Tentukan durasi aktif (hari), lalu klik Simpan."}),w.jsx("li",{children:"Saat iklan di klik user, link aktif dipilih random."}),w.jsx("li",{children:"Jika durasi habis, slot otomatis tidak dipakai."})]})]})]}),w.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[w.jsx("p",{className:"text-xs text-slate-300",children:"Kompatibilitas lama: tombol ini set ke slot 1."}),w.jsx("button",{type:"button",onClick:()=>{const N=p.find(O=>O.slot===1),B=a((N==null?void 0:N.link)||"");m(B.ok?"Link slot 1 berhasil diupdate.":B.error)},className:"mt-2 rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs text-slate-200 hover:bg-white/10",children:"Simpan Slot 1 (Legacy)"})]}),d?w.jsx("p",{className:"text-sm text-cyan-200",children:d}):null,w.jsx("button",{type:"submit",className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Save User Changes"})]}):w.jsx("p",{className:"text-sm text-slate-400",children:"Pilih user terlebih dahulu."})})]})]})}const LB="https://anichinapi-production.up.railway.app",RS=String(LB).replace(/\/+$/,""),sr=2e4,CB="donghuax_cache_v1",cp=new Map,fm=new Map,os="anichin";function Se(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function kB(n={}){const e=new URLSearchParams;Object.entries(n).forEach(([r,s])=>{s==null||s===""||e.set(r,String(s))});const t=e.toString();return t?`?${t}`:""}function ad(n){const e=Se(n).trim().replace(/\\\//g,"/");return e?/^https?:\/\//i.test(e)?e:e.startsWith("//")?`https:${e}`:/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(e)?`https://${e}`:"":""}function mm(n){return ld(n,"").toLowerCase().replace(/[^a-z0-9]/g,"")}function hp(n){const e=Se(n).trim();return e?e.replace(/-episode-\d+.*$/i,"").trim()||e:""}function dp(n){const e=Se(n);if(!e)return null;const t=e.match(/(\d+)/);if(!t)return null;const r=Number.parseInt(t[1],10);return Number.isFinite(r)?r:null}function PB(n){const t=Se(n).replace(",",".").match(/(\d+(\.\d+)?)/);if(!t)return null;const r=Number.parseFloat(t[1]);return Number.isFinite(r)?r:null}function ld(n,e="Source"){let t=Se(n,e).trim();return t?(t=t.replace(/https?:\/\/[^\s]+/gi,"").replace(/\b(?:www\.)?anichin\.(?:care|club|moe)\b/gi,"").replace(/\bmega\b/gi,"").replace(/\[[^\]]*ads[^\]]*\]/gi,"").replace(/\(.*?ads.*?\)/gi,"").replace(/\s{2,}/g," ").trim(),t||e):e}function DB(n){const e=Se(n).toLowerCase();if(!e)return"";const r=[{key:"senin",label:"Senin"},{key:"selasa",label:"Selasa"},{key:"rabu",label:"Rabu"},{key:"kamis",label:"Kamis"},{key:"jumat",label:"Jumat"},{key:"sabtu",label:"Sabtu"},{key:"minggu",label:"Minggu"},{key:"monday",label:"Monday"},{key:"tuesday",label:"Tuesday"},{key:"wednesday",label:"Wednesday"},{key:"thursday",label:"Thursday"},{key:"friday",label:"Friday"},{key:"saturday",label:"Saturday"},{key:"sunday",label:"Sunday"}].find(s=>e.includes(s.key));return(r==null?void 0:r.label)||""}function NB(n){const e=Se(n).toLowerCase();if(!e)return"";const t=e.match(/(\d+)\s*x\s*(seminggu|minggu|week)/i);if(t)return`${t[1]}x/minggu`;const r=e.match(/(\d+)\s*(kali|times?)\s*(per|\/)?\s*(minggu|week)/i);return r?`${r[1]}x/minggu`:/\bdaily\b|setiap hari|harian/i.test(e)?"7x/minggu":/weekdays|senin\s*-\s*jumat/i.test(e)?"5x/minggu":/weekends|sabtu\s*-\s*minggu/i.test(e)?"2x/minggu":/weekly|mingguan|setiap minggu/i.test(e)?"1x/minggu":""}function OB(n){const e=Se(n==null?void 0:n.status),t=Se(n==null?void 0:n.headline),r=Se(n==null?void 0:n.title),s=[e,t,r].filter(Boolean).join(" | "),i=DB(s),o=NB(s),a=i||o?`Tayang ${i||"jadwal belum pasti"}${o?` - ${o}`:""}`:"Tayang: belum diumumkan";return{day:i,perWeek:o,scheduleText:a}}function MB(n){return`${CB}:${n}`}function bS(n){const e=Date.now(),t=cp.get(n);if(t&&t.expiresAt>e)return t.value;try{const r=localStorage.getItem(n);if(!r)return null;const s=JSON.parse(r);return!s||s.expiresAt<=e?(localStorage.removeItem(n),null):(cp.set(n,s),s.value)}catch{return null}}function FB(n,e,t){const r={value:e,expiresAt:Date.now()+Math.max(t,1e3)};cp.set(n,r);try{localStorage.setItem(n,JSON.stringify(r))}catch{}}async function Sr(n,e={},t={},r=sr,s=0){if(!RS)throw new Error("VITE_API_BASE_URL belum diatur.");const i=`${RS}${n}${kB(e)}`,o=MB(i),l=String((t==null?void 0:t.method)||"GET").toUpperCase()==="GET"&&s>0;if(l){const d=bS(o);if(d!=null)return d;const m=fm.get(o);if(m)return m}const u=new AbortController,c=setTimeout(()=>u.abort(),r),h=(async()=>{try{const d=await fetch(i,{...t,signal:u.signal,headers:{Accept:"application/json",...t.headers||{}}});if(!d.ok)throw new Error(`Permintaan gagal (${d.status}).`);const m=await d.json();return l&&FB(o,m,s),m}catch(d){if((d==null?void 0:d.name)==="AbortError")throw new Error("Koneksi timeout. Coba lagi.");if(l){const m=bS(o);if(m!=null)return m}throw d}finally{clearTimeout(c),l&&fm.delete(o)}})();return l&&fm.set(o,h),h}function ud(n){if(!n||typeof n!="object")return null;const e=Se(n.slug||n.animeId||n.id),t=hp(e)||e,r=Se(n.title)||Se(n.name)||Se(n.headline)||"Untitled Donghua",s=dp(n.eps||n.episode||n.status||""),i=Se(n.status||n.headline||n.type||""),o=ad(n.thumbnail||n.poster||n.image||""),a=n.sinopsis,l=typeof a=="string"?a:Array.isArray(a==null?void 0:a.paragraphs)?a.paragraphs.join(" "):Se(n.synopsis||n.description||""),u=OB(n);return{...n,id:t||r,animeId:t||r,animeSlug:t||"",episodeSlug:e,mediaType:"anime",source:os,title:r,poster:o,synopsis:l,score:PB(n.rating||n.score),rank:null,status:i,scheduleDay:u.day,schedulePerWeek:u.perWeek,scheduleText:u.scheduleText,episodes:s,episodesText:s?`${s} eps`:i||"Episode tersedia"}}function UB(n){var r;const e=n==null?void 0:n.result;if(!e||typeof e!="object")return!1;const t=Se(e==null?void 0:e.name).trim().toLowerCase();return!!(t&&t!=="unknown title"||Array.isArray(e==null?void 0:e.episode)&&e.episode.length>0||Se(e==null?void 0:e.sinopsis).trim()||Array.isArray((r=e==null?void 0:e.sinopsis)==null?void 0:r.paragraphs)&&e.sinopsis.paragraphs.length>0)}function bo(n,e){const t=Array.isArray(n==null?void 0:n.results)?n.results:[];if(!t.length)return[];const r=e.map(i=>String(i).toLowerCase()),s=t.filter(i=>r.includes(String((i==null?void 0:i.section)||"").toLowerCase())).flatMap(i=>Array.isArray(i==null?void 0:i.cards)?i.cards:[]);return s.length?s.map(ud).filter(Boolean):t.flatMap(i=>Array.isArray(i==null?void 0:i.cards)?i.cards:[]).map(ud).filter(Boolean)}function Ui(n){const e=new Set;return(Array.isArray(n)?n:[]).filter(t=>{const r=Se((t==null?void 0:t.animeId)||(t==null?void 0:t.id));return!r||e.has(r)?!1:(e.add(r),!0)})}function gm(n){return(Array.isArray(n==null?void 0:n.results)?n.results:Array.isArray(n==null?void 0:n.data)?n.data:[]).map(ud).filter(Boolean)}function BB(n){return(Array.isArray(n==null?void 0:n.genres)?n.genres:[]).map(t=>({name:Se(t==null?void 0:t.name),slug:Se(t==null?void 0:t.slug)})).filter(t=>t.name&&t.slug)}function rb(n){var i,o;const e=n!=null&&n.result&&typeof n.result=="object"?n.result:{},t=ud(e)||{},r=Se((i=e==null?void 0:e.sinopsis)==null?void 0:i.title),s=Array.isArray((o=e==null?void 0:e.sinopsis)==null?void 0:o.paragraphs)?e.sinopsis.paragraphs.filter(Boolean).join(`

`):"";return{...t,animeId:t.animeId||Se(e==null?void 0:e.slug)||Se(n==null?void 0:n.slug)||"",animeSlug:t.animeSlug||Se(e==null?void 0:e.slug)||Se(n==null?void 0:n.slug)||"",title:t.title||Se(e==null?void 0:e.name)||"Untitled Donghua",poster:t.poster||ad((e==null?void 0:e.thumbnail)||""),synopsis:[r,s,t.synopsis].filter(Boolean).join(`

`),status:t.status||Se((e==null?void 0:e.status)||""),episodes:Array.isArray(e==null?void 0:e.episode)?e.episode.length:t.episodes,score:t.score,genre:Array.isArray(e==null?void 0:e.genre)?e.genre:[]}}function $B(n){const e=bo(n,["latest_release"]),t=bo(n,["popular_today"]),r=bo(n,["recommendation"]),s=bo(n,["upcoming_donghua"]),i=bo(n,["dropped_project"]),o=bo(n,["movie"]);return{spotlight:Ui(r).slice(0,16),trending:Ui(o).slice(0,16),latestEpisodes:Ui(e).slice(0,16),topAiring:Ui(i).slice(0,16),mostPopular:Ui(t).slice(0,16),latestCompleted:Ui(o).slice(0,16),topUpcoming:Ui(s).slice(0,16)}}function sb(n){var t,r;return(Array.isArray((t=n==null?void 0:n.result)==null?void 0:t.episode)?n.result.episode:Array.isArray((r=n==null?void 0:n.data)==null?void 0:r.episodes)?n.data.episodes:[]).map(s=>{const i=Se((s==null?void 0:s.slug)||(s==null?void 0:s.episodeId)||(s==null?void 0:s.id)),o=dp((s==null?void 0:s.episode)||(s==null?void 0:s.subtitle)||(s==null?void 0:s.name)||i),a=Se(s==null?void 0:s.subtitle)||Se(s==null?void 0:s.name),l=dp(i)||0,u=o||l,c=a?/^episode\s*\d+/i.test(a)?a:u?`Episode ${u} - ${a}`:a:u?`Episode ${u}`:"Episode";return{...s,id:i||c,episodeId:i,number:o,title:c,animeId:Se((s==null?void 0:s.root)||(n==null?void 0:n.slug)||""),animeSlug:Se((s==null?void 0:s.root)||(n==null?void 0:n.slug)||"")}}).filter(s=>s.episodeId||s.id)}function VB(){return[]}function jB(){return[]}function GB(){return[]}function KB(n){return Array.isArray(n)?n.map((e,t)=>{const r=ld(e==null?void 0:e.name,`Server ${t+1}`);return r?{serverName:r,serverId:r,name:r}:null}).filter(Boolean):[]}function HB(n,e,t){const r=Array.isArray(n)?n:[],s=mm(e);let i=r;if(s){const h=r.filter(d=>mm(d==null?void 0:d.name)===s);if(h.length>0)i=h;else{const d=r.filter(m=>{const g=mm(m==null?void 0:m.name);return g&&(g.includes(s)||s.includes(g))});i=d.length>0?d:r}}const o=i.map((h,d)=>{const m=ad((h==null?void 0:h.url)||(h==null?void 0:h.src)||(h==null?void 0:h.link)||(h==null?void 0:h.file));return m?{quality:ld(h==null?void 0:h.name,`Player ${d+1}`),url:m}:null}).filter(Boolean),a=Array.isArray(t==null?void 0:t.medias)?t.medias.map((h,d)=>{const m=ad(h==null?void 0:h.url);return m?{quality:ld(h==null?void 0:h.quality)||Se(h==null?void 0:h.resolution)||Se(h==null?void 0:h.format)||`Media ${d+1}`,url:m}:null}).filter(Boolean):[],l=new Set,u=[...a,...o].filter(h=>!(h!=null&&h.url)||l.has(h.url)?!1:(l.add(h.url),!0)),c=h=>{const d=Se(h==null?void 0:h.quality).toLowerCase(),m=Se(h==null?void 0:h.url).toLowerCase();let g=100;return/\.(m3u8|mp4|webm)(\?|$)/i.test(m)&&(g-=60),(m.includes("ok.ru")||m.includes("dailymotion.com")||m.includes("rumble.com"))&&(g-=30),(m.includes("videoembed")||m.includes("/embed"))&&(g-=20),d.includes("new player")&&(g-=10),(d.includes("ads")||m.includes("short.")||m.includes("rpmvid"))&&(g+=25),g};return[...u].sort((h,d)=>c(h)-c(d))}const un={getHome:()=>Sr("/",{},{},sr,12e4),searchAnime:n=>Sr(`/search/${encodeURIComponent(n||"")}`,{},{},sr,18e4),getSearchSuggestions:()=>Promise.resolve({data:[]}),getAzList:()=>Promise.resolve({data:[]}),getAnimeQtip:()=>Promise.resolve({data:{}}),getCategoryAnime:()=>Promise.resolve({data:[]}),getGenres:()=>Sr("/genres",{},{},sr,216e5),getGenreAnime:(n,e=1)=>Sr(`/genre/${encodeURIComponent(n||"")}`,{page:e},{},sr,3e5),getProducerAnime:()=>Promise.resolve({data:[]}),getSchedule:()=>Promise.resolve({data:[]}),getNextEpisodeSchedule:()=>Promise.resolve({data:{}}),getAnimeDetail:async n=>{var i,o;const e=Se(n).trim(),t=hp(e)||e;let r=null;try{r=await Sr(`/${encodeURIComponent(t)}`,{},{},sr,6e5)}catch{r=null}if(!UB(r))try{const a=await Sr(`/episode/${encodeURIComponent(e)}`,{},{},sr,3e5),l=hp(Se((i=a==null?void 0:a.result)==null?void 0:i.root))||t;r={...await Sr(`/${encodeURIComponent(l)}`,{},{},sr,6e5)||{},selectedEpisodeSlug:e}}catch{}const s=r&&typeof r=="object"?r:{result:{}};return{...s,result:{...(s==null?void 0:s.result)||{},slug:Se(((o=s==null?void 0:s.result)==null?void 0:o.slug)||t||e)},slug:Se((s==null?void 0:s.slug)||t||e)}},getAnimeEpisodes:n=>un.getAnimeDetail(n),getAnimeCharacters:()=>Promise.resolve({data:[]}),getAnimeStreaming:()=>Promise.resolve({data:[]}),getAnimeVideos:()=>Promise.resolve({data:[]}),getAnimeRecommendations:()=>Promise.resolve({data:[]}),getEpisodeServers:async n=>{var r;const e=await Sr(`/episode/${encodeURIComponent(n)}`,{},{},sr,3e5),t=Array.isArray((r=e==null?void 0:e.result)==null?void 0:r.players)?e.result.players:[];return{data:{sub:KB(t),dub:[],raw:[]},payload:e}},getEpisodeSources:async({animeEpisodeId:n,server:e=""})=>{var o;const t=await Sr(`/episode/${encodeURIComponent(n)}`,{},{},sr,3e5);let r=null;try{r=await Sr(`/video-source/${encodeURIComponent(n)}`,{},{},sr,3e5)}catch{r=null}const s=Array.isArray((o=t==null?void 0:t.result)==null?void 0:o.players)?t.result.players:[];return{data:{sources:HB(s,e,r)}}},getTopManga:()=>Promise.resolve({data:[]}),searchManga:()=>Promise.resolve({data:[]}),getMangaDetail:()=>Promise.resolve({data:{}}),getMangaCharacters:()=>Promise.resolve({data:[]}),getMangaRecommendations:()=>Promise.resolve({data:[]})},xc="donghuax_android_notify_v1";function zB(n){if(typeof n=="number")return Number.isFinite(n)?n:null;const t=String(n??"").replace(",",".").match(/(\d+(\.\d+)?)/);if(!t)return null;const r=Number.parseFloat(t[1]);return Number.isFinite(r)?r:null}function fp(n){const e=Number(n==null?void 0:n.number);return Number.isFinite(e)&&e>0?e:0}function WB(n=[]){return[...n].sort((e,t)=>{const r=fp(e),s=fp(t);return r&&s?r-s:r?-1:s?1:String((e==null?void 0:e.title)||"").localeCompare(String((t==null?void 0:t.title)||""),"id",{sensitivity:"base"})})}function qB(){return typeof navigator>"u"?!1:/Android/i.test(navigator.userAgent||"")}function LS(){const{watchlist:n,addToWatchlist:e,removeFromWatchlist:t,watchedEpisodes:r,markEpisodeWatched:s}=In(),{animeId:i,source:o}=EA(),a=Pu(),l=qr(),u=new URLSearchParams(l.search).get("slug")||"",c=o||os,h=c==="hianime"?os:c,[d,m]=$.useState(!0),[g,y]=$.useState({}),[v,E]=$.useState([]),[p,S]=$.useState([]),[L,D]=$.useState([]),[F,A]=$.useState(""),[x,R]=$.useState(""),[b,C]=$.useState(!1);$.useEffect(()=>{let N=!0;return(async()=>{try{m(!0),A("");const[B,O,K,Q]=await Promise.allSettled([un.getAnimeDetail(i,{source:h,slug:u}),un.getAnimeEpisodes(i,1,{source:h,slug:u}),un.getAnimeCharacters(i,{source:h,slug:u}),un.getAnimeRecommendations(i,{source:h,slug:u})]);if(!N)return;const Y=B.status==="fulfilled"?rb(B.value,"anime"):{animeId:i,title:String(i||"").replace(/[-_]+/g," ").trim()||i,source:h,synopsis:""};y(Y);const ee=O.status==="fulfilled"?sb(O.value):[];E(WB(ee)),S(K.status==="fulfilled"?VB(K.value):[]),D(Q.status==="fulfilled"?GB(Q.value,"anime"):[]),B.status==="rejected"&&A("Detail donghua belum lengkap, menampilkan data fallback sementara.")}catch(B){A(B.message||"Gagal load detail donghua.")}finally{N&&m(!1)}})(),()=>{N=!1}},[i,h,u]),$.useEffect(()=>{const N=String(g.animeId||i||"");if(!N){C(!1);return}try{const B=localStorage.getItem(xc),O=B?JSON.parse(B):{};C(!!(O!=null&&O[N]))}catch{C(!1)}},[g.animeId,i]);const M=$.useMemo(()=>g.synopsis||"No synopsis available.",[g]),k=g.animeSlug||u,re=$.useMemo(()=>n.some(N=>String(N==null?void 0:N.animeId)===String(g.animeId||i)),[n,g.animeId,i]),te=$.useMemo(()=>{const N=String(g.animeId||i),B=r==null?void 0:r[N];return new Set(Array.isArray(B)?B.map(O=>String(O)):[])},[r,g.animeId,i]),J=$.useMemo(()=>{var B,O;const N=zB((g==null?void 0:g.score)??((B=g==null?void 0:g.moreInfo)==null?void 0:B.malscore)??((O=g==null?void 0:g.jikan)==null?void 0:O.score));return N==null?"N/A":N.toFixed(2)},[g]),W=$.useMemo(()=>qB(),[]),U=$.useMemo(()=>v.reduce((N,B)=>Math.max(N,fp(B)),0),[v]),H=async()=>{if(R(""),!W){R("Notifikasi otomatis hanya tersedia di Android.");return}if(typeof Notification>"u"){R("Browser ini tidak mendukung notifikasi.");return}const N=String(g.animeId||i||"");if(!N)return;let B=Notification.permission;if(B==="default"&&(B=await Notification.requestPermission()),B!=="granted"){R("Izin notifikasi ditolak.");return}try{const O=localStorage.getItem(xc),K=O?JSON.parse(O):{};if(K[N]){delete K[N],localStorage.setItem(xc,JSON.stringify(K)),C(!1),R("Notifikasi dimatikan.");return}K[N]={animeId:N,title:g.title||i,poster:g.poster||"",source:h,slug:k,lastNotifiedEpisode:U},localStorage.setItem(xc,JSON.stringify(K)),C(!0),R("Notifikasi Android aktif.")}catch{R("Gagal menyimpan preferensi notifikasi.")}};return d?w.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:w.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})}):w.jsxs("section",{className:"space-y-6",children:[F?w.jsx("p",{className:"text-sm text-red-400",children:F}):null,w.jsx("button",{type:"button",onClick:()=>a(-1),className:"inline-flex rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20",children:"Kembali"}),w.jsxs("div",{className:"grid gap-6 rounded-3xl border border-white/10 bg-slate-900/60 p-4 md:grid-cols-[220px,1fr]",children:[w.jsx("div",{className:"overflow-hidden rounded-2xl bg-slate-800",children:g.poster?w.jsx("img",{src:g.poster,alt:g.title||"Donghua",className:"h-full w-full object-cover"}):null}),w.jsxs("div",{children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:g.title||i}),w.jsx("p",{className:"mt-2 text-sm text-slate-300",children:M}),w.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-slate-300 sm:grid-cols-2 lg:grid-cols-3",children:[w.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Status: ",g.status||"Unknown"]}),w.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Episodes: ",g.episodes||"?"]}),w.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Score: ",J]})]}),w.jsx(Pt,{to:`/watch/${encodeURIComponent(h)}/${encodeURIComponent(g.animeId||i)}${k?`?slug=${encodeURIComponent(k)}`:""}`,className:"mt-4 inline-flex rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white transition hover:brightness-110",children:"Open Streaming Links"}),w.jsx("button",{type:"button",onClick:()=>{if(re){t(g.animeId||i);return}e({animeId:g.animeId||i,title:g.title||i,poster:g.poster||"",source:h,slug:k})},className:"ml-2 mt-4 inline-flex rounded-full border border-white/20 bg-white/5 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/10",children:re?"Remove Watchlist":"Add Watchlist"}),w.jsx("button",{type:"button",onClick:H,className:`ml-2 mt-4 inline-flex rounded-full border px-4 py-2 text-sm font-semibold transition ${b?"border-emerald-300/50 bg-emerald-400/15 text-emerald-200 hover:bg-emerald-400/20":"border-white/20 bg-white/5 text-white hover:bg-white/10"}`,children:b?"Notif Android: ON":"Aktifkan Notif Android"}),x?w.jsx("p",{className:"mt-2 text-xs text-amber-200",children:x}):null]})]}),w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[w.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Episodes"}),w.jsxs("div",{className:"mt-4 grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:[v.map(N=>w.jsx(Pt,{onClick:()=>s({animeId:g.animeId||i,episodeId:N.episodeId||"",episodeNumber:N.number||null,title:g.title||i,episodeTitle:N.title||"",poster:g.poster||"",source:h,slug:k}),to:`/watch/${encodeURIComponent(h)}/${encodeURIComponent(g.animeId||i)}${k?`?slug=${encodeURIComponent(k)}`:""}${N.number?`${k?"&":"?"}ep=${encodeURIComponent(N.number)}`:""}${N.episodeId?`${k||N.number?"&":"?"}epid=${encodeURIComponent(N.episodeId)}`:""}`,className:`rounded-xl border px-3 py-2 text-sm transition hover:border-cyan-300/60 ${te.has(String(N.episodeId||N.number||""))?"border-white/10 bg-slate-950/40 text-slate-500":"border-white/10 bg-slate-950 text-white"}`,children:N.title},N.id||N.title)),v.length===0?w.jsxs("div",{className:"space-y-2 rounded-xl border border-amber-400/30 bg-amber-400/10 p-3 text-sm text-amber-200",children:[w.jsx("p",{children:"Daftar episode belum tersedia."}),w.jsx(Pt,{to:`/watch/${encodeURIComponent(h)}/${encodeURIComponent(g.animeId||i)}${k?`?slug=${encodeURIComponent(k)}`:""}`,className:"inline-flex rounded-full border border-amber-300/50 px-3 py-1.5 text-xs font-semibold text-amber-100 transition hover:bg-amber-300/10",children:"Coba Buka Halaman Nonton"})]}):null]})]}),p.length>0?w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[w.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Characters"}),w.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-6",children:p.slice(0,12).map(N=>w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-2",children:[N.image?w.jsx("img",{src:N.image,alt:N.name,className:"aspect-[3/4] w-full rounded-lg object-cover"}):null,w.jsx("p",{className:"mt-2 line-clamp-2 text-xs font-semibold text-white",children:N.name}),w.jsx("p",{className:"text-[11px] text-slate-400",children:N.role||"Character"})]},N.id))})]}):null,L.length>0?w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[w.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Recommendations"}),w.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5",children:L.slice(0,10).map(N=>w.jsxs(Pt,{to:`/anime/${encodeURIComponent(N.source||h)}/${encodeURIComponent(N.animeId)}${N.animeSlug?`?slug=${encodeURIComponent(N.animeSlug)}`:""}`,className:"rounded-xl border border-white/10 bg-black/20 p-2",children:[N.poster?w.jsx("img",{src:N.poster,alt:N.title,className:"aspect-[3/4] w-full rounded-lg object-cover"}):null,w.jsx("p",{className:"mt-2 line-clamp-2 text-xs font-semibold text-white",children:N.title})]},N.animeId))})]}):null]})}function YB(){return w.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[w.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Contact"}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Untuk pertanyaan bisnis, laporan konten, atau kerja sama, hubungi kami melalui email berikut:"}),w.jsx("a",{href:"mailto:akuryzel@gmail.com",className:"inline-flex rounded-xl border border-white/15 bg-white/5 px-4 py-2 text-sm text-white",children:"akuryzel@gmail.com"}),w.jsx("p",{className:"text-xs text-slate-400",children:"Silakan ganti email ini dengan email resmi domain kamu sebelum publish."})]})}function QB(){const{watchHistory:n}=In();return w.jsxs("section",{className:"space-y-5",children:[w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-5",children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Riwayat Tontonan"}),w.jsx("p",{className:"mt-1 text-sm text-slate-300",children:"Episode yang pernah kamu buka akan muncul di sini."})]}),n.length===0?w.jsx("p",{className:"text-sm text-slate-400",children:"Belum ada riwayat tontonan."}):w.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>{const t=[e.slug?`slug=${encodeURIComponent(e.slug)}`:"",e.episodeNumber?`ep=${encodeURIComponent(e.episodeNumber)}`:"",e.episodeId?`epid=${encodeURIComponent(e.episodeId)}`:""].filter(Boolean).join("&"),r=`/watch/${encodeURIComponent(e.source||"anichin")}/${encodeURIComponent(e.animeId)}${t?`?${t}`:""}`;return w.jsx(Pt,{to:r,className:"rounded-2xl border border-white/10 bg-slate-900/70 p-3 transition hover:border-cyan-300/60",children:w.jsxs("div",{className:"flex gap-3",children:[w.jsx("div",{className:"h-20 w-14 shrink-0 overflow-hidden rounded-lg bg-slate-800",children:e.poster?w.jsx("img",{src:e.poster,alt:e.title,className:"h-full w-full object-cover"}):null}),w.jsxs("div",{className:"min-w-0",children:[w.jsx("p",{className:"line-clamp-2 text-sm font-semibold text-white",children:e.title}),w.jsxs("p",{className:"mt-1 text-xs text-cyan-200",children:["Episode ",e.episodeNumber||"?"," ",e.episodeTitle?`- ${e.episodeTitle}`:""]}),w.jsx("p",{className:"mt-1 text-[11px] text-slate-400",children:e.watchedAt?new Date(e.watchedAt).toLocaleString("id-ID"):""})]})]})},e.id)})})]})}function gn(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function XB(n){const e=gn(n==null?void 0:n.source),t=gn((n==null?void 0:n.animeId)||(n==null?void 0:n.id)),r=gn(n==null?void 0:n.animeSlug);return t?e?`/anime/${encodeURIComponent(e)}/${encodeURIComponent(t)}${r?`?slug=${encodeURIComponent(r)}`:""}`:`/anime/${encodeURIComponent(t)}`:"#"}function JB({anime:n}){const e=gn(n==null?void 0:n.title,gn(n==null?void 0:n.name,"Welcome to DonghuaX")),t=(n==null?void 0:n.animeId)||(n==null?void 0:n.id)||"",r=gn(n==null?void 0:n.poster,gn(n==null?void 0:n.thumbnail,gn(n==null?void 0:n.image,""))),s=[gn(n==null?void 0:n.episodesText),gn(n==null?void 0:n.status),gn(n==null?void 0:n.season)].filter(Boolean).join("  "),i=gn(n==null?void 0:n.synopsis)||gn(n==null?void 0:n.description)||gn(n==null?void 0:n.plot)||(s?`${e}  ${s}`:`${e} sedang populer minggu ini.`),o=XB(n);return w.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-slate-900/70 animate-fade-in",children:[r?w.jsx("img",{src:r,alt:e,className:"h-56 w-full object-cover opacity-60 sm:h-72 lg:h-96"}):w.jsx("div",{className:"h-56 w-full bg-gradient-to-r from-slate-950 via-slate-800 to-slate-900 sm:h-72 lg:h-96"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-950 via-slate-950/75 to-slate-950/30"}),w.jsxs("div",{className:"absolute inset-0 flex max-w-3xl flex-col justify-end p-4 sm:p-6 lg:p-8",children:[w.jsx("p",{className:"mb-2 inline-flex w-fit rounded-full bg-cyan-400/20 px-3 py-1 text-xs font-bold uppercase tracking-wider text-cyan-200",children:"Featured Pick"}),w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-4xl lg:text-5xl",children:e}),w.jsx("p",{className:"mt-3 line-clamp-3 max-w-2xl text-sm text-slate-200 sm:line-clamp-none sm:text-base",children:i}),t?w.jsx(Pt,{to:o,className:"mt-5 inline-flex w-fit rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-5 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Lihat Detail"}):null]})]})}function Lr(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function ZB(n){const e=Lr(n==null?void 0:n.source),t=Lr((n==null?void 0:n.animeId)||(n==null?void 0:n.id)),r=Lr(n==null?void 0:n.animeSlug);return t?e?`/anime/${encodeURIComponent(e)}/${encodeURIComponent(t)}${r?`?slug=${encodeURIComponent(r)}`:""}`:`/anime/${encodeURIComponent(t)}`:"#"}function e$({anime:n}){const e="donghua",t=Lr(n==null?void 0:n.title,Lr(n==null?void 0:n.name,`Untitled ${e}`)),r=Lr(n==null?void 0:n.poster,Lr(n==null?void 0:n.thumbnail,Lr(n==null?void 0:n.image,""))),s=Lr(n==null?void 0:n.episodesText)||Lr(n==null?void 0:n.status)||(typeof(n==null?void 0:n.score)=="number"?`Score ${n.score}`:"No score yet"),i=ZB(n);return w.jsxs(Pt,{to:i,className:"group w-36 shrink-0 overflow-hidden rounded-2xl border border-white/10 bg-slate-900/80 transition duration-300 hover:-translate-y-1 hover:border-cyan-300/50 sm:w-40 md:w-44 lg:w-52",children:[w.jsxs("div",{className:"relative aspect-[3/4] w-full bg-slate-800",children:[r?w.jsx("img",{src:r,alt:t,className:"h-full w-full object-cover transition duration-500 group-hover:scale-110"}):null,w.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-slate-950/75 via-transparent to-transparent"}),w.jsx("p",{className:"absolute right-2 top-2 rounded-full bg-black/60 px-2 py-1 text-[10px] font-bold uppercase tracking-wide text-cyan-200",children:e})]}),w.jsxs("div",{className:"p-2.5 sm:p-3",children:[w.jsx("p",{className:"line-clamp-2 text-sm font-semibold text-slate-100",children:t}),w.jsx("p",{className:"mt-1 text-xs text-cyan-200/85",children:s})]})]})}function Bi({title:n,items:e}){return!Array.isArray(e)||e.length===0?null:w.jsxs("section",{className:"animate-slide-up",children:[w.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[w.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:n}),w.jsxs("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-400",children:[e.length," titles"]})]}),w.jsx("div",{className:"horizontal-rail flex gap-3 pb-3 sm:gap-4",children:e.map(t=>w.jsx(e$,{anime:t},`${(t==null?void 0:t.mediaType)||"anime"}-${(t==null?void 0:t.animeId)||(t==null?void 0:t.mangaId)||(t==null?void 0:t.id)||(t==null?void 0:t.title)}`))})]})}const CS="donghuax_search_history_v1",kS=12,PS="donghuax_android_notify_v1";function t$(){return typeof navigator>"u"?!1:/Android/i.test(navigator.userAgent||"")}function n$(n){const e=Number(n==null?void 0:n.episodes);if(Number.isFinite(e)&&e>0)return e;const r=String((n==null?void 0:n.episodesText)||(n==null?void 0:n.status)||(n==null?void 0:n.headline)||"").match(/(\d+)/);if(!r)return 0;const s=Number.parseInt(r[1],10);return Number.isFinite(s)&&s>0?s:0}function Cr(n){return String(n||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}function r$(n,e){const t=Cr(n),r=Cr(e),s=t.length+1,i=r.length+1,o=Array.from({length:s},()=>Array(i).fill(0));for(let a=0;a<s;a+=1)o[a][0]=a;for(let a=0;a<i;a+=1)o[0][a]=a;for(let a=1;a<s;a+=1)for(let l=1;l<i;l+=1){const u=t[a-1]===r[l-1]?0:1;o[a][l]=Math.min(o[a-1][l]+1,o[a][l-1]+1,o[a-1][l-1]+u)}return o[s-1][i-1]}function DS(n,e=[]){const t=Cr(n);if(!t||!Array.isArray(e)||e.length===0)return"";let r="",s=Number.POSITIVE_INFINITY;return e.forEach(i=>{const o=String(i||"").trim();if(!o)return;const a=Cr(o);if(!a||a===t)return;const l=r$(t,a),u=Math.max(t.length,a.length,1),c=l/u;c<s&&(s=c,r=o)}),s<=.45?r:""}function s$(){var te,J;const{user:n}=In(),[e,t]=$.useState(!0),[r,s]=$.useState(""),[i,o]=$.useState({spotlight:[],trending:[],latestEpisodes:[],topAiring:[],mostPopular:[],latestCompleted:[],topUpcoming:[]}),[a,l]=$.useState(""),[u,c]=$.useState([]),[h,d]=$.useState([]),[m,g]=$.useState(""),[y,v]=$.useState([]),[E,p]=$.useState(""),[S,L]=$.useState([]),[D,F]=$.useState(!1),[A,x]=$.useState(0);$.useEffect(()=>{try{const W=localStorage.getItem(CS),U=W?JSON.parse(W):[];d(Array.isArray(U)?U.filter(Boolean).slice(0,kS):[])}catch{d([])}},[]),$.useEffect(()=>{let W=!0;return(async()=>{try{t(!0),s("");const[U,H]=await Promise.allSettled([un.getHome(),un.getGenres()]);if(!W)return;o($B(U.status==="fulfilled"?U.value:{}));const N=BB(H.status==="fulfilled"?H.value:{});v(N),N.length>0&&p(N[0].slug)}catch(U){if(!W)return;s(U.message||"Gagal load homepage donghua.")}finally{W&&t(!1)}})(),()=>{W=!1}},[]),$.useEffect(()=>{let W=!0;if(!E){L([]);return}return(async()=>{try{F(!0);const U=await un.getGenreAnime(E,1);if(!W)return;L(gm(U).slice(0,18))}catch{if(!W)return;L([])}finally{W&&F(!1)}})(),()=>{W=!1}},[E]);const R=$.useMemo(()=>{const W=[...Array.isArray(i.spotlight)?i.spotlight:[],...Array.isArray(i.trending)?i.trending:[],...Array.isArray(i.latestEpisodes)?i.latestEpisodes:[]],U=new Set;return W.filter(H=>{const N=String((H==null?void 0:H.animeId)||(H==null?void 0:H.id)||(H==null?void 0:H.title)||"");return!N||U.has(N)?!1:(U.add(N),!0)})},[i.spotlight,i.trending,i.latestEpisodes]);$.useEffect(()=>{x(0)},[R.length]),$.useEffect(()=>{if(R.length<=1)return;const W=setInterval(()=>{x(U=>(U+1)%R.length)},5e3);return()=>clearInterval(W)},[R.length]),$.useEffect(()=>{if(t$()&&!(typeof Notification>"u")&&Notification.permission==="granted")try{const W=localStorage.getItem(PS),U=W?JSON.parse(W):{};if(!U||typeof U!="object")return;let H=!1;i.latestEpisodes.forEach(N=>{var Q,Y;const B=String((N==null?void 0:N.animeId)||(N==null?void 0:N.id)||"");if(!B||!U[B])return;const O=n$(N),K=Number(((Q=U[B])==null?void 0:Q.lastNotifiedEpisode)||0);!Number.isFinite(O)||O<=K||(new Notification(`Donghua update: ${(N==null?void 0:N.title)||B}`,{body:`Episode ${O} sudah tayang.`,icon:(N==null?void 0:N.poster)||((Y=U[B])==null?void 0:Y.poster)||void 0,tag:`donghuax-${B}-${O}`}),U[B]={...U[B],lastNotifiedEpisode:O},H=!0)}),H&&localStorage.setItem(PS,JSON.stringify(U))}catch{}},[i.latestEpisodes]);const b=$.useMemo(()=>{var W,U,H;return R[A]||((W=i.topAiring)==null?void 0:W[0])||((U=i.mostPopular)==null?void 0:U[0])||((H=i.latestEpisodes)==null?void 0:H[0])||null},[R,A,i.topAiring,i.mostPopular,i.latestEpisodes]),C=$.useMemo(()=>{const W=Cr(a);return W?h.filter(U=>Cr(U).includes(W)).slice(0,6):h.slice(0,6)},[h,a]),M=W=>{const U=String(W||"").trim();U&&d(H=>{const N=[U,...H.filter(B=>Cr(B)!==Cr(U))].slice(0,kS);try{localStorage.setItem(CS,JSON.stringify(N))}catch{}return N})},k=async W=>{const U=String(W||"").trim();if(!U){c([]),g("");return}try{s(""),g("");const H=await un.searchAnime(U),N=gm(H);if(c(N),M(U),N.length>0){const O=DS(U,N.map(K=>(K==null?void 0:K.title)||(K==null?void 0:K.headline)||""));O&&g(O);return}const B=U.split(/\s+/).find(O=>O.length>=3)||"";if(B&&Cr(B)!==Cr(U))try{const O=await un.searchAnime(B),K=gm(O),Q=DS(U,K.map(Y=>(Y==null?void 0:Y.title)||(Y==null?void 0:Y.headline)||""));Q&&g(Q)}catch{}}catch(H){s(H.message||"Search donghua gagal."),c([]),g("")}},re=async W=>{W.preventDefault(),await k(a)};return e?w.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:w.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300",role:"status","aria-label":"Loading"})}):w.jsxs("div",{className:"space-y-6 pb-4 sm:space-y-8",children:[w.jsxs("section",{className:"grid gap-3 sm:grid-cols-2 sm:gap-4 lg:grid-cols-3",children:[w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Welcome"}),w.jsx("p",{className:"mt-1 text-base font-semibold text-white sm:text-lg",children:(n==null?void 0:n.username)||"User"})]}),w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Account Plan"}),w.jsx("p",{className:"mt-1 text-base font-semibold text-amber-300 sm:text-lg",children:(te=n==null?void 0:n.premium)!=null&&te.active?n.premium.plan:"Free Plan"})]}),w.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Donghua Catalog"}),w.jsx("p",{className:"mt-1 text-base font-semibold text-cyan-200 sm:text-lg",children:"Live"})]})]}),w.jsx("div",{children:w.jsx(JB,{anime:b})},`featured-${(b==null?void 0:b.animeId)||(b==null?void 0:b.id)||A}`),w.jsxs("section",{className:"rounded-3xl border border-white/10 bg-slate-900/50 p-4 sm:p-5",children:[w.jsxs("form",{onSubmit:re,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[w.jsx("input",{className:"w-full rounded-xl border border-white/15 bg-slate-900/80 px-4 py-3 text-sm outline-none transition focus:border-cyan-300/60",placeholder:"Cari donghua favorit...",value:a,onChange:W=>l(W.target.value)}),w.jsx("button",{type:"submit",className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-5 py-3 text-sm font-semibold text-white transition hover:brightness-110 sm:w-auto",children:"Search"})]}),C.length>0?w.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[w.jsx("span",{className:"text-xs uppercase tracking-wider text-slate-400",children:"Riwayat"}),C.map(W=>w.jsx("button",{type:"button",onClick:()=>{l(W),k(W)},className:"rounded-full border border-white/15 bg-white/5 px-3 py-1 text-xs text-slate-200 transition hover:border-cyan-300/50 hover:text-white",children:W},W))]}):null,m?w.jsxs("p",{className:"mt-3 text-xs text-amber-300",children:["Mungkin maksud kamu:"," ",w.jsx("button",{type:"button",className:"font-semibold underline underline-offset-2",onClick:()=>{l(m),k(m)},children:m})]}):null]}),r?w.jsx("p",{className:"text-sm text-red-400",children:r}):null,u.length>0?w.jsx(Bi,{title:"Hasil Pencarian Donghua",items:u}):null,y.length>0?w.jsxs("section",{className:"rounded-3xl border border-white/10 bg-slate-900/50 p-4 sm:p-5",children:[w.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[w.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Pilih Genre"}),D?w.jsx("p",{className:"text-xs text-slate-400",children:"Loading genre..."}):null]}),w.jsx("div",{className:"flex flex-wrap gap-2",children:y.slice(0,24).map(W=>w.jsx("button",{type:"button",onClick:()=>p(W.slug),className:`rounded-full px-3 py-1.5 text-xs font-semibold uppercase tracking-wide transition ${E===W.slug?"bg-cyan-300 text-slate-950":"border border-white/15 bg-white/5 text-slate-300 hover:border-cyan-300/50"}`,children:W.name},W.slug))})]}):null,E&&S.length>0?w.jsx(Bi,{title:`Genre: ${((J=y.find(W=>W.slug===E))==null?void 0:J.name)||E}`,items:S}):null,w.jsx(Bi,{title:"Terbaru Rilis",items:i.latestEpisodes}),w.jsx(Bi,{title:"Populer Hari Ini",items:i.mostPopular}),w.jsx(Bi,{title:"Rekomendasi Donghua",items:i.spotlight}),w.jsx(Bi,{title:"Movie Donghua",items:i.trending}),w.jsx(Bi,{title:"Upcoming Donghua",items:i.topUpcoming})]})}function i$(){const{signIn:n,signInWithGoogle:e,canUseGoogleAuth:t,isWebView:r}=In(),[s,i]=$.useState({email:"",password:""}),[o,a]=$.useState(""),[l,u]=$.useState(!1),c=async d=>{d.preventDefault(),u(!0);const m=await n(s);if(u(!1),!m.ok){a(m.error||"Login gagal.");return}},h=async()=>{u(!0);const d=await e();if(u(!1),!d.ok){a(d.error||"Login Google gagal.");return}};return w.jsxs("section",{className:"mx-auto grid min-h-[76vh] max-w-6xl overflow-hidden rounded-3xl border border-cyan-400/20 bg-zinc-950/90 shadow-2xl md:grid-cols-2",children:[w.jsx("div",{className:"hidden bg-[radial-gradient(circle_at_65%_22%,rgba(217,70,239,.35),transparent_35%),radial-gradient(circle_at_20%_78%,rgba(34,211,238,.4),transparent_35%),linear-gradient(155deg,#020617,#131a2f)] p-8 md:block",children:w.jsxs("div",{className:"animate-float rounded-2xl border border-cyan-400/20 bg-black/35 p-6 backdrop-blur",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"DonghuaX Streaming"}),w.jsx("h2",{className:"mt-3 font-heading text-3xl font-bold text-white",children:"Masuk untuk lanjut nonton."}),w.jsx("p",{className:"mt-4 text-sm text-zinc-300",children:"Gunakan email/password atau akun Google."})]})}),w.jsxs("div",{className:"p-6 sm:p-10",children:[w.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Login"}),w.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Akses akun untuk membuka katalog donghua."}),w.jsxs("form",{onSubmit:c,className:"mt-6 space-y-3",children:[w.jsx("input",{type:"email",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Email",value:s.email,onChange:d=>i(m=>({...m,email:d.target.value})),required:!0}),w.jsx("input",{type:"password",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Password",value:s.password,onChange:d=>i(m=>({...m,password:d.target.value})),required:!0}),o?w.jsx("p",{className:"text-sm text-red-400",children:o}):null,w.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 py-3 font-semibold text-white transition hover:brightness-110 disabled:opacity-60",type:"submit",disabled:l,children:l?"Loading...":"Login"}),t?w.jsx("button",{type:"button",onClick:h,disabled:l,className:"w-full rounded-xl border border-zinc-700 bg-zinc-900/80 py-3 text-sm font-semibold text-zinc-100 transition hover:bg-zinc-800 disabled:opacity-60",children:"Login dengan Google"}):null,r?w.jsx("p",{className:"text-xs text-amber-300",children:"Google login tidak tersedia di APK/WebView. Gunakan email/password atau browser eksternal."}):null]}),w.jsxs("p",{className:"mt-4 text-sm text-zinc-300",children:["Belum punya akun?"," ",w.jsx(Pt,{to:"/signup",className:"font-semibold text-cyan-200 underline",children:"Daftar"})]})]})]})}function o$(){return w.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[w.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"About DonghuaX"}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"DonghuaX adalah platform hiburan untuk menelusuri katalog donghua secara cepat, responsif, dan nyaman di berbagai perangkat."}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami berfokus pada pengalaman pengguna yang sederhana, informasi judul yang jelas, serta navigasi yang mudah untuk penonton."})]})}function a$(){var t,r;const{user:n}=In(),e=(t=n==null?void 0:n.premium)!=null&&t.expireAt?new Date(n.premium.expireAt).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-";return w.jsx("section",{className:"mx-auto max-w-3xl space-y-4",children:w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/70 p-5 sm:p-6",children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Premium"}),w.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Aktivasi via admin. Admin bisa atur plan + durasi hari langsung dari Admin Panel."}),w.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-white/5 p-4",children:[w.jsx("p",{className:"text-sm text-slate-300",children:"Status saat ini"}),w.jsx("p",{className:"mt-1 text-lg font-semibold text-amber-300",children:(r=n==null?void 0:n.premium)!=null&&r.active?n.premium.plan:"Free Plan"}),w.jsxs("p",{className:"text-sm text-slate-400",children:["Expired: ",e]})]}),w.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-slate-300",children:[w.jsx("li",{children:"No ads saat play episode."}),w.jsx("li",{children:"Badge premium di profile."}),w.jsx("li",{children:"Prioritas support dari admin."})]}),w.jsx("a",{href:"https://wa.me/628990870271?text=Halo%20Admin%20DonghuaX%2C%20saya%20ingin%20aktivasi%20premium.",target:"_blank",rel:"noreferrer",className:"mt-4 inline-flex rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white",children:"Hubungi WhatsApp Admin"})]})})}function l$(){return w.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[w.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Privacy Policy"}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami menghormati privasi pengguna. Informasi akun digunakan untuk autentikasi, personalisasi pengalaman, serta fitur seperti riwayat tontonan dan watchlist."}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami dapat menggunakan cookie atau penyimpanan lokal untuk meningkatkan performa situs. Data tidak diperjualbelikan kepada pihak ketiga."}),w.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Dengan menggunakan situs ini, kamu menyetujui kebijakan privasi ini. Kebijakan dapat diperbarui sewaktu-waktu."})]})}function u$(){const{signUp:n,signInWithGoogle:e,canUseGoogleAuth:t,isWebView:r}=In(),[s,i]=$.useState({username:"",email:"",password:""}),[o,a]=$.useState(""),[l,u]=$.useState(!1),c=async d=>{d.preventDefault(),u(!0);const m=await n(s);if(u(!1),!m.ok){a(m.error||"Signup gagal.");return}},h=async()=>{u(!0);const d=await e();if(u(!1),!d.ok){a(d.error||"Signup Google gagal.");return}};return w.jsxs("section",{className:"mx-auto grid min-h-[76vh] max-w-6xl overflow-hidden rounded-3xl border border-cyan-400/20 bg-zinc-950/90 shadow-2xl md:grid-cols-2",children:[w.jsx("div",{className:"hidden bg-[radial-gradient(circle_at_30%_18%,rgba(244,114,182,.35),transparent_35%),radial-gradient(circle_at_78%_12%,rgba(56,189,248,.3),transparent_38%),linear-gradient(145deg,#020617,#121b31)] p-8 md:block",children:w.jsxs("div",{className:"animate-float rounded-2xl border border-cyan-400/20 bg-black/35 p-6 backdrop-blur",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"Create account"}),w.jsx("h2",{className:"mt-3 font-heading text-3xl font-bold text-white",children:"Buat akun dan mulai sekarang."}),w.jsx("p",{className:"mt-4 text-sm text-zinc-300",children:"Daftar via email/password atau akun Google."})]})}),w.jsxs("div",{className:"p-6 sm:p-10",children:[w.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Daftar"}),w.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Bikin akun untuk akses penuh website."}),w.jsxs("form",{onSubmit:c,className:"mt-6 space-y-3",children:[w.jsx("input",{className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Username",value:s.username,onChange:d=>i(m=>({...m,username:d.target.value})),required:!0}),w.jsx("input",{type:"email",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Email",value:s.email,onChange:d=>i(m=>({...m,email:d.target.value})),required:!0}),w.jsx("input",{type:"password",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Password",value:s.password,onChange:d=>i(m=>({...m,password:d.target.value})),required:!0}),o?w.jsx("p",{className:"text-sm text-red-400",children:o}):null,w.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 py-3 font-semibold text-white transition hover:brightness-110 disabled:opacity-60",type:"submit",disabled:l,children:l?"Loading...":"Daftar"}),t?w.jsx("button",{type:"button",onClick:h,disabled:l,className:"w-full rounded-xl border border-zinc-700 bg-zinc-900/80 py-3 text-sm font-semibold text-zinc-100 transition hover:bg-zinc-800 disabled:opacity-60",children:"Lanjut dengan Google"}):null,r?w.jsx("p",{className:"text-xs text-amber-300",children:"Google login tidak tersedia di APK/WebView. Gunakan email/password atau browser eksternal."}):null]}),w.jsxs("p",{className:"mt-4 text-sm text-zinc-300",children:["Sudah punya akun?"," ",w.jsx(Pt,{to:"/login",className:"font-semibold text-cyan-200 underline",children:"Masuk"})]})]})]})}const oe=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},c$=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=h$},h$=Number.MAX_SAFE_INTEGER||9007199254740991;let ce=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),j=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),_=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Re={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},le={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Lo{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class d${constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Lo(e),this.fast_=new Lo(t),this.defaultTTFB_=s,this.ttfb_=new Lo(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Lo(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Lo(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Lo(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function f$(n,e,t){return(e=g$(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ze(){return ze=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ze.apply(null,arguments)}function NS(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function je(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?NS(Object(t),!0).forEach(function(r){f$(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):NS(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function m$(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function g$(n){var e=m$(n,"string");return typeof e=="symbol"?e:e+""}class Jn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=js,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const js=function(){},p$={trace:js,debug:js,log:js,warn:js,info:js,error:js};function mp(){return ze({},p$)}function y$(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):js}function OS(n,e,t){return e[n]?e[n].bind(e):y$(n,t)}const gp=mp();function v$(n,e,t){const r=mp();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=OS(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return mp()}s.forEach(i=>{gp[i]=OS(i,n)})}else ze(gp,r);return r}const Ge=gp;function Ii(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function E$(n){return typeof self<"u"&&n===self.ManagedMediaSource}function ib(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(o=>r.indexOf(o)===-1)}function Mn(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,s,i,o="",a=0;for(;a<t;){if(r=n[a++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=n[a++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[a++],i=n[a++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function Kt(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function ob(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function T$(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pm={exports:{}},MS;function S$(){return MS||(MS=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=a.normalizePath(h.path),a.buildURLFromParts(h)}var d=a.parseURL(u);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return c.alwaysNormalize?(d.path=a.normalizePath(d.path),a.buildURLFromParts(d)):u;var m=a.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var g=s.exec(m.path);m.netLoc=g[1],m.path=g[2]}m.netLoc&&!m.path&&(m.path="/");var y={scheme:m.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(y.netLoc=m.netLoc,d.path[0]!=="/"))if(!d.path)y.path=m.path,d.params||(y.params=m.params,d.query||(y.query=m.query));else{var v=m.path,E=v.substring(0,v.lastIndexOf("/")+1)+d.path;y.path=a.normalizePath(E)}return y.path===null&&(y.path=c.alwaysNormalize?a.normalizePath(d.path):d.path),a.buildURLFromParts(y)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(pm)),pm.exports}var Sy=S$();class _y{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var qe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ab{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,x$(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[qe.AUDIO]:null,[qe.VIDEO]:null,[qe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new _y),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sy.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[qe.AUDIO]=null,e[qe.VIDEO]=null,e[qe.AUDIOVIDEO]=null}}function Et(n){return n.sn!=="initSegment"}class ym extends ab{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(oe(e)&&oe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!oe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Et(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class _$ extends ab{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function lb(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||lb(t,e)}}function x$(n,e){const t=lb(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const FS=Math.pow(2,32)-1,I$=[].push,ub={video:1,audio:2,id3:3,text:4};function Rt(n){return String.fromCharCode.apply(null,n)}function cb(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function pe(n,e){const t=hb(n,e);return t<0?4294967296+t:t}function US(n,e){let t=pe(n,e);return t*=Math.pow(2,32),t+=pe(n,e+4),t}function hb(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function A$(n){const e=n.byteLength;for(let t=0;t<e;){const r=pe(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Ie(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=pe(n,s),o=Rt(n.subarray(s+4,s+8)),a=i>1?s+i:r;if(o===e[0])if(e.length===1)t.push(n.subarray(s+8,a));else{const l=Ie(n.subarray(s+8,a),e.slice(1));l.length&&I$.apply(t,l)}s=a}return t}function w$(n){const e=[],t=n[0];let r=8;const s=pe(n,r);r+=4;let i=0,o=0;t===0?(i=pe(n,r),o=pe(n,r+4),r+=8):(i=US(n,r),o=US(n,r+8),r+=16),r+=2;let a=n.length+o;const l=cb(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const h=pe(n,c);c+=4;const d=h&2147483647;if((h&2147483648)>>>31===1)return Ge.warn("SIDX has hierarchical references (not supported)"),null;const g=pe(n,c);c+=4,e.push({referenceSize:d,subsegmentDuration:g,info:{duration:g/s,start:a,end:a+d-1}}),a+=d,c+=4,r=c}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function db(n){const e=[],t=Ie(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=Ie(i,["tkhd"])[0];if(o){let a=o[0];const l=pe(o,a===0?12:20),u=Ie(i,["mdia","mdhd"])[0];if(u){a=u[0];const c=pe(u,a===0?12:20),h=Ie(i,["mdia","hdlr"])[0];if(h){const d=Rt(h.subarray(8,12)),m={soun:qe.AUDIO,vide:qe.VIDEO}[d],g=Ie(i,["mdia","minf","stbl","stsd"])[0],y=R$(g);m?(e[l]={timescale:c,type:m,stsd:y},e[m]=je({timescale:c,id:l},y)):e[l]={timescale:c,type:d,stsd:y}}}}}return Ie(n,["moov","mvex","trex"]).forEach(s=>{const i=pe(s,4),o=e[i];o&&(o.default={duration:pe(s,12),flags:pe(s,20)})}),e}function R$(n){const e=n.subarray(8),t=e.subarray(86),r=Rt(e.subarray(4,8));let s=r,i;const o=r==="enca"||r==="encv";if(o){const u=Ie(e,[r])[0].subarray(r==="enca"?28:78);Ie(u,["sinf"]).forEach(h=>{const d=Ie(h,["schm"])[0];if(d){const m=Rt(d.subarray(4,8));if(m==="cbcs"||m==="cenc"){const g=Ie(h,["frma"])[0];g&&(s=Rt(g))}}})}const a=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Ie(t,["avcC"])[0];l&&l.length>3&&(s+="."+Ac(l[1])+Ac(l[2])+Ac(l[3]),i=Ic(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Ie(e,[r])[0],u=Ie(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=vm(u,c),c+=2;const h=u[c++];if(h&128&&(c+=2),h&64&&(c+=u[c++]),u[c++]!==4)break;c=vm(u,c);const d=u[c++];if(d===64)s+="."+Ac(d);else break;if(c+=12,u[c++]!==5)break;c=vm(u,c);const m=u[c++];let g=(m&248)>>3;g===31&&(g+=1+((m&7)<<3)+((u[c]&224)>>5)),s+="."+g}break}case"hvc1":case"hev1":{const l=Ie(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],h=u&31,d=pe(l,2),m=(u&32)>>5?"H":"L",g=l[12],y=l.subarray(6,12);s+="."+c+h,s+="."+b$(d).toString(16).toUpperCase(),s+="."+m+g;let v="";for(let E=y.length;E--;){const p=y[E];(p||v)&&(v="."+p.toString(16).toUpperCase()+v)}s+=v}i=Ic(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Ic(s,t)||s;break}case"vp09":{const l=Ie(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],h=l[6]>>4&15;s+="."+Rr(u)+"."+Rr(c)+"."+Rr(h)}break}case"av01":{const l=Ie(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,h=l[2]>>>7?"H":"M",d=(l[2]&64)>>6,m=(l[2]&32)>>5,g=u===2&&d?m?12:10:d?10:8,y=(l[2]&16)>>4,v=(l[2]&8)>>3,E=(l[2]&4)>>2,p=l[2]&3;s+="."+u+"."+Rr(c)+h+"."+Rr(g)+"."+y+"."+v+E+p+"."+Rr(1)+"."+Rr(1)+"."+Rr(1)+"."+0,i=Ic("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function Ic(n,e){const t=Ie(e,["dvvC"]),r=t.length?t[0]:Ie(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+Rr(s)+"."+Rr(i)}}function b$(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function vm(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Ac(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Rr(n){return(n<10?"0":"")+n}function L$(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&fb(n,(r,s)=>{const i=r.subarray(8,24);i.some(o=>o!==0)||(Ge.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Kt(i)} -> ${Kt(t)}`),r.set(t,8))})}function C$(n){const e=[];return fb(n,t=>e.push(t.subarray(8,24))),e}function fb(n,e){Ie(n,["moov","trak"]).forEach(r=>{const s=Ie(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=Ie(i,["enca"]);const a=o.length>0;a||(o=Ie(i,["encv"])),o.forEach(l=>{const u=a?l.subarray(28):l.subarray(78);Ie(u,["sinf"]).forEach(h=>{const d=mb(h);d&&e(d,a)})})})}function mb(n){const e=Ie(n,["schm"])[0];if(e){const t=Rt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=Ie(n,["schi","tenc"])[0];if(r)return r}}}function k$(n,e,t){const r={},s=Ie(n,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],a=Ie(o,["tfhd"])[0],l=pe(a,4),u=e[l];if(!u)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=r[l],h=Ie(o,["tfdt"])[0];if(h){const S=h[0];let L=pe(h,4);S===1&&(L===FS?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(L*=FS+1,L+=pe(h,8))),oe(L)&&(!oe(c.start)||L<c.start)&&(c.start=L)}const d=u.default,m=pe(a,0)|(d==null?void 0:d.flags);let g=(d==null?void 0:d.duration)||0;m&8&&(m&2?g=pe(a,12):g=pe(a,8));const y=Ie(o,["trun"]);let v=c.start||0,E=0,p=g;for(let S=0;S<y.length;S++){const L=y[S],D=pe(L,4),F=c.sampleCount;c.sampleCount+=D;const A=L[3]&1,x=L[3]&4,R=L[2]&1,b=L[2]&2,C=L[2]&4,M=L[2]&8;let k=8,re=D;for(A&&(k+=4),x&&D&&(!(L[k+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=F),k+=4,R?(p=pe(L,k),k+=4):p=g,b&&(k+=4),M&&(k+=4),v+=p,E+=p,re--);re--;)R?(p=pe(L,k),k+=4):p=g,b&&(k+=4),C&&(L[k+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(re+1),c.keyFrameStart=v),k+=4),M&&(k+=4),v+=p,E+=p;!E&&g&&(E+=g*D)}c.duration+=E}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,o=0;const a=Ie(n,["sidx"]);for(let l=0;l<a.length;l++){const u=w$(a[l]);if(u!=null&&u.references){i=Math.min(i,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((h,d)=>h+d.info.duration||0,0);o=Math.max(o,c+u.earliestPresentationTime/u.timescale)}}o&&oe(o)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=o*r[l].timescale-r[l].start)})}return r}function P$(n){const e={valid:null,remainder:null},t=Ie(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Xn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function BS(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let o=!1;return Ie(r,["moof"]).map(l=>{const u=l.byteOffset-8;Ie(l,["traf"]).map(h=>{const d=Ie(h,["tfdt"]).map(m=>{const g=m[0];let y=pe(m,4);return g===1&&(y*=Math.pow(2,32),y+=pe(m,8)),y/s})[0];return d!==void 0&&(n=d),Ie(h,["tfhd"]).map(m=>{const g=pe(m,4),y=pe(m,0)&16777215,v=(y&1)!==0,E=(y&2)!==0,p=(y&8)!==0;let S=0;const L=(y&16)!==0;let D=0;const F=(y&32)!==0;let A=8;g===i&&(v&&(A+=8),E&&(A+=4),p&&(S=pe(m,A),A+=4),L&&(D=pe(m,A),A+=4),F&&(A+=4),e.type==="video"&&(o=uf(e.codec)),Ie(h,["trun"]).map(x=>{const R=x[0],b=pe(x,0)&16777215,C=(b&1)!==0;let M=0;const k=(b&4)!==0,re=(b&256)!==0;let te=0;const J=(b&512)!==0;let W=0;const U=(b&1024)!==0,H=(b&2048)!==0;let N=0;const B=pe(x,4);let O=8;C&&(M=pe(x,O),O+=4),k&&(O+=4);let K=M+u;for(let Q=0;Q<B;Q++){if(re?(te=pe(x,O),O+=4):te=S,J?(W=pe(x,O),O+=4):W=D,U&&(O+=4),H&&(R===0?N=pe(x,O):N=hb(x,O),O+=4),e.type===qe.VIDEO){let Y=0;for(;Y<W;){const ee=pe(r,K);if(K+=4,D$(o,r[K])){const de=r.subarray(K,K+ee);xy(de,o?2:1,n+N/s,t)}K+=ee,Y+=ee+4}}n+=te/s}}))})})}),t}function uf(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function D$(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function xy(n,e,t,r){const s=gb(n);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const u=s.length-i;let c=i;if(a<u)i+=a;else if(a>u){Ge.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(s[c++]===181){const d=cb(s,c);if(c+=2,d===49){const m=pe(s,c);if(c+=4,m===1195456820){const g=s[c++];if(g===3){const y=s[c++],v=31&y,E=64&y,p=E?2+v*3:0,S=new Uint8Array(p);if(E){S[0]=y;for(let L=1;L<p;L++)S[L]=s[c++]}r.push({type:g,payloadType:o,pts:t,bytes:S})}}}}}else if(o===5&&a>16){const h=[];for(let g=0;g<16;g++){const y=s[c++].toString(16);h.push(y.length==1?"0"+y:y),(g===3||g===5||g===7||g===9)&&h.push("-")}const d=a-16,m=new Uint8Array(d);for(let g=0;g<d;g++)m[g]=s[c++];r.push({payloadType:o,pts:t,uuid:h.join(""),userData:Mn(m),userDataBytes:m})}}}function gb(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let o=0;for(r=0;r<s;o++,r++)o===t[0]&&(o++,t.shift()),i[r]=n[o];return i}function N$(n){const e=n[0];let t="",r="",s=0,i=0,o=0,a=0,l=0,u=0;if(e===0){for(;Rt(n.subarray(u,u+1))!=="\0";)t+=Rt(n.subarray(u,u+1)),u+=1;for(t+=Rt(n.subarray(u,u+1)),u+=1;Rt(n.subarray(u,u+1))!=="\0";)r+=Rt(n.subarray(u,u+1)),u+=1;r+=Rt(n.subarray(u,u+1)),u+=1,s=pe(n,12),i=pe(n,16),a=pe(n,20),l=pe(n,24),u=28}else if(e===1){u+=4,s=pe(n,u),u+=4;const h=pe(n,u);u+=4;const d=pe(n,u);for(u+=4,o=2**32*h+d,c$(o)||(o=Number.MAX_SAFE_INTEGER,Ge.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=pe(n,u),u+=4,l=pe(n,u),u+=4;Rt(n.subarray(u,u+1))!=="\0";)t+=Rt(n.subarray(u,u+1)),u+=1;for(t+=Rt(n.subarray(u,u+1)),u+=1;Rt(n.subarray(u,u+1))!=="\0";)r+=Rt(n.subarray(u,u+1)),u+=1;r+=Rt(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:c}}function O$(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function M$(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),O$([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,o,t)}function F$(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=U$(s);e.push(i),r+=i.size}}return e}function U$(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,a=Kt(new Uint8Array(o,t+12,16));let l=null,u=null,c=0;if(i===0)c=28;else{const d=n.getUint32(28);if(!d||r<32+d*16)return{offset:t,size:e};l=[];for(let m=0;m<d;m++)l.push(new Uint8Array(o,t+32+m*16,16));c=32+d*16}if(!c)return{offset:t,size:e};const h=n.getUint32(c);return e-32<h?{offset:t,size:e}:(u=new Uint8Array(o,t+c+4,h),{version:i,systemId:a,kids:l,data:u,offset:t,size:e})}const pb=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),La={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Iy(n,e){const t=La[e];return!!t&&!!t[n.slice(0,4)]}function Tu(n,e,t=!0){return!n.split(",").some(r=>!Ay(r,e,t))}function Ay(n,e,t=!0){var r;const s=Ii(t);return(r=s==null?void 0:s.isTypeSupported(Su(n,e)))!=null?r:!1}function Su(n,e){return`${e}/mp4;codecs=${n}`}function $S(n){if(n){const e=n.substring(0,4);return La.video[e]}return 2}function cd(n){const e=pb();return n.split(",").reduce((t,r)=>{const i=e&&uf(r)?9:La.video[r];return i?(i*2+t)/(t?3:2):(La.audio[r]+t)/(t?2:1)},0)}const Em={};function B$(n,e=!0){if(Em[n])return Em[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(Ay(t[s],"audio",e))return Em[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Ii(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const $$=/flac|opus|mp4a\.40\.34/i;function hd(n,e=!0){return n.replace($$,t=>B$(t.toLowerCase(),e))}function V$(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)Iy(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function ah(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(VS(n,"audio")||VS(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function VS(n,e){return Iy(n,e)&&Ay(n,e)}function j$(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function G$(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function jS(n){const e=Ii(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function pp(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const K$={supported:!0,powerEfficient:!0,smooth:!0},H$={supported:!1,smooth:!1,powerEfficient:!1},yb={supported:!0,configurations:[],decodingInfoResults:[K$]};function vb(n,e){return{supported:!1,configurations:e,decodingInfoResults:[H$],error:n}}function z$(n,e,t,r,s,i){const o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=i==null?void 0:i.audioCodec,u=i==null?void 0:i.channels,c=u?parseInt(u):l?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((d,m)=>{if(m){const g=e.groups[m];if(!g)throw new Error(`Audio track group ${m} not found`);Object.keys(g.channels).forEach(y=>{d[y]=(d[y]||0)+g.channels[y]})}return d},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(d=>uf(d))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!h&&oe(c)&&Object.keys(h).some(d=>parseInt(d)>c)}function Eb(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(yb);const i=[],o=W$(n),a=o.length,l=q$(n,e,a>0),u=l.length;for(let c=a||1*u||1;c--;){const h={type:"media-source"};if(a&&(h.video=o[c%a]),u){h.audio=l[c%u];const d=h.audio.bitrate;h.video&&d&&(h.video.bitrate-=d)}i.push(h)}if(s){const c=navigator.userAgent;if(s.split(",").some(h=>uf(h))&&pb())return Promise.resolve(vb(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),i))}return Promise.all(i.map(c=>{const h=Q$(c);return r[h]||(r[h]=t.decodingInfo(c))})).then(c=>({supported:!c.some(h=>!h.supported),configurations:i,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:i,decodingInfoResults:[],error:c}))}function W$(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=Tb(n),s=n.width||640,i=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:Su(G$(l),"video"),width:s,height:i,bitrate:r,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function q$(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=Tb(n);return s&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;const u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((c,h)=>{if(h.groupId===a){const d=parseFloat(h.channels||"");s.forEach(m=>{const g={contentType:Su(m,"audio"),bitrate:t?Y$(m,i):i};d&&(g.channels=""+d),c.push(g)})}return c},o):o},[]):[]}function Y$(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Tb(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Q$(n){let e="";const{audio:t,video:r}=n;if(r){const s=pp(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=pp(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const yp=["NONE","TYPE-0","TYPE-1",null];function X$(n){return yp.indexOf(n)>-1}const dd=["SDR","PQ","HLG"];function J$(n){return!!n&&dd.indexOf(n)>-1}var lh={No:"",Yes:"YES",v2:"v2"};function GS(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?lh.v2:lh.Yes:lh.No}class KS{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class _u{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return HS(this._audioGroups,e)}hasSubtitleGroup(e){return HS(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function HS(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Z$(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function eV(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||dd.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&Z$(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const tV=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Ye=(n,e)=>JSON.stringify(n,tV(e));function nV(n,e,t,r,s){const i=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=s==null?void 0:s.videoCodec,u=o&&parseInt(o)===2;let c=!1,h=!1,d=1/0,m=1/0,g=1/0,y=1/0,v=0,E=[];const{preferHDR:p,allowedVideoRanges:S}=eV(e,s);for(let x=i.length;x--;){const R=n[i[x]];c||(c=R.channels[2]>0),d=Math.min(d,R.minHeight),m=Math.min(m,R.minFramerate),g=Math.min(g,R.minBitrate),S.filter(C=>R.videoRanges[C]>0).length>0&&(h=!0)}d=oe(d)?d:0,m=oe(m)?m:0;const L=Math.max(1080,d),D=Math.max(30,m);g=oe(g)?g:t,t=Math.max(g,t),h||(e=void 0);const F=i.length>1;return{codecSet:i.reduce((x,R)=>{const b=n[R];if(R===x)return x;if(E=h?S.filter(C=>b.videoRanges[C]>0):[],F){if(b.minBitrate>t)return _r(R,`min bitrate of ${b.minBitrate} > current estimate of ${t}`),x;if(!b.hasDefaultAudio)return _r(R,"no renditions with default or auto-select sound found"),x;if(a&&R.indexOf(a.substring(0,4))%5!==0)return _r(R,`audio codec preference "${a}" not found`),x;if(o&&!u){if(!b.channels[o])return _r(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(b.channels)})`),x}else if((!a||u)&&c&&b.channels[2]===0)return _r(R,"no renditions with stereo sound found"),x;if(b.minHeight>L)return _r(R,`min resolution of ${b.minHeight} > maximum of ${L}`),x;if(b.minFramerate>D)return _r(R,`min framerate of ${b.minFramerate} > maximum of ${D}`),x;if(!E.some(C=>b.videoRanges[C]>0))return _r(R,`no variants with VIDEO-RANGE of ${Ye(E)} found`),x;if(l&&R.indexOf(l.substring(0,4))%5!==0)return _r(R,`video codec preference "${l}" not found`),x;if(b.maxScore<v)return _r(R,`max score of ${b.maxScore} < selected max of ${v}`),x}return x&&(cd(R)>=cd(x)||b.fragmentError>n[x].fragmentError)?x:(y=b.minIndex,v=b.maxScore,R)},void 0),videoRanges:E,preferHDR:p,minFramerate:m,minBitrate:g,minIndex:y}}function _r(n,e){Ge.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function Sb(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function rV(n,e,t,r){return n.slice(t,r+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const a=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const u=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const h=e.groups[c];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(d=>{l.channels[d]=(l.channels[d]||0)+h.channels[d]}))}),s},{})}function zS(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function Or(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(to(n,s,t))return r}return-1}function to(n,e,t){const{groupId:r,name:s,lang:i,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||sV(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||iV(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function sV(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function iV(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Hi(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function oV(n,e,t,r,s){const i=e[r],a=e.reduce((d,m,g)=>{const y=m.uri;return(d[y]||(d[y]=[])).push(g),d},{})[i.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),h=WS(e,r,d=>{if(d.videoRange!==l||d.frameRate!==u||d.codecSet.substring(0,4)!==c)return!1;const m=d.audioGroups,g=t.filter(y=>!m||m.indexOf(y.groupId)!==-1);return Or(n,g,s)>-1});return h>-1?h:WS(e,r,d=>{const m=d.audioGroups,g=t.filter(y=>!m||m.indexOf(y.groupId)!==-1);return Or(n,g,s)>-1})}function WS(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function fd(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class aV extends Jn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!s||!l)return;const u=performance.now(),c=i?i.stats:s.stats,h=i?i.duration:s.duration,d=u-c.loading.start,m=o.minAutoLevel,g=s.level,y=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=m){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const v=y>-1&&y!==g,E=!!t||v;if(!E&&(l.paused||!l.playbackRate||!l.readyState))return;const p=o.mainForwardBufferInfo;if(!E&&p===null)return;const S=this.bwEstimator.getEstimateTTFB(),L=Math.abs(l.playbackRate);if(d<=Math.max(S,1e3*(h/(L*2))))return;const D=p?p.len/L:0,F=c.loading.first?c.loading.first-c.loading.start:-1,A=c.loaded&&F>-1,x=this.getBwEstimate(),R=o.levels,b=R[g],C=Math.max(c.loaded,Math.round(h*(s.bitrate||b.averageBitrate)/8));let M=A?d-F:d;M<1&&A&&(M=Math.min(d,c.loaded*8/x));const k=A?c.loaded*1e3/M:0,re=S/1e3,te=k?(C-c.loaded)/k:C*8/x+re;if(te<=D)return;const J=k?k*8:x,W=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,U=this.hls.config.abrBandWidthUpFactor;let H=Number.POSITIVE_INFINITY,N;for(N=g-1;N>m;N--){const Q=R[N].maxBitrate,Y=!R[N].details||W;if(H=this.getTimeToLoadFrag(re,J,h*Q,Y),H<Math.min(D,h+re))break}if(H>=te||H>h*10)return;A?this.bwEstimator.sample(d-Math.min(S,F),c.loaded):this.bwEstimator.sampleTTFB(d);const B=R[N].maxBitrate;this.getBwEstimate()*U>B&&this.resetEstimator(B);const O=this.findBestLevel(B,m,N,0,D,1,1);O>-1&&(N=O),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${D.toFixed(3)} s
      Estimated load time for current fragment: ${te.toFixed(3)} s
      Estimated load time for down switch fragment: ${H.toFixed(3)} s
      TTFB estimate: ${F|0} ms
      Current BW estimate: ${oe(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${N} @ ${B|0} bps`),o.nextLoadLevel=o.nextAutoLevel=N,this.clearTimer();const K=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===N&&N>0){const Q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${N>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Q.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,N>m){let Y=this.findBestLevel(this.hls.levels[m].bitrate,m,N,0,Q,1,1);Y===-1&&(Y=m),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Y,this.resetEstimator(this.hls.levels[Y].bitrate)}}};v||te>H*2?K():this.timer=self.setInterval(K,H*1e3),o.trigger(_.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new d$(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(_.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case j.BUFFER_ADD_CODEC_ERROR:case j.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case j.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const o=performance.now(),a=i?i.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;oe(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===le.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(_.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==le.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,h=i.abrBandWidthUpFactor;if(u){const v=this.findBestLevel(l,o,s,u,0,c,h);if(v>=0)return this.rebufferNotice=-1,v}let d=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const v=this.bitrateTestDelay;v&&(d=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),c=h=1)}const m=this.findBestLevel(l,o,s,u,d,c,h);if(this.rebufferNotice!==m&&(this.rebufferNotice=m,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`)),m>-1)return m;const g=r.levels[o],y=r.loadLevelObj;return y&&(g==null?void 0:g.bitrate)<y.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,o,a){var l;const u=s+i,c=this.lastLoadedFragLevel,h=c===-1?this.hls.firstLevel:c,{fragCurrent:d,partCurrent:m}=this,{levels:g,allAudioTracks:y,loadLevel:v,config:E}=this.hls;if(g.length===1)return 0;const p=g[h],S=!!((l=this.hls.latestLevelDetails)!=null&&l.live),L=v===-1||c===-1;let D,F="SDR",A=(p==null?void 0:p.frameRate)||0;const{audioPreference:x,videoPreference:R}=E,b=this.audioTracksByGroup||(this.audioTracksByGroup=Sb(y));let C=-1;if(L){if(this.firstSelection!==-1)return this.firstSelection;const J=this.codecTiers||(this.codecTiers=rV(g,b,t,r)),W=nV(J,F,e,x,R),{codecSet:U,videoRanges:H,minFramerate:N,minBitrate:B,minIndex:O,preferHDR:K}=W;C=O,D=U,F=K?H[H.length-1]:H[0],A=N,e=Math.max(e,B),this.log(`picked start tier ${Ye(W)}`)}else D=p==null?void 0:p.codecSet,F=p==null?void 0:p.videoRange;const M=m?m.duration:d?d.duration:0,k=this.bwEstimator.getEstimateTTFB()/1e3,re=[];for(let J=r;J>=t;J--){var te;const W=g[J],U=J>h;if(!W)continue;if(E.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const Y=navigator.mediaCapabilities;typeof(Y==null?void 0:Y.decodingInfo)=="function"&&z$(W,b,F,A,e,x)?(W.supportedPromise=Eb(W,b,Y,this.supportedCache),W.supportedPromise.then(ee=>{if(!this.hls)return;W.supportedResult=ee;const de=this.hls.levels,Ae=de.indexOf(W);ee.error?this.warn(`MediaCapabilities decodingInfo error: "${ee.error}" for level ${Ae} ${Ye(ee)}`):ee.supported?ee.decodingInfoResults.some(_e=>_e.smooth===!1||_e.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ae} not smooth or powerEfficient: ${Ye(ee)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ae} ${Ye(ee)}`),Ae>-1&&de.length>1&&(this.log(`Removing unsupported level ${Ae}`),this.hls.removeLevel(Ae),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ee=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ee}`)})):W.supportedResult=yb}if((D&&W.codecSet!==D||F&&W.videoRange!==F||U&&A>W.frameRate||!U&&A>0&&A<W.frameRate||(te=W.supportedResult)!=null&&(te=te.decodingInfoResults)!=null&&te.some(Y=>Y.smooth===!1))&&(!L||J!==C)){re.push(J);continue}const H=W.details,N=(m?H==null?void 0:H.partTarget:H==null?void 0:H.averagetargetduration)||M;let B;U?B=a*e:B=o*e;const O=M&&s>=M*2&&i===0?W.averageBitrate:W.maxBitrate,K=this.getTimeToLoadFrag(k,B,O*N,H===void 0);if(B>=O&&(J===c||W.loadError===0&&W.fragmentError===0)&&(K<=k||!oe(K)||S&&!this.bitrateTestDelay||K<u)){const Y=this.forcedAutoLevel;return J!==v&&(Y===-1||Y!==v)&&(re.length&&this.trace(`Skipped level(s) ${re.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[re[0]].codecs}" ${g[re[0]].videoRange}; not compatible with "${D}" ${F}`),this.info(`switch candidate:${h}->${J} adjustedbw(${Math.round(B)})-bitrate=${Math.round(B-O)} ttfb:${k.toFixed(1)} avgDuration:${N.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${K.toFixed(1)} firstSelection:${L} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${v}`)),L&&(this.firstSelection=J),J}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const _b={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const o=e(i);if(o>0)t=s+1;else if(o<0)r=s-1;else return i}return null}};function lV(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!oe(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(cV(e,t,o))return o}return null}function po(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&qS(t,r,i)===0||uV(i,n,Math.min(s,r))))return i;const o=_b.search(e,qS.bind(null,t,r));return o&&(o!==n||!i)?o:i}function uV(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function qS(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function cV(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function xb(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return _b.search(r,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function md(n){switch(n.details){case j.FRAG_LOAD_TIMEOUT:case j.KEY_LOAD_TIMEOUT:case j.LEVEL_LOAD_TIMEOUT:case j.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ib(n){return n.details.startsWith("key")}function Ab(n){return Ib(n)&&!!n.frag&&!n.frag.decryptdata}function YS(n,e){const t=md(e);return n.default[`${t?"timeout":"error"}Retry`]}function wy(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function QS(n){return je(je({},n),{errorRetry:null,timeoutRetry:null})}function gd(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(hV(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function hV(n){return vp(n)||!!n&&(n<400||n>499)}function vp(n){return n===0&&navigator.onLine===!1}var jt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Cn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class dV extends Jn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.ERROR,this.onError,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.ERROR,this.onError,this),e.off(_.ERROR,this.onErrorOut,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===le.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case j.FRAG_LOAD_ERROR:case j.FRAG_LOAD_TIMEOUT:case j.KEY_LOAD_ERROR:case j.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case j.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ha();return}case j.FRAG_GAP:case j.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=jt.SendAlternateToPenaltyBox;return}case j.LEVEL_EMPTY_ERROR:case j.LEVEL_PARSING_ERROR:{var o;const l=t.parent===le.MAIN?t.level:s.loadLevel;t.details===j.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case j.LEVEL_LOAD_ERROR:case j.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case j.AUDIO_TRACK_LOAD_ERROR:case j.AUDIO_TRACK_LOAD_TIMEOUT:case j.SUBTITLE_LOAD_ERROR:case j.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===Re.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===Re.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=jt.SendAlternateToPenaltyBox,t.errorAction.flags=Cn.MoveAllAlternatesMatchingHost;return}}return;case j.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:jt.SendAlternateToPenaltyBox,flags:Cn.MoveAllAlternatesMatchingHDCP};return;case j.KEY_SYSTEM_SESSION_UPDATE_FAILED:case j.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case j.KEY_SYSTEM_NO_SESSION:t.errorAction={action:jt.SendAlternateToPenaltyBox,flags:Cn.MoveAllAlternatesMatchingKey};return;case j.BUFFER_ADD_CODEC_ERROR:case j.REMUX_ALLOC_ERROR:case j.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:s.loadLevel)}return;case j.INTERNAL_EXCEPTION:case j.BUFFER_APPENDING_ERROR:case j.BUFFER_FULL_ERROR:case j.LEVEL_SWITCH_ERROR:case j.BUFFER_STALLED_ERROR:case j.BUFFER_SEEK_OVER_HOLE:case j.BUFFER_NUDGE_ON_STALL:t.errorAction=ha();return}t.type===ce.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ha())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=YS(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(gd(s,i,md(e),e.response))return{action:jt.RetryRequest,flags:Cn.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=YS(Ib(e)?o:i,e),l=t.levels.reduce((c,h)=>c+h.fragmentError,0);if(s&&(e.details!==j.FRAG_GAP&&s.fragmentError++,!Ab(e)&&gd(a,l,md(e),e.response)))return{action:jt.RetryRequest,flags:Cn.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const u=e.details;s.loadError++,u===j.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:h,loadLevel:d,minAutoLevel:m,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const y=(i=e.frag)==null?void 0:i.type,E=(y===le.AUDIO&&u===j.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===j.BUFFER_ADD_CODEC_ERROR||u===j.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:F})=>s.audioCodec!==F),S=e.sourceBufferName==="video"&&(u===j.BUFFER_ADD_CODEC_ERROR||u===j.BUFFER_APPEND_ERROR)&&h.some(({codecSet:F,audioCodec:A})=>s.codecSet!==F&&s.audioCodec===A),{type:L,groupId:D}=(o=e.context)!=null?o:{};for(let F=h.length;F--;){const A=(F+d)%h.length;if(A!==d&&A>=m&&A<=g&&h[A].loadError===0){var a,l;const x=h[A];if(u===j.FRAG_GAP&&y===le.MAIN&&e.frag){const R=h[A].details;if(R){const b=po(e.frag,R.fragments,e.frag.start);if(b!=null&&b.gap)continue}}else{if(L===Re.AUDIO_TRACK&&x.hasAudioGroup(D)||L===Re.SUBTITLE_TRACK&&x.hasSubtitleGroup(D))continue;if(y===le.AUDIO&&(a=s.audioGroups)!=null&&a.some(R=>x.hasAudioGroup(R))||y===le.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(R=>x.hasSubtitleGroup(R))||E&&s.audioCodec===x.audioCodec||S&&s.codecSet===x.codecSet||!E&&s.codecSet!==x.codecSet)continue}c=A;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:jt.SendAlternateToPenaltyBox,flags:Cn.None,nextAutoLevel:c}}return{action:jt.SendAlternateToPenaltyBox,flags:Cn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case jt.DoNothing:break;case jt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==j.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Cn.None:this.switchLevel(e,i);break;case Cn.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(r.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=yp[yp.indexOf(c)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Cn.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let d=c;d--;)if(this.variantHasKey(u[d],l)){var o,a;this.log(`Banned key found in level ${d} (${u[d].bitrate}bps) or audio group "${(o=u[d].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Kt(l.keyId||[])}`),u[d].fragmentError++,u[d].loadError++,this.log(`Removing level ${d} with key error (${e.error})`),this.hls.removeLevel(d)}const h=e.frag;if(this.hls.levels.length<c)r.resolved=!0;else if(h&&h.type!==le.MAIN){const d=h.decryptdata;d&&!l.matches(d)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===j.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=pp(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function ha(n){const e={action:jt.DoNothing,flags:Cn.None};return n&&(e.resolved=!0),e}var Lt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class fV{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const a=s[i[o]];if((a==null?void 0:a.body.type)===t&&(!r||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const h=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=Co(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(a=>{const l=r.elementaryStreams[a];if(!l)return;const u=t[a],c=o||l.partial===!0;i.range[a]=this.getBufferedTimes(r,e.part,c,u)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),wc(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=XS(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Co(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<s.length;c++){const h=s.start(c)-this.bufferPadding,d=s.end(c)+this.bufferPadding;if(u>=h&&l<=d){i.time.push({startPTS:Math.max(o,s.start(c)),endPTS:Math.min(a,s.end(c))});break}else if(o<d&&a>h){const m=Math.max(o,s.start(c)),g=Math.min(a,s.end(c));g>m&&(i.partial=!0,i.time.push({startPTS:m,endPTS:g}))}else if(a<=h)break}return i}getPartialFragment(e){let t=null,r,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&wc(c)&&(s=c.body.start-a,i=c.body.end+a,e>=s&&e<=i&&(r=Math.min(e-s,i-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||wc(t))}getState(e){const t=Co(e),r=this.fragments[t];return r?r.buffered?wc(r)?Lt.PARTIAL:Lt.OK:Lt.APPENDING:Lt.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let o=0;o<r.length;o++){if(s=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=Co(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(s){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(s)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Co(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Co(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=XS(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function wc(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Co(n){return`${n.type}_${n.level}_${n.sn}`}function XS(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Ai={cbc:0,ctr:1};class mV{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Ai.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ai.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function gV(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class pV{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],h=l[2],d=l[3],m=new Uint32Array(256);let g=0,y=0,v=0;for(v=0;v<256;v++)v<128?m[v]=v<<1:m[v]=v<<1^283;for(v=0;v<256;v++){let E=y^y<<1^y<<2^y<<3^y<<4;E=E>>>8^E&255^99,e[g]=E,t[E]=g;const p=m[g],S=m[p],L=m[S];let D=m[E]*257^E*16843008;s[g]=D<<24|D>>>8,i[g]=D<<16|D>>>16,o[g]=D<<8|D>>>24,a[g]=D,D=L*16843009^S*65537^p*257^g*16843008,u[E]=D<<24|D>>>8,c[E]=D<<16|D>>>16,h[E]=D<<8|D>>>24,d[E]=D,g?(g=p^m[m[m[L^p]]],y^=m[m[y]]):g=y=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),h=this.sBox,d=this.rcon,m=this.invSubMix,g=m[0],y=m[1],v=m[2],E=m[3];let p,S;for(a=0;a<o;a++){if(a<i){p=u[a]=t[a];continue}S=p,a%i===0?(S=S<<8|S>>>24,S=h[S>>>24]<<24|h[S>>>16&255]<<16|h[S>>>8&255]<<8|h[S&255],S^=d[a/i|0]<<24):i>6&&a%i===4&&(S=h[S>>>24]<<24|h[S>>>16&255]<<16|h[S>>>8&255]<<8|h[S&255]),u[a]=p=(u[a-i]^S)>>>0}for(l=0;l<o;l++)a=o-l,l&3?S=u[a]:S=u[a-4],l<4||a<=4?c[l]=S:c[l]=g[h[S>>>24]]^y[h[S>>>16&255]]^v[h[S>>>8&255]]^E[h[S&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],h=a[3],d=this.uint8ArrayToUint32Array_(r);let m=d[0],g=d[1],y=d[2],v=d[3];const E=new Int32Array(e),p=new Int32Array(E.length);let S,L,D,F,A,x,R,b,C,M,k,re,te,J;const W=this.networkToHostOrderSwap;for(;t<E.length;){for(C=W(E[t]),M=W(E[t+1]),k=W(E[t+2]),re=W(E[t+3]),A=C^i[0],x=re^i[1],R=k^i[2],b=M^i[3],te=4,J=1;J<s;J++)S=l[A>>>24]^u[x>>16&255]^c[R>>8&255]^h[b&255]^i[te],L=l[x>>>24]^u[R>>16&255]^c[b>>8&255]^h[A&255]^i[te+1],D=l[R>>>24]^u[b>>16&255]^c[A>>8&255]^h[x&255]^i[te+2],F=l[b>>>24]^u[A>>16&255]^c[x>>8&255]^h[R&255]^i[te+3],A=S,x=L,R=D,b=F,te=te+4;S=o[A>>>24]<<24^o[x>>16&255]<<16^o[R>>8&255]<<8^o[b&255]^i[te],L=o[x>>>24]<<24^o[R>>16&255]<<16^o[b>>8&255]<<8^o[A&255]^i[te+1],D=o[R>>>24]<<24^o[b>>16&255]<<16^o[A>>8&255]<<8^o[x&255]^i[te+2],F=o[b>>>24]<<24^o[A>>16&255]<<16^o[x>>8&255]<<8^o[R&255]^i[te+3],p[t]=W(S^m),p[t+1]=W(F^g),p[t+2]=W(D^y),p[t+3]=W(L^v),m=C,g=M,y=k,v=re,t=t+4}return p.buffer}}class yV{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=vV(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function vV(n){switch(n){case Ai.cbc:return"AES-CBC";case Ai.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const EV=16;class Ry{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?gV(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,s);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:o,remainderData:a}=this;if(s!==Ai.cbc||t.byteLength!==16)return Ge.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Xn(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new pV),u.expandKey(t);const c=o;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new yV(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new mV(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Ge.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%EV;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Ge.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const JS=Math.pow(2,17);class TV{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new rs({type:ce.NETWORK_ERROR,details:j.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(e_(e));return}else e.gap=!1;const u=this.loader=i?new i(s):new o(s),c=ZS(e);e.loader=u;const h=QS(s.fragLoadPolicy.default),d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:JS};e.stats=u.stats;const m={onSuccess:(g,y,v,E)=>{this.resetLoader(e,u);let p=g.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(p.slice(0,16)),p=p.slice(16)),a({frag:e,part:null,payload:p,networkDetails:E})},onError:(g,y,v,E)=>{this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:je({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:v,stats:E}))},onAbort:(g,y,v)=>{this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:g}))},onTimeout:(g,y,v)=>{this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:v,stats:g}))}};t&&(m.onProgress=(g,y,v,E)=>t({frag:e,part:null,payload:v,networkDetails:E})),u.load(c,d,m)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(e_(e,t));return}const u=this.loader=i?new i(s):new o(s),c=ZS(e,t);e.loader=u;const h=QS(s.fragLoadPolicy.default),d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:JS};t.stats=u.stats,u.load(c,d,{onSuccess:(m,g,y,v)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:m.data,networkDetails:v};r(E),a(E)},onError:(m,g,y,v)=>{this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:je({url:c.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:y,stats:v}))},onAbort:(m,g,y)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:m}))},onTimeout:(m,g,y)=>{this.resetLoader(e,u),l(new rs({type:ce.NETWORK_ERROR,details:j.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:y,stats:m}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/i),l),h=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+h}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ZS(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(oe(s)&&oe(i)){var o;let a=s,l=i;if(n.sn==="initSegment"&&SV((o=n.decryptdata)==null?void 0:o.method)){const u=i-s;u%16&&(l=i+(16-u%16)),s!==0&&(r.resetIV=!0,a=s-16)}r.rangeStart=a,r.rangeEnd=l}return r}function e_(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:ce.MEDIA_ERROR,details:j.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new rs(r)}function SV(n){return n==="AES-128"||n==="AES-256"}class rs extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class wb extends Jn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class by{constructor(e,t,r,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Rc(),this.buffering={audio:Rc(),video:Rc(),audiovideo:Rc()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=o}}function Rc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const t_={length:0,start:()=>0,end:()=>0};class ve{static isBuffered(e,t){if(e){const r=ve.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=ve.getBuffered(e);return ve.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=ve.bufferedRanges(e);if(s.length)return ve.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,h)=>c.start-h.start||h.end-c.end);let s=-1,i=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(s=c);const h=i.length;if(h){const d=i[h-1].end;e[c].start-d<r?e[c].end>d&&(i[h-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let o=0,a,l=t,u=t;for(let c=0;c<i.length;c++){const h=i[c].start,d=i[c].end;if(s===-1&&t>=h&&t<=d&&(s=c),t+r>=h&&t<d)l=h,u=d,o=u-t;else if(t+r<h){a=h;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||t_}catch(t){return Ge.log("failed to get media.buffered",t),t_}}}const Rb=/\{\$([a-zA-Z0-9-_]+)\}/g;function n_(n){return Rb.test(n)}function Ep(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(Rb,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function r_(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function _V(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const xV=/^(\d+)x(\d+)$/,s_=/(.+?)=(".*?"|.*?)(?:,|$)/g;class it{constructor(e,t){typeof e=="string"&&(e=it.parseAttrList(e,t)),ze(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xV.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={},i='"';for(s_.lastIndex=0;(r=s_.exec(e))!==null;){const o=r[1].trim();let a=r[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=Ep(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ge.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=a}return s}}const IV="com.apple.hls.interstitial";function AV(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function wV(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class bb{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){Ge.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ze(new it({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);oe(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ge.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===IV}get isValid(){return!!this.id&&!this._badValueForSameId&&oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const RV=10;class bV{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||RV}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function pd(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function i_(n,e){return!n&&!e?!0:!n||!e?!1:pd(n,e)}function da(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Ly(n){switch(n){case"AES-128":case"AES-256":return Ai.cbc;case"AES-256-CTR":return Ai.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Cy(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Tp(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function LV(n){const e=Tp(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Lb(n){const e=function(r,s,i){const o=r[s];r[s]=r[i],r[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function Cb(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(r.splice(-1,1),t=Cy(o)):t=LV(o)}}return t}const yd=typeof self<"u"?self:void 0;var at={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ht={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function uh(n){switch(n){case Ht.FAIRPLAY:return at.FAIRPLAY;case Ht.PLAYREADY:return at.PLAYREADY;case Ht.WIDEVINE:return at.WIDEVINE;case Ht.CLEARKEY:return at.CLEARKEY}}function Tm(n){switch(n){case at.FAIRPLAY:return Ht.FAIRPLAY;case at.PLAYREADY:return Ht.PLAYREADY;case at.WIDEVINE:return Ht.WIDEVINE;case at.CLEARKEY:return Ht.CLEARKEY}}function Al(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[at.FAIRPLAY,at.WIDEVINE,at.PLAYREADY,at.CLEARKEY].filter(s=>!!e[s]):[];return!r[at.WIDEVINE]&&t&&r.push(at.WIDEVINE),r}const kb=function(n){return yd!=null&&(n=yd.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function CV(n,e,t,r){let s;switch(n){case at.FAIRPLAY:s=["cenc","sinf"];break;case at.WIDEVINE:case at.PLAYREADY:s=["cenc"];break;case at.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return kV(s,e,t,r)}function kV(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function PV(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Pb(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=Cy(a).subarray(0,16);return Lb(l),l}}return null}let ko={};class gi{static clearKeyUriToKeyIdMap(){ko={}}static setKeyIdForUri(e,t){ko[e]=t}static addKeyIdForUri(e){const t=Object.keys(ko).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),ko[e]=r,r}constructor(e,t,r,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!da(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(ob(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&pd(e.keyFormatVersions,this.keyFormatVersions)&&i_(e.iv,this.iv)&&i_(e.keyId,this.keyId)}isSupported(){if(this.method){if(da(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ht.FAIRPLAY:case Ht.WIDEVINE:case Ht.PLAYREADY:case Ht.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(da(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Ge.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=NV(e)),new gi(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=ko[this.uri];if(i&&!pd(this.keyId,i)&&gi.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=Cb(this.uri);if(r)switch(this.keyFormat){case Ht.WIDEVINE:if(this.pssh=r,!this.keyId){const i=F$(r.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=o_(t));break;case Ht.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=M$(i,null,r),this.keyId=Pb(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=DV(t),i||(i=o_(t),i||(i=ko[this.uri])),i&&(this.keyId=i,gi.setKeyIdForUri(this.uri,i))}return this}}function DV(n){const e=n==null?void 0:n[Ht.WIDEVINE];return e?e.keyId:null}function o_(n){const e=n==null?void 0:n[Ht.PLAYREADY];if(e){const t=Cb(e.uri);if(t)return Pb(t)}return null}function NV(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const a_=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,l_=/#EXT-X-MEDIA:(.*)/g,OV=/^#EXT(?:INF|-X-TARGETDURATION):/m,Sm=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),MV=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Mr{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return Sy.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return OV.test(e)}static parseMasterPlaylist(e,t){const r=n_(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(a_.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=a_.exec(e))!=null;)if(o[1]){var a;const u=new it(o[1],s),c=Ep(s,o[2]),h={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Mr.resolve(c,t)},d=u.decimalResolution("RESOLUTION");d&&(h.width=d.width,h.height=d.height),h_(u.CODECS,h);const m=u["SUPPLEMENTAL-CODECS"];m&&(h.supplemental={},h_(m,h.supplemental)),(a=h.unknownCodecs)!=null&&a.length||i.push(h),s.levels.push(h)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const h=new it(c,s),d=h["DATA-ID"];d&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[d]=h);break}case"SESSION-KEY":{const h=u_(c,t,s);h.encrypted&&h.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(h)):Ge.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const h=new it(c,s);r_(s,h,t)}break}case"CONTENT-STEERING":{const h=new it(c,s);s.contentSteering={uri:Mr.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=c_(c);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(l_.lastIndex=0;(s=l_.exec(e))!==null;){const u=new it(s[1],r),c=u.TYPE;if(c){const h=a[c],d=i[c]||[];i[c]=d;const m=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],y=u.CHANNELS,v=u.CHARACTERISTICS,E=u["INSTREAM-ID"],p={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||m||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:m,url:u.URI?Mr.resolve(u.URI,t):""};if(g&&(p.assocLang=g),y&&(p.channels=y),v&&(p.characteristics=v),E&&(p.instreamId=E),h!=null&&h.length){const S=Mr.findGroup(h,p.groupId)||h[0];d_(p,S,"audioCodec"),d_(p,S,"textCodec")}d.push(p)}}return i}static parseLevelPlaylist(e,t,r,s,i,o){var a;const l={url:t},u=new bV(t),c=u.fragments,h=[];let d=null,m=0,g=0,y=0,v=0,E=0,p=null,S=new ym(s,l),L,D,F,A=-1,x=!1,R=null,b;if(Sm.lastIndex=0,u.m3u8=e,u.hasVariableRefs=n_(e),((a=Sm.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(L=Sm.exec(e))!==null;){x&&(x=!1,S=new ym(s,l),S.playlistOffset=y,S.setStart(y),S.sn=m,S.cc=v,E&&(S.bitrate=E),S.level=r,d&&(S.initSegment=d,d.rawProgramDateTime&&(S.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null),R&&(S.setByteRange(R),R=null)));const re=L[1];if(re){S.duration=parseFloat(re);const te=(" "+L[2]).slice(1);S.title=te||null,S.tagList.push(te?["INF",re,te]:["INF",re])}else if(L[3]){if(oe(S.duration)){S.playlistOffset=y,S.setStart(y),F&&m_(S,F,u),S.sn=m,S.level=r,S.cc=v,c.push(S);const te=(" "+L[3]).slice(1);S.relurl=Ep(u,te),Sp(S,p,h),p=S,y+=S.duration,m++,g=0,x=!0}}else{if(L=L[0].match(MV),!L){Ge.warn("No matches on slow regex match for level playlist!");continue}for(D=1;D<L.length&&L[D]===void 0;D++);const te=(" "+L[D]).slice(1),J=(" "+L[D+1]).slice(1),W=L[D+2]?(" "+L[D+2]).slice(1):null;switch(te){case"BYTERANGE":p?S.setByteRange(J,p):S.setByteRange(J);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=J,S.tagList.push(["PROGRAM-DATE-TIME",J]),A===-1&&(A=c.length);break;case"PLAYLIST-TYPE":u.type&&es(u,te,L),u.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?es(u,te,L):c.length>0&&g_(u,te,L),m=u.startSN=parseInt(J);break;case"SKIP":{u.skippedSegments&&es(u,te,L);const U=new it(J,u),H=U.decimalInteger("SKIPPED-SEGMENTS");if(oe(H)){u.skippedSegments+=H;for(let B=H;B--;)c.push(null);m+=H}const N=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(N.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&es(u,te,L),u.targetduration=Math.max(parseInt(J),1);break;case"VERSION":u.version!==null&&es(u,te,L),u.version=parseInt(J);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||es(u,te,L),u.live=!1;break;case"#":(J||W)&&S.tagList.push(W?[J,W]:[J]);break;case"DISCONTINUITY":v++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([te]);break;case"BITRATE":S.tagList.push([te,J]),E=parseInt(J)*1e3,oe(E)?S.bitrate=E:E=0;break;case"DATERANGE":{const U=new it(J,u),H=new bb(U,u.dateRanges[U.ID],u.dateRangeTagCount);u.dateRangeTagCount++,H.isValid||u.skippedSegments?u.dateRanges[H.id]=H:Ge.warn(`Ignoring invalid DATERANGE tag: "${J}"`),S.tagList.push(["EXT-X-DATERANGE",J]);break}case"DEFINE":{{const U=new it(J,u);"IMPORT"in U?_V(u,U,o):r_(u,U,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?es(u,te,L):c.length>0&&g_(u,te,L),u.startCC=v=parseInt(J);break;case"KEY":{const U=u_(J,t,u);if(U.isSupported()){if(U.method==="NONE"){F=void 0;break}F||(F={});const H=F[U.keyFormat];H!=null&&H.matches(U)||(H&&(F=ze({},F)),F[U.keyFormat]=U)}else Ge.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${J}"`);break}case"START":u.startTimeOffset=c_(J);break;case"MAP":{const U=new it(J,u);if(S.duration){const H=new ym(s,l);f_(H,U,r,F),d=H,S.initSegment=d,d.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=d.rawProgramDateTime)}else{const H=S.byteRangeEndOffset;if(H){const N=S.byteRangeStartOffset;R=`${H-N}@${N}`}else R=null;f_(S,U,r,F),d=S,x=!0}d.cc=v;break}case"SERVER-CONTROL":{b&&es(u,te,L),b=new it(J),u.canBlockReload=b.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=b.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&b.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=b.optionalFloat("PART-HOLD-BACK",0),u.holdBack=b.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&es(u,te,L);const U=new it(J);u.partTarget=U.decimalFloatingPoint("PART-TARGET");break}case"PART":{let U=u.partList;U||(U=u.partList=[]);const H=g>0?U[U.length-1]:void 0,N=g++,B=new it(J,u),O=new _$(B,S,l,N,H);U.push(O),S.duration+=O.duration;break}case"PRELOAD-HINT":{const U=new it(J,u);u.preloadHint=U;break}case"RENDITION-REPORT":{const U=new it(J,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(U);break}default:Ge.warn(`line parsed but not handled: ${L}`);break}}}p&&!p.relurl?(c.pop(),y-=p.duration,u.partList&&(u.fragmentHint=p)):u.partList&&(Sp(S,p,h),S.cc=v,u.fragmentHint=S,F&&m_(S,F,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const C=c.length,M=c[0],k=c[C-1];if(y+=u.skippedSegments*u.targetduration,y>0&&C&&k){u.averagetargetduration=y/C;const re=k.sn;u.endSN=re!=="initSegment"?re:0,u.live||(k.endList=!0),A>0&&(UV(c,A),M&&h.unshift(M))}return u.fragmentHint&&(y+=u.fragmentHint.duration),u.totalduration=y,h.length&&u.dateRangeTagCount&&M&&Db(h,u),u.endCC=v,u}}function Db(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],u=l.startDate.getTime();l.tagAnchor=r.ref;for(let c=t;c--;){var o;if(((o=n[c])==null?void 0:o.sn)<e.startSN)break;const h=FV(e,u,n,c,s);if(h!==-1){l.tagAnchor=e.fragments[h].ref;break}}}}function FV(n,e,t,r,s){const i=t[r];if(i){const a=i.programDateTime;if(e>=a||r===0){var o;const l=(((o=t[r+1])==null?void 0:o.start)||s)-i.start;if(e<=a+l*1e3){const u=t[r].sn-n.startSN;if(u<0)return-1;const c=n.fragments;if(c.length>t.length){const d=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let m=d;m>u;m--){const g=c[m].programDateTime;if(e>=g&&e<g+c[m].duration*1e3)return m}}return u}}}return-1}function u_(n,e,t){var r,s;const i=new it(n,t),o=(r=i.METHOD)!=null?r:"",a=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&Ge.error(`Invalid IV: ${i.IV}`);const h=a?Mr.resolve(a,e):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new gi(o,h,c,d,l,i.KEYID)}function c_(n){const t=new it(n).decimalFloatingPoint("TIME-OFFSET");return oe(t)?t:null}function h_(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>Iy(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function d_(n,e,t){const r=e[t];r&&(n[t]=r)}function UV(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Sp(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function f_(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function m_(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function es(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function g_(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function _m(n,e){const t=e.startPTS;if(oe(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Nb(n,e,t,r,s,i,o){r-t<=0&&(o.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let l=t,u=r;const c=e.startPTS,h=e.endPTS;if(oe(c)){const E=Math.abs(c-t);n&&E>n.totalduration?o.warn(`media timestamps and playlist times differ by ${E}s for level ${e.level} ${n.url}`):oe(e.deltaPTS)?e.deltaPTS=Math.max(E,e.deltaPTS):e.deltaPTS=E,l=Math.max(t,c),t=Math.min(t,c),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,u=Math.min(r,h),r=Math.max(r,h),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=r,e.minEndPTS=u,e.endDTS=i;const m=e.sn;if(!n||m<n.startSN||m>n.endSN)return 0;let g;const y=m-n.startSN,v=n.fragments;for(v[y]=e,g=y;g>0;g--)_m(v[g],v[g-1]);for(g=y;g<v.length-1;g++)_m(v[g],v[g+1]);return n.fragmentHint&&_m(v[v.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function BV(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let c=s.length-1;c>=0;c--){const h=s[c].initSegment;if(h){r=h;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;jV(n,e,(c,h,d,m)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==c.cc){const g=c.cc-h.cc;for(let y=d;y<m.length;y++)m[y].cc+=g;e.endCC=m[m.length-1].cc}oe(c.startPTS)&&oe(c.endPTS)&&(h.setStart(h.startPTS=c.startPTS),h.startDTS=c.startDTS,h.maxStartPTS=c.maxStartPTS,h.endPTS=c.endPTS,h.endDTS=c.endDTS,h.minEndPTS=c.minEndPTS,h.setDuration(c.endPTS-c.startPTS),h.duration&&(i=h),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(h.elementaryStreams=c.elementaryStreams),h.loader=c.loader,c.hasStats&&(h.stats=c.stats),c.initSegment&&(h.initSegment=c.initSegment,r=c.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(r&&a.forEach(c=>{var h;c&&(!c.initSegment||c.initSegment.relurl===((h=r)==null?void 0:h.relurl))&&(c.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=$V(n.dateRanges,e,t));const c=n.fragments.filter(h=>h.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<a.length;h++)a[h].programDateTime===null&&Sp(a[h],a[h-1],c);Db(c,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const c=Fb(n,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:o[0].cc}VV(n.partList,e.partList,(c,h)=>{h.elementaryStreams=c.elementaryStreams,h.stats=c.stats}),i?Nb(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):Ob(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function $V(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=ze({},n);s&&s.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(r).forEach(l=>{const u=i[l],c=new bb(r[l].attr,u);c.isValid?(i[l]=c,u||(c.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ye(r[l].attr)}"`)}),i):r}function VV(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const o=n[s],a=e[s+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function jV(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=s;u<=i;u++){const c=l[o+u];let h=a[u];if(r&&!h&&c&&(h=e.fragments[u]=c),c&&h){t(c,h,u,a);const d=c.relurl,m=h.relurl;if(d&&GV(d,m)){e.playlistParsingError=p_(`media sequence mismatch ${h.sn}:`,n,e,c,h);return}else if(c.cc!==h.cc){e.playlistParsingError=p_(`discontinuity sequence mismatch (${c.cc}!=${h.cc})`,n,e,c,h);return}}}}function p_(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Ob(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let o=0;if(i&&r<s.length)o=s[r].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;_p(e,o)}function _p(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Mb(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function Fb(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function y_(n,e,t){return n?Ub(n.partList,e,t):null}function Ub(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Bb(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function GV(n,e){return n!==e&&e?v_(n)!==v_(e):!1}function v_(n){return n.replace(/\?[^?]*$/,"")}function jl(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function KV(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function E_(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function $b(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)E_(t[r],n);e.fragmentHint&&E_(e.fragmentHint,n),e.alignedSliding=!0}function HV(n,e){n&&(Vb(e,n),e.alignedSliding||vd(e,n),!e.alignedSliding&&!e.skippedSegments&&Ob(n,e,!1))}function Vb(n,e){if(!KV(e,n))return;const t=Math.min(e.endCC,n.endCC),r=jl(e.fragments,t),s=jl(n.fragments,t);if(!r||!s)return;Ge.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;$b(i,n)}function vd(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(s=jl(r,o),i=jl(t,o)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=jl(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(i.start-s.start);$b(u,n)}function cn(n,e,t){Tn(n,e,t),n.addEventListener(e,t)}function Tn(n,e,t){n.removeEventListener(e,t)}const zV={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},q={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class ky extends wb{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=q.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:c}=this,h=l?l.currentTime:0,d=ve.bufferInfo(u||l,h,o.maxBufferHole),m=!d.len;if(this.log(`Media seeking to ${oe(h)?h.toFixed(3):h}, state: ${c}, ${m?"out of":"in"} buffer`),this.state===q.ENDED)this.resetLoadingState();else if(a){const g=o.maxFragLookUpTolerance,y=a.start-g,v=a.start+a.duration+g;if(m||v<d.start||y>d.end){const E=h>v;(h<y||E)&&(E&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(h>g&&(this.lastCurrentTime=h),!this.loadingParts){const y=Math.max(d.end,h),v=this.shouldLoadParts(this.getLevelDetails(),y);v&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${m?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,m&&(this.startPosition=h)),m&&this.state===q.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new TV(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ry(e.config)}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===q.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=q.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=ve.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ve.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;cn(r,"seeking",this.onMediaSeeking),cn(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===q.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Tn(s,"seeking",this.onMediaSeeking),Tn(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=q.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===q.FRAG_LOADING||!this.fragCurrent&&o===q.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=q.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(_.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Lt.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Lt.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(_.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:o}=r,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&da(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,Ly(a.method)).catch(u=>{throw s.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(u=>{const c=self.performance.now();return s.trigger(_.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==q.STOPPED&&(this.state=q.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(_.ERROR,{type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?zV.toString(ve.getBuffered(r)):"(detached)"})`),Et(e)){var s;if(e.type!==le.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=q.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=q.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new by(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=q.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(_.KEY_LOADED,d),this.state===q.KEY_LOADING&&(this.state=q.IDLE),d}),this.hls.trigger(_.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Et(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(r=Math.max(e.start,r||0),this.loadingParts&&Et(e)){const d=o.partList;if(d&&s){r>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const m=this.getNextPart(d,e,r);if(m>-1){const g=d[m];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${m}/${d.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=q.FRAG_LOADING;let y;return a?y=a.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(v=>this.handleFragLoadError(v)):y=this.doFragPartsLoad(e,g,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(_.FRAG_LOADING,{frag:e,part:g,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}if(Et(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(d=>d.loaded).map(d=>`[${d.start}-${d.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=q.FRAG_LOADING;const c=this.config.progressive&&e.type!==le.SUBTITLE;let h;return c&&a?h=a.then(d=>!d||this.fragContextChanged(d.frag)?null:this.fragmentLoader.load(e,s)).catch(d=>this.handleFragLoadError(d)):h=Promise.all([this.fragmentLoader.load(e,c?s:void 0),a]).then(([d])=>(!c&&s&&s(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(_.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,r,s){return new Promise((i,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=h=>{this.fragmentLoader.loadPart(e,h,s).then(d=>{l[h.index]=d;const m=d.part;this.hls.trigger(_.FRAG_LOADED,d);const g=y_(r.details,e.sn,h.index+1)||Ub(u,e.sn,h.index+1);if(g)c(g);else return i({frag:e,part:m,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===j.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ce.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(_.ERROR,t)}else this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==q.PARSING){!this.fragCurrent&&this.state!==q.STOPPED&&this.state!==q.ERROR&&(this.state=q.IDLE);return}const{frag:r,part:s,level:i}=t,o=self.performance.now();r.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===le.SUBTITLE)return!1;const o=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=a.details,u=o>-1?y_(l,i,o):null,c=u?u.fragment:Fb(l,i,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:a}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==q.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Xn(o,a)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,h={type:e.type,frag:t,part:r,chunkMeta:s,offset:c,parent:t.type,data:l};if(this.hls.trigger(_.BUFFER_APPENDING,h),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ve.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=ve.bufferInfo(t,r,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!oe(s))return null;const o=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,r,s){const i=ve.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,s);return ve.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=le.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,o=r[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=i.initialLiveManifestSize;if(s<h)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const d=this.hls.startPosition,m=this.hls.liveSyncPosition,g=l?(d!==-1&&d>=o?d:m)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${d} liveSyncPosition: ${m} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=o&&(l=r[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const h=l.sn-t.startSN;c=this.filterReplacedPrimary(r[h+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Lt.OK||r===Lt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(a!==null&&r.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(T_(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(T_(this.config)&&e.type!==le.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,s>-1&&r<u.start)break;const c=u.loaded;c?s=-1:(i||(u.independent||o)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${u.start}`),s=a),i=c}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=lV(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];r.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=xb(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=s,c=r.partList,h=!!(this.loadingParts&&c!=null&&c.length&&l);h&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let d;if(e<t){var m;const y=e<this.lastCurrentTime||e>t-u||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:u;d=po(i,o,e,y)}else d=o[o.length-1];if(d){const g=d.sn-r.startSN,y=this.fragmentTracker.getState(d);if((y===Lt.OK||y===Lt.PARTIAL&&d.gap)&&(i=d),i&&d.sn===i.sn&&(!h||c[0].fragment.sn>d.sn||!r.live)&&d.level===i.level){const E=o[g+1];d.sn<a&&this.fragmentTracker.getState(E)!==Lt.OK?d=E:d=null}}return d}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&oe(i);if(o||!a&&!i){HV(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&oe(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Et(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==q.FRAG_LOADING_WAITING_RETRY)&&(this.state=q.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===j.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction;if(!a){this.state=q.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:h}=a,d=!!h,m=d&&l===jt.RetryRequest,g=d&&!a.resolved&&u===Cn.MoveAllAlternatesMatchingHost,y=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!m&&g&&Et(s)&&!s.endList&&y&&!Ab(t))this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((m||g)&&c<h.maxNumRetry){var v;const E=vp((v=t.response)==null?void 0:v.code),p=wy(h,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+p,this.state=q.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,E){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${h.maxNumRetry} in ${p}ms`)}else if(h)if(this.resetFragmentErrors(e),c<h.maxNumRetry)!o&&l!==jt.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===jt.SendAlternateToPenaltyBox?this.state=q.WAITING_LEVEL:this.state=q.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!vp(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=q.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===q.PARSING||this.state===q.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===le.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==q.STOPPED&&(this.state=q.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=ve.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===q.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==q.STOPPED&&(this.state=q.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const h=c.endPTS-c.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${h})`),l||!1;const d=s?0:Nb(i,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(_.LEVEL_PTS_UPDATED,{details:i,level:r,drift:d,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((r.fragmentError===0||l&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=q.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(_.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===le.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function T_(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class jb{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=WV(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function WV(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var xm={exports:{}},S_;function qV(){return S_||(S_=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,h,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var m=new s(c,h||l,d),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],m]:l._events[g].push(m):(l._events[g]=m,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)e.call(c,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,m=h.length,g=new Array(m);d<m;d++)g[d]=h[d].fn;return g},a.prototype.listenerCount=function(u){var c=t?t+u:u,h=this._events[c];return h?h.fn?1:h.length:0},a.prototype.emit=function(u,c,h,d,m,g){var y=t?t+u:u;if(!this._events[y])return!1;var v=this._events[y],E=arguments.length,p,S;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),E){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,h),!0;case 4:return v.fn.call(v.context,c,h,d),!0;case 5:return v.fn.call(v.context,c,h,d,m),!0;case 6:return v.fn.call(v.context,c,h,d,m,g),!0}for(S=1,p=new Array(E-1);S<E;S++)p[S-1]=arguments[S];v.fn.apply(v.context,p)}else{var L=v.length,D;for(S=0;S<L;S++)switch(v[S].once&&this.removeListener(u,v[S].fn,void 0,!0),E){case 1:v[S].fn.call(v[S].context);break;case 2:v[S].fn.call(v[S].context,c);break;case 3:v[S].fn.call(v[S].context,c,h);break;case 4:v[S].fn.call(v[S].context,c,h,d);break;default:if(!p)for(D=1,p=new Array(E-1);D<E;D++)p[D-1]=arguments[D];v[S].fn.apply(v[S].context,p)}}return!0},a.prototype.on=function(u,c,h){return i(this,u,c,h,!1)},a.prototype.once=function(u,c,h){return i(this,u,c,h,!0)},a.prototype.removeListener=function(u,c,h,d){var m=t?t+u:u;if(!this._events[m])return this;if(!c)return o(this,m),this;var g=this._events[m];if(g.fn)g.fn===c&&(!d||g.once)&&(!h||g.context===h)&&o(this,m);else{for(var y=0,v=[],E=g.length;y<E;y++)(g[y].fn!==c||d&&!g[y].once||h&&g[y].context!==h)&&v.push(g[y]);v.length?this._events[m]=v.length===1?v[0]:v:o(this,m)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(xm)),xm.exports}var YV=qV(),Py=T$(YV);const xu="1.6.15",Ca={};function QV(){return typeof __HLS_WORKER_BUNDLE__=="function"}function XV(){const n=Ca[xu];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ca[xu]=s,s}function JV(n){const e=Ca[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ca[n]=s,s}function ZV(n){const e=Ca[n||xu];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Ca[n||xu],s&&self.URL.revokeObjectURL(s),r.terminate()}}function Gb(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Dy(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function cf(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Iu(n,e){const t=e;let r=0;for(;Dy(n,e);){r+=10;const s=cf(n,e+6);r+=s,Gb(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function e3(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const m=new Error(`invalid ADTS sampling index:${o}`);n.emit(_.ERROR,_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_PARSING_ERROR,fatal:!0,error:m,reason:m.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,u="mp4a.40."+a,c=s[o];let h=o;(a===5||a===29)&&(h-=3);const d=[a<<3|(h&14)>>1,(h&1)<<7|l<<3];return Ge.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:d,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function Kb(n,e){return n[e]===255&&(n[e+1]&246)===240}function Hb(n,e){return n[e+1]&1?7:9}function Ny(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function t3(n,e){return e+5<n.length}function Ed(n,e){return e+1<n.length&&Kb(n,e)}function n3(n,e){return t3(n,e)&&Kb(n,e)&&Ny(n,e)<=n.length-e}function r3(n,e){if(Ed(n,e)){const t=Hb(n,e);if(e+t>=n.length)return!1;const r=Ny(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||Ed(n,s)}return!1}function zb(n,e,t,r,s){if(!n.samplerate){const i=e3(e,t,r,s);if(!i)return;ze(n,i)}}function Wb(n){return 1024*9e4/n}function s3(n,e){const t=Hb(n,e);if(e+t<=n.length){const r=Ny(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function qb(n,e,t,r,s){const i=Wb(n.samplerate),o=r+s*i,a=s3(e,t);let l;if(a){const{frameLength:h,headerLength:d}=a,m=d+h,g=Math.max(0,t+m-e.length);g?(l=new Uint8Array(m-d),l.set(e.subarray(t+d,e.length),0)):l=e.subarray(t+d,t+m);const y={unit:l,pts:o};return g||n.samples.push(y),{sample:y,length:m,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function i3(n,e){return Dy(n,e)&&cf(n,e+6)+10<=n.length-e}function o3(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Im(n,e=0,t=1/0){return a3(n,e,t,Uint8Array)}function a3(n,e,t,r){const s=l3(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const o=u3(n)?n.byteOffset:0,a=(o+n.byteLength)/i,l=(o+e)/i,u=Math.floor(Math.max(0,Math.min(l,a))),c=Math.floor(Math.min(u+Math.max(t,0),a));return new r(s,u,c-u)}function l3(n){return n instanceof ArrayBuffer?n:n.buffer}function u3(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function c3(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Mn(Im(n.data,1,r)),i=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const a=Mn(Im(n.data,3+r,o));let l;return s==="-->"?l=Mn(Im(n.data,4+r+o)):l=o3(n.data.subarray(4+r+o)),e.mimeType=s,e.pictureType=i,e.description=a,e.data=l,e}function h3(n){if(n.size<2)return;const e=Mn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function d3(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Mn(n.data.subarray(t),!0);t+=r.length+1;const s=Mn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Mn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function f3(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Mn(n.data.subarray(t),!0);t+=r.length+1;const s=Mn(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Mn(n.data);return{key:n.type,info:"",data:e}}function m3(n){return n.type==="PRIV"?h3(n):n.type[0]==="W"?f3(n):n.type==="APIC"?c3(n):d3(n)}function g3(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=cf(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const bc=10,p3=10;function Yb(n){let e=0;const t=[];for(;Dy(n,e);){const r=cf(n,e+6);n[e+5]>>6&1&&(e+=bc),e+=bc;const s=e+r;for(;e+p3<s;){const i=g3(n.subarray(e)),o=m3(i);o&&t.push(o),e+=i.size+bc}Gb(n,e)&&(e+=bc)}return t}function Qb(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function y3(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Oy(n){const e=Yb(n);for(let t=0;t<e.length;t++){const r=e[t];if(Qb(r))return y3(r)}}let Dn=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function kr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class My{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Xn(this.cachedData,e),this.cachedData=null);let r=Iu(e,0),s=r?r.length:0,i;const o=this._audioTrack,a=this._id3Track,l=r?Oy(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&oe(l))&&(this.basePTS=v3(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Dn.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(o,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,i=s):s=u}else i3(e,s)?(r=Iu(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Dn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===u&&i!==u){const c=e.slice(i);this.cachedData?this.cachedData=Xn(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:kr(),id3Track:a,textTrack:kr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:kr(),id3Track:this._id3Track,textTrack:kr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const v3=(n,e,t)=>{if(oe(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Lc=null;const E3=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],T3=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],S3=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_3=[0,1,1,4];function Xb(n,e,t,r,s){if(t+24>e.length)return;const i=Jb(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=r+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function Jb(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=E3[l*14+s-1]*1e3,h=T3[(t===3?0:t===2?1:2)*3+i],d=a===3?1:2,m=S3[t][r],g=_3[r],y=m*8*g,v=Math.floor(m*u/h+o)*g;if(Lc===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Lc=S?parseInt(S[1]):0}return!!Lc&&Lc<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:h,channelCount:d,frameLength:v,samplesPerFrame:y}}}function Fy(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Zb(n,e){return e+1<n.length&&Fy(n,e)}function x3(n,e){return Fy(n,e)&&4<=n.length-e}function eL(n,e){if(e+1<n.length&&Fy(n,e)){const r=Jb(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||Zb(n,i)}return!1}class I3 extends My{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Iu(e,0);let s=(r==null?void 0:r.length)||0;if(eL(e,s))return!1;for(let i=e.length;s<i;s++)if(r3(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return n3(e,t)}appendFrame(e,t,r){zb(e,this.observer,t,r,e.manifestCodec);const s=qb(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const tL=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,r-=a}return t};class A3 extends My{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=nL(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Iu(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Oy(t)!==void 0&&tL(e,r)<16}}function nL(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const h=e[t+6]>>5;let d=0;h===2?d+=2:(h&1&&h!==1&&(d+=2),h&4&&(d+=2));const m=(e[t+6]<<8|e[t+7])>>12-d&1,y=[2,1,2,3,3,4,4,5][h]+m,v=e[t+5]>>3,E=e[t+5]&7,p=new Uint8Array([i<<6|v<<1|E>>2,(E&3)<<6|h<<3|m<<2|l>>4,l<<4&224]),S=1536/a*9e4,L=r+s*S,D=e.subarray(t,t+c);return n.config=p,n.channelCount=y,n.samplerate=a,n.samples.push({unit:D,pts:L}),c}class w3 extends My{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Iu(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Oy(t)!==void 0&&tL(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(eL(e,r))return Ge.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return x3(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Xb(e,t,r,this.basePTS,this.frameIndex)}}const R3=/\/emsg[-/]ID3/i;class b3{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=kr("video",1),o=this.audioTrack=kr("audio",1),a=this.txtTrack=kr("text",1);if(this.id3Track=kr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=db(e);if(l.video){const{id:u,timescale:c,codec:h,supplemental:d}=l.video;i.id=u,i.timescale=a.timescale=c,i.codec=h,i.supplemental=d}if(l.audio){const{id:u,timescale:c,codec:h}=l.audio;o.id=u,o.timescale=c,o.codec=h}a.id=ub.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return A$(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Xn(this.remainderData,e));const a=P$(r);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=r;const o=this.extractID3Track(s,t);return i.samples=BS(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=BS(e,t),{videoTrack:t,audioTrack:kr(),id3Track:s,textTrack:kr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Ie(e.samples,["emsg"]);s&&s.forEach(i=>{const o=N$(i);if(R3.test(o.schemeIdUri)){const a=__(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Dn.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=__(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Dn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function __(n,e){return oe(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class L3{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Ry(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ai.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const o=gb(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const o=i[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,s,o),!this.decrypter.isSync()))return}}}}class rL{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,u,c,h,d=-1,m=0;for(i===-1&&(d=0,m=this.getNALuType(t,0),i=0,l=1);l<s;){if(u=t[l++],!i){i=u?0:1;continue}if(i===1){i=u?0:2;continue}if(!u)i=3;else if(u===1){if(c=l-i-1,d>=0){const g={data:t.subarray(d,c),type:m};a.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(o&&l<=4-o&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-o)),c>0&&(g.data=Xn(g.data,t.subarray(0,c)),g.state=0))}l<s?(h=this.getNALuType(t,l),d=l,m=h,i=0):i=-1}else i=0}if(d>=0&&i>=0){const g={data:t.subarray(d,s),type:m,state:i};a.push(g)}if(a.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Xn(g.data,t))}return e.naluState=i,a}}class Gl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Ge.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class C3 extends rL{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,h;switch(u.type){case 1:{let y=!1;a=!0;const v=u.data;if(l&&v.length>4){const E=this.readSliceType(v);(E===2||E===4||E===7||E===9)&&(y=!0)}if(y){var d;(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=y;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,xy(u.data,1,r.pts,t.samples);break}case 7:{var m,g;a=!0,l=!0;const y=u.data,v=this.readSPS(y);if(!e.sps||e.width!==v.width||e.height!==v.height||((m=e.pixelRatio)==null?void 0:m[0])!==v.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[y];const E=y.subarray(1,4);let p="avc1.";for(let S=0;S<3;S++){let L=E[S].toString(16);L.length<2&&(L="0"+L),p+=L}e.codec=p}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Gl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new Gl(e);let r=0,s=0,i=0,o=0,a,l,u;const c=t.readUByte.bind(t),h=t.readBits.bind(t),d=t.readUEG.bind(t),m=t.readBoolean.bind(t),g=t.skipBits.bind(t),y=t.skipEG.bind(t),v=t.skipUEG.bind(t),E=this.skipScalingList.bind(this);c();const p=c();if(h(5),g(3),c(),v(),p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128){const x=d();if(x===3&&g(1),v(),v(),g(1),m())for(l=x!==3?8:12,u=0;u<l;u++)m()&&(u<6?E(16,t):E(64,t))}v();const S=d();if(S===0)d();else if(S===1)for(g(1),y(),y(),a=d(),u=0;u<a;u++)y();v(),g(1);const L=d(),D=d(),F=h(1);F===0&&g(1),g(1),m()&&(r=d(),s=d(),i=d(),o=d());let A=[1,1];if(m()&&m())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((L+1)*16-r*2-s*2),height:(2-F)*(D+1)*16-(F?2:4)*(i+o),pixelRatio:A}}}class k3 extends rL{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let o=this.VideoSample,a,l=!1;r.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,h;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var d;(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,xy(u.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ze(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const m=this.readSPS(u.data);e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.codec=m.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in m.params)e.params[g]=m.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const m=this.readPPS(u.data);for(const g in m)e.params[g]=m[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Gl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new Gl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),m=t.readUByte(),g=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),p=[],S=[];for(let Ee=0;Ee<r;Ee++)p.push(t.readBoolean()),S.push(t.readBoolean());if(r>0)for(let Ee=r;Ee<8;Ee++)t.readBits(2);for(let Ee=0;Ee<r;Ee++)p[Ee]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),S[Ee]&&t.readUByte();t.readUEG();const L=t.readUEG();L==3&&t.skipBits(1);const D=t.readUEG(),F=t.readUEG(),A=t.readBoolean();let x=0,R=0,b=0,C=0;A&&(x+=t.readUEG(),R+=t.readUEG(),b+=t.readUEG(),C+=t.readUEG());const M=t.readUEG(),k=t.readUEG(),re=t.readUEG(),te=t.readBoolean();for(let Ee=te?0:r;Ee<=r;Ee++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let we=0;we<4;we++)for(let Tt=0;Tt<(we===3?2:6);Tt++)if(!t.readBoolean())t.readUEG();else{const $e=Math.min(64,1<<4+(we<<1));we>1&&t.readEG();for(let an=0;an<$e;an++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const U=t.readUEG();let H=0;for(let Ee=0;Ee<U;Ee++){let we=!1;if(Ee!==0&&(we=t.readBoolean()),we){Ee===U&&t.readUEG(),t.readBoolean(),t.readUEG();let Tt=0;for(let Ne=0;Ne<=H;Ne++){const $e=t.readBoolean();let an=!1;$e||(an=t.readBoolean()),($e||an)&&Tt++}H=Tt}else{const Tt=t.readUEG(),Ne=t.readUEG();H=Tt+Ne;for(let $e=0;$e<Tt;$e++)t.readUEG(),t.readBoolean();for(let $e=0;$e<Ne;$e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ee=t.readUEG();for(let we=0;we<Ee;we++){for(let Tt=0;Tt<re+4;Tt++)t.readBits(1);t.readBits(1)}}let B=0,O=1,K=1,Q=!0,Y=1,ee=0;t.readBoolean(),t.readBoolean();let de=!1;if(t.readBoolean()){if(t.readBoolean()){const Zn=t.readUByte(),St=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],er=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Zn>0&&Zn<16?(O=St[Zn-1],K=er[Zn-1]):Zn===255&&(O=t.readBits(16),K=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),de=t.readBoolean(),de&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Y=t.readBits(32),ee=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const er=t.readBoolean(),pr=t.readBoolean();let Rn=!1;(er||pr)&&(Rn=t.readBoolean(),Rn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Rn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Qr=0;Qr<=r;Qr++){Q=t.readBoolean();const yr=Q||t.readBoolean();let Ci=!1;yr?t.readEG():Ci=t.readBoolean();const Xr=Ci?1:t.readUEG()+1;if(er)for(let Vn=0;Vn<Xr;Vn++)t.readUEG(),t.readUEG(),Rn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(pr)for(let Vn=0;Vn<Xr;Vn++)t.readUEG(),t.readUEG(),Rn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),B=t.readUEG())}let _e=D,st=F;if(A){let Ee=1,we=1;L===1?Ee=we=2:L==2&&(Ee=2),_e=D-Ee*R-Ee*x,st=F-we*C-we*b}const Fe=s?["A","B","C"][s]:"",on=a<<24|l<<16|u<<8|c;let An=0;for(let Ee=0;Ee<32;Ee++)An=(An|(on>>Ee&1)<<31-Ee)>>>0;let wn=An.toString(16);return o===1&&wn==="2"&&(wn="6"),{codecString:`hvc1.${Fe}${o}.${wn}.${i?"H":"L"}${E}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[a,l,u,c],general_constraint_indicator_flags:[h,d,m,g,y,v],general_level_idc:E,bit_depth:M+8,bit_depth_luma_minus8:M,bit_depth_chroma_minus8:k,min_spatial_segmentation_idc:B,chroma_format_idc:L,frame_rate:{fixed:Q,fps:ee/Y}},width:_e,height:st,pixelRatio:[O,K]}}readPPS(e){const t=new Gl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ot=188;class Gs{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=Gs.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ot*5,t-Ot)+1,s=0;for(;s<r;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=Ot)if(e[l]===71&&(t-l===Ot||e[l+Ot]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+Ot*99,e.length-Ot)+1)),i||(i=xp(e,l)===0),i&&a>1&&(o===0&&a>2||l+Ot>r))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:ub[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Gs.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Gs.createTrack("audio",s),this._id3Track=Gs.createTrack("id3"),this._txtTrack=Gs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,h=o.pesData,d=a.pid,m=l.pid,g=a.pesData,y=l.pesData,v=null,E=this.pmtParsed,p=this._pmtId,S=e.length;if(this.remainderData&&(e=Xn(this.remainderData,e),S=e.length,this.remainderData=null),S<Ot&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const L=Math.max(0,Gs.syncOffset(e));S-=(S-L)%Ot,S<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));let D=0;for(let A=L;A<S;A+=Ot)if(e[A]===71){const x=!!(e[A+1]&64),R=xp(e,A),b=(e[A+3]&48)>>4;let C;if(b>1){if(C=A+5+e[A+4],C===A+Ot)continue}else C=A+4;switch(R){case c:x&&(h&&(i=Po(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,i,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(C,A+Ot)),h.size+=A+Ot-C);break;case d:if(x){if(g&&(i=Po(g,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(C,A+Ot)),g.size+=A+Ot-C);break;case m:x&&(y&&(i=Po(y,this.logger))&&this.parseID3PES(l,i),y={data:[],size:0}),y&&(y.data.push(e.subarray(C,A+Ot)),y.size+=A+Ot-C);break;case 0:x&&(C+=e[C]+1),p=this._pmtId=P3(e,C);break;case p:{x&&(C+=e[C]+1);const M=D3(e,C,this.typeSupported,r,this.observer,this.logger);c=M.videoPid,c>0&&(o.pid=c,o.segmentCodec=M.segmentVideoCodec),d=M.audioPid,d>0&&(a.pid=d,a.segmentCodec=M.segmentAudioCodec),m=M.id3Pid,m>0&&(l.pid=m),v!==null&&!E&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${v}'. Backtracking to sync byte @${L} to parse all TS packets.`),v=null,A=L-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=R;break}}else D++;D>0&&Ip(this.observer,new Error(`Found ${D} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,a.pesData=g,l.pesData=y;const F={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(F),F}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,o=r.pesData,a=t.pesData,l=s.pesData;let u;if(o&&(u=Po(o,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,u,!0),r.pesData=null)):r.pesData=o,a&&(u=Po(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=Po(l,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new L3(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new C3:e==="hevc"&&(this.videoParser=new k3))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const h=s.missing,d=s.sample.unit.byteLength;if(h===-1)i=Xn(s.sample.unit,i);else{const m=d-h;s.sample.unit.set(i.subarray(0,h),m),e.samples.push(s.sample),r=s.missing}}let o,a;for(o=r,a=i.length;o<a-1&&!Ed(i,o);o++);if(o!==r){let h;const d=o<a-1;if(d?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",Ip(this.observer,new Error(h),d,this.logger),!d)return}zb(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const h=Wb(e.samplerate);l=s.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=qb(e,i,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!Ed(i,o);o++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Zb(r,o)){const l=Xb(e,r,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let o=0,a=0,l;for(;a<i&&(l=nL(e,r,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=ze({},t,{type:this._videoTrack?Dn.emsg:Dn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function xp(n,e){return((n[e+1]&31)<<8)+n[e+2]}function P3(n,e){return(n[e+10]&31)<<8|n[e+11]}function D3(n,e,t,r,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=xp(n,e),h=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Am("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!r){Am("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!r){Am("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let d=e+5,m=h;for(;m>2;){switch(n[d]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const y=n[d+1]+2;d+=y,m-=y}}break;case 194:case 135:return Ip(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=h+5}return o}function Ip(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(_.ERROR,_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Am(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Po(n,e){let t=0,r,s,i,o,a;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Xn(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const c=r[7];c&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=r[8];let h=i+9;if(n.size<=h)return null;n.size-=h;const d=new Uint8Array(n.size);for(let m=0,g=l.length;m<g;m++){r=l[m];let y=r.byteLength;if(h)if(h>y){h-=y;continue}else r=r.subarray(h),y-=h,h=0;d.set(r,t),t+=y}return s&&(s-=i+3),{data:d,pts:o,dts:a,len:s}}return null}class N3{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Us=Math.pow(2,32)-1;class V{static init(){V.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in V.types)V.types.hasOwnProperty(e)&&(V.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);V.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);V.STTS=V.STSC=V.STCO=i,V.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),V.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),V.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),V.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);V.FTYP=V.box(V.types.ftyp,o,l,o,a),V.DINF=V.box(V.types.dinf,V.box(V.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),s=0,r=8;s<i;s++)o.set(t[s],r),r+=t[s].byteLength;return o}static hdlr(e){return V.box(V.types.hdlr,V.HDLR_TYPES[e])}static mdat(e){return V.box(V.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Us+1)),s=Math.floor(t%(Us+1));return V.box(V.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return V.box(V.types.mdia,V.mdhd(e.timescale||0,e.duration||0),V.hdlr(e.type),V.minf(e))}static mfhd(e){return V.box(V.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?V.box(V.types.minf,V.box(V.types.smhd,V.SMHD),V.DINF,V.stbl(e)):V.box(V.types.minf,V.box(V.types.vmhd,V.VMHD),V.DINF,V.stbl(e))}static moof(e,t,r){return V.box(V.types.moof,V.mfhd(e),V.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=V.trak(e[t]);return V.box.apply(null,[V.types.moov,V.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(V.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=V.trex(e[t]);return V.box.apply(null,[V.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Us+1)),s=Math.floor(t%(Us+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return V.box(V.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return V.box(V.types.sdtp,r)}static stbl(e){return V.box(V.types.stbl,V.stsd(e),V.box(V.types.stts,V.STTS),V.box(V.types.stsc,V.STSC),V.box(V.types.stsz,V.STSZ),V.box(V.types.stco,V.STCO))}static avc1(e){let t=[],r=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(i));const a=V.box(V.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return V.box(V.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return V.box(V.types.mp4a,V.audioStsd(e),V.box(V.types.esds,V.esds(e)))}static mp3(e){return V.box(V.types[".mp3"],V.audioStsd(e))}static ac3(e){return V.box(V.types["ac-3"],V.audioStsd(e),V.box(V.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return V.box(V.types.stsd,V.STSD,V.mp4a(e));if(t==="ac3"&&e.config)return V.box(V.types.stsd,V.STSD,V.ac3(e));if(t==="mp3"&&e.codec==="mp3")return V.box(V.types.stsd,V.STSD,V.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return V.box(V.types.stsd,V.STSD,V.avc1(e));if(t==="hevc"&&e.vps)return V.box(V.types.stsd,V.STSD,V.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(r/(Us+1)),a=Math.floor(r%(Us+1));return V.box(V.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=V.sdtp(e),s=e.id,i=Math.floor(t/(Us+1)),o=Math.floor(t%(Us+1));return V.box(V.types.traf,V.box(V.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),V.box(V.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),V.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,V.box(V.types.trak,V.tkhd(e),V.mdia(e))}static trex(e){const t=e.id;return V.box(V.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,o=new Uint8Array(i);let a,l,u,c,h,d;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=r[a],u=l.duration,c=l.size,h=l.flags,d=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*a);return V.box(V.types.trun,o)}static initSegment(e){V.types||V.init();const t=V.moov(e);return Xn(V.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=i.length;for(let g=0;g<r.length;g+=1){o+=3;for(let y=0;y<r[g].length;y+=1)o+=2+r[g][y].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=r.length-1;for(let g=0;g<r.length;g+=1){a.set(new Uint8Array([32+g|(g===l?128:0),0,r[g].length]),o),o+=3;for(let y=0;y<r[g].length;y+=1)a.set(new Uint8Array([r[g][y].length>>8,r[g][y].length&255]),o),o+=2,a.set(r[g][y],o),o+=r[g][y].length}const u=V.box(V.types.hvcC,a),c=e.width,h=e.height,d=e.pixelRatio[0],m=e.pixelRatio[1];return V.box(V.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,m>>24,m>>16&255,m>>8&255,m&255])))}}V.types=void 0;V.HDLR_TYPES=void 0;V.STTS=void 0;V.STSC=void 0;V.STCO=void 0;V.STSZ=void 0;V.VMHD=void 0;V.SMHD=void 0;V.STSD=void 0;V.FTYP=void 0;V.DINF=void 0;const sL=9e4;function Uy(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function O3(n,e,t=1,r=!1){return Uy(n,e,1/t,r)}function dl(n,e=!1){return Uy(n,1e3,1/sL,e)}function M3(n,e=1){return Uy(n,sL,1/e)}function x_(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const F3=10*1e3,U3=1024,B3=1152,$3=1536;let Do=null,wm=null;function I_(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class ch extends Jn{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Do===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Do=o?parseInt(o[1]):0}if(wm===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);wm=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&x_(t)} > ${e&&x_(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=kn(a,r),l=a-i),l>0?i:a},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,o,a,l){let u,c,h,d,m,g,y=i,v=i;const E=e.pid>-1,p=t.pid>-1,S=t.samples.length,L=e.samples.length>0,D=a&&S>0||S>1;if((!E||L)&&(!p||D)||this.ISGenerated||a){if(this.ISGenerated){var A,x,R,b;const re=this.videoTrackConfig;(re&&(t.width!==re.width||t.height!==re.height||((A=t.pixelRatio)==null?void 0:A[0])!==((x=re.pixelRatio)==null?void 0:x[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((b=re.pixelRatio)==null?void 0:b[1]))||!re&&D||this.nextAudioTs===null&&L)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,i,o));const C=this.isVideoContiguous;let M=-1,k;if(D&&(M=V3(t.samples),!C&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,M>0){this.warn(`Dropped ${M} out of ${S} video samples due to a missing keyframe`);const re=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(M),t.dropped+=M,v+=(t.samples[0].pts-re)/t.inputTimeScale,k=v}else M===-1&&(this.warn(`No keyframe found out of ${S} video samples`),g=!1);if(this.ISGenerated){if(L&&D){const re=this.getVideoStartPts(t.samples),J=(kn(e.samples[0].pts,re)-re)/t.inputTimeScale;y+=Math.max(0,J),v+=Math.max(0,-J)}if(L){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i,o)),c=this.remuxAudio(e,y,this.isAudioContiguous,o,p||D||l===le.AUDIO?v:void 0),D){const re=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,i,o)),u=this.remuxVideo(t,v,C,re)}}else D&&(u=this.remuxVideo(t,v,C,0));u&&(u.firstKeyFrame=M,u.independent=M!==-1,u.firstKeyFramePTS=k)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(m=iL(r,i,this._initPTS,this._initDTS)),s.samples.length&&(d=oL(s,i,this._initPTS))),{audio:c,video:u,initSegment:h,independent:g,text:d,id3:m}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let o=kn(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,r,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||s,h="audio/mp4",d,m,g,y=-1;if(c&&(d=m=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(h="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):V.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(y=e.id,g=e.inputTimeScale,!u||g!==u.timescale?d=m=this.computeInitPts(i[0].pts,g,r,"audio"):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:V.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(y=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const v=this.getVideoStartPts(o),E=kn(o[0].dts,v),p=this.computeInitPts(E,g,r,"video"),S=this.computeInitPts(v,g,r,"video");m=Math.min(m,p),d=Math.min(d,S)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${d/g} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${d/g} (${d}/${g}) trackId: ${y}`),this._initPTS={baseTime:d,timescale:g,trackId:y},this._initDTS={baseTime:m,timescale:g,trackId:y}):d=g=void 0,{tracks:l,initPTS:d,timescale:g,trackId:y}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,c=u.baseTime*i/u.timescale;let h=this.nextVideoTs,d=8,m=this.videoSampleDuration,g,y,v=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,p=!1;if(!r||h===null){const B=c+t*i,O=o[0].pts-kn(o[0].dts,o[0].pts);Do&&h!==null&&Math.abs(B-O-(h+c))<15e3?r=!0:h=B-O-c}const S=h+c;for(let B=0;B<l;B++){const O=o[B];O.pts=kn(O.pts,S),O.dts=kn(O.dts,S),O.dts<o[B>0?B-1:B].dts&&(p=!0)}p&&o.sort(function(B,O){const K=B.dts-O.dts,Q=B.pts-O.pts;return K||Q}),g=o[0].dts,y=o[o.length-1].dts;const L=y-g,D=L?Math.round(L/(l-1)):m||e.inputTimeScale/30;if(r){const B=g-S,O=B>D,K=B<-1;if((O||K)&&(O?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(B,!0)} ms (${B}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(-B,!0)} ms (${B}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!K||S>=o[0].pts||Do)){g=S;const Q=o[0].pts-B;if(O)o[0].dts=g,o[0].pts=Q;else{let Y=!0;for(let ee=0;ee<o.length&&!(o[ee].dts>Q&&Y);ee++){const de=o[ee].pts;if(o[ee].dts-=B,o[ee].pts-=B,ee<o.length-1){const Ae=o[ee+1].pts,_e=o[ee].pts,st=Ae<=_e,Fe=Ae<=de;Y=st==Fe}}}this.log(`Video: Initial PTS/DTS adjusted: ${dl(Q,!0)}/${dl(g,!0)}, delta: ${dl(B,!0)} ms`)}}g=Math.max(0,g);let F=0,A=0,x=g;for(let B=0;B<l;B++){const O=o[B],K=O.units,Q=K.length;let Y=0;for(let ee=0;ee<Q;ee++)Y+=K[ee].data.length;A+=Y,F+=Q,O.length=Y,O.dts<x?(O.dts=x,x+=D/4|0||1):x=O.dts,v=Math.min(O.pts,v),E=Math.max(O.pts,E)}y=o[l-1].dts;const R=A+4*F+8;let b;try{b=new Uint8Array(R)}catch(B){this.observer.emit(_.ERROR,_.ERROR,{type:ce.MUX_ERROR,details:j.REMUX_ALLOC_ERROR,fatal:!1,error:B,bytes:R,reason:`fail allocating video mdat ${R}`});return}const C=new DataView(b.buffer);C.setUint32(0,R),b.set(V.types.mdat,4);let M=!1,k=Number.POSITIVE_INFINITY,re=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let B=0;B<l;B++){const O=o[B],K=O.units;let Q=0;for(let de=0,Ae=K.length;de<Ae;de++){const _e=K[de],st=_e.data,Fe=_e.data.byteLength;C.setUint32(d,Fe),d+=4,b.set(st,d),d+=Fe,Q+=4+Fe}let Y;if(B<l-1)m=o[B+1].dts-O.dts,Y=o[B+1].pts-O.pts;else{const de=this.config,Ae=B>0?O.dts-o[B-1].dts:D;if(Y=B>0?O.pts-o[B-1].pts:D,de.stretchShortVideoTrack&&this.nextAudioTs!==null){const _e=Math.floor(de.maxBufferHole*i),st=(s?v+s*i:this.nextAudioTs+c)-O.pts;st>_e?(m=st-Ae,m<0?m=Ae:M=!0,this.log(`It is approximately ${st/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=Ae}else m=Ae}const ee=Math.round(O.pts-O.dts);k=Math.min(k,m),te=Math.max(te,m),re=Math.min(re,Y),J=Math.max(J,Y),a.push(I_(O.key,m,Q,ee))}if(a.length){if(Do){if(Do<70){const B=a[0].flags;B.dependsOn=2,B.isNonSync=0}}else if(wm&&J-re<te-k&&D/te<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let B=g;for(let O=0,K=a.length;O<K;O++){const Q=B+a[O].duration,Y=B+a[O].cts;if(O<K-1){const ee=Q+a[O+1].cts;a[O].duration=ee-Y}else a[O].duration=O?a[O-1].duration:D;a[O].cts=0,B=Q}}}m=M||!m?D:m;const W=y+m;this.nextVideoTs=h=W-c,this.videoSampleDuration=m,this.isVideoContiguous=!0;const N={data1:V.moof(e.sequenceNumber++,g,ze(e,{samples:a})),data2:b,startPTS:(v-c)/i,endPTS:(E+m-c)/i,startDTS:(g-c)/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,N}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return B3;case"ac3":return $3;default:return U3}}remuxAudio(e,t,r,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,h=this._initPTS,d=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],g=i!==void 0;let y=e.samples,v=d?0:8,E=this.nextAudioTs||-1;const p=h.baseTime*o/h.timescale,S=p+t*o;if(this.isAudioContiguous=r=r||y.length&&E>0&&(s&&Math.abs(S-(E+p))<9e3||Math.abs(kn(y[0].pts,S)-(E+p))<20*c),y.forEach(function(J){J.pts=kn(J.pts,S)}),!r||E<0){const J=y.length;if(y=y.filter(W=>W.pts>=0),J!==y.length&&this.warn(`Removed ${y.length-J} of ${J} samples (initPTS ${p} / ${o})`),!y.length)return;i===0?E=0:s&&!g?E=Math.max(0,S-p):E=y[0].pts-p}if(e.segmentCodec==="aac"){const J=this.config.maxAudioFramesDrift;for(let W=0,U=E+p;W<y.length;W++){const H=y[W],N=H.pts,B=N-U,O=Math.abs(1e3*B/o);if(B<=-J*c&&g)W===0&&(this.warn(`Audio frame @ ${(N/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*B/o)} ms.`),this.nextAudioTs=E=N-p,U=N);else if(B>=J*c&&O<F3&&g){let K=Math.round(B/c);for(U=N-K*c;U<0&&K&&c;)K--,U+=c;W===0&&(this.nextAudioTs=E=U-p),this.warn(`Injecting ${K} audio frames @ ${((U-p)/o).toFixed(3)}s due to ${Math.round(1e3*B/o)} ms gap.`);for(let Q=0;Q<K;Q++){let Y=N3.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Y||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Y=H.unit.subarray()),y.splice(W,0,{unit:Y,pts:U}),U+=c,W++}}H.pts=U,U+=c}}let L=null,D=null,F,A=0,x=y.length;for(;x--;)A+=y[x].unit.byteLength;for(let J=0,W=y.length;J<W;J++){const U=y[J],H=U.unit;let N=U.pts;if(D!==null){const O=m[J-1];O.duration=Math.round((N-D)/l)}else if(r&&e.segmentCodec==="aac"&&(N=E+p),L=N,A>0){A+=v;try{F=new Uint8Array(A)}catch(O){this.observer.emit(_.ERROR,_.ERROR,{type:ce.MUX_ERROR,details:j.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:A,reason:`fail allocating audio mdat ${A}`});return}d||(new DataView(F.buffer).setUint32(0,A),F.set(V.types.mdat,4))}else return;F.set(H,v);const B=H.byteLength;v+=B,m.push(I_(!0,u,B,0)),D=N}const R=m.length;if(!R)return;const b=m[m.length-1];E=D-p,this.nextAudioTs=E+l*b.duration;const C=d?new Uint8Array(0):V.moof(e.sequenceNumber++,L/l,ze({},e,{samples:m}));e.samples=[];const M=(L-p)/o,k=this.nextAudioTs/o,te={data1:C,data2:F,startPTS:M,endPTS:k,startDTS:M,endDTS:k,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,te}}function kn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function V3(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function iL(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let a=0;a<s;a++){const l=n.samples[a];l.pts=kn(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=kn(l.dts-r.baseTime*i/r.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function oL(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=kn(a.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class j3 extends Jn{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=db(e);if(t)L$(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(r=A_(i,qe.AUDIO,this)),o&&(s=A_(o,qe.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,r,s,i,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const h={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};oe(c)||(c=this.lastEndTime=i||0);const d=t.samples;if(!d.length)return h;const m={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((a=g)!=null&&a.length||(this.generateInitSegment(d),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const y=k$(d,g,this),v=g.audio?y[g.audio.id]:null,E=g.video?y[g.video.id]:null,p=Cc(E,1/0),S=Cc(v,1/0),L=Cc(E,0,!0),D=Cc(v,0,!0);let F=i,A=0;const x=v&&(!E||!u&&S<p||u&&u.trackId===g.audio.id),R=x?v:E;if(R){const U=R.timescale,H=R.start-i*U,N=x?g.audio.id:g.video.id;F=R.start/U,A=x?D-S:L-p,(o||!u)&&(G3(u,F,i,A)||U!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${H/U} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${F-i} (${H}/${U}) trackId: ${N}`),u=null,m.initPTS=H,m.timescale=U,m.trackId=N)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);u?(m.initPTS=u.baseTime,m.timescale=u.timescale,m.trackId=u.trackId):((!m.timescale||m.trackId===void 0||m.initPTS===void 0)&&(this.warn("Could not set initPTS"),m.initPTS=F,m.timescale=1,m.trackId=-1),this.initPTS=u={baseTime:m.initPTS,timescale:m.timescale,trackId:m.trackId});const b=F-u.baseTime/u.timescale,C=b+A;A>0?this.lastEndTime=C:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!g.audio,k=!!g.video;let re="";M&&(re+="audio"),k&&(re+="video");const te=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),J={data1:d,startPTS:b,startDTS:b,endPTS:C,endDTS:C,type:re,hasAudio:M,hasVideo:k,nb:1,dropped:0,encrypted:te};h.audio=M&&!k?J:void 0,h.video=k?J:void 0;const W=E==null?void 0:E.sampleCount;if(W){const U=E.keyFrameIndex,H=U!==-1;J.nb=W,J.dropped=U===0||this.isVideoContiguous?0:H?U:W,J.independent=H,J.firstKeyFrame=U,H&&E.keyFrameStart&&(J.firstKeyFramePTS=(E.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(h.independent=H),this.isVideoContiguous||(this.isVideoContiguous=H),J.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${U}/${W} dropped: ${J.dropped} start: ${J.firstKeyFramePTS||"NA"}`)}return h.initSegment=m,h.id3=iL(r,i,u,u),s.samples.length&&(h.text=oL(s,i,u)),h}}function Cc(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function G3(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function A_(n,e,t){const r=n.codec;return r&&r.length>4?r:e===qe.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?hd(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let ss;try{ss=self.performance.now.bind(self.performance)}catch{ss=Date.now}const hh=[{demux:b3,remux:j3},{demux:Gs,remux:ch},{demux:I3,remux:ch},{demux:w3,remux:ch}];hh.splice(2,0,{demux:A3,remux:ch});class w_{constructor(e,t,r,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=ss();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:h,accurateTimeOffset:d,timeOffset:m,initSegmentChange:g}=s||a,{audioCodec:y,videoCodec:v,defaultInitPts:E,duration:p,initSegmentData:S}=l,L=K3(o,t);if(L&&da(L.method)){const x=this.getDecrypter(),R=Ly(L.method);if(x.isSync()){let b=x.softwareDecrypt(o,L.key.buffer,L.iv.buffer,R);if(r.part>-1){const M=x.flush();b=M&&M.buffer}if(!b)return i.executeEnd=ss(),Rm(r);o=new Uint8Array(b)}else return this.asyncResult=!0,this.decryptionPromise=x.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer,R).then(b=>{const C=this.push(b,null,r);return this.decryptionPromise=null,C}),this.decryptionPromise}const D=this.needsProbing(c,h);if(D){const x=this.configureTransmuxer(o);if(x)return this.logger.warn(`[transmuxer] ${x.message}`),this.observer.emit(_.ERROR,_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message}),i.executeEnd=ss(),Rm(r)}(c||h||g||D)&&this.resetInitSegment(S,y,v,p,t),(c||g||D)&&this.resetInitialTimestamp(E),u||this.resetContiguity();const F=this.transmux(o,L,m,d,r);this.asyncResult=Au(F);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,i.executeEnd=ss(),F}flush(e){const t=e.transmuxing;t.executeStart=ss();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(r){const h=r.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=ss();const h=[Rm(e)];return this.asyncResult?Promise.resolve(h):h}const c=l.flush(a);return Au(c)?(this.asyncResult=!0,c.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===le.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(s,i,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=ss()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,s,i):o=this.transmuxUnencrypted(e,r,s,i),o}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let h=0,d=hh.length;h<d;h++){var o;if((o=hh[h].demux)!=null&&o.probe(e,this.logger)){i=hh[h];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=i.remux,c=i.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,s,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(r,t,s,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ry(this.config)),e}}function K3(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Rm=n=>({remuxResult:{},chunkMeta:n});function Au(n){return"then"in n&&n.then instanceof Function}class H3{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class z3{constructor(e,t,r,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let R_=0;class aL{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=R_++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var h;const d=(h=this.workerContext)==null?void 0:h.objectURL;d&&self.URL.revokeObjectURL(d);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===_.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Py,this.observer.on(_.FRAG_DECRYPTED,o),this.observer.on(_.ERROR,o);const a=jS(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||QV()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=JV(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=XV());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Ye(i)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new w_(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new w_(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=R_++;const t=this.hls.config,r=jS(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Ye(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),ZV(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,o,a,l,u,c){var h,d;u.transmuxing.start=self.performance.now();const{instanceNo:m,transmuxer:g}=this,y=o?o.start:i.start,v=i.decryptdata,E=this.frag,p=!(E&&i.cc===E.cc),S=!(E&&u.level===E.level),L=E?u.sn-E.sn:-1,D=this.part?u.part-this.part.index:-1,F=L===0&&u.id>1&&u.id===(E==null?void 0:E.stats.chunkCount),A=!S&&(L===1||L===0&&(D===1||F&&D<=0)),x=self.performance.now();(S||L||i.stats.parsing.start===0)&&(i.stats.parsing.start=x),o&&(D||!A)&&(o.stats.parsing.start=x);const R=!(E&&((h=i.initSegment)==null?void 0:h.url)===((d=E.initSegment)==null?void 0:d.url)),b=new z3(p,A,l,S,y,R);if(!A||p||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===le.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${p}
        trackSwitch: ${S}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${R}`);const C=new H3(r,s,t,a,c);this.configureTransmuxer(C)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:b},e instanceof ArrayBuffer?[e]:[]);else if(g){const C=g.push(e,v,u,b);Au(C)?C.then(M=>{this.handleTransmuxComplete(M)}).catch(M=>{this.transmuxerError(M,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(C)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);Au(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const b_=100;class W3 extends ky{constructor(e,t,r){super(e,t,r,"audio-stream-controller",le.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){if(r===le.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===q.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===q.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=xb(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===q.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=q.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(b_),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=q.IDLE):this.state=q.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case q.IDLE:this.doTickIdle();break;case q.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=q.WAITING_INIT_PTS}break}case q.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case q.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=q.FRAG_LOADING;const a=s.flush().buffer,l={frag:t,part:r,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=q.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[i]))return;const a=r[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=q.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,qe.AUDIO,le.AUDIO));const c=this.getFwdBufferInfo(u,le.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(_.BUFFER_EOS,{type:"audio"}),this.state=q.ENDED;return}const h=c.len,d=t.maxBufferLength,m=l.fragments,g=m[0].start,y=this.getLoadPosition(),v=this.flushing?y:c.end;if(this.switchingTrack&&s){const S=y;l.PTSKnown&&S<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(h>=d&&!this.switchingTrack&&v<m[m.length-1].start)return;let E=this.getNextFragment(v,l);if(E&&this.isLoopLoading(E,v)&&(E=this.getNextFragmentLoopLoading(E,l,c,le.MAIN,d)),!E){this.bufferFlushed=!0;return}let p=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&p&&Et(E)&&!E.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(p)===Lt.OK&&(this.mainFragLoading=p=null),p&&Et(p))){if(E.start>p.end){const L=this.fragmentTracker.getFragAtPos(v,le.MAIN);L&&L.end>p.end&&(p=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(E.start>p.end)return}this.loadFragment(E,a,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new _u(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==q.STOPPED&&(this.setInterval(b_),this.state=q.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(_.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:o,groupId:a,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||i.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==q.STOPPED&&(this.state=q.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=s[o];let h=0;if(i.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(c.details){var d;h=this.alignPlaylists(i,c.details,(d=this.levelLastLoaded)==null?void 0:d.details)}i.alignedSliding||(Vb(i,u),i.alignedSliding||vd(i,u),h=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,h),this.hls.trigger(_.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===q.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=q.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const h=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new aL(this.hls,le.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(m!==void 0){const v=s?s.index:-1,E=v!==-1,p=new by(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,E);d.push(i,g,h,"",r,s,c.totalduration,!1,p,m)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:y}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new jb,complete:!1};y.push(new Uint8Array(i)),this.state!==q.STOPPED&&(this.state=q.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===le.MAIN&&Et(t.frag)&&(this.mainFragLoading=t,this.state===q.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==le.AUDIO){!this.audioOnly&&r.type===le.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Et(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(_.AUDIO_TRACK_SWITCHED,je({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=q.ERROR;return}switch(t.details){case j.FRAG_GAP:case j.FRAG_PARSING_ERROR:case j.FRAG_DECRYPT_ERROR:case j.FRAG_LOAD_ERROR:case j.FRAG_LOAD_TIMEOUT:case j.KEY_LOAD_ERROR:case j.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(le.AUDIO,t);break;case j.AUDIO_TRACK_LOAD_ERROR:case j.AUDIO_TRACK_LOAD_TIMEOUT:case j.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===q.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Re.AUDIO_TRACK&&(this.state=q.IDLE);break;case j.BUFFER_ADD_CODEC_ERROR:case j.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case j.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case j.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==qe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==qe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===q.ENDED&&(this.state=q.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,le.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:h}=c,{audio:d,text:m,id3:g,initSegment:y}=i;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=q.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(y,l))return;this._bufferInitSegment(c,y.tracks,v,o),s.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:y.tracks})}if(d){const{startPTS:v,endPTS:E,startDTS:p,endDTS:S}=d;u&&(u.elementaryStreams[qe.AUDIO]={startPTS:v,endPTS:E,startDTS:p,endDTS:S}),l.setElementaryStreamInfo(qe.AUDIO,v,E,p,S),this.bufferFragmentData(d,l,u,o)}if(g!=null&&(t=g.samples)!=null&&t.length){const v=ze({id:r,frag:l,details:h},g);s.trigger(_.FRAG_PARSING_METADATA,v)}if(m){const v=ze({id:r,frag:l,details:h},m);s.trigger(_.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,s){if(this.state!==q.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=le.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(_.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:a};this.hls.trigger(_.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Lt.NOT_LOADED||s===Lt.PARTIAL){var i;if(!Et(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=q.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&vd(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;to({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:o,channels:a},e,Hi)||(fd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(_.AUDIO_TRACK_SWITCHED,je({},e))}}class By extends Jn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&GS(r);return new KS(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const c=Math.max(l||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(h=>{h.setStart(h.playlistOffset+c)})}if(s.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){BV(r,s,this);const p=s.playlistParsingError;if(p){this.warn(p);const S=this.hls;if(!S.config.ignorePlaylistParsingErrors){var u;const{networkDetails:L}=t;S.trigger(_.ERROR,{type:ce.NETWORK_ERROR,details:j.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:p,reason:p.message,level:t.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:L,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const h=this.hls.mainForwardBufferInfo,d=h?h.end-h.len:0,m=(s.edge-d)*1e3,g=Mb(s,m);if(s.requestScheduled+g<o?s.requestScheduled=o:s.requestScheduled+=g,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let y,v,E;if(s.canBlockReload&&s.endSN&&s.advanced){const p=this.hls.config.lowLatencyMode,S=s.lastPartSn,L=s.endSN,D=s.lastPartIndex,F=D!==-1,A=S===L;F?A?(v=L+1,E=p?0:D):(v=S,E=p?D+1:s.maxPartIndex):v=L+1;const x=s.age,R=x+s.ageHeader;let b=Math.min(R-s.partTarget,s.targetduration*1.5);if(b>0){if(R>s.targetduration*3)this.log(`Playlist last advanced ${x.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,E=void 0;else if(r!=null&&r.tuneInGoal&&R-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${b} with playlist age: ${s.age}`),b=0;else{const C=Math.floor(b/s.targetduration);if(v+=C,E!==void 0){const M=Math.round(b%s.targetduration/s.partTarget);E+=M}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${x.toFixed(2)}s goal: ${b} skip sn ${C} to part ${E}`)}s.tuneInGoal=b}if(y=this.getDeliveryDirectives(s,t.deliveryDirectives,v,E),p||!A){s.requestScheduled=o,this.loadingPlaylist(c,y);return}}else(s.canBlockReload||s.canSkipUntil)&&(y=this.getDeliveryDirectives(s,t.deliveryDirectives,v,E));y&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(g-a*2,g/2)),this.scheduleLoading(c,y,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,s){let i=GS(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=lh.No),new KS(r,s,i)}checkRetry(e){const t=e.details,r=md(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===jt.RetryRequest||!s.resolved&&i===jt.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=wy(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function lL(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!wu(n[t].attrs,e[t].attrs))return!1;return!0}function wu(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Ap(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class q3 extends By{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(d=>!r||r.indexOf(d.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(d=>d.default)&&(this.selectDefaultTrack=!1),a.forEach((d,m)=>{d.id=m});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const d=Or(l,a,Hi);if(d>-1)i=a[d];else{const m=Or(l,this.tracks);i=this.tracks[m]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(_.AUDIO_TRACKS_UPDATED,c);const h=this.trackId;if(u!==-1&&h===-1)this.setAudioTrack(u);else if(a.length&&h===-1){var o;const d=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(d.message),this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:d})}}}onError(e,t){t.fatal||!t.context||t.context.type===Re.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&to(e,s,Hi))return s;const i=Or(e,this.tracksInGroup,Hi);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=oV(e,t.levels,r,o,Hi);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Or(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(_.AUDIO_TRACK_SWITCHING,je({},s)),i))return;const o=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||to(e,s,Hi)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(to({name:r,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},c,Hi))return u}for(let u=0;u<t.length;u++){const c=t[u];if(wu(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(wu(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&fd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(_.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class Y3{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const L_=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,uL="HlsJsTrackRemovedError";class Q3 extends Error{constructor(e){super(e),this.name=uL}}class X3 extends Jn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(_.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=E$(Ii(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_APPENDING,this.onBufferAppending,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.BUFFER_EOS,this.onBufferEos,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.FRAG_PARSED,this.onFragParsed,this),e.on(_.FRAG_CHANGED,this.onFragChanged,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_APPENDING,this.onBufferAppending,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_EOS,this.onBufferEos,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.FRAG_PARSED,this.onFragParsed,this),e.off(_.FRAG_CHANGED,this.onFragChanged,this),e.off(_.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?ze(r,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(r[o]=ze({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Ii(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=r.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,C_(r),J3(r,a),r.load()}catch{r.src=a}else r.src=a}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ye(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Ye(s,(l,u)=>l==="initSegment"?void 0:u)}}`),!ib(s,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(_.MEDIA_DETACHING,{}),this.onMediaAttaching(_.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,i.forEach(l=>{const u=l,c=s[u];if(c){const h=c.buffer;if(h){const d=this.fragmentTracker,m=c.id;if(d.hasFragments(m)||d.hasParts(m)){const v=ve.getBuffered(h);d.detectEvictedFragments(u,v,m,null,!0)}const g=bm(u),y=[u,h];this.sourceBuffers[g]=y,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),i.removeSourceBuffer(l[u]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&C_(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(_.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[bm(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Y3(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var u,c;const h=t[l],{id:d,codec:m,levelCodec:g,container:y,metadata:v,supplemental:E}=h;let p=s[l];const S=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],L=S!=null&&S.buffer?S:p,D=(L==null?void 0:L.pendingCodec)||(L==null?void 0:L.codec),F=L==null?void 0:L.levelCodec;p||(p=s[l]={buffer:void 0,listeners:[],codec:m,supplemental:E,container:y,levelCodec:g,metadata:v,id:d});const A=ah(D,F),x=A==null?void 0:A.replace(L_,"$1");let R=ah(m,g);const b=(c=R)==null?void 0:c.replace(L_,"$1");R&&A&&x!==b&&(l.slice(0,5)==="audio"&&(R=hd(R,this.appendSource)),this.log(`switching codec ${D} to ${R}`),R!==(p.pendingCodec||p.codec)&&(p.pendingCodec=R),p.container=y,this.appendChangeType(l,y,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),a.changeType(s),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,le.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&ve.isBuffered(l.buffer,s)||((a=this.fragmentTracker.getAppendedFrag(s,le.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:o,frag:a,part:l,chunkMeta:u,offset:c}=t,h=u.buffering[i],{sn:d,cc:m}=a,g=self.performance.now();h.start=g;const y=a.stats.buffering,v=l?l.stats.buffering:null;y.start===0&&(y.start=g),v&&v.start===0&&(v.start=g);const E=r.audio;let p=!1;i==="audio"&&(E==null?void 0:E.container)==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const S=r.video,L=S==null?void 0:S.buffer;if(L&&d!=="initSegment"){const A=l||a,x=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(S.ending||S.ended)){const b=A.start+A.duration*.05,C=L.buffered,M=this.currentOp("video");!C.length&&!M?this.blockAudio(A):!M&&!ve.isBuffered(L,b)&&this.lastVideoAppendEnd<b&&this.blockAudio(A)}else if(i==="video"){const R=A.end;if(x){const b=x.frag.start;(R>b||R<this.lastVideoAppendEnd||ve.isBuffered(L,b))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}const D=(l||a).start,F={label:`append-${i}`,execute:()=>{var A;h.executeStart=self.performance.now();const x=(A=this.tracks[i])==null?void 0:A.buffer;x&&(p?this.updateTimestampOffset(x,D,.1,i,d,m):c!==void 0&&oe(c)&&this.updateTimestampOffset(x,c,1e-6,i,d,m)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();h.executeEnd=h.end=A,y.first===0&&(y.first=A),v&&v.first===0&&(v.first=A);const x={};this.sourceBuffers.forEach(([R,b])=>{R&&(x[R]=ve.getBuffered(b))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(_.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:x})},onError:A=>{var x;const R={type:ce.MEDIA_ERROR,parent:a.type,details:j.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:u,error:A,err:A,fatal:!1},b=(x=this.media)==null?void 0:x.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)R.details=j.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!b)R.errorAction=ha(!0);else if(A.name===uL&&this.sourceBufferCount===0)R.errorAction=ha(!0);else{const C=++this.appendErrors[i];this.warn(`Failed ${C}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${b||"no media error"})`),(C>=this.hls.config.appendErrorMaxRetry||b)&&(R.fatal=!0)}this.hls.trigger(_.ERROR,R)}};this.log(`queuing "${i}" append sn: ${d}${l?" p: "+l.index:""} of ${a.type===le.MAIN?"level":"track"} ${a.level} cc: ${m}`),this.append(F,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(_.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],o=s?s.elementaryStreams:r.elementaryStreams;o[qe.AUDIOVIDEO]?i.push("audiovideo"):(o[qe.AUDIO]&&i.push("audio"),o[qe.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:r.stats;this.hls.trigger(_.FRAG_BUFFERED,{frag:r,part:s,stats:u,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(_.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(_.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===j.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;oe(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,o=t.levelTargetDuration,a=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(oe(a)&&a>=0){const u=Math.max(a,o),c=Math.floor(i/o)*o-u;this.flushBackBuffer(i,o,c)}const l=s.frontBufferFlushThreshold;if(oe(l)&&l>0){const u=Math.max(s.maxBufferLength,l),c=Math.max(u,o),h=Math.floor(i/o)*o+c;this.flushFrontBuffer(i,o,h)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=ve.getBuffered(i);if(a.length>0&&r>a.start(0)){var o;this.hls.trigger(_.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(_.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=ve.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return oe(i)?{duration:i}:null;const o=this.media.duration,a=oe(r.duration)?r.duration:0;return s>a&&s>o||!oe(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(oe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ye(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(_.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${Ye(a)}`);try{const c=r.addSourceBuffer(u),h=bm(o),d=[o,c];t[h]=d,a.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Tu(r,"video")&&(s=V$(s,r));const i=ah(s,e.levelCodec);return i?t.slice(0,5)==="audio"?hd(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(_.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,o){const a=t-e.timestampOffset;Math.abs(a)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!s||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=oe(s.duration)?s.duration:1/0,u=oe(i.duration)?i.duration:1/0,c=Math.max(0,t),h=Math.min(r,l,u);h>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${h}] from the ${e} SourceBuffer`),a.remove(c,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new Q3(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=r.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function C_(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function J3(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function bm(n){return n==="audio"?1:0}class $y{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,$y.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}const Z3={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},mn=Z3,e4={HLS:"h"},t4=e4;class zr{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof zr?r:new zr(r))),this.value=e,this.params=t}}const n4="Dict";function r4(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function s4(n,e,t,r){return new Error(`failed to ${n} "${r4(e)}" as ${t}`,{cause:r})}function Wr(n,e,t){return s4("serialize",n,e,t)}class cL{constructor(e){this.description=e}}const k_="Bare Item",i4="Boolean";function o4(n){if(typeof n!="boolean")throw Wr(n,i4);return n?"?1":"?0"}function a4(n){return btoa(String.fromCharCode(...n))}const l4="Byte Sequence";function u4(n){if(ArrayBuffer.isView(n)===!1)throw Wr(n,l4);return`:${a4(n)}:`}const c4="Integer";function h4(n){return n<-999999999999999||999999999999999<n}function hL(n){if(h4(n))throw Wr(n,c4);return n.toString()}function d4(n){return`@${hL(n.getTime()/1e3)}`}function dL(n,e){if(n<0)return-dL(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const f4="Decimal";function m4(n){const e=dL(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Wr(n,f4);const t=e.toString();return t.includes(".")?t:`${t}.0`}const g4="String",p4=/[\x00-\x1f\x7f]+/;function y4(n){if(p4.test(n))throw Wr(n,g4);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function v4(n){return n.description||n.toString().slice(7,-1)}const E4="Token";function P_(n){const e=v4(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Wr(e,E4);return e}function wp(n){switch(typeof n){case"number":if(!oe(n))throw Wr(n,k_);return Number.isInteger(n)?hL(n):m4(n);case"string":return y4(n);case"symbol":return P_(n);case"boolean":return o4(n);case"object":if(n instanceof Date)return d4(n);if(n instanceof Uint8Array)return u4(n);if(n instanceof cL)return P_(n);default:throw Wr(n,k_)}}const T4="Key";function Rp(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Wr(n,T4);return n}function Vy(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Rp(e)}`:`;${Rp(e)}=${wp(t)}`).join("")}function fL(n){return n instanceof zr?`${wp(n.value)}${Vy(n.params)}`:wp(n)}function S4(n){return`(${n.value.map(fL).join(" ")})${Vy(n.params)}`}function _4(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Wr(n,n4);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof zr||(i=new zr(i));let o=Rp(s);return i.value===!0?o+=Vy(i.params):(o+="=",Array.isArray(i.value)?o+=S4(i):o+=fL(i)),o}).join(`,${r}`)}function mL(n,e){return _4(n,e)}const xr="CMCD-Object",mt="CMCD-Request",$i="CMCD-Session",Bs="CMCD-Status",x4={br:xr,ab:xr,d:xr,ot:xr,tb:xr,tpb:xr,lb:xr,tab:xr,lab:xr,url:xr,pb:mt,bl:mt,tbl:mt,dl:mt,ltc:mt,mtp:mt,nor:mt,nrr:mt,rc:mt,sn:mt,sta:mt,su:mt,ttfb:mt,ttfbb:mt,ttlb:mt,cmsdd:mt,cmsds:mt,smrt:mt,df:mt,cs:mt,ts:mt,cid:$i,pr:$i,sf:$i,sid:$i,st:$i,v:$i,msd:$i,bs:Bs,bsd:Bs,cdn:Bs,rtp:Bs,bg:Bs,pt:Bs,ec:Bs,e:Bs},I4={REQUEST:mt};function A4(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function w4(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?A4(e):{};return r.reduce((i,o)=>{var a;const l=x4[o]||s[o]||I4.REQUEST,u=(a=i[l])!==null&&a!==void 0?a:i[l]={};return u[o]=n[o],i},t)}function R4(n){return["ot","sf","st","e","sta"].includes(n)}function b4(n){return typeof n=="number"?oe(n):n!=null&&n!==""&&n!==!1}const gL="event";function L4(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const dh=n=>Math.round(n),bp=(n,e)=>Array.isArray(n)?n.map(t=>bp(t,e)):n instanceof zr&&typeof n.value=="string"?new zr(bp(n.value,e),n.params):(e.baseUrl&&(n=L4(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),kc=n=>dh(n/100)*100,C4=(n,e)=>{let t=n;return e.version>=2&&(n instanceof zr&&typeof n.value=="string"?t=new zr([n]):typeof n=="string"&&(t=[n])),bp(t,e)},k4={br:dh,d:dh,bl:kc,dl:kc,mtp:kc,nor:C4,rtp:kc,tb:dh},pL="request",yL="response",jy=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],P4=["e"],D4=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function hf(n){return D4.test(n)}function N4(n){return jy.includes(n)||P4.includes(n)||hf(n)}const vL=["d","dl","nor","ot","rtp","su"];function O4(n){return jy.includes(n)||vL.includes(n)||hf(n)}const M4=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function F4(n){return jy.includes(n)||vL.includes(n)||M4.includes(n)||hf(n)}const U4=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function B4(n){return U4.includes(n)||hf(n)}const $4={[yL]:F4,[gL]:N4,[pL]:O4};function EL(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||pL,i=r===1?B4:$4[s];let o=Object.keys(n).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=s===yL||s===gL;l&&!o.includes("ts")&&o.push("ts"),r>1&&!o.includes("v")&&o.push("v");const u=ze({},k4,e.formatters),c={version:r,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let d=n[h];const m=u[h];if(typeof m=="function"&&(d=m(d,c)),h==="v"){if(r===1)return;d=r}h=="pr"&&d===1||(l&&h==="ts"&&!oe(d)&&(d=Date.now()),b4(d)&&(R4(h)&&typeof d=="string"&&(d=new cL(d)),t[h]=d))}),t}function V4(n,e={}){const t={};if(!n)return t;const r=EL(n,e),s=w4(r,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[o,a])=>{const l=mL(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function j4(n,e,t){return ze(n,V4(e,t))}const G4="CMCD";function K4(n,e={}){return n?mL(EL(n,e),{whitespace:!1}):""}function H4(n,e={}){if(!n)return"";const t=K4(n,e);return encodeURIComponent(t)}function z4(n,e={}){if(!n)return"";const t=H4(n,e);return`${G4}=${t}`}const D_=/CMCD=[^&#]+/;function W4(n,e,t){const r=z4(e,t);if(!r)return n;if(D_.test(n))return n.replace(D_,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class q4{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:mn.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,a=this.hls.levels[i.level],l=this.getObjectType(i),u={d:(o||i).duration*1e3,ot:l};(l===mn.VIDEO||l===mn.AUDIO||l==mn.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=o?this.getNextPart(o):this.getNextFrag(i);c!=null&&c.url&&c.url!==i.url&&(u.nor=c.url),this.apply(s,u)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHED,this.onMediaDetached,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHED,this.onMediaDetached,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:t4.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ze(t,this.createData());const r=t.ot===mn.INIT||t.ot===mn.VIDEO||t.ot===mn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),j4(e.headers,t,i)):e.url=W4(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===r&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return mn.TIMED_TEXT;if(e.sn==="initSegment")return mn.INIT;if(t==="audio")return mn.AUDIO;if(t==="main")return this.hls.audioTracks.length?mn.VIDEO:mn.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===mn.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;r=s.levels.slice(0,o)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===mn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ve.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const Y4=3e5;class Q4 extends Jn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===jt.SendAlternateToPenaltyBox&&r.flags===Cn.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&s?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==o),t.details===j.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Ye(i)} penalized: ${Ye(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>Y4&&delete r[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Bb(t),this.hls.trigger(_.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Re.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Re.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const h=new it(c.attrs);h["PATHWAY-ID"]=o;const d=h.AUDIO&&`${h.AUDIO}_clone_${o}`,m=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;d&&(r[h.AUDIO]=d,h.AUDIO=d),m&&(s[h.SUBTITLES]=m,h.SUBTITLES=m);const g=TL(c.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),y=new _u({attrs:h,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let v=1;v<c.audioGroups.length;v++)y.addGroupId("audio",`${c.audioGroups[v]}_clone_${o}`);if(c.subtitleGroups)for(let v=1;v<c.subtitleGroups.length;v++)y.addGroupId("text",`${c.subtitleGroups[v]}_clone_${o}`);return y});t.push(...u),N_(this.audioTracks,r,l,o),N_(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,h,d,m)=>{this.log(`Loaded steering manifest: "${s}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":E}=g;if(y)try{this.uri=new self.URL(y,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||d.url),v&&this.clonePathways(v);const p={steeringManifest:g,url:s.toString()};this.hls.trigger(_.STEERING_MANIFEST_LOADED,p),E&&this.updatePathwayPriority(E)},onError:(c,h,d,m)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${h.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const v=y.getResponseHeader("Retry-After");v&&(g=parseFloat(v)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,g)},onTimeout:(c,h,d)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function N_(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(o=>o.groupId===s).map(o=>{const a=ze({},o);return a.details=void 0,a.attrs=new it(a.attrs),a.url=a.attrs.URI=TL(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=r,a});n.push(...i)})}function TL(n,e,t,r){const{HOST:s,PARAMS:i,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}class fa extends Jn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=fa.CDMCleanupPromise?[fa.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Al(this.config));const a=o.map(Tm).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=uh(o);if(r!=="sinf"||a!==at.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}let l;try{const m=Rt(new Uint8Array(s)),g=Cy(JSON.parse(m).sinf),y=mb(g);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24))}catch(m){this.warn(`${i} Failed to parse sinf: ${m}`);return}const u=Kt(l),{keyIdToKeySessionPromise:c,mediaKeySessions:h}=this;let d=c[u];for(let m=0;m<h.length;m++){const g=h[m],y=g.decryptdata;if(!y.keyId)continue;const v=Kt(y.keyId);if(pd(l,y.keyId)||y.uri.replace(/-/g,"").indexOf(u)!==-1){if(d=c[v],!d)continue;if(y.pssh)break;delete c[v],y.pssh=new Uint8Array(s),y.keyId=l,d=c[u]=d.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),d.catch(E=>this.handleError(E));break}}d||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(_.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(_.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===at.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(r),i=t.map(o=>o.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,i).then(h=>o({keySystem:c,mediaKeys:h})).catch(h=>{u.length?l(u):h instanceof Ln?a(h):a(new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return kb===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=CV(e,t,r,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(s=o)==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ye(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),a.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=l.mediaKeys=u.createMediaKeys().then(d=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(m=>m?this.setMediaKeysServerCertificate(d,e,m):d)));return h.catch(d=>{this.error(`Failed to create media-keys for "${e}"}: ${d}`)}),h})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Kt(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=Pc(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Kt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Tm(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Tm(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Al(this.config),r=e.map(uh).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=X4(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=Pc(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const a=O_(s||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[r];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=a,a}return o.catch(a=>{if(a instanceof Ln){const l=je({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new Ln(l,a.message);this.handleError(u,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ln){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Kt(r.keyId||[])})`:""}`),this.hls.trigger(_.ERROR,e.data)}else this.error(e.message),this.hls.trigger(_.ERROR,{type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Pc(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=uh(e.keyFormat),i=s?[s]:Al(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Al(this.config)),e.length===0)throw new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ye({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const g=o.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const a=Pc(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${r.byteLength})`);const u=new Py,c=e._onmessage=g=>{const y=e.mediaKeysSession;if(!y){u.emit("error",new Error("invalid state"));return}const{messageType:v,message:E}=g;this.log(`"${v}" message event for session "${y.sessionId}" message size: ${E.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,E).catch(p=>{u.eventNames().length?u.emit("error",p):this.handleError(p)}):v==="license-release"?e.keySystem===at.FAIRPLAY&&this.updateKeySession(e,Tp("acknowledged")).then(()=>this.removeSession(e)).catch(p=>this.handleError(p)):this.warn(`unhandled media key message type "${v}"`)},h=(g,y)=>{y.keyStatus=g;let v;g.startsWith("usable")?u.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?v=O_(g,y.decryptdata):g==="expired"?v=new Error(`key expired (keyId: ${a})`):g==="released"?v=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${a})`),v&&(u.eventNames().length?u.emit("error",v):this.handleError(v))},d=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(L=>v[L]!=="status-pending"))return;if(v[a]==="expired"){this.log(`Expired key ${Ye(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let p=v[a];if(p)h(p,e);else{var S;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(S=e.keyStatusTimeouts)[a]||(S[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const D=this.getKeyStatus(e.decryptdata);if(D&&D!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${D} from other session.`),h(D,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),p="internal-error",h(p,e)},1e3)),this.log(`No status for keyId ${a} (${Ye(v)}).`)}};cn(e.mediaKeysSession,"message",c),cn(e.mediaKeysSession,"keystatuseschange",d);const m=new Promise((g,y)=>{u.on("error",y),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(g=>{throw new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>m).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const a=s;s=r,r=a}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===at.PLAYREADY&&i.length===16){const a=Kt(i);t[a]=r,Lb(i)}const o=Kt(i);r==="internal-error"&&(this.bannedKeyIds[o]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(d,m,g,y)=>{o(d.data)},onError:(d,m,g,y)=>{a(new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:je({url:l.url,data:void 0},d)},`"${e}" certificate request failed (${i}). Status: ${d.code} (${d.text})`))},onTimeout:(d,m,g)=>{a(new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(d,m,g)=>{a(new Error("aborted"))}};s.load(l,c,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let h=0,d=i.length;h<d;h++){var o,a;c=i[h];const m=(o=c.querySelector("name"))==null?void 0:o.textContent,g=(a=c.querySelector("value"))==null?void 0:a.textContent;m&&g&&e.setRequestHeader(m,g)}}const l=s.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Tp(atob(u))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}s(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)i(new Ln({type:ce.KEY_SYSTEM_ERROR,details:j.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==at.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,cn(r,"encrypted",this.onMediaEncrypted),cn(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(Tn(e,"encrypted",this.onMediaEncrypted),Tn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,gi.clearKeyUriToKeyIdMap();const i=s.length;fa.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Kt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(u=>self.clearTimeout(o[u]));const{drmSystemOptions:a}=this.config;return(PV(a)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}fa.CDMCleanupPromise=void 0;function Pc(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Kt(n.keyId)}function X4(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class Ln extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function O_(n,e){const t=n==="output-restricted",r=t?j.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:j.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ln({type:ce.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class J4{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,u=this.hls;if(u.trigger(_.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(_.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function SL(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function _L(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Ge.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Ge.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Xo(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Lp(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=e6(n.cues,e,t);for(let o=0;o<i.length;o++)(!r||r(i[o]))&&n.removeCue(i[o])}s==="disabled"&&(n.mode=s)}function Z4(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function e6(n,e,t){const r=[],s=Z4(n,e);if(s>-1)for(let i=s,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function fh(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class t6 extends By{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=fh(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;fh(r.textTracks).forEach(o=>{Xo(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,h)=>{c.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const c=Or(a,o);if(c>-1)i=o[c];else{const h=Or(a,this.tracks);i=this.tracks[h]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(_.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||to(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(wu(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(wu(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Ap(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Re.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&to(e,r))return r;const s=Or(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=Or(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(_.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=fh(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Ap(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=s;this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const h=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(h)}}function n6(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Kl(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const ma=.025;let Td=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function r6(n,e,t){return`${n.identifier}-${t+1}-${Kl(e)}`}class s6{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Lm(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Lm(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=oe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Lm(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ma))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Td.Range:Td.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return i6(this)}}function Lm(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<ma)?e.start:e.start+e.duration}function xL(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Cm(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function i6(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Uo(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class o6{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(_.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(_.LEVEL_LOADED,o),i.once(_.AUDIO_TRACK_LOADED,o),i.once(_.SUBTITLE_TRACK_LOADED,o),i.on(_.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(_.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,i.trigger(_.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=xL(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=ve.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ve.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Uo(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const M_=.033;class a6 extends Jn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const o=r[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,o=this.parseDateRanges(s,{url:r.url},t),a=Object.keys(s),l=i?i.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,c)=>{const h=u.cue.pre,d=u.cue.post,m=c.cue.pre,g=c.cue.post;if(h&&!m)return-1;if(m&&!h||d&&!g)return 1;if(g&&!d)return-1;if(!h&&!m&&!d&&!g){const y=u.startTime,v=c.startTime;if(y!==v)return y-v}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(r||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,u)=>Math.abs(l.playout.start-i[u].playout.start)>.005||Math.abs(l.playout.end-i[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new s6(l,t),this.eventMap[a]=u,r===!1&&(u.appendInPlace=r)),s.push(u)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,h)=>{const d=c.cue.pre,m=c.cue.post,g=e[h-1]||null,y=c.appendInPlace,v=m?i:c.startOffset,E=c.duration,p=c.timelineOccupancy===Td.Range?E:0,S=c.resumptionOffset,L=(g==null?void 0:g.startTime)===v,D=v+c.cumulativeDuration;let F=y?D+E:v+S;if(d||!m&&v<=0){const x=u;u+=p,c.timelineStart=D;const R=o;o+=E,r.push({event:c,start:D,end:F,playout:{start:R,end:o},integrated:{start:x,end:u}})}else if(v<=i){if(!L){const b=v-l;if(b>M_){const C=l,M=u;u+=b;const k=o;o+=b;const re={previousEvent:e[h-1]||null,nextEvent:c,start:C,end:C+b,playout:{start:k,end:o},integrated:{start:M,end:u}};r.push(re)}else b>0&&g&&(g.cumulativeDuration+=b,r[r.length-1].end=v)}m&&(F=D),c.timelineStart=D;const x=u;u+=p;const R=o;o+=E,r.push({event:c,start:D,end:F,playout:{start:R,end:o},integrated:{start:x,end:u}})}else return;const A=c.resumeTime;m||A>i?l=i:l=A}),l<i){var a;const c=l,h=u,d=i-l;u+=d;const m=o;o+=d,r.push({previousEvent:((a=r[r.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:c+d,playout:{start:m,end:o},integrated:{start:h,end:u}})}this.setDurations(i,o,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,c=a.cue.post,h=u?0:c?s:a.startTime;this.updateAssetDurations(a),o===h?a.cumulativeDuration=i:(i=0,o=h),!c&&a.snapOptions.in&&(a.resumeAnchor=po(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<M_&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const m=oe(a.resumeOffset)?a.resumeOffset:a.duration;i+=m})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>ma?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${l}`),!1;const u=po(null,a.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(u.start-r)<ma+c||Math.abs(u.end-r)<ma+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+r;a.startOffset=r,a.timelineStart=l,s||(s=a.duration===null),i||(i=!!a.error);const u=a.error?0:a.duration||0;r+=u}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function rr(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class l6{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=xL(r,this.hls.sessionId,e.baseUrl)}catch(d){const m=this.assignAssetListError(e,j.ASSET_LIST_LOAD_ERROR,d,r);this.hls.trigger(_.ERROR,m);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:s.href},u=i.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(d,m,g,y)=>{const v=d.data,E=v==null?void 0:v.ASSETS;if(!Array.isArray(E)){const p=this.assignAssetListError(e,j.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,m,y);this.hls.trigger(_.ERROR,p);return}e.assetListResponse=v,this.hls.trigger(_.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:y})},onError:(d,m,g,y)=>{const v=this.assignAssetListError(e,j.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${d.code} ${d.text} (${m.url})`),m.url,y,g);this.hls.trigger(_.ERROR,v)},onTimeout:(d,m,g)=>{const y=this.assignAssetListError(e,j.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${m.url})`),m.url,d,g);this.hls.trigger(_.ERROR,y)}};return a.load(l,c,h),this.hls.trigger(_.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,s,i,o){return e.error=r,{type:ce.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:o,stats:i}}}function F_(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function Dc(n,e){return`[${n}] Advancing timeline position to ${e}`}class u6 extends Jn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&r<a.start||r>=a.end){var l;const m=this.findItemIndex(a);let g=this.schedule.findItemIndexAtTime(r);if(g===-1&&(g=m+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${r} (resolving from ${m} to ${g})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&g>m){const y=this.schedule.findJumpRestrictedIndex(m+1,g);if(y>m){this.setSchedulePosition(y);return}}this.setSchedulePosition(g);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const m=a.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,m))}return}const c=u.timelineStart,h=u.duration||0;if(o&&r<c||r>=c+h){var d;(d=a.event)!=null&&d.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,u)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const a=this.findItemIndex(s);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],u=i.durations,c=r.map(y=>y.identifier),h=!!(a.length||c.length);(h||s)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(y=>rr(y))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let d=null,m=null;o&&(d=this.updateItem(o,this.timelinePos),this.itemsMatch(o,d)?this.playingItem=d:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(m=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,m)?this.bufferingItem=m:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),r.forEach(y=>{y.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const v=y.assetItem.timelineStart,E=y.timelineOffset-v;if(E)try{y.timelineOffset=v}catch(p){Math.abs(E)>ma&&this.warn(`${p} ("${y.assetId}" ${y.timelineOffset}->${v})`)}}}),h||s){if(this.hls.trigger(_.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(d,o),g&&m!==d&&this.trimInPlace(m,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new l6(e),this.schedule=new a6(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(_.MEDIA_ENDED,this.onMediaEnded,this),e.on(_.ERROR,this.onError,this),e.on(_.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(_.MEDIA_ENDED,this.onMediaEnded,this),e.off(_.ERROR,this.onError,this),e.off(_.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Tn(e,"play",this.onPlay),Tn(e,"pause",this.onPause),Tn(e,"seeking",this.onSeeking),Tn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;cn(r,"seeking",this.onSeeking),cn(r,"timeupdate",this.onTimeupdate),cn(r,"play",this.onPlay),cn(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=h=>h&&e.getAssetPlayer(h.identifier),s=(h,d,m,g,y)=>{if(h){let v=h[d].start;const E=h.event;if(E){if(d==="playout"||E.timelineOccupancy!==Td.Point){const p=r(m);(p==null?void 0:p.interstitial)===E&&(v+=p.assetItem.startOffset+p[y])}}else{const p=g==="bufferedPos"?o():e[g];v+=p-h.start}return v}return 0},i=(h,d)=>{var m;if(h!==0&&d!=="primary"&&(m=e.schedule)!=null&&m.length){var g;const y=e.schedule.findItemIndexAtTime(h),v=(g=e.schedule.items)==null?void 0:g[y];if(v){const E=v[d].start-v.start;return h+E}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?a("primary"):Math.max(h,0)},a=h=>{var d,m;return(d=e.primaryDetails)!=null&&d.live?e.primaryDetails.edge:((m=e.schedule)==null?void 0:m.durations[h])||0},l=(h,d)=>{var m,g;const y=e.effectivePlayingItem;if(y!=null&&(m=y.event)!=null&&m.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${d}"`);const v=e.effectivePlayingItem,E=e.schedule.findItemIndexAtTime(h,d),p=(g=e.schedule.items)==null?void 0:g[E],S=e.getBufferingPlayer(),L=S==null?void 0:S.interstitial,D=L==null?void 0:L.appendInPlace,F=v&&e.itemsMatch(v,p);if(v&&(D||F)){const A=r(e.playingAsset),x=(A==null?void 0:A.media)||e.primaryMedia;if(x){const R=d==="primary"?x.currentTime:s(v,d,e.playingAsset,"timelinePos","currentTime"),b=h-R,C=(D?R:x.currentTime)+b;if(C>=0&&(!A||D||C<=A.duration)){x.currentTime=C;return}}}if(p){let A=h;if(d!=="primary"){const R=p[d].start,b=h-R;A=p.start+b}const x=!e.isInterstitial(p);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(x||p.event.appendInPlace)){const R=e.media||(D?S==null?void 0:S.media:null);R&&(R.currentTime=A)}else if(v){const R=e.findItemIndex(v);if(E>R){const C=e.schedule.findJumpRestrictedIndex(R+1,E);if(C>R){e.setSchedulePosition(C);return}}let b=0;if(x)e.timelinePos=A,e.checkBuffer();else{const C=p.event.assetList,M=h-(p[d]||p).start;for(let k=C.length;k--;){const re=C[k];if(re.duration&&M>=re.startOffset&&M<re.startOffset+re.duration){b=k;break}}}e.setSchedulePosition(E,b)}}},u=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const d=t();return e.isInterstitial(d)?d:null},c={get bufferedEnd(){const h=t(),d=e.bufferingItem;if(d&&d===h){var m;return s(d,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-d.playout.start||((m=e.bufferingAsset)==null?void 0:m.startOffset)||0}return 0},get currentTime(){const h=u(),d=e.effectivePlayingItem;return d&&d===h?s(d,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-d.playout.start:0},set currentTime(h){const d=u(),m=e.effectivePlayingItem;m&&m===d&&l(h+m.playout.start,"playout")},get duration(){const h=u();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const d=(h=u())==null?void 0:h.event.assetList;return d?d.map(m=>e.getAssetPlayer(m.identifier)):[]},get playingIndex(){var h;const d=(h=u())==null?void 0:h.event;return d&&e.effectivePlayingAsset?d.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return a("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return a("integrated")},get seekableStart(){var h;return i(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,d=h==null?void 0:h.event;if(d&&!d.restrictions.skip){const m=e.findItemIndex(h);if(d.appendInPlace){const g=h.playout.start+h.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(d,m,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!oe(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ye(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),c="Primary";else if(u){const g=this.getBufferingPlayer();g?(i=g.transferMedia(),c=`${g}`):c="detached MediaSource"}else c="detached media";if(!i){if(u)i=this.detachedData,this.log(`using detachedData: MediaSource ${Ye(i)}`);else if(!this.detachedData||o.media===t){const g=this.playerQueue;g.length>1&&g.forEach(y=>{if(a&&y.interstitial.appendInPlace!==l){const v=y.interstitial;this.clearInterstitial(y.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",d=h&&i?i:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const m=this.schedule;if(d===i&&m){const g=a&&e.assetId===m.assetIdAtEnd;d.overrides={duration:m.duration,endOfStream:!a||g,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Dc("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=Cm(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,r){const s=Cm(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Dc("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const o=r.findEventIndex(s),a=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&rr(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const c=o.event,h=this.playingAsset,d=h==null?void 0:h.identifier,m=d?this.getAssetPlayer(d):null;if(m&&d&&(!this.eventItemsMatch(o,i)||t!==void 0&&d!==c.assetList[t].identifier)){var l;const g=c.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${c.assetList.length} ${Uo(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(_.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:g,event:c,schedule:s.slice(0),scheduleIndex:e,player:m}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(d,i),m.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${rr(o)}`),c.hasPlayed=!0,this.hls.trigger(_.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const g=(u=this.schedule)==null?void 0:u.items;if(i&&g){const y=this.findItemIndex(i);this.advanceSchedule(y,g,t,o,a)}return}}this.advanceSchedule(e,s,t,o,a)}advanceSchedule(e,t,r,s,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const h=c.interstitial,d=o.findEventIndex(h.identifier);(d<e||d>e+1)&&this.clearInterstitial(h,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const c=a.event;if(r===void 0){r=o.findAssetIndex(c,this.timelinePos);const g=Cm(c,r-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(c,e,r);return}r=g}const h=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let d=this.preloadAssets(c,r);if(this.eventItemsMatch(a,h||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${rr(a)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(_.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const m=c.assetList[r];if(!m){this.advanceAfterAssetEnded(c,e,r||0);return}if(d||(d=this.getAssetPlayer(m.identifier)),d===null||d.destroyed){const g=c.assetList.length;this.warn(`asset ${r+1}/${g} player destroyed ${c}`),d=this.createAssetPlayer(c,m,r),d.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(d,r,t,e,l),this.shouldPlay&&F_(d.media)}else a?(this.resumePrimary(a,e,s),this.shouldPlay&&F_(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${rr(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(Dc("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!r)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${rr(e)}`),this.hls.trigger(_.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ve.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Dc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(_.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(_.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=je(je({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=je(je({},this.altSelection),{},{audio:r});return}const i=je(je({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=je(je({},this.altSelection),{},{subtitles:r});return}const i=je(je({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=zS(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=zS(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const o=this.schedule.findEventIndex(i.identifier),a=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=ve.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${rr(e)} (was ${rr(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=ve.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(i),h=Math.min(c+1,t.length-1),d=t[h];if((l===-1&&i&&e>=i.end||(u=d.event)!=null&&u.appendInPlace&&e+.01>=d.start)&&(l=h),this.isInterstitial(i)){const m=i.event;if(h-a>1&&m.appendInPlace===!1||m.assetList.length===0&&m.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>a)this.bufferedToItem(d);else{const m=this.primaryDetails;this.primaryLive&&m&&e>m.edge-m.targetduration&&d.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(d)&&this.preloadAssets(d.event,0)}}else r&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${rr(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const u=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,h)=>{const d=this.getAssetPlayer(c.identifier);d&&(h===u&&d.loadSource(),d.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(_.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const d=this.playingItem;!this.isInterstitial(d)&&(d==null||(a=d.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const d=c-l;d>0&&(u=Math.round(d*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const h=this.assetListLoader.loadAssetList(e,u);h&&(e.assetListLoader=h)}else if(!o&&s){for(let u=t;u<s;u++){const c=e.assetList[u],h=this.getAssetPlayerQueueIndex(c.identifier);(h===-1||this.playerQueue[h].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,o){const a={parentIdentifier:e.identifier,identifier:r6(e,o,t),duration:i,startOffset:r,timelineStart:s,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(o||a)&&(o=ze({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const L=this.timelinePos-t.timelineStart;if(L>1){const D=t.duration;D&&L<D&&(c=L)}}const h=t.identifier,d=je(je({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:u||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const m=d.cmcd;m!=null&&m.sessionId&&m.contentId&&(d.cmcd=ze({},m,{contentId:Kl(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const g=new o6(this.HlsPlayerClass,d,e,t);this.playerQueue.push(g),e.assetList[r]=t;let y=!0;const v=L=>{if(L.live){var D;const x=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:ce.OTHER_ERROR,details:j.INTERSTITIAL_ASSET_ITEM_ERROR,error:x},b=((D=this.schedule)==null?void 0:D.findEventIndex(e.identifier))||-1;this.handleAssetItemError(R,e,b,r,x.message);return}const F=L.edge-L.fragmentStart,A=t.duration;(y||A===null||F>A)&&(y=!1,this.log(`Interstitial asset "${h}" duration change ${A} > ${F}`),t.duration=F,this.updateSchedule())};g.on(_.LEVEL_UPDATED,(L,{details:D})=>v(D)),g.on(_.LEVEL_PTS_UPDATED,(L,{details:D})=>v(D)),g.on(_.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const E=(L,D)=>{const F=this.getAssetPlayer(h);if(F&&D.tracks){F.off(_.BUFFER_CODECS,E),F.tracks=D.tracks;const A=this.primaryMedia;this.bufferingAsset===F.assetItem&&A&&!F.media&&this.bufferAssetPlayer(F,A)}};g.on(_.BUFFER_CODECS,E);const p=()=>{var L;const D=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${D}`),!D||!this.schedule)return;const F=this.schedule.findEventIndex(e.identifier),A=(L=this.schedule.items)==null?void 0:L[F];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};g.on(_.BUFFERED_TO_END,p);const S=L=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const F=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,F,L)};return g.once(_.MEDIA_ENDED,S(r)),g.once(_.PLAYOUT_LIMIT_REACHED,S(1/0)),g.on(_.ERROR,(L,D)=>{if(!this.schedule)return;const F=this.getAssetPlayer(h);if(D.details===j.BUFFER_STALLED_ERROR){if(F!=null&&F.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${D.error} ${e}`)}),g.on(_.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const D=new Error(`Asset player destroyed unexpectedly ${h}`),F={fatal:!0,type:ce.OTHER_ERROR,details:j.INTERSTITIAL_ASSET_ITEM_ERROR,error:D};this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),r,D.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Uo(t)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&rr(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Uo(a)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const u=this.getBufferingPlayer();if(u===e)return;const c=i.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const h=(u==null?void 0:u.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!ib(h,e.tracks)){const d=new Error(`Asset ${Uo(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),m={fatal:!0,type:ce.OTHER_ERROR,details:j.INTERSTITIAL_ASSET_ITEM_ERROR,error:d},g=i.findAssetIndex(o);this.handleAssetItemError(m,i,a,g,d.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||s-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${s})`),l&&(u/r.playbackRate<.5||a.bufferedInPlaceToEnd(r))&&a.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===j.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Uo(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,c=this.schedule.items,h=ze({},e,{fatal:!1,errorAction:ha(!0),asset:o,assetListIndex:s,event:t,schedule:c,scheduleIndex:r,player:u});if(this.hls.trigger(_.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const d=this.playingAsset,m=this.bufferingAsset,g=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=g),!t.assetList.some(y=>!y.error))t.error=g;else for(let y=s;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===a?this.advanceAfterAssetEnded(t,r,s):m&&m.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,m)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${rr(r)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(r,s);this.itemsMatch(r,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,s;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(o)))return;const l=i.timelineStart,u=i.duration;let c=0;a.forEach((y,v)=>{const E=parseFloat(y.DURATION);this.createAsset(i,v,c,l+c,E,y.URI),c+=E}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${i}`);const h=this.waitingItem,d=(h==null?void 0:h.event.identifier)===o;this.updateSchedule();const m=(s=this.bufferingItem)==null?void 0:s.event;if(d){var g;const y=this.schedule.findEventIndex(o),v=(g=this.schedule.items)==null?void 0:g[y];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){i.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(y)}else if((m==null?void 0:m.identifier)===o){const y=i.assetList[0];if(y){const v=this.getAssetPlayer(y.identifier);if(m.appendInPlace){const E=this.primaryMedia;v&&E&&this.bufferAssetPlayer(v,E)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case j.ASSET_LIST_PARSING_ERROR:case j.ASSET_LIST_LOAD_ERROR:case j.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case j.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const U_=500;class c6 extends ky{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",le.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=q.IDLE,this.setInterval(U_),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(Et(r)&&(this.fragPrevious=r),this.state=q.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=r.start;for(let u=0;u<i.length;u++)if(a>=i[u].start&&a<=i[u].end){o=i[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,i,le.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===le.SUBTITLE&&(t.details===j.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==q.STOPPED&&(this.state=q.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&lL(this.levels,t)){this.levels=t.map(r=>new _u(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new _u(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,le.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==q.STOPPED&&this.setInterval(U_)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const d=h.fragments[0];if(!l.details)o.hasProgramDateTime&&h.hasProgramDateTime?(vd(o,h),u=o.fragmentStart):d&&(u=d.start,_p(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&d&&(u=d.start,_p(o,u))}h&&!this.startFragRequested&&this.setStartPosition(h,u)}l.details=o,this.levelLastLoaded=l,a===s&&(this.hls.trigger(_.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===q.IDLE&&(po(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&da(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,Ly(s.method)).catch(a=>{throw i.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(_.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=q.IDLE})}}doTick(){if(!this.media){this.state=q.IDLE;return}if(this.state===q.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),o=ve.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const h=u.fragments,d=h.length,m=u.edge;let g=null;const y=this.fragPrevious;if(a<m){const p=s.maxFragLookUpTolerance,S=a>m-p?0:p;g=po(y,h,Math.max(h[0].start,a),S),!g&&y&&y.start<h[0].start&&(g=h[0])}else g=h[d-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const v=g.sn-u.startSN,E=h[v-1];if(E&&E.cc===g.cc&&this.fragmentTracker.getState(E)===Lt.NOT_LOADED&&(g=E),this.fragmentTracker.getState(g)===Lt.NOT_LOADED){const p=this.mapToInitFragWhenRequired(g);p&&this.loadFragment(p,r,a)}}}loadFragment(e,t,r){Et(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new h6(this.tracksBuffered[this.currentTrackId]||[])}}class h6{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const d6={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},IL=n=>String.fromCharCode(d6[n]||n),ir=15,ts=100,f6={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m6={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g6={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p6={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y6=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class v6{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Ge.log(`${this.time} [${e}] ${r}`)}}}const Vi=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class AL{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class E6{constructor(){this.uchar=" ",this.penState=new AL}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class T6{constructor(e){this.chars=[],this.pos=0,this.currPenState=new AL,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ts;t++)this.chars.push(new E6);this.logger=e}equals(e){for(let t=0;t<ts;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ts;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ts;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ts&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ts)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=IL(e);if(this.pos>=ts){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ts;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<ts;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class km{constructor(e){this.rows=[],this.currRow=ir-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ir;t++)this.rows.push(new T6(e));this.logger=e}reset(){for(let e=0;e<ir;e++)this.rows[e].clear();this.currRow=ir-1}equals(e){let t=!0;for(let r=0;r<ir;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<ir;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ir;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ye(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<ir;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[i+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ye(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<ir;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class B_{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new km(r),this.nonDisplayedMemory=new km(r),this.lastOutputScreen=new km(r),this.currRollUpRow=this.displayedMemory.rows[ir-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ir-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+Ye(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class $_{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=_6(),this.logger=void 0;const s=this.logger=new v6;this.channels=[null,new B_(e,t,s),new B_(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Vi([t[r],t[r+1]])+"] -> ("+Vi([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(S6(s,i,l)){Nc(null,null,l),this.logger.log(3,()=>"Repeated command ("+Vi([s,i])+") is dropped");continue}Nc(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else Nc(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Vi([s,i])+" orig: "+Vi([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Vi([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?f6[e]:g6[e]:r=o===1?m6[e]:p6[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+IL(o)+"' in channel "+r),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Vi(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=y6[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Nc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Nc(n,e,t){t.a=n,t.b=e}function S6(n,e,t){return t.a===n&&t.b===e}function _6(){return{a:null,b:null}}var Gy=function(){if(yd!=null&&yd.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function s(a){return t(e,a)}function i(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const h in c)a[h]=c[h]}return a}function o(a,l,u){const c=this,h={enumerable:!0};c.hasBeenReset=!1;let d="",m=!1,g=a,y=l,v=u,E=null,p="",S=!0,L="auto",D="start",F=50,A="middle",x=50,R="middle";Object.defineProperty(c,"id",i({},h,{get:function(){return d},set:function(b){d=""+b}})),Object.defineProperty(c,"pauseOnExit",i({},h,{get:function(){return m},set:function(b){m=!!b}})),Object.defineProperty(c,"startTime",i({},h,{get:function(){return g},set:function(b){if(typeof b!="number")throw new TypeError("Start time must be set to a number.");g=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},h,{get:function(){return y},set:function(b){if(typeof b!="number")throw new TypeError("End time must be set to a number.");y=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},h,{get:function(){return v},set:function(b){v=""+b,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},h,{get:function(){return E},set:function(b){E=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},h,{get:function(){return p},set:function(b){const C=r(b);if(C===!1)throw new SyntaxError("An invalid or illegal string was specified.");p=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},h,{get:function(){return S},set:function(b){S=!!b,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},h,{get:function(){return L},set:function(b){if(typeof b!="number"&&b!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},h,{get:function(){return D},set:function(b){const C=s(b);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");D=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},h,{get:function(){return F},set:function(b){if(b<0||b>100)throw new Error("Position must be between 0 and 100.");F=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},h,{get:function(){return A},set:function(b){const C=s(b);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");A=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},h,{get:function(){return x},set:function(b){if(b<0||b>100)throw new Error("Size must be between 0 and 100.");x=b,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},h,{get:function(){return R},set:function(b){const C=s(b);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");R=C,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class x6{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function wL(n){function e(r,s,i,o){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class I6{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function RL(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const Cp=new Gy(0,0,""),Oc=Cp.align==="middle"?"middle":"center";function A6(n,e,t){const r=n;function s(){const a=wL(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const u=new I6;RL(a,function(d,m){let g;switch(d){case"region":for(let y=t.length-1;y>=0;y--)if(t[y].id===m){u.set(d,t[y].region);break}break;case"vertical":u.alt(d,m,["rl","lr"]);break;case"line":g=m.split(","),u.integer(d,g[0]),u.percent(d,g[0])&&u.set("snapToLines",!1),u.alt(d,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",Oc,"end"]);break;case"position":g=m.split(","),u.percent(d,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",Oc,"end","line-left","line-right","auto"]);break;case"size":u.percent(d,m);break;case"align":u.alt(d,m,["start",Oc,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&Cp.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Oc);let h=u.get("position","auto");h==="auto"&&Cp.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=s(),o(),i(n,e)}function bL(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class w6{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new x6,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,o=0;for(i=bL(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){RL(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Gy(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{A6(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const R6=/\r\n|\n\r|\n|\r/g,Pm=function(e,t,r=0){return e.slice(r,r+t.length)===t},b6=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!oe(t)||!oe(r)||!oe(s)||!oe(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t};function Ky(n,e,t){return Kl(n.toString())+Kl(e.toString())+Kl(t)}const L6=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function C6(n,e,t,r,s,i,o){const a=new w6,l=Mn(new Uint8Array(n)).trim().replace(R6,`
`).split(`
`),u=[],c=e?M3(e.baseTime,e.timescale):0;let h="00:00.000",d=0,m=0,g,y=!0;a.oncue=function(v){const E=t[r];let p=t.ccOffset;const S=(d-c)/9e4;if(E!=null&&E.new&&(m!==void 0?p=t.ccOffset=E.start:L6(t,r,S)),S){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}p=S-t.presentationOffset}const L=v.endTime-v.startTime,D=kn((v.startTime+p-m)*9e4,s*9e4)/9e4;v.startTime=Math.max(D,0),v.endTime=Math.max(D+L,0);const F=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(F)),v.id||(v.id=Ky(v.startTime,v.endTime,F)),v.endTime>0&&u.push(v)},a.onparsingerror=function(v){g=v},a.onflush=function(){if(g){o(g);return}i(u)},l.forEach(v=>{if(y)if(Pm(v,"X-TIMESTAMP-MAP=")){y=!1,v.slice(16).split(",").forEach(E=>{Pm(E,"LOCAL:")?h=E.slice(6):Pm(E,"MPEGTS:")&&(d=parseInt(E.slice(7)))});try{m=b6(h)/1e3}catch(E){g=E}return}else v===""&&(y=!1);a.parse(v+`
`)}),a.flush()}const Dm="stpp.ttml.im1t",LL=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,CL=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,k6={left:"start",center:"center",right:"end",start:"start",end:"end"};function V_(n,e,t,r){const s=Ie(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>Mn(a)),o=O3(e.baseTime,1,e.timescale);try{i.forEach(a=>t(P6(a,o)))}catch(a){r(a)}}function P6(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((h,d)=>(h[d]=s.getAttribute(`ttp:${d}`)||i[d],h),{}),a=s.getAttribute("xml:space")!=="preserve",l=j_(Nm(s,"styling","style")),u=j_(Nm(s,"layout","region")),c=Nm(s,"body","[begin]");return[].map.call(c,h=>{const d=kL(h,a);if(!d||!h.hasAttribute("begin"))return null;const m=Mm(h.getAttribute("begin"),o),g=Mm(h.getAttribute("dur"),o);let y=Mm(h.getAttribute("end"),o);if(m===null)throw G_(h);if(y===null){if(g===null)throw G_(h);y=m+g}const v=new Gy(m-e,y-e,d);v.id=Ky(v.startTime,v.endTime,v.text);const E=u[h.getAttribute("region")],p=l[h.getAttribute("style")],S=D6(E,p,l),{textAlign:L}=S;if(L){const D=k6[L];D&&(v.lineAlign=D),v.align=L}return ze(v,S),v}).filter(h=>h!==null)}function Nm(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function j_(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function kL(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?kL(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function D6(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const u=Om(e,r,l)||Om(n,r,l)||Om(s,r,l);return u&&(a[l]=u),a},{})}function Om(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function G_(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Mm(n,e){if(!n)return null;let t=wL(n);return t===null&&(LL.test(n)?t=N6(n,e):CL.test(n)&&(t=O6(n,e))),t}function N6(n,e){const t=LL.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function O6(n,e){const t=CL.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Mc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class M6{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=H_(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Mc(this,"textTrack1"),t=new Mc(this,"textTrack2"),r=new Mc(this,"textTrack3"),s=new Mc(this,"textTrack4");this.cea608Parser1=new $_(1,e,t),this.cea608Parser2=new $_(3,r,s)}addCues(e,t,r,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],u=F6(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||i.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,s)}else{const a=this.Cues.newCue(null,t,r,s);this.hls.trigger(_.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;r===le.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(_.FRAG_LOADED,l):this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(K_(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)r[e]=a,Xo(r[e]),SL(r[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Xo(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=H_(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Xo(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===Dm);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(lL(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?fh(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let h=null;for(let d=0;d<a.length;d++)if(a[d]&&K_(a[d],l)){h=a[d],a[d]=null;break}h&&(c=h)}if(c)Xo(c);else{const h=PL(l);c=this.createTextTrack(h,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===le.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===le.SUBTITLE)if(s.byteLength){const i=r.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Dm?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;V_(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?Xn(r.initSegment.data,new Uint8Array(s)).buffer:s;C6(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const h=c.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(r,s),l.logger.log(`Failed to parse VTT cue: ${c}`),!(h&&a>r.cc)&&l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||V_(t,this.initPTS[e.cc],()=>{r.textCodec=Dm,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>_L(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(_.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===le.SUBTITLE&&this.onFragLoaded(_.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===le.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,a[0]),this.cea608Parser2.addData(s[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Lp(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Lp(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function PL(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function K_(n,e){return!!n&&n.kind===PL(e)&&Ap(e,n)}function F6(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function H_(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const U6=/\s/,B6={newCue(n,e,t,r){const s=[];let i,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let d=0;d<r.rows.length;d++)if(i=r.rows[d],a=!0,l=0,u="",!i.isEmpty()){var h;for(let y=0;y<i.chars.length;y++)U6.test(i.chars[y].uchar)&&a?l++:(u+=i.chars[y].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=bL(u.trim()),g=Ky(e,t,m);n!=null&&(h=n.cues)!=null&&h.getCueById(g)||(o=new c(e,t,m),o.id=g,o.line=d+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return n&&s.length&&(s.sort((d,m)=>d.line==="auto"||m.line==="auto"?0:d.line>8&&m.line>8?m.line-d.line:d.line-m.line),s.forEach(d=>_L(n,d))),s}};function $6(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const V6=/(\d+)-(\d+)\/(\d+)/;class z_{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||H6,this.controller=new self.AbortController,this.stats=new _y}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=j6(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&oe(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Au(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var d;this.response=this.loader=h;const m=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(m-s.loading.start)),!h.ok){const{status:y,statusText:v}=h;throw new z6(v||"fetch, bad network response",y,h)}s.loading.first=m,s.total=K6(h.headers)||s.total;const g=(d=this.callbacks)==null?void 0:d.onProgress;return g&&oe(t.highWaterMark)?this.loadProgressively(h,s,e,t.highWaterMark,g):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var d,m;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const y=h[a];y&&(s.loaded=s.total=y);const v={url:g.url,data:h,code:g.status},E=(d=this.callbacks)==null?void 0:d.onProgress;E&&!oe(t.highWaterMark)&&E(s,e,h,g),(m=this.callbacks)==null||m.onSuccess(v,s,e,g)}).catch(h=>{var d;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const m=h&&h.code||0,g=h?h.message:null;(d=this.callbacks)==null||d.onError({code:m,text:g},e,h?h.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const o=new jb,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&i(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,h=c.length;return t.loaded+=h,h<s||o.dataLength?(o.push(c),o.dataLength>=s&&i(t,r,o.flush().buffer,e)):i(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function j6(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ze({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function G6(n){const e=V6.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function K6(n){const e=n.get("Content-Range");if(e){const r=G6(e);if(oe(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function H6(n,e){return new self.Request(n.url,e)}class z6 extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const W6=/^age:\s*[\d.]+\s*$/im;class DL{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new _y,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:r.status,text:o.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=r.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&oe(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var o,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const y=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=y,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const v=(o=this.callbacks)==null?void 0:o.onProgress;v&&v(r,e,g,t);const E={url:t.responseURL,data:g,code:u};(a=this.callbacks)==null||a.onSuccess(E,r,e,t);return}}const h=i.loadPolicy.errorRetry,d=r.retry,m={url:e.url,data:void 0,code:u};if(gd(h,d,!1,m))this.retry(h);else{var l;Ge.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(gd(e,t,!0))this.retry(e);else{var r;Ge.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=wy(e,r.retry),r.retry++,Ge.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&W6.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const q6={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Y6=je(je({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:DL,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:aV,bufferController:X3,capLevelController:$y,errorController:dV,fpsController:J4,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:kb,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:q6},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Q6()),{},{subtitleStreamController:c6,subtitleTrackController:t6,timelineController:M6,audioStreamController:W3,audioTrackController:q3,emeController:fa,cmcdController:q4,contentSteeringController:Q4,interstitialsController:u6});function Q6(){return{cueHandler:B6,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function X6(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=kp(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];i.forEach(c=>{const h=`${o}Loading${c}`,d=e[h];if(d!==void 0&&l){u.push(h);const m=r[a].default;switch(e[a]={default:m},c){case"TimeOut":m.maxLoadTimeMs=d,m.maxTimeToFirstByteMs=d;break;case"MaxRetry":m.errorRetry.maxNumRetry=d,m.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":m.errorRetry.retryDelayMs=d,m.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":m.errorRetry.maxRetryDelayMs=d,m.timeoutRetry.maxRetryDelayMs=d;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${Ye(e[a])}`)}),je(je({},r),e)}function kp(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(kp):Object.keys(n).reduce((e,t)=>(e[t]=kp(n[t]),e),{}):n}function J6(n,e){const t=n.loader;t!==z_&&t!==DL?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):$6()&&(n.loader=z_,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const mh=2,Z6=.1,e5=.05,t5=100;class n5 extends wb{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(t5),this.mediaSource=t.mediaSource;const r=this.media=t.media;cn(r,"playing",this.onMediaPlaying),cn(r,"waiting",this.onMediaWaiting),cn(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Tn(r,"playing",this.onMediaPlaying),Tn(r,"waiting",this.onMediaWaiting),Tn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,c=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1}));return}if(!ve.getBuffered(o).length){this.nudgeRetry=0;return}const h=ve.bufferInfo(o,e,0),d=h.nextStart||0,m=this.fragmentTracker;if(a&&m&&this.hls){const F=W_(this.hls.inFlightFragments,e),A=h.len>mh,x=!d||F||d-e>mh&&!m.getPartialFragment(e);if(A||x)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(h.len>0)&&!d)return;const A=Math.max(d,h.start||0)-e,R=!!(g!=null&&g.live)?g.targetduration*2:mh,b=Fc(e,m);if(A>0&&(A<=R||b)){o.paused||this._trySkipBufferHole(b);return}}const y=i.detectStallWithCurrentTimeMs,v=self.performance.now(),E=this.waiting;let p=this.stalled;if(p===null)if(E>0&&v-E<y)p=this.stalled=E;else{this.stalled=v;return}const S=v-p;if(!a&&(S>=y||E)&&this.hls){var L;if(((L=this.mediaSource)==null?void 0:L.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const D=ve.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(D,S,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(_.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=ve.bufferedInfo(ve.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=ve.timeRangesToArray(s),a=ve.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=ve.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,c=o[a+1].start;if((l===-1||l>a)&&c-u<1&&e-u<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let d=Fc(e,this.fragmentTracker);d&&"fragment"in d?d=d.fragment:d||(d=void 0);const m=ve.bufferInfo(this.media,e,0);this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:d,buffer:m.len,bufferInfo:m})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:o,media:a}=this,l=(s=this.hls)==null?void 0:s.config;if(!a||!o||!l)return;const u=(i=this.hls)==null?void 0:i.latestLevelDetails,c=Fc(r,o);if((c||u!=null&&u.live&&r<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const h=e.buffered,d=this.adjacentTraversal(e,r);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||d))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,le.MAIN),o=r.getFragAtPos(s,le.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Ye(e)})`);this.warn(o.message),t.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const o=s.currentTime,a=ve.bufferInfo(s,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const c=a.len<=i.maxBufferHole,h=a.len>0&&a.len<1&&s.readyState<3,d=l-o;if(d>0&&(c||h)){if(d>i.maxBufferHole){let g=!1;if(o===0){const y=r.getAppendedFrag(0,le.MAIN);y&&l<y.end&&(g=!0)}if(!g&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||W_(this.hls.inFlightFragments,l))return 0;let v=!1,E=e.end;for(;E<l;){const p=Fc(E,r);if(p)E+=p.duration;else{v=!0;break}}if(v)return 0}}const m=Math.max(l+e5,o+Z6);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${m}`),this.moved=!0,s.currentTime=m,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${m}`),y={type:ce.MEDIA_ERROR,details:j.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(_.ERROR,y)}return m}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const o=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const a=o+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),r.currentTime=a,t.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function W_(n,e){const t=q_(n.main);if(t&&t.start<=e)return t;const r=q_(n.audio);return r&&r.start<=e?r:null}function q_(n){if(!n)return null;switch(n.state){case q.IDLE:case q.STOPPED:case q.ENDED:case q.ERROR:return null}return n.frag}function Fc(n,e){return e.getAppendedFrag(n,le.MAIN)||e.getPartialFragment(n)}const r5=.25;function Pp(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Fm(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,Ye(s?je({type:s},r):r))}return i}const Uc=(()=>{const n=Pp();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class s5{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(_.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Xo(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return SL(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Pp();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Dn.emsg&&!r||!s)continue;const u=Yb(i[a].data),c=i[a].pts;let h=c+i[a].duration;h>Uc&&(h=Uc),h-c<=0&&(h=c+r5);for(let m=0;m<u.length;m++){const g=u[m];if(!Qb(g)){this.updateId3CueEnds(c,l);const y=Fm(o,c,h,g,l);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===Uc&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let u;s==="audio"?u=c=>c.type===Dn.audioId3&&l:s==="video"?u=c=>c.type===Dn.emsg&&a:u=c=>c.type===Dn.audioId3&&l||c.type===Dn.emsg&&a,Lp(i,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=Pp();if(r&&s&&!o){const{fragmentStart:y,fragmentEnd:v}=e;let E=this.assetCue;E?(E.startTime=y,E.endTime=v):a&&(E=this.assetCue=Fm(a,y,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),E&&(E.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(E),E.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let h=this.dateRangeCuesAppended;if(l&&t){var d;if((d=l.cues)!=null&&d.length){const y=Object.keys(h).filter(v=>!c.includes(v));for(let v=y.length;v--;){var m;const E=y[v],p=(m=h[E])==null?void 0:m.cues;delete h[E],p&&Object.keys(p).forEach(S=>{const L=p[S];if(L){L.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(L)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(c.length===0||!oe(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<c.length;y++){const v=c[y],E=u[v],p=E.startTime,S=h[v],L=(S==null?void 0:S.cues)||{};let D=(S==null?void 0:S.durationKnown)||!1,F=Uc;const{duration:A,endDate:x}=E;if(x&&A!==null)F=p+A,D=!0;else if(E.endOnNext&&!D){const b=c.reduce((C,M)=>{if(M!==E.id){const k=u[M];if(k.class===E.class&&k.startDate>E.startDate&&(!C||E.startDate<C.startDate))return k}return C},null);b&&(F=b.startTime,D=!0)}const R=Object.keys(E.attr);for(let b=0;b<R.length;b++){const C=R[b];if(!AV(C))continue;const M=L[C];if(M)D&&!(S!=null&&S.durationKnown)?M.endTime=F:Math.abs(M.startTime-p)>.01&&(M.startTime=p,M.endTime=F);else if(a){let k=E.attr[C];wV(C)&&(k=ob(k));const te=Fm(a,p,F,{key:C,data:k},Dn.dateRange);te&&(te.id=v,this.id3Track.addCue(te),L[C]=te,o&&(C==="X-ASSET-LIST"||C==="X-ASSET-URL")&&te.addEventListener("enter",this.onEventCueEnter))}}h[v]={cues:L,dateRange:E,durationKnown:D}}}}}class i5{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!r.live)return;const a=this.targetLatency;if(a===null)return;const l=s-a,u=Math.min(this.maxLatency,a+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),d=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,m=Math.min(h,Math.max(1,d));this.changeMediaPlaybackRate(t,m)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:o*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,o=s-r.totalduration,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===j.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class o5 extends By{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{const h=c.attrs;let{audioCodec:d,videoCodec:m}=c;d&&(c.audioCodec=d=hd(d,r)||void 0),m&&(m=c.videoCodec=j$(m));const{width:g,height:y,unknownCodecs:v}=c,E=(v==null?void 0:v.length)||0;if(a||(a=!!(g&&y)),l||(l=!!m),u||(u=!!d),E||d&&!this.isAudioSupported(d)||m&&!this.isVideoSupported(m)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:p,"FRAME-RATE":S,"HDCP-LEVEL":L,"PATHWAY-ID":D,RESOLUTION:F,"VIDEO-RANGE":A}=h,R=`${`${D||"."}-`}${c.bitrate}-${F}-${S}-${p}-${A}-${L}`;if(i[R])if(i[R].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const b=o[R]+=1;c.attrs["PATHWAY-ID"]=new Array(b+1).join(".");const C=this.createLevel(c);i[R]=C,s.push(C)}else i[R].addGroupId("audio",h.AUDIO),i[R].addGroupId("text",h.SUBTITLES);else{const b=this.createLevel(c);i[R]=b,o[R]=1,s.push(b)}}),this.filterAndSortMediaOptions(s,t,a,l,u)}createLevel(e){const t=new _u(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=vb(s,[])}return t}isAudioSupported(e){return Tu(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Tu(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var o;let a=[],l=[],u=e;const c=((o=t.stats)==null?void 0:o.parsing)||{};if((r||s)&&i&&(u=u.filter(({videoCodec:p,videoRange:S,width:L,height:D})=>(!!p||!!(L&&D))&&J$(S))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let p="no level with compatible codecs found in manifest",S=p;t.levels.length&&(S=`one or more CODECS in variant not supported: ${Ye(t.levels.map(D=>D.attrs.CODECS).filter((D,F,A)=>A.indexOf(D)===F))}`,this.warn(S),p+=` (${S})`);const L=new Error(p);this.hls.trigger(_.ERROR,{type:ce.MEDIA_ERROR,details:j.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:L,reason:S})}}),c.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(p=>!p.audioCodec||this.isAudioSupported(p.audioCodec)),Y_(a)),t.subtitles&&(l=t.subtitles,Y_(l));const h=u.slice(0);u.sort((p,S)=>{if(p.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&p.height!==S.height)return p.height-S.height;if(p.frameRate!==S.frameRate)return p.frameRate-S.frameRate;if(p.videoRange!==S.videoRange)return dd.indexOf(p.videoRange)-dd.indexOf(S.videoRange);if(p.videoCodec!==S.videoCodec){const L=$S(p.videoCodec),D=$S(S.videoCodec);if(L!==D)return D-L}if(p.uri===S.uri&&p.codecSet!==S.codecSet){const L=cd(p.codecSet),D=cd(S.codecSet);if(L!==D)return D-L}return p.averageBitrate!==S.averageBitrate?p.averageBitrate-S.averageBitrate:0});let d=h[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==h.length)){for(let p=0;p<h.length;p++)if(h[p].pathwayId===u[0].pathwayId){d=h[p];break}}this._levels=u;for(let p=0;p<u.length;p++)if(u[p]===d){var m;this._firstLevel=p;const S=d.bitrate,L=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${S}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const D=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);D>L&&L===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=D)}break}const g=i&&!s,y=this.hls.config,v=!!(y.audioStreamController&&y.audioTrackController),E={levels:u,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:v&&!g&&a.some(p=>!!p.url)};c.end=performance.now(),this.hls.trigger(_.MANIFEST_PARSED,E)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:c,reason:c.message}),h)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(_.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Re.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===le.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(_.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));Bb(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(_.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(_.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Y_(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function NL(){return self.SourceBuffer||self.WebKitSourceBuffer}function OL(){if(!Ii())return!1;const e=NL();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function a5(){if(!OL())return!1;const n=Ii();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Su(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Su(e,"audio"))))}function l5(){var n;const e=NL();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const u5=100;class c5 extends ky{constructor(e,t,r){super(e,t,r,"stream-controller",le.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!oe(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,le.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(u5),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=q.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=q.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case q.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=q.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=q.IDLE;break}break}case q.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===q.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const o=r[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(_.BUFFER_EOS,y),this.state=q.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=o.details;if(!u||this.state===q.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=q.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(c>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let m=this.getNextFragment(d,u);if(this.couldBacktrack&&!this.fragPrevious&&m&&Et(m)&&this.fragmentTracker.getState(m)!==Lt.OK){var g;const v=((g=this.backtrackFragment)!=null?g:m).sn-u.startSN,E=u.fragments[v-1];E&&m.cc===E.cc&&(m=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,d)){if(!m.gap){const v=this.audioOnly&&!this.altAudio?qe.AUDIO:qe.VIDEO,E=(v===qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,v,le.MAIN)}m=this.getNextFragmentLoopLoading(m,u,a,le.MAIN,h)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,d))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===Lt.NOT_LOADED||s===Lt.PARTIAL?Et(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,le.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case q.KEY_LOADING:case q.FRAG_LOADING:case q.FRAG_LOADING_WAITING_RETRY:case q.PARSING:case q.PARSED:this.state=q.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;cn(r,"playing",this.onMediaPlaying),cn(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Tn(r,"playing",this.onMediaPlaying),Tn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!l5(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==q.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=q.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===q.FRAG_LOADING||this.state===q.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let h=0;if(a.live||(r=u.details)!=null&&r.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,u.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(u.details=a,this.levelLastLoaded=u,i||this.setStartPosition(a,h),this.hls.trigger(_.LEVEL_UPDATED,{details:a,level:o}),this.state===q.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=q.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&r.duration>s&&(i<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||i<a-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const h=ve.bufferInfo(r,s,0);if(!((u=h.buffered)!=null&&u.length)){r.currentTime=s;return}if(h.start<=i){r.currentTime=s;return}const{nextStart:m}=ve.bufferedInfo(h.buffered,i,0);m&&(r.currentTime=m)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level];if(!a){this.warn(`Level ${r.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,h=(t=r.initSegment)==null?void 0:t.data,d=this._getAudioCodec(a),m=this.transmuxer=this.transmuxer||new aL(this.hls,le.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,y=g!==-1,v=new by(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,y),E=this.initPTS[r.cc];m.push(i,h,d,u,r,s,l.totalduration,c,v,E)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio!==0;if(fd(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(_.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(_.AUDIO_TRACK_SWITCHED,t)}),r.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(_.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=fd(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===le.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===q.PARSED&&(this.state=q.IDLE);return}const a=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Et(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const o=this.media;o&&(!this._hasEnoughToStart&&ve.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=q.ERROR;return}switch(t.details){case j.FRAG_GAP:case j.FRAG_PARSING_ERROR:case j.FRAG_DECRYPT_ERROR:case j.FRAG_LOAD_ERROR:case j.FRAG_LOAD_TIMEOUT:case j.KEY_LOAD_ERROR:case j.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(le.MAIN,t);break;case j.LEVEL_LOAD_ERROR:case j.LEVEL_LOAD_TIMEOUT:case j.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===q.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Re.LEVEL&&(this.state=q.IDLE);break;case j.BUFFER_ADD_CODEC_ERROR:case j.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case j.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case j.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=q.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==qe.AUDIO||!this.altAudio){const r=(t===qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,le.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),o=ve.getBuffered(e),a=o.length?o.start(0):0,l=a-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=q.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(_.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:u}=o,{video:c,text:h,id3:d,initSegment:m}=s,{details:g}=u,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=q.PARSING,m){const v=m.tracks;if(v){const L=a.initSegment||a;if(this.unhandledEncryptionError(m,a))return;this._bufferInitSegment(u,v,L,i),r.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:t,tracks:v})}const E=m.initPTS,p=m.timescale,S=this.initPTS[a.cc];if(oe(E)&&(!S||S.baseTime!==E||S.timescale!==p)){const L=m.trackId;this.initPTS[a.cc]={baseTime:E,timescale:p,trackId:L},r.trigger(_.INIT_PTS_FOUND,{frag:a,id:t,initPTS:E,timescale:p,trackId:L})}}if(c&&g){y&&c.type==="audiovideo"&&this.logMuxedErr(a);const v=g.fragments[a.sn-1-g.startSN],E=a.sn===g.startSN,p=!v||a.cc>v.cc;if(s.independent!==!1){const{startPTS:S,endPTS:L,startDTS:D,endDTS:F}=c;if(l)l.elementaryStreams[c.type]={startPTS:S,endPTS:L,startDTS:D,endDTS:F};else if(c.firstKeyFrame&&c.independent&&i.id===1&&!p&&(this.couldBacktrack=!0),c.dropped&&c.independent){const A=this.getMainFwdBufferInfo(),x=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,R=c.firstKeyFramePTS?c.firstKeyFramePTS:S;if(!E&&x<R-this.config.maxBufferHole&&!p){this.backtrack(a);return}else p&&(a.gap=!0);a.setElementaryStreamInfo(c.type,a.start,L,a.start,F,!0)}else E&&S-(g.appliedTimelineOffset||0)>mh&&(a.gap=!0);a.setElementaryStreamInfo(c.type,S,L,D,F),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,i,E||p)}else if(E||p)a.gap=!0;else{this.backtrack(a);return}}if(y){const{startPTS:v,endPTS:E,startDTS:p,endDTS:S}=y;l&&(l.elementaryStreams[qe.AUDIO]={startPTS:v,endPTS:E,startDTS:p,endDTS:S}),a.setElementaryStreamInfo(qe.AUDIO,v,E,p,S),this.bufferFragmentData(y,a,l,i)}if(g&&d!=null&&d.samples.length){const v={id:t,frag:a,details:g,samples:d.samples};r.trigger(_.FRAG_PARSING_METADATA,v)}if(g&&h){const v={id:t,frag:a,details:g,samples:h.samples};r.trigger(_.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${Et(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==q.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:o,audiovideo:a}=t;if(i){const u=e.audioCodec;let c=ah(i.codec,u);c==="mp4a"&&(c="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const d=i.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),i.levelCodec=c,i.id=le.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=le.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(_.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const h=t[u].initSegment;h!=null&&h.byteLength&&this.hls.trigger(_.BUFFER_APPENDING,{type:u,data:h,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,le.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=q.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ve.isBuffered(e,r)?t=this.getAppendedFrag(r):ve.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(_.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(_.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return oe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(oe(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?po(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class h5 extends Jn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=j.KEY_LOAD_ERROR,r,s,i){return new rs({type:ce.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!Et(e)||!Et(o)||e.sn<o.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=uh(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=Al(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,j.KEY_LOAD_ERROR,u))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,j.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=Um(i);let l=this.keyIdToKeyInfo[a];if((r=l)!=null&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:h}=c;return i.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${i.keyId?" keyId: "+Kt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,j.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=C$(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Kt(a)}`),gi.setKeyIdForUri(e.decryptdata.uri,a)):(a=gi.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Kt(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!Et(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(d,m,g,y)=>{const{frag:v,keyInfo:E}=g,p=Um(E.decryptdata);if(!v.decryptdata||E!==this.keyIdToKeyInfo[p])return a(this.createKeyLoadError(v,j.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));E.decryptdata.key=v.decryptdata.key=new Uint8Array(d.data),v.keyLoader=null,E.loader=null,o({frag:v,keyInfo:E})},onError:(d,m,g,y)=>{this.resetLoader(m),a(this.createKeyLoadError(t,j.KEY_LOAD_ERROR,new Error(`HTTP Error ${d.code} loading key ${d.text}`),g,je({url:l.url,data:void 0},d)))},onTimeout:(d,m,g)=>{this.resetLoader(m),a(this.createKeyLoadError(t,j.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(d,m,g)=>{this.resetLoader(m),a(this.createKeyLoadError(t,j.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};i.load(l,c,h)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const o=Um(r.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Um(n){if(n.keyFormat!==Ht.FAIRPLAY){const e=n.keyId;if(e)return Kt(e)}return n.uri}function Q_(n){const{type:e}=n;switch(e){case Re.AUDIO_TRACK:return le.AUDIO;case Re.SUBTITLE_TRACK:return le.SUBTITLE;default:return le.MAIN}}function Bm(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class d5{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Re.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:Re.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Re.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Re.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[Re.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[Re.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Re.MANIFEST?i=r.manifestLoadPolicy.default:i=ze({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),oe((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Re.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Re.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Re.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,h=u.targetduration;if(c&&h){const d=Math.max(c*3,h*.8)*1e3;i=ze({},i,{maxTimeToFirstByteMs:Math.min(d,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,h,d)=>{const m=this.getInternalLoader(h);this.resetInternalLoader(h.type);const g=u.data;c.parsing.start=performance.now(),Mr.isMediaPlaylist(g)||h.type!==Re.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,h,d||null,m):this.handleMasterPlaylist(u,c,h,d)},onError:(u,c,h,d)=>{this.handleNetworkError(c,h,!1,u,d)},onTimeout:(u,c,h)=>{this.handleNetworkError(c,h,!0,void 0,u)}};s.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,o=e.data,a=Bm(e,r),l=Mr.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:h,sessionKeys:d,startTimeOffset:m,variableList:g}=l;this.variableList=g,c.forEach(p=>{const{unknownCodecs:S}=p;if(S){const{preferManagedMediaSource:L}=this.hls.config;let{audioCodec:D,videoCodec:F}=p;for(let A=S.length;A--;){const x=S[A];Tu(x,"audio",L)?(p.audioCodec=D=D?`${D},${x}`:x,La.audio[D.substring(0,4)]=2,S.splice(A,1)):Tu(x,"video",L)&&(p.videoCodec=F=F?`${F},${x}`:x,La.video[F.substring(0,4)]=2,S.splice(A,1))}}});const{AUDIO:y=[],SUBTITLES:v,"CLOSED-CAPTIONS":E}=Mr.parseMasterPlaylistMedia(o,a,l);y.length&&!y.some(S=>!S.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new it({}),bitrate:0,url:""})),i.trigger(_.MANIFEST_LOADED,{levels:c,audioTracks:y,subtitles:v,captions:E,contentSteering:u,url:a,stats:t,networkDetails:s,sessionData:h,sessionKeys:d,startTimeOffset:m,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,s,i){const o=this.hls,{id:a,level:l,type:u}=r,c=Bm(e,r),h=oe(l)?l:oe(a)?a:0,d=Q_(r),m=Mr.parseLevelPlaylist(e.data,c,h,d,0,this.variableList);if(u===Re.MANIFEST){const g={attrs:new it({}),bitrate:0,details:m,name:"",url:c};m.requestScheduled=t.loading.start+Mb(m,0),o.trigger(_.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(_.ERROR,{type:ce.NETWORK_ERROR,details:j.MANIFEST_PARSING_ERROR,fatal:t.type===Re.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let o=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Re.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Re.AUDIO_TRACK||e.type===Re.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=j.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Re.MANIFEST:l=r?j.MANIFEST_LOAD_TIMEOUT:j.MANIFEST_LOAD_ERROR,u=!0;break;case Re.LEVEL:l=r?j.LEVEL_LOAD_TIMEOUT:j.LEVEL_LOAD_ERROR,u=!1;break;case Re.AUDIO_TRACK:l=r?j.AUDIO_TRACK_LOAD_TIMEOUT:j.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Re.SUBTITLE_TRACK:l=r?j.SUBTITLE_TRACK_LOAD_TIMEOUT:j.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const h={type:ce.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(s){const d=(t==null?void 0:t.url)||e.url;h.response=je({url:d,data:void 0},s)}this.hls.trigger(_.ERROR,h)}handlePlaylistLoaded(e,t,r,s,i,o){const a=this.hls,{type:l,level:u,levelOrTrack:c,id:h,groupId:d,deliveryDirectives:m}=s,g=Bm(t,s),y=Q_(s);let v=typeof s.level=="number"&&y===le.MAIN?u:void 0;const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(`${E} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(_.ERROR,{type:ce.NETWORK_ERROR,details:j.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:s,level:v,parent:y,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const p=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(_.ERROR,{type:ce.NETWORK_ERROR,details:j.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:p,reason:p.message,response:t,context:s,level:v,parent:y,networkDetails:i,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Re.MANIFEST:case Re.LEVEL:if(v){if(!c)v=0;else if(c!==a.levels[v]){const p=a.levels.indexOf(c);p>-1&&(v=p)}}a.trigger(_.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:v||0,id:h||0,stats:r,networkDetails:i,deliveryDirectives:m,withoutMultiVariant:l===Re.MANIFEST});break;case Re.AUDIO_TRACK:a.trigger(_.AUDIO_TRACK_LOADED,{details:e,track:c,id:h||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:m});break;case Re.SUBTITLE_TRACK:a.trigger(_.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:h||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:m});break}}}class Nr{static get version(){return xu}static isMSESupported(){return OL()}static isSupported(){return a5()}static getMediaSource(){return Ii()}static get Events(){return _}static get MetadataSchema(){return Dn}static get ErrorTypes(){return ce}static get ErrorDetails(){return j}static get DefaultConfig(){return Nr.defaultConfig?Nr.defaultConfig:Y6}static set DefaultConfig(e){Nr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Py,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=v$(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=X6(Nr.DefaultConfig,e,t);this.userConfig=e,r.progressive&&J6(r,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=r,u=new a(this),c=this.abrController=new s(this),h=new fV(this),d=r.interstitialsController,m=d?this.interstitialsController=new d(this,Nr):null,g=this.bufferController=new i(this,h),y=this.capLevelController=new o(this),v=new l(this),E=new d5(this),p=r.contentSteeringController,S=p?new p(this):null,L=this.levelController=new o5(this,S),D=new s5(this),F=new h5(this.config,this.logger),A=this.streamController=new c5(this,h,F),x=this.gapController=new n5(this,h);y.setStreamController(A),v.setStreamController(A);const R=[E,L,A];m&&R.splice(1,0,m),S&&R.splice(1,0,S),this.networkControllers=R;const b=[c,g,x,y,v,D,h];this.audioTrackController=this.createController(r.audioTrackController,R);const C=r.audioStreamController;C&&R.push(this.audioStreamController=new C(this,h,F)),this.subtitleTrackController=this.createController(r.subtitleTrackController,R);const M=r.subtitleStreamController;M&&R.push(this.subtititleStreamController=new M(this,h,F)),this.createController(r.timelineController,b),F.emeController=this.emeController=this.createController(r.emeController,b),this.cmcdController=this.createController(r.cmcdController,b),this.latencyController=this.createController(i5,b),this.coreComponents=b,R.push(u);const k=u.onErrorOut;typeof k=="function"&&this.on(_.ERROR,k,u),this.on(_.MANIFEST_LOADED,E.onManifestLoaded,E)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===_.ERROR;this.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(_.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(_.ERROR,{type:ce.OTHER_ERROR,details:j.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(_.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(_.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(_.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=Sy.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(_.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[le.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[le.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[le.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=n6()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){X$(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=Sb(t);return Eb(e,r,navigator.mediaCapabilities)}}Nr.defaultConfig=void 0;function Fn(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function Pr(n){const e=Fn(n).trim();return e?/^https?:\/\//i.test(e)?e:e.startsWith("//")?`https:${e}`:/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(e)?`https://${e}`:"":""}function ML(n){if(!n||typeof n!="string")return"";try{const e=new URL(n),t=e.hostname.toLowerCase();if(t.includes("youtube.com")){if(e.pathname.startsWith("/embed/"))return e.toString();if(e.pathname==="/watch"){const r=e.searchParams.get("v");return r?`https://www.youtube.com/embed/${r}`:""}}if(t==="youtu.be"){const r=e.pathname.replace("/","");return r?`https://www.youtube.com/embed/${r}`:""}return t.includes("ok.ru")||t.includes("dailymotion.com")||t.includes("rumble.com")||t.includes("vidhide")||t.includes("rubyvid")||t.includes("listeamed.net")||t.includes("vidguard")||t.includes("streamwish")||t.includes("filemoon")||t.includes("dood")||t.includes("mixdrop")||t.includes("streamtape")||t.includes("mp4upload")||t.includes("turbovidhls.com")||/^\/e\/[^/]+/i.test(e.pathname)||e.pathname.includes("/embed")||e.pathname.includes("videoembed")?e.toString():""}catch{return""}}function f5(n){const e=Fn(n);return/\.(m3u8|mp4|webm)(\?|$)/i.test(e)}function Dp(n,e=new Set,t=0){if(t>8||n==null)return e;if(typeof n=="string"){const r=Pr(n);return r&&e.add(r),e}return Array.isArray(n)?(n.forEach(r=>Dp(r,e,t+1)),e):(typeof n=="object"&&Object.entries(n).forEach(([r,s])=>{const i=r.toLowerCase();if(typeof s=="string"){const o=Pr(s);o&&(i.includes("url")||i.includes("src")||i.includes("file")||i.includes("embed")||i.includes("stream")||i.includes("video")||i.includes("link"))&&e.add(o)}Dp(s,e,t+1)}),e)}function m5(...n){const e=n.flat().filter(Boolean),t=new Set,r=[];return e.forEach(s=>{const i=Pr(s==null?void 0:s.url);!i||t.has(i)||(t.add(i),r.push({id:s.id||i,name:s.name||"Source",url:i}))}),r}function g5(n){return n.map(t=>t.url).find(t=>/\.(mp4|webm)(\?|$)/i.test(t))||""}function p5(n){const e=(n==null?void 0:n.data)||{},t=["sub","dub","raw"],r={sub:[],dub:[],raw:[]};return t.forEach(s=>{const i=Array.isArray(e==null?void 0:e[s])?e[s]:[];r[s]=i.map((o,a)=>{const l=Fn((o==null?void 0:o.serverName)||(o==null?void 0:o.server_name)||(o==null?void 0:o.serverId)||(o==null?void 0:o.server_id));return l?{id:l,name:Fn((o==null?void 0:o.serverName)||(o==null?void 0:o.server_name)||(o==null?void 0:o.name),`Server ${a+1}`)}:null}).filter(Boolean)}),r}function Sd(n){const e=Fn(n).trim().toLowerCase();return e?e.includes("ok.ru")||e==="ok.ru"||e.includes("okru")?1:e.includes("dailymotion")?2:e.includes("rumble")?3:e==="hd-2"?1:e==="hd-1"?2:e==="hd-3"?3:e.includes("vid")?6:e.includes("mega")?7:50:999}function X_(n){return!Array.isArray(n)||n.length===0?null:[...n].sort((e,t)=>Sd((e==null?void 0:e.name)||(e==null?void 0:e.id))-Sd((t==null?void 0:t.name)||(t==null?void 0:t.id)))[0]||null}function y5(n){var s;const t=(Array.isArray((s=n==null?void 0:n.data)==null?void 0:s.sources)?n.data.sources:[]).map((i,o)=>{const a=Pr(i==null?void 0:i.url);if(!a)return null;const l=Fn(i==null?void 0:i.quality);return{id:`source-${o}-${l||"stream"}`,name:l?`Source ${l}`:`Source ${o+1}`,url:a}}).filter(Boolean),r=Array.from(Dp(n)).map((i,o)=>({id:`auto-${o}`,name:`Auto ${o+1}`,url:i}));return m5(t,r)}function v5(n,e,t){var o,a;const r=Fn(e).trim();if(r)return r;const s=Number(t);if(Number.isFinite(s)&&s>0){const l=n.find(u=>Number(u==null?void 0:u.number)===s);if(l!=null&&l.episodeId)return l.episodeId}if(!Array.isArray(n)||n.length===0)return"";const i=[...n].filter(l=>l==null?void 0:l.episodeId).sort((l,u)=>Number((l==null?void 0:l.number)||0)-Number((u==null?void 0:u.number)||0))[0];return i!=null&&i.episodeId?Fn(i.episodeId):Fn(((o=n==null?void 0:n[0])==null?void 0:o.episodeId)||((a=n==null?void 0:n[n.length-1])==null?void 0:a.episodeId))}function Np(n,e=0){const t=Number(n==null?void 0:n.number),r=Fn(n==null?void 0:n.title).trim(),s=e+1,i=Number.isFinite(t)&&t>0?t:s;return r?/^episode\s*\d+/i.test(r)?r:`Episode ${i} - ${r}`:`Episode ${i}`}function E5(n=[]){return[...n].sort((e,t)=>{const r=Number(e==null?void 0:e.number),s=Number(t==null?void 0:t.number),i=Number.isFinite(r)&&r>0,o=Number.isFinite(s)&&s>0;return i&&o?r-s:i?-1:o?1:Np(e).localeCompare(Np(t),"id",{sensitivity:"base"})})}function T5(n,e){var r,s,i,o;const t=[(r=n==null?void 0:n.trailer)==null?void 0:r.embed_url,(s=n==null?void 0:n.trailer)==null?void 0:s.url,(i=e.find(a=>a.embedUrl))==null?void 0:i.embedUrl,(o=e.find(a=>a.url))==null?void 0:o.url];for(const a of t){const l=ML(a||"");if(l)return l}return""}function S5(n,e){const t=[n,"sub","dub","raw"],r=new Set,s=[];return t.forEach(i=>{const o=Fn(i).toLowerCase();!o||r.has(o)||!Array.isArray(e==null?void 0:e[o])||e[o].length===0||(r.add(o),s.push(o))}),s}function J_(){var Ka,Rs,xo,Io;const n=EA(),e=Pu(),t=qr(),{user:r,markEpisodeWatched:s,getRandomActiveAdEntry:i}=In(),o=n.animeId||"",a=n.source||os,l=a==="hianime"?os:a,u=new URLSearchParams(t.search),c=u.get("ep")||"",h=u.get("epid")||"",d=u.get("slug")||"",[m,g]=$.useState(!0),[y,v]=$.useState(""),[E,p]=$.useState({}),[S,L]=$.useState([]),[D,F]=$.useState([]),[A,x]=$.useState(""),[R,b]=$.useState(null),[C,M]=$.useState({sub:[],dub:[],raw:[]}),[k,re]=$.useState("sub"),[te,J]=$.useState(""),[W,U]=$.useState([]),[H,N]=$.useState(""),[B,O]=$.useState(""),[K,Q]=$.useState(!1),[Y,ee]=$.useState(!1),[de,Ae]=$.useState(!0),[_e,st]=$.useState(null),[Fe,on]=$.useState(null),An=$.useRef(""),wn=$.useRef(new Set),Ga=$.useRef(null),Ee=$.useRef(null),we=$.useMemo(()=>{var se;return!!((se=r==null?void 0:r.premium)!=null&&se.active)},[(Ka=r==null?void 0:r.premium)==null?void 0:Ka.active]),Tt=$.useMemo(()=>!we&&!Y,[we,Y]),Ne=(C==null?void 0:C[k])||[],$e=$.useMemo(()=>["sub","dub","raw"].filter(se=>Array.isArray(C==null?void 0:C[se])&&C[se].length>0),[C]);$.useEffect(()=>{ee(!1),Ae(!0),st(i())},[o,l,c,h,d,i]),$.useEffect(()=>{if(!Tt)return;const se=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=se}},[Tt]),$.useEffect(()=>{let se=!0;return(async()=>{try{g(!0),v("");const[He,Ue,dt]=await Promise.allSettled([un.getAnimeDetail(o,{source:l,slug:d}),un.getAnimeEpisodes(o,1,{source:l,slug:d}),un.getAnimeVideos(o,{source:l,slug:d})]);if(!se)return;const Ve=He.status==="fulfilled"?rb(He.value,"anime"):{},pt=Ue.status==="fulfilled"?sb(Ue.value):[],Xe=E5(pt),Bt=dt.status==="fulfilled"?jB(dt.value):[];p(Ve),F(Xe),L(Bt);const Oe=v5(Xe,h,c);if(!Oe){x(""),M({sub:[],dub:[],raw:[]}),U([]),v("Episode belum tersedia untuk donghua ini.");return}x(Oe);const Me=Xe.find(Pi=>(Pi==null?void 0:Pi.episodeId)===Oe)||null;if(b(Number(Me==null?void 0:Me.number)||null),on({animeId:(Ve==null?void 0:Ve.animeId)||o,episodeId:Oe,episodeNumber:Number(Me==null?void 0:Me.number)||null,title:(Ve==null?void 0:Ve.title)||o,episodeTitle:Fn(Me==null?void 0:Me.title),poster:(Ve==null?void 0:Ve.poster)||"",source:l||os,slug:d}),l!==os){M({sub:[],dub:[],raw:[]}),J("");return}const ki=await un.getEpisodeServers(Oe);if(!se)return;const bs=p5(ki);M(bs);const Jr=["sub","dub","raw"].find(Pi=>{var Di;return((Di=bs[Pi])==null?void 0:Di.length)>0})||"sub";re(Jr);const Ha=X_(bs[Jr]||[]);J((Ha==null?void 0:Ha.id)||"")}catch(He){v(He.message||"Gagal memuat halaman watch.")}finally{se&&g(!1)}})(),()=>{se=!1}},[o,l,d,c,h]),$.useEffect(()=>{if(!(Fe!=null&&Fe.animeId))return;const se=`${Fe.animeId}:${Fe.episodeId||Fe.episodeNumber||""}`;!se||An.current===se||(An.current=se,s(Fe))},[Fe,s]),$.useEffect(()=>{if(!Ne.length){J("");return}if(we&&Ne.some(He=>He.id===te))return;const se=X_(Ne);J((se==null?void 0:se.id)||Ne[0].id)},[Ne,te,we]),$.useEffect(()=>{let se=!0;return(async()=>{if(l!==os||!A||!te){U([]),N(""),O("");return}try{Q(!0);const Ue=(we?[k]:S5(k,C)).map(Bt=>({category:Bt,servers:((C==null?void 0:C[Bt])||[]).filter(Oe=>Oe==null?void 0:Oe.id).sort((Oe,Me)=>Sd((Oe==null?void 0:Oe.name)||(Oe==null?void 0:Oe.id))-Sd((Me==null?void 0:Me.name)||(Me==null?void 0:Me.id))).map(Oe=>Oe.id)}));let dt=[],Ve=te,pt=k,Xe=null;for(const Bt of Ue){const Oe=we&&te?[te]:Bt.servers;for(const Me of Oe)try{const ki=await un.getEpisodeSources({animeEpisodeId:A,server:Me,category:Bt.category}),bs=y5(ki);if(bs.length>0){dt=bs,Ve=Me,pt=Bt.category;break}}catch(ki){Xe=ki}if(dt.length>0)break}if(dt.length>0&&(!we&&pt!==k&&re(pt),!we&&Ve!==te&&J(Ve),v("")),!se)return;if(!dt.length)throw Xe||new Error("Tidak ada source valid dari server yang tersedia.");U(dt),N(Bt=>{var Oe;return dt.some(Me=>Me.id===Bt)?Bt:((Oe=dt[0])==null?void 0:Oe.id)||""})}catch(He){if(!se)return;U([]),N(""),O(""),v(He.message||"Gagal memuat source episode.")}finally{se&&Q(!1)}})(),()=>{se=!1}},[l,A,te,k,Ne,we]),$.useEffect(()=>{var He,Ue;if(!we){O("");return}if(!H){O(((He=W[0])==null?void 0:He.url)||"");return}const se=W.find(dt=>dt.id===H);O((se==null?void 0:se.url)||((Ue=W[0])==null?void 0:Ue.url)||"")},[W,H,we]);const an=we?B||((Rs=W[0])==null?void 0:Rs.url)||"":((xo=W[0])==null?void 0:xo.url)||"",Zn=g5(W),St=Pr(an||Zn),er=f5(St),pr=T5(E,S),Rn=er?"":ML(St),Qr=Rn||pr,yr=St||(E==null?void 0:E.url)||((Io=E==null?void 0:E.trailer)==null?void 0:Io.url)||(o?`https://anichin.club/${encodeURIComponent(o)}`:""),Ci=Pr((_e==null?void 0:_e.imageUrl)||""),Xr=$.useCallback(se=>{const He=Pr(se);He&&wn.current.add(He);const Ue=W.findIndex(pt=>Pr(pt==null?void 0:pt.url)===Pr(an)),dt=Ue>=0?Ue+1:0,Ve=W.slice(dt).find(pt=>(pt==null?void 0:pt.url)&&!wn.current.has(Pr(pt.url)));if(!Ve){v("Source stream error. Semua source yang tersedia sudah dicoba.");return}v(`Source error, pindah otomatis ke ${Ve.name||"source berikutnya"}.`),we?N(Ve.id):U(pt=>{const Xe=pt.findIndex(Me=>(Me==null?void 0:Me.id)===Ve.id);if(Xe<=0)return pt;const Bt=[...pt],[Oe]=Bt.splice(Xe,1);return[Oe,...Bt]})},[an,we,W]);$.useEffect(()=>{wn.current.clear()},[A,te,k,W.length]),$.useEffect(()=>{const se=Ga.current;if(!se)return;if(Ee.current&&(Ee.current.destroy(),Ee.current=null),!St||Rn||!er){se.removeAttribute("src"),se.load();return}if(!/\.m3u8(\?|$)/i.test(St)){se.src=St,se.load();return}if(se.canPlayType("application/vnd.apple.mpegurl")){se.src=St,se.load();return}if(Nr.isSupported()){const Ue=new Nr({enableWorker:!0,lowLatencyMode:!0});Ue.on(Nr.Events.ERROR,(dt,Ve)=>{Ve!=null&&Ve.fatal&&Xr(St)}),Ee.current=Ue,Ue.loadSource(St),Ue.attachMedia(se)}return()=>{Ee.current&&(Ee.current.destroy(),Ee.current=null)}},[St,Rn,er,Xr]);const Vn=()=>{ee(!0);const se=i(),He=(se==null?void 0:se.url)||(_e==null?void 0:_e.url)||"";if(He)try{window.open(He,"_blank","noopener,noreferrer")}catch{}};return m?w.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:w.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})}):w.jsxs("section",{className:"space-y-4",children:[w.jsx("button",{type:"button",onClick:()=>e(-1),className:"inline-flex rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20",children:"Kembali"}),Tt?w.jsx("div",{role:"button",tabIndex:0,onClick:Vn,onKeyDown:se=>{(se.key==="Enter"||se.key===" ")&&Vn()},className:"fixed inset-0 z-[100] flex h-screen w-screen items-center justify-center bg-black/95 p-4 text-left",children:w.jsxs("div",{className:"mx-auto w-full max-w-4xl overflow-hidden rounded-2xl border border-white/20 bg-zinc-950",children:[Ci&&de?w.jsx("img",{src:Ci,alt:"Sponsor",className:"max-h-[72vh] w-full object-contain bg-black",onError:()=>Ae(!1)}):w.jsxs("div",{className:"flex min-h-[260px] flex-col items-center justify-center bg-[radial-gradient(circle_at_50%_10%,rgba(239,68,68,.35),transparent_38%),linear-gradient(165deg,#050505,#18181b)] px-6 py-10 text-center",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"Sponsored"}),w.jsx("p",{className:"mt-3 font-heading text-3xl font-bold text-white sm:text-4xl",children:"Ketuk Untuk Lanjut Menonton"}),w.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Sponsor harus dibuka dulu. Setelah disentuh, player akan otomatis tersedia."}),_e!=null&&_e.url?w.jsx("p",{className:"mt-3 line-clamp-1 text-xs text-zinc-400",children:_e.url}):null]}),w.jsx("div",{className:"border-t border-white/10 bg-black/70 px-4 py-3 text-center text-xs text-zinc-300",children:"Sentuh area iklan untuk lanjut menonton."}),w.jsx("div",{className:"border-t border-white/10 bg-black/80 p-3 text-center",children:w.jsx("button",{type:"button",onClick:se=>{se.stopPropagation(),Vn()},className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Lanjutkan Menonton"})})]})}):null,w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:E.title||`Donghua ${o}`}),R?w.jsxs("p",{className:"mt-1 text-sm text-cyan-200",children:["Episode #",R]}):null,w.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Pilih episode, category, dan server, lalu mulai menonton."}),w.jsx("p",{className:"mt-2 rounded-lg border border-amber-300/30 bg-amber-400/10 px-3 py-2 text-xs text-amber-200",children:"Note: jangan di pencet berkali kali, stream otomatis play."})]}),y?w.jsx("p",{className:"rounded-xl border border-red-500/40 bg-red-500/10 p-3 text-sm text-red-300",children:y}):null,l===os?w.jsxs("div",{className:"grid gap-3 rounded-2xl border border-white/10 bg-slate-900/60 p-4 sm:grid-cols-2",children:[w.jsxs("label",{className:"text-sm text-slate-200 sm:col-span-2",children:[w.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Episode"}),w.jsx("select",{value:A,onChange:se=>{const He=se.target.value;x(He);const Ue=D.find(dt=>(dt==null?void 0:dt.episodeId)===He)||null;b(Number(Ue==null?void 0:Ue.number)||null),on({animeId:(E==null?void 0:E.animeId)||o,episodeId:He,episodeNumber:Number(Ue==null?void 0:Ue.number)||null,title:(E==null?void 0:E.title)||o,episodeTitle:Fn(Ue==null?void 0:Ue.title),poster:(E==null?void 0:E.poster)||"",source:l,slug:d})},className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:D.map((se,He)=>w.jsx("option",{value:se.episodeId||"",children:Np(se,He)},se.episodeId||se.id||se.title))})]}),w.jsxs("label",{className:"text-sm text-slate-200",children:[w.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Category"}),w.jsx("select",{value:k,onChange:se=>re(se.target.value),className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:$e.map(se=>w.jsx("option",{value:se,children:se.toUpperCase()},se))})]}),w.jsxs("label",{className:"text-sm text-slate-200",children:[w.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Server"}),w.jsx("select",{value:te,onChange:se=>{we&&J(se.target.value)},disabled:!we,className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:Ne.map(se=>w.jsx("option",{value:se.id,children:se.name},se.id))})]}),we?w.jsxs("label",{className:"text-sm text-slate-200 sm:col-span-2",children:[w.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Source"}),w.jsx("select",{value:H,onChange:se=>N(se.target.value),className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:W.map(se=>w.jsx("option",{value:se.id,children:se.name},se.id))})]}):w.jsx("p",{className:"text-xs text-amber-300 sm:col-span-2",children:"Free Plan: server dikunci otomatis ke yang paling stabil (auto fallback jika gagal)."})]}):null,w.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-white/10 bg-black",children:[!Tt&&K?w.jsx("div",{className:"absolute right-3 top-3 z-20 rounded-full bg-black/70 px-3 py-1 text-xs text-slate-300",children:"Loading source..."}):null,St&&!Rn&&er?w.jsx("video",{ref:Ga,className:"aspect-video w-full bg-black",controls:!0,playsInline:!0,preload:"metadata",onError:()=>Xr(St)}):Qr?w.jsx("iframe",{className:"aspect-video w-full",src:Qr,title:E.title||"Streaming",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onError:()=>Xr(St||Qr)}):w.jsxs("div",{className:"flex aspect-video flex-col items-center justify-center gap-3 text-sm text-slate-400",children:[w.jsx("p",{children:"Video player tidak tersedia untuk donghua ini."}),yr?w.jsx("a",{href:yr,target:"_blank",rel:"noreferrer",className:"rounded-full border border-cyan-300/40 bg-cyan-400/10 px-4 py-2 text-xs font-semibold text-cyan-200 transition hover:bg-cyan-400/20",children:"Buka Streaming di Tab Baru"}):null]})]}),!St&&yr?w.jsx("a",{href:yr,target:"_blank",rel:"noreferrer",className:"inline-flex rounded-full border border-cyan-300/40 bg-cyan-400/10 px-4 py-2 text-xs font-semibold text-cyan-200 transition hover:bg-cyan-400/20",children:"Jika player kosong, buka stream di tab baru"}):null,w.jsx(Pt,{to:`/anime/${encodeURIComponent(l)}/${encodeURIComponent(o)}${d?`?slug=${encodeURIComponent(d)}`:""}`,className:"inline-flex rounded-full bg-white/10 px-4 py-2 text-sm text-white transition hover:bg-white/20",children:"Back to Detail"})]})}function _5(){const{watchlist:n,removeFromWatchlist:e}=In();return w.jsxs("section",{className:"space-y-5",children:[w.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4 sm:p-5",children:[w.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Watchlist"}),w.jsx("p",{className:"mt-1 text-sm text-slate-300",children:"Daftar donghua yang kamu simpan untuk ditonton nanti."})]}),n.length===0?w.jsx("p",{className:"text-sm text-slate-400",children:"Watchlist masih kosong."}):w.jsx("div",{className:"grid grid-cols-2 gap-2.5 sm:gap-3 lg:grid-cols-4",children:n.map(t=>w.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/70 p-2.5 sm:rounded-2xl sm:p-3",children:[w.jsxs(Pt,{to:`/anime/${encodeURIComponent(t.source||"anichin")}/${encodeURIComponent(t.animeId)}${t.slug?`?slug=${encodeURIComponent(t.slug)}`:""}`,className:"block",children:[w.jsx("div",{className:"overflow-hidden rounded-lg bg-slate-800",children:t.poster?w.jsx("img",{src:t.poster,alt:t.title,className:"aspect-[3/4] w-full object-cover"}):null}),w.jsx("p",{className:"mt-1.5 line-clamp-2 text-xs font-semibold leading-snug text-white sm:mt-2 sm:text-sm",children:t.title})]}),w.jsx("button",{type:"button",onClick:()=>e(t.animeId),className:"mt-2 w-full rounded-lg border border-cyan-300/30 bg-cyan-400/10 px-2 py-1.5 text-[11px] font-semibold text-cyan-200 transition hover:bg-cyan-400/20 sm:mt-3 sm:px-3 sm:py-2 sm:text-xs",children:"Hapus"})]},`${t.animeId}-${t.addedAt}`))})]})}function Hy(){return w.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:w.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})})}function Ir({children:n}){const{isLoggedIn:e,ready:t}=In();return t?e?n:w.jsx(Vd,{to:"/login",replace:!0}):w.jsx(Hy,{})}function x5({children:n}){const{isAdmin:e,ready:t}=In();return t?e?n:w.jsx(Vd,{to:"/",replace:!0}):w.jsx(Hy,{})}function Z_({children:n}){const{isLoggedIn:e,ready:t}=In();return t?e?w.jsx(Vd,{to:"/",replace:!0}):n:w.jsx(Hy,{})}function I5(){const n="wa.me/628990870271?text=Halo%20Admin%20DonghuaX%2C%20saya%20ingin%20memasang%20iklan/ads.".trim();if(n)return n;const e="628990870271".trim().replace(/[^\d]/g,"");return e?`https://wa.me/${e}`:"https://wa.me/6280000000000"}function A5(){const[n,e]=$.useState(!1),t=$.useMemo(()=>I5(),[]);return $.useEffect(()=>{e(!0)},[]),n?w.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/80 p-4",children:w.jsxs("div",{className:"w-full max-w-lg rounded-2xl border border-white/15 bg-slate-950 p-5 sm:p-6",children:[w.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"Announcement"}),w.jsx("h2",{className:"mt-2 font-heading text-2xl font-bold text-white",children:"Open Penempatan Iklan"}),w.jsx("p",{className:"mt-3 text-sm text-slate-300",children:"Penempatan iklan di website/aplikasi ini sedang dibuka. Jika ingin pasang iklan, hubungi WhatsApp admin."}),w.jsxs("div",{className:"mt-5 flex flex-wrap gap-2",children:[w.jsx("a",{href:t,target:"_blank",rel:"noreferrer",className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white",children:"Hubungi WhatsApp"}),w.jsx("button",{type:"button",onClick:()=>e(!1),className:"rounded-xl border border-white/20 bg-white/5 px-4 py-2.5 text-sm text-slate-100 hover:bg-white/10",children:"Skip"})]})]})}):null}function w5(){const n=qr();return w.jsxs("div",{className:"min-h-screen bg-bg font-body text-text",children:[w.jsx(A5,{}),w.jsx(xB,{}),w.jsx("main",{className:"mx-auto w-full max-w-7xl px-3 py-4 sm:px-5 sm:py-6 lg:px-8",children:w.jsx("div",{className:"animate-page-in",children:w.jsxs(EP,{children:[w.jsx($t,{path:"/signup",element:w.jsx(Z_,{children:w.jsx(u$,{})})}),w.jsx($t,{path:"/login",element:w.jsx(Z_,{children:w.jsx(i$,{})})}),w.jsx($t,{path:"/",element:w.jsx(Ir,{children:w.jsx(s$,{})})}),w.jsx($t,{path:"/about",element:w.jsx(o$,{})}),w.jsx($t,{path:"/contact",element:w.jsx(YB,{})}),w.jsx($t,{path:"/privacy-policy",element:w.jsx(l$,{})}),w.jsx($t,{path:"/anime/:animeId",element:w.jsx(Ir,{children:w.jsx(LS,{})})}),w.jsx($t,{path:"/anime/:source/:animeId",element:w.jsx(Ir,{children:w.jsx(LS,{})})}),w.jsx($t,{path:"/watch/:animeId",element:w.jsx(Ir,{children:w.jsx(J_,{})})}),w.jsx($t,{path:"/watch/:source/:animeId",element:w.jsx(Ir,{children:w.jsx(J_,{})})}),w.jsx($t,{path:"/history",element:w.jsx(Ir,{children:w.jsx(QB,{})})}),w.jsx($t,{path:"/watchlist",element:w.jsx(Ir,{children:w.jsx(_5,{})})}),w.jsx($t,{path:"/premium",element:w.jsx(Ir,{children:w.jsx(a$,{})})}),w.jsx($t,{path:"/account",element:w.jsx(Ir,{children:w.jsx(AB,{})})}),w.jsx($t,{path:"/admin",element:w.jsx(Ir,{children:w.jsx(x5,{children:w.jsx(bB,{})})})}),w.jsx($t,{path:"*",element:w.jsx(Vd,{to:"/",replace:!0})})]})},n.pathname)}),w.jsx(IB,{})]})}$m.createRoot(document.getElementById("root")).render(w.jsx(cx.StrictMode,{children:w.jsx(RP,{children:w.jsx(_B,{children:w.jsx(w5,{})})})}));

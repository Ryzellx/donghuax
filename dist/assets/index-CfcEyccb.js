function yx(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function vx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var m0={exports:{}},Ql={},y0={exports:{}},oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $a=Symbol.for("react.element"),Ex=Symbol.for("react.portal"),Sx=Symbol.for("react.fragment"),xx=Symbol.for("react.strict_mode"),Tx=Symbol.for("react.profiler"),Ix=Symbol.for("react.provider"),Ax=Symbol.for("react.context"),_x=Symbol.for("react.forward_ref"),Lx=Symbol.for("react.suspense"),wx=Symbol.for("react.memo"),bx=Symbol.for("react.lazy"),Yf=Symbol.iterator;function Rx(n){return n===null||typeof n!="object"?null:(n=Yf&&n[Yf]||n["@@iterator"],typeof n=="function"?n:null)}var v0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E0=Object.assign,S0={};function Ti(n,e,t){this.props=n,this.context=e,this.refs=S0,this.updater=t||v0}Ti.prototype.isReactComponent={};Ti.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ti.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function x0(){}x0.prototype=Ti.prototype;function lh(n,e,t){this.props=n,this.context=e,this.refs=S0,this.updater=t||v0}var uh=lh.prototype=new x0;uh.constructor=lh;E0(uh,Ti.prototype);uh.isPureReactComponent=!0;var qf=Array.isArray,T0=Object.prototype.hasOwnProperty,ch={current:null},I0={key:!0,ref:!0,__self:!0,__source:!0};function A0(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)T0.call(e,r)&&!I0.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:$a,type:n,key:i,ref:a,props:s,_owner:ch.current}}function kx(n,e){return{$$typeof:$a,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function dh(n){return typeof n=="object"&&n!==null&&n.$$typeof===$a}function Cx(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Xf=/\/+/g;function _u(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Cx(""+n.key):e.toString(36)}function No(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case $a:case Ex:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+_u(a,0):r,qf(s)?(t="",n!=null&&(t=n.replace(Xf,"$&/")+"/"),No(s,e,t,"",function(u){return u})):s!=null&&(dh(s)&&(s=kx(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Xf,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",qf(n))for(var o=0;o<n.length;o++){i=n[o];var l=r+_u(i,o);a+=No(i,e,t,l,s)}else if(l=Rx(n),typeof l=="function")for(n=l.call(n),o=0;!(i=n.next()).done;)i=i.value,l=r+_u(i,o++),a+=No(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function eo(n,e,t){if(n==null)return n;var r=[],s=0;return No(n,r,"","",function(i){return e.call(t,i,s++)}),r}function Px(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var mt={current:null},Oo={transition:null},Dx={ReactCurrentDispatcher:mt,ReactCurrentBatchConfig:Oo,ReactCurrentOwner:ch};function _0(){throw Error("act(...) is not supported in production builds of React.")}oe.Children={map:eo,forEach:function(n,e,t){eo(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return eo(n,function(){e++}),e},toArray:function(n){return eo(n,function(e){return e})||[]},only:function(n){if(!dh(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};oe.Component=Ti;oe.Fragment=Sx;oe.Profiler=Tx;oe.PureComponent=lh;oe.StrictMode=xx;oe.Suspense=Lx;oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Dx;oe.act=_0;oe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=E0({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=ch.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)T0.call(e,l)&&!I0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:$a,type:n.type,key:s,ref:i,props:r,_owner:a}};oe.createContext=function(n){return n={$$typeof:Ax,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Ix,_context:n},n.Consumer=n};oe.createElement=A0;oe.createFactory=function(n){var e=A0.bind(null,n);return e.type=n,e};oe.createRef=function(){return{current:null}};oe.forwardRef=function(n){return{$$typeof:_x,render:n}};oe.isValidElement=dh;oe.lazy=function(n){return{$$typeof:bx,_payload:{_status:-1,_result:n},_init:Px}};oe.memo=function(n,e){return{$$typeof:wx,type:n,compare:e===void 0?null:e}};oe.startTransition=function(n){var e=Oo.transition;Oo.transition={};try{n()}finally{Oo.transition=e}};oe.unstable_act=_0;oe.useCallback=function(n,e){return mt.current.useCallback(n,e)};oe.useContext=function(n){return mt.current.useContext(n)};oe.useDebugValue=function(){};oe.useDeferredValue=function(n){return mt.current.useDeferredValue(n)};oe.useEffect=function(n,e){return mt.current.useEffect(n,e)};oe.useId=function(){return mt.current.useId()};oe.useImperativeHandle=function(n,e,t){return mt.current.useImperativeHandle(n,e,t)};oe.useInsertionEffect=function(n,e){return mt.current.useInsertionEffect(n,e)};oe.useLayoutEffect=function(n,e){return mt.current.useLayoutEffect(n,e)};oe.useMemo=function(n,e){return mt.current.useMemo(n,e)};oe.useReducer=function(n,e,t){return mt.current.useReducer(n,e,t)};oe.useRef=function(n){return mt.current.useRef(n)};oe.useState=function(n){return mt.current.useState(n)};oe.useSyncExternalStore=function(n,e,t){return mt.current.useSyncExternalStore(n,e,t)};oe.useTransition=function(){return mt.current.useTransition()};oe.version="18.3.1";y0.exports=oe;var P=y0.exports;const L0=vx(P),Nx=yx({__proto__:null,default:L0},[P]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ox=P,Mx=Symbol.for("react.element"),Fx=Symbol.for("react.fragment"),Ux=Object.prototype.hasOwnProperty,Bx=Ox.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$x={key:!0,ref:!0,__self:!0,__source:!0};function w0(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)Ux.call(e,r)&&!$x.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Mx,type:n,key:i,ref:a,props:s,_owner:Bx.current}}Ql.Fragment=Fx;Ql.jsx=w0;Ql.jsxs=w0;m0.exports=Ql;var x=m0.exports,Pc={},b0={exports:{}},$t={},R0={exports:{}},k0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(R,M){var G=R.length;R.push(M);e:for(;0<G;){var V=G-1>>>1,$=R[V];if(0<s($,M))R[V]=M,R[G]=$,G=V;else break e}}function t(R){return R.length===0?null:R[0]}function r(R){if(R.length===0)return null;var M=R[0],G=R.pop();if(G!==M){R[0]=G;e:for(var V=0,$=R.length,Q=$>>>1;V<Q;){var re=2*(V+1)-1,J=R[re],te=re+1,Ae=R[te];if(0>s(J,G))te<$&&0>s(Ae,J)?(R[V]=Ae,R[te]=G,V=te):(R[V]=J,R[re]=G,V=re);else if(te<$&&0>s(Ae,G))R[V]=Ae,R[te]=G,V=te;else break e}}return M}function s(R,M){var G=R.sortIndex-M.sortIndex;return G!==0?G:R.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(R){for(var M=t(u);M!==null;){if(M.callback===null)r(u);else if(M.startTime<=R)r(u),M.sortIndex=M.expirationTime,e(l,M);else break;M=t(u)}}function T(R){if(m=!1,E(R),!g)if(t(l)!==null)g=!0,B(A);else{var M=t(u);M!==null&&O(T,M.startTime-R)}}function A(R,M){g=!1,m&&(m=!1,p(L),L=-1),f=!0;var G=h;try{for(E(M),d=t(l);d!==null&&(!(d.expirationTime>M)||R&&!k());){var V=d.callback;if(typeof V=="function"){d.callback=null,h=d.priorityLevel;var $=V(d.expirationTime<=M);M=n.unstable_now(),typeof $=="function"?d.callback=$:d===t(l)&&r(l),E(M)}else r(l);d=t(l)}if(d!==null)var Q=!0;else{var re=t(u);re!==null&&O(T,re.startTime-M),Q=!1}return Q}finally{d=null,h=G,f=!1}}var w=!1,_=null,L=-1,b=5,I=-1;function k(){return!(n.unstable_now()-I<b)}function H(){if(_!==null){var R=n.unstable_now();I=R;var M=!0;try{M=_(!0,R)}finally{M?U():(w=!1,_=null)}}else w=!1}var U;if(typeof y=="function")U=function(){y(H)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,F=C.port2;C.port1.onmessage=H,U=function(){F.postMessage(null)}}else U=function(){v(H,0)};function B(R){_=R,w||(w=!0,U())}function O(R,M){L=v(function(){R(n.unstable_now())},M)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(R){R.callback=null},n.unstable_continueExecution=function(){g||f||(g=!0,B(A))},n.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<R?Math.floor(1e3/R):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(R){switch(h){case 1:case 2:case 3:var M=3;break;default:M=h}var G=h;h=M;try{return R()}finally{h=G}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(R,M){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var G=h;h=R;try{return M()}finally{h=G}},n.unstable_scheduleCallback=function(R,M,G){var V=n.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?V+G:V):G=V,R){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=G+$,R={id:c++,callback:M,priorityLevel:R,startTime:G,expirationTime:$,sortIndex:-1},G>V?(R.sortIndex=G,e(u,R),t(l)===null&&R===t(u)&&(m?(p(L),L=-1):m=!0,O(T,G-V))):(R.sortIndex=$,e(l,R),g||f||(g=!0,B(A))),R},n.unstable_shouldYield=k,n.unstable_wrapCallback=function(R){var M=h;return function(){var G=h;h=M;try{return R.apply(this,arguments)}finally{h=G}}}})(k0);R0.exports=k0;var jx=R0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gx=P,Bt=jx;function K(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var C0=new Set,ca={};function Is(n,e){ci(n,e),ci(n+"Capture",e)}function ci(n,e){for(ca[n]=e,n=0;n<e.length;n++)C0.add(e[n])}var er=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dc=Object.prototype.hasOwnProperty,Vx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qf={},Jf={};function Hx(n){return Dc.call(Jf,n)?!0:Dc.call(Qf,n)?!1:Vx.test(n)?Jf[n]=!0:(Qf[n]=!0,!1)}function Kx(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Wx(n,e,t,r){if(e===null||typeof e>"u"||Kx(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yt(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var at={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){at[n]=new yt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];at[e]=new yt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){at[n]=new yt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){at[n]=new yt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){at[n]=new yt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){at[n]=new yt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){at[n]=new yt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){at[n]=new yt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){at[n]=new yt(n,5,!1,n.toLowerCase(),null,!1,!1)});var hh=/[\-:]([a-z])/g;function fh(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(hh,fh);at[e]=new yt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(hh,fh);at[e]=new yt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(hh,fh);at[e]=new yt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){at[n]=new yt(n,1,!1,n.toLowerCase(),null,!1,!1)});at.xlinkHref=new yt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){at[n]=new yt(n,1,!1,n.toLowerCase(),null,!0,!0)});function gh(n,e,t,r){var s=at.hasOwnProperty(e)?at[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Wx(e,t,s,r)&&(t=null),r||s===null?Hx(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ar=Gx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,to=Symbol.for("react.element"),Fs=Symbol.for("react.portal"),Us=Symbol.for("react.fragment"),ph=Symbol.for("react.strict_mode"),Nc=Symbol.for("react.profiler"),P0=Symbol.for("react.provider"),D0=Symbol.for("react.context"),mh=Symbol.for("react.forward_ref"),Oc=Symbol.for("react.suspense"),Mc=Symbol.for("react.suspense_list"),yh=Symbol.for("react.memo"),mr=Symbol.for("react.lazy"),N0=Symbol.for("react.offscreen"),Zf=Symbol.iterator;function Di(n){return n===null||typeof n!="object"?null:(n=Zf&&n[Zf]||n["@@iterator"],typeof n=="function"?n:null)}var Ce=Object.assign,Lu;function Gi(n){if(Lu===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Lu=e&&e[1]||""}return`
`+Lu+n}var wu=!1;function bu(n,e){if(!n||wu)return"";wu=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{wu=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Gi(n):""}function zx(n){switch(n.tag){case 5:return Gi(n.type);case 16:return Gi("Lazy");case 13:return Gi("Suspense");case 19:return Gi("SuspenseList");case 0:case 2:case 15:return n=bu(n.type,!1),n;case 11:return n=bu(n.type.render,!1),n;case 1:return n=bu(n.type,!0),n;default:return""}}function Fc(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Us:return"Fragment";case Fs:return"Portal";case Nc:return"Profiler";case ph:return"StrictMode";case Oc:return"Suspense";case Mc:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case D0:return(n.displayName||"Context")+".Consumer";case P0:return(n._context.displayName||"Context")+".Provider";case mh:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case yh:return e=n.displayName||null,e!==null?e:Fc(n.type)||"Memo";case mr:e=n._payload,n=n._init;try{return Fc(n(e))}catch{}}return null}function Yx(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fc(e);case 8:return e===ph?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function jr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function O0(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function qx(n){var e=O0(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function no(n){n._valueTracker||(n._valueTracker=qx(n))}function M0(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=O0(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function sl(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Uc(n,e){var t=e.checked;return Ce({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function eg(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=jr(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function F0(n,e){e=e.checked,e!=null&&gh(n,"checked",e,!1)}function Bc(n,e){F0(n,e);var t=jr(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?$c(n,e.type,t):e.hasOwnProperty("defaultValue")&&$c(n,e.type,jr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function tg(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function $c(n,e,t){(e!=="number"||sl(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Vi=Array.isArray;function Xs(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+jr(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function jc(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(K(91));return Ce({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ng(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(K(92));if(Vi(t)){if(1<t.length)throw Error(K(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:jr(t)}}function U0(n,e){var t=jr(e.value),r=jr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function rg(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function B0(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gc(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?B0(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ro,$0=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ro=ro||document.createElement("div"),ro.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ro.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function da(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Xi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xx=["Webkit","ms","Moz","O"];Object.keys(Xi).forEach(function(n){Xx.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Xi[e]=Xi[n]})});function j0(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Xi.hasOwnProperty(n)&&Xi[n]?(""+e).trim():e+"px"}function G0(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=j0(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var Qx=Ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vc(n,e){if(e){if(Qx[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(K(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(K(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(K(61))}if(e.style!=null&&typeof e.style!="object")throw Error(K(62))}}function Hc(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kc=null;function vh(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Wc=null,Qs=null,Js=null;function sg(n){if(n=Va(n)){if(typeof Wc!="function")throw Error(K(280));var e=n.stateNode;e&&(e=nu(e),Wc(n.stateNode,n.type,e))}}function V0(n){Qs?Js?Js.push(n):Js=[n]:Qs=n}function H0(){if(Qs){var n=Qs,e=Js;if(Js=Qs=null,sg(n),e)for(n=0;n<e.length;n++)sg(e[n])}}function K0(n,e){return n(e)}function W0(){}var Ru=!1;function z0(n,e,t){if(Ru)return n(e,t);Ru=!0;try{return K0(n,e,t)}finally{Ru=!1,(Qs!==null||Js!==null)&&(W0(),H0())}}function ha(n,e){var t=n.stateNode;if(t===null)return null;var r=nu(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(K(231,e,typeof t));return t}var zc=!1;if(er)try{var Ni={};Object.defineProperty(Ni,"passive",{get:function(){zc=!0}}),window.addEventListener("test",Ni,Ni),window.removeEventListener("test",Ni,Ni)}catch{zc=!1}function Jx(n,e,t,r,s,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Qi=!1,il=null,al=!1,Yc=null,Zx={onError:function(n){Qi=!0,il=n}};function eT(n,e,t,r,s,i,a,o,l){Qi=!1,il=null,Jx.apply(Zx,arguments)}function tT(n,e,t,r,s,i,a,o,l){if(eT.apply(this,arguments),Qi){if(Qi){var u=il;Qi=!1,il=null}else throw Error(K(198));al||(al=!0,Yc=u)}}function As(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Y0(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function ig(n){if(As(n)!==n)throw Error(K(188))}function nT(n){var e=n.alternate;if(!e){if(e=As(n),e===null)throw Error(K(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return ig(s),n;if(i===r)return ig(s),e;i=i.sibling}throw Error(K(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a)throw Error(K(189))}}if(t.alternate!==r)throw Error(K(190))}if(t.tag!==3)throw Error(K(188));return t.stateNode.current===t?n:e}function q0(n){return n=nT(n),n!==null?X0(n):null}function X0(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=X0(n);if(e!==null)return e;n=n.sibling}return null}var Q0=Bt.unstable_scheduleCallback,ag=Bt.unstable_cancelCallback,rT=Bt.unstable_shouldYield,sT=Bt.unstable_requestPaint,Fe=Bt.unstable_now,iT=Bt.unstable_getCurrentPriorityLevel,Eh=Bt.unstable_ImmediatePriority,J0=Bt.unstable_UserBlockingPriority,ol=Bt.unstable_NormalPriority,aT=Bt.unstable_LowPriority,Z0=Bt.unstable_IdlePriority,Jl=null,Dn=null;function oT(n){if(Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(Jl,n,void 0,(n.current.flags&128)===128)}catch{}}var dn=Math.clz32?Math.clz32:cT,lT=Math.log,uT=Math.LN2;function cT(n){return n>>>=0,n===0?32:31-(lT(n)/uT|0)|0}var so=64,io=4194304;function Hi(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ll(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?r=Hi(o):(i&=a,i!==0&&(r=Hi(i)))}else a=t&~s,a!==0?r=Hi(a):i!==0&&(r=Hi(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-dn(e),s=1<<t,r|=n[t],e&=~s;return r}function dT(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hT(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-dn(i),o=1<<a,l=s[a];l===-1?(!(o&t)||o&r)&&(s[a]=dT(o,e)):l<=e&&(n.expiredLanes|=o),i&=~o}}function qc(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function ey(){var n=so;return so<<=1,!(so&4194240)&&(so=64),n}function ku(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function ja(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-dn(e),n[e]=t}function fT(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-dn(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Sh(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-dn(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var fe=0;function ty(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var ny,xh,ry,sy,iy,Xc=!1,ao=[],Rr=null,kr=null,Cr=null,fa=new Map,ga=new Map,xr=[],gT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function og(n,e){switch(n){case"focusin":case"focusout":Rr=null;break;case"dragenter":case"dragleave":kr=null;break;case"mouseover":case"mouseout":Cr=null;break;case"pointerover":case"pointerout":fa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ga.delete(e.pointerId)}}function Oi(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Va(e),e!==null&&xh(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function pT(n,e,t,r,s){switch(e){case"focusin":return Rr=Oi(Rr,n,e,t,r,s),!0;case"dragenter":return kr=Oi(kr,n,e,t,r,s),!0;case"mouseover":return Cr=Oi(Cr,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return fa.set(i,Oi(fa.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ga.set(i,Oi(ga.get(i)||null,n,e,t,r,s)),!0}return!1}function ay(n){var e=os(n.target);if(e!==null){var t=As(e);if(t!==null){if(e=t.tag,e===13){if(e=Y0(t),e!==null){n.blockedOn=e,iy(n.priority,function(){ry(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Mo(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Qc(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Kc=r,t.target.dispatchEvent(r),Kc=null}else return e=Va(t),e!==null&&xh(e),n.blockedOn=t,!1;e.shift()}return!0}function lg(n,e,t){Mo(n)&&t.delete(e)}function mT(){Xc=!1,Rr!==null&&Mo(Rr)&&(Rr=null),kr!==null&&Mo(kr)&&(kr=null),Cr!==null&&Mo(Cr)&&(Cr=null),fa.forEach(lg),ga.forEach(lg)}function Mi(n,e){n.blockedOn===e&&(n.blockedOn=null,Xc||(Xc=!0,Bt.unstable_scheduleCallback(Bt.unstable_NormalPriority,mT)))}function pa(n){function e(s){return Mi(s,n)}if(0<ao.length){Mi(ao[0],n);for(var t=1;t<ao.length;t++){var r=ao[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Rr!==null&&Mi(Rr,n),kr!==null&&Mi(kr,n),Cr!==null&&Mi(Cr,n),fa.forEach(e),ga.forEach(e),t=0;t<xr.length;t++)r=xr[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<xr.length&&(t=xr[0],t.blockedOn===null);)ay(t),t.blockedOn===null&&xr.shift()}var Zs=ar.ReactCurrentBatchConfig,ul=!0;function yT(n,e,t,r){var s=fe,i=Zs.transition;Zs.transition=null;try{fe=1,Th(n,e,t,r)}finally{fe=s,Zs.transition=i}}function vT(n,e,t,r){var s=fe,i=Zs.transition;Zs.transition=null;try{fe=4,Th(n,e,t,r)}finally{fe=s,Zs.transition=i}}function Th(n,e,t,r){if(ul){var s=Qc(n,e,t,r);if(s===null)$u(n,e,r,cl,t),og(n,r);else if(pT(s,n,e,t,r))r.stopPropagation();else if(og(n,r),e&4&&-1<gT.indexOf(n)){for(;s!==null;){var i=Va(s);if(i!==null&&ny(i),i=Qc(n,e,t,r),i===null&&$u(n,e,r,cl,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else $u(n,e,r,null,t)}}var cl=null;function Qc(n,e,t,r){if(cl=null,n=vh(r),n=os(n),n!==null)if(e=As(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Y0(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return cl=n,null}function oy(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iT()){case Eh:return 1;case J0:return 4;case ol:case aT:return 16;case Z0:return 536870912;default:return 16}default:return 16}}var Lr=null,Ih=null,Fo=null;function ly(){if(Fo)return Fo;var n,e=Ih,t=e.length,r,s="value"in Lr?Lr.value:Lr.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return Fo=s.slice(n,1<r?1-r:void 0)}function Uo(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function oo(){return!0}function ug(){return!1}function jt(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?oo:ug,this.isPropagationStopped=ug,this}return Ce(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=oo)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=oo)},persist:function(){},isPersistent:oo}),e}var Ii={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ah=jt(Ii),Ga=Ce({},Ii,{view:0,detail:0}),ET=jt(Ga),Cu,Pu,Fi,Zl=Ce({},Ga,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_h,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Fi&&(Fi&&n.type==="mousemove"?(Cu=n.screenX-Fi.screenX,Pu=n.screenY-Fi.screenY):Pu=Cu=0,Fi=n),Cu)},movementY:function(n){return"movementY"in n?n.movementY:Pu}}),cg=jt(Zl),ST=Ce({},Zl,{dataTransfer:0}),xT=jt(ST),TT=Ce({},Ga,{relatedTarget:0}),Du=jt(TT),IT=Ce({},Ii,{animationName:0,elapsedTime:0,pseudoElement:0}),AT=jt(IT),_T=Ce({},Ii,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),LT=jt(_T),wT=Ce({},Ii,{data:0}),dg=jt(wT),bT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CT(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=kT[n])?!!e[n]:!1}function _h(){return CT}var PT=Ce({},Ga,{key:function(n){if(n.key){var e=bT[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Uo(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?RT[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_h,charCode:function(n){return n.type==="keypress"?Uo(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Uo(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),DT=jt(PT),NT=Ce({},Zl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hg=jt(NT),OT=Ce({},Ga,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_h}),MT=jt(OT),FT=Ce({},Ii,{propertyName:0,elapsedTime:0,pseudoElement:0}),UT=jt(FT),BT=Ce({},Zl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),$T=jt(BT),jT=[9,13,27,32],Lh=er&&"CompositionEvent"in window,Ji=null;er&&"documentMode"in document&&(Ji=document.documentMode);var GT=er&&"TextEvent"in window&&!Ji,uy=er&&(!Lh||Ji&&8<Ji&&11>=Ji),fg=" ",gg=!1;function cy(n,e){switch(n){case"keyup":return jT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dy(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Bs=!1;function VT(n,e){switch(n){case"compositionend":return dy(e);case"keypress":return e.which!==32?null:(gg=!0,fg);case"textInput":return n=e.data,n===fg&&gg?null:n;default:return null}}function HT(n,e){if(Bs)return n==="compositionend"||!Lh&&cy(n,e)?(n=ly(),Fo=Ih=Lr=null,Bs=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uy&&e.locale!=="ko"?null:e.data;default:return null}}var KT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pg(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!KT[n.type]:e==="textarea"}function hy(n,e,t,r){V0(r),e=dl(e,"onChange"),0<e.length&&(t=new Ah("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Zi=null,ma=null;function WT(n){Iy(n,0)}function eu(n){var e=Gs(n);if(M0(e))return n}function zT(n,e){if(n==="change")return e}var fy=!1;if(er){var Nu;if(er){var Ou="oninput"in document;if(!Ou){var mg=document.createElement("div");mg.setAttribute("oninput","return;"),Ou=typeof mg.oninput=="function"}Nu=Ou}else Nu=!1;fy=Nu&&(!document.documentMode||9<document.documentMode)}function yg(){Zi&&(Zi.detachEvent("onpropertychange",gy),ma=Zi=null)}function gy(n){if(n.propertyName==="value"&&eu(ma)){var e=[];hy(e,ma,n,vh(n)),z0(WT,e)}}function YT(n,e,t){n==="focusin"?(yg(),Zi=e,ma=t,Zi.attachEvent("onpropertychange",gy)):n==="focusout"&&yg()}function qT(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return eu(ma)}function XT(n,e){if(n==="click")return eu(e)}function QT(n,e){if(n==="input"||n==="change")return eu(e)}function JT(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var gn=typeof Object.is=="function"?Object.is:JT;function ya(n,e){if(gn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Dc.call(e,s)||!gn(n[s],e[s]))return!1}return!0}function vg(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Eg(n,e){var t=vg(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=vg(t)}}function py(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?py(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function my(){for(var n=window,e=sl();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=sl(n.document)}return e}function wh(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function ZT(n){var e=my(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&py(t.ownerDocument.documentElement,t)){if(r!==null&&wh(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=Eg(t,i);var a=Eg(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var eI=er&&"documentMode"in document&&11>=document.documentMode,$s=null,Jc=null,ea=null,Zc=!1;function Sg(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Zc||$s==null||$s!==sl(r)||(r=$s,"selectionStart"in r&&wh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ea&&ya(ea,r)||(ea=r,r=dl(Jc,"onSelect"),0<r.length&&(e=new Ah("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=$s)))}function lo(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var js={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionend:lo("Transition","TransitionEnd")},Mu={},yy={};er&&(yy=document.createElement("div").style,"AnimationEvent"in window||(delete js.animationend.animation,delete js.animationiteration.animation,delete js.animationstart.animation),"TransitionEvent"in window||delete js.transitionend.transition);function tu(n){if(Mu[n])return Mu[n];if(!js[n])return n;var e=js[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in yy)return Mu[n]=e[t];return n}var vy=tu("animationend"),Ey=tu("animationiteration"),Sy=tu("animationstart"),xy=tu("transitionend"),Ty=new Map,xg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kr(n,e){Ty.set(n,e),Is(e,[n])}for(var Fu=0;Fu<xg.length;Fu++){var Uu=xg[Fu],tI=Uu.toLowerCase(),nI=Uu[0].toUpperCase()+Uu.slice(1);Kr(tI,"on"+nI)}Kr(vy,"onAnimationEnd");Kr(Ey,"onAnimationIteration");Kr(Sy,"onAnimationStart");Kr("dblclick","onDoubleClick");Kr("focusin","onFocus");Kr("focusout","onBlur");Kr(xy,"onTransitionEnd");ci("onMouseEnter",["mouseout","mouseover"]);ci("onMouseLeave",["mouseout","mouseover"]);ci("onPointerEnter",["pointerout","pointerover"]);ci("onPointerLeave",["pointerout","pointerover"]);Is("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Is("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Is("onBeforeInput",["compositionend","keypress","textInput","paste"]);Is("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Is("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Is("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ki="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ki));function Tg(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,tT(r,e,void 0,n),n.currentTarget=null}function Iy(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;Tg(s,o,u),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;Tg(s,o,u),i=l}}}if(al)throw n=Yc,al=!1,Yc=null,n}function Se(n,e){var t=e[sd];t===void 0&&(t=e[sd]=new Set);var r=n+"__bubble";t.has(r)||(Ay(e,n,2,!1),t.add(r))}function Bu(n,e,t){var r=0;e&&(r|=4),Ay(t,n,r,e)}var uo="_reactListening"+Math.random().toString(36).slice(2);function va(n){if(!n[uo]){n[uo]=!0,C0.forEach(function(t){t!=="selectionchange"&&(rI.has(t)||Bu(t,!1,n),Bu(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[uo]||(e[uo]=!0,Bu("selectionchange",!1,e))}}function Ay(n,e,t,r){switch(oy(e)){case 1:var s=yT;break;case 4:s=vT;break;default:s=Th}t=s.bind(null,e,t,n),s=void 0,!zc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function $u(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=os(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}z0(function(){var u=i,c=vh(t),d=[];e:{var h=Ty.get(n);if(h!==void 0){var f=Ah,g=n;switch(n){case"keypress":if(Uo(t)===0)break e;case"keydown":case"keyup":f=DT;break;case"focusin":g="focus",f=Du;break;case"focusout":g="blur",f=Du;break;case"beforeblur":case"afterblur":f=Du;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=cg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=xT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=MT;break;case vy:case Ey:case Sy:f=AT;break;case xy:f=UT;break;case"scroll":f=ET;break;case"wheel":f=$T;break;case"copy":case"cut":case"paste":f=LT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=hg}var m=(e&4)!==0,v=!m&&n==="scroll",p=m?h!==null?h+"Capture":null:h;m=[];for(var y=u,E;y!==null;){E=y;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,p!==null&&(T=ha(y,p),T!=null&&m.push(Ea(y,T,E)))),v)break;y=y.return}0<m.length&&(h=new f(h,g,null,t,c),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==Kc&&(g=t.relatedTarget||t.fromElement)&&(os(g)||g[tr]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=t.relatedTarget||t.toElement,f=u,g=g?os(g):null,g!==null&&(v=As(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(m=cg,T="onMouseLeave",p="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(m=hg,T="onPointerLeave",p="onPointerEnter",y="pointer"),v=f==null?h:Gs(f),E=g==null?h:Gs(g),h=new m(T,y+"leave",f,t,c),h.target=v,h.relatedTarget=E,T=null,os(c)===u&&(m=new m(p,y+"enter",g,t,c),m.target=E,m.relatedTarget=v,T=m),v=T,f&&g)t:{for(m=f,p=g,y=0,E=m;E;E=Rs(E))y++;for(E=0,T=p;T;T=Rs(T))E++;for(;0<y-E;)m=Rs(m),y--;for(;0<E-y;)p=Rs(p),E--;for(;y--;){if(m===p||p!==null&&m===p.alternate)break t;m=Rs(m),p=Rs(p)}m=null}else m=null;f!==null&&Ig(d,h,f,m,!1),g!==null&&v!==null&&Ig(d,v,g,m,!0)}}e:{if(h=u?Gs(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var A=zT;else if(pg(h))if(fy)A=QT;else{A=qT;var w=YT}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(A=XT);if(A&&(A=A(n,u))){hy(d,A,t,c);break e}w&&w(n,h,u),n==="focusout"&&(w=h._wrapperState)&&w.controlled&&h.type==="number"&&$c(h,"number",h.value)}switch(w=u?Gs(u):window,n){case"focusin":(pg(w)||w.contentEditable==="true")&&($s=w,Jc=u,ea=null);break;case"focusout":ea=Jc=$s=null;break;case"mousedown":Zc=!0;break;case"contextmenu":case"mouseup":case"dragend":Zc=!1,Sg(d,t,c);break;case"selectionchange":if(eI)break;case"keydown":case"keyup":Sg(d,t,c)}var _;if(Lh)e:{switch(n){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else Bs?cy(n,t)&&(L="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(L="onCompositionStart");L&&(uy&&t.locale!=="ko"&&(Bs||L!=="onCompositionStart"?L==="onCompositionEnd"&&Bs&&(_=ly()):(Lr=c,Ih="value"in Lr?Lr.value:Lr.textContent,Bs=!0)),w=dl(u,L),0<w.length&&(L=new dg(L,n,null,t,c),d.push({event:L,listeners:w}),_?L.data=_:(_=dy(t),_!==null&&(L.data=_)))),(_=GT?VT(n,t):HT(n,t))&&(u=dl(u,"onBeforeInput"),0<u.length&&(c=new dg("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=_))}Iy(d,e)})}function Ea(n,e,t){return{instance:n,listener:e,currentTarget:t}}function dl(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ha(n,t),i!=null&&r.unshift(Ea(n,i,s)),i=ha(n,e),i!=null&&r.push(Ea(n,i,s))),n=n.return}return r}function Rs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ig(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,s?(l=ha(t,i),l!=null&&a.unshift(Ea(t,l,o))):s||(l=ha(t,i),l!=null&&a.push(Ea(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var sI=/\r\n?/g,iI=/\u0000|\uFFFD/g;function Ag(n){return(typeof n=="string"?n:""+n).replace(sI,`
`).replace(iI,"")}function co(n,e,t){if(e=Ag(e),Ag(n)!==e&&t)throw Error(K(425))}function hl(){}var ed=null,td=null;function nd(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rd=typeof setTimeout=="function"?setTimeout:void 0,aI=typeof clearTimeout=="function"?clearTimeout:void 0,_g=typeof Promise=="function"?Promise:void 0,oI=typeof queueMicrotask=="function"?queueMicrotask:typeof _g<"u"?function(n){return _g.resolve(null).then(n).catch(lI)}:rd;function lI(n){setTimeout(function(){throw n})}function ju(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),pa(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);pa(e)}function Pr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Lg(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ai=Math.random().toString(36).slice(2),Rn="__reactFiber$"+Ai,Sa="__reactProps$"+Ai,tr="__reactContainer$"+Ai,sd="__reactEvents$"+Ai,uI="__reactListeners$"+Ai,cI="__reactHandles$"+Ai;function os(n){var e=n[Rn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[tr]||t[Rn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Lg(n);n!==null;){if(t=n[Rn])return t;n=Lg(n)}return e}n=t,t=n.parentNode}return null}function Va(n){return n=n[Rn]||n[tr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Gs(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(K(33))}function nu(n){return n[Sa]||null}var id=[],Vs=-1;function Wr(n){return{current:n}}function xe(n){0>Vs||(n.current=id[Vs],id[Vs]=null,Vs--)}function ve(n,e){Vs++,id[Vs]=n.current,n.current=e}var Gr={},ct=Wr(Gr),At=Wr(!1),gs=Gr;function di(n,e){var t=n.type.contextTypes;if(!t)return Gr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function _t(n){return n=n.childContextTypes,n!=null}function fl(){xe(At),xe(ct)}function wg(n,e,t){if(ct.current!==Gr)throw Error(K(168));ve(ct,e),ve(At,t)}function _y(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(K(108,Yx(n)||"Unknown",s));return Ce({},t,r)}function gl(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Gr,gs=ct.current,ve(ct,n),ve(At,At.current),!0}function bg(n,e,t){var r=n.stateNode;if(!r)throw Error(K(169));t?(n=_y(n,e,gs),r.__reactInternalMemoizedMergedChildContext=n,xe(At),xe(ct),ve(ct,n)):xe(At),ve(At,t)}var Kn=null,ru=!1,Gu=!1;function Ly(n){Kn===null?Kn=[n]:Kn.push(n)}function dI(n){ru=!0,Ly(n)}function zr(){if(!Gu&&Kn!==null){Gu=!0;var n=0,e=fe;try{var t=Kn;for(fe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Kn=null,ru=!1}catch(s){throw Kn!==null&&(Kn=Kn.slice(n+1)),Q0(Eh,zr),s}finally{fe=e,Gu=!1}}return null}var Hs=[],Ks=0,pl=null,ml=0,Vt=[],Ht=0,ps=null,Yn=1,qn="";function rs(n,e){Hs[Ks++]=ml,Hs[Ks++]=pl,pl=n,ml=e}function wy(n,e,t){Vt[Ht++]=Yn,Vt[Ht++]=qn,Vt[Ht++]=ps,ps=n;var r=Yn;n=qn;var s=32-dn(r)-1;r&=~(1<<s),t+=1;var i=32-dn(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Yn=1<<32-dn(e)+s|t<<s|r,qn=i+n}else Yn=1<<i|t<<s|r,qn=n}function bh(n){n.return!==null&&(rs(n,1),wy(n,1,0))}function Rh(n){for(;n===pl;)pl=Hs[--Ks],Hs[Ks]=null,ml=Hs[--Ks],Hs[Ks]=null;for(;n===ps;)ps=Vt[--Ht],Vt[Ht]=null,qn=Vt[--Ht],Vt[Ht]=null,Yn=Vt[--Ht],Vt[Ht]=null}var Mt=null,Ot=null,Ie=!1,un=null;function by(n,e){var t=Wt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Rg(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Mt=n,Ot=Pr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Mt=n,Ot=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ps!==null?{id:Yn,overflow:qn}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Wt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Mt=n,Ot=null,!0):!1;default:return!1}}function ad(n){return(n.mode&1)!==0&&(n.flags&128)===0}function od(n){if(Ie){var e=Ot;if(e){var t=e;if(!Rg(n,e)){if(ad(n))throw Error(K(418));e=Pr(t.nextSibling);var r=Mt;e&&Rg(n,e)?by(r,t):(n.flags=n.flags&-4097|2,Ie=!1,Mt=n)}}else{if(ad(n))throw Error(K(418));n.flags=n.flags&-4097|2,Ie=!1,Mt=n}}}function kg(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Mt=n}function ho(n){if(n!==Mt)return!1;if(!Ie)return kg(n),Ie=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!nd(n.type,n.memoizedProps)),e&&(e=Ot)){if(ad(n))throw Ry(),Error(K(418));for(;e;)by(n,e),e=Pr(e.nextSibling)}if(kg(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(K(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ot=Pr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ot=null}}else Ot=Mt?Pr(n.stateNode.nextSibling):null;return!0}function Ry(){for(var n=Ot;n;)n=Pr(n.nextSibling)}function hi(){Ot=Mt=null,Ie=!1}function kh(n){un===null?un=[n]:un.push(n)}var hI=ar.ReactCurrentBatchConfig;function Ui(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(K(309));var r=t.stateNode}if(!r)throw Error(K(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(K(284));if(!t._owner)throw Error(K(290,n))}return n}function fo(n,e){throw n=Object.prototype.toString.call(e),Error(K(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Cg(n){var e=n._init;return e(n._payload)}function ky(n){function e(p,y){if(n){var E=p.deletions;E===null?(p.deletions=[y],p.flags|=16):E.push(y)}}function t(p,y){if(!n)return null;for(;y!==null;)e(p,y),y=y.sibling;return null}function r(p,y){for(p=new Map;y!==null;)y.key!==null?p.set(y.key,y):p.set(y.index,y),y=y.sibling;return p}function s(p,y){return p=Mr(p,y),p.index=0,p.sibling=null,p}function i(p,y,E){return p.index=E,n?(E=p.alternate,E!==null?(E=E.index,E<y?(p.flags|=2,y):E):(p.flags|=2,y)):(p.flags|=1048576,y)}function a(p){return n&&p.alternate===null&&(p.flags|=2),p}function o(p,y,E,T){return y===null||y.tag!==6?(y=qu(E,p.mode,T),y.return=p,y):(y=s(y,E),y.return=p,y)}function l(p,y,E,T){var A=E.type;return A===Us?c(p,y,E.props.children,T,E.key):y!==null&&(y.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===mr&&Cg(A)===y.type)?(T=s(y,E.props),T.ref=Ui(p,y,E),T.return=p,T):(T=Ko(E.type,E.key,E.props,null,p.mode,T),T.ref=Ui(p,y,E),T.return=p,T)}function u(p,y,E,T){return y===null||y.tag!==4||y.stateNode.containerInfo!==E.containerInfo||y.stateNode.implementation!==E.implementation?(y=Xu(E,p.mode,T),y.return=p,y):(y=s(y,E.children||[]),y.return=p,y)}function c(p,y,E,T,A){return y===null||y.tag!==7?(y=hs(E,p.mode,T,A),y.return=p,y):(y=s(y,E),y.return=p,y)}function d(p,y,E){if(typeof y=="string"&&y!==""||typeof y=="number")return y=qu(""+y,p.mode,E),y.return=p,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case to:return E=Ko(y.type,y.key,y.props,null,p.mode,E),E.ref=Ui(p,null,y),E.return=p,E;case Fs:return y=Xu(y,p.mode,E),y.return=p,y;case mr:var T=y._init;return d(p,T(y._payload),E)}if(Vi(y)||Di(y))return y=hs(y,p.mode,E,null),y.return=p,y;fo(p,y)}return null}function h(p,y,E,T){var A=y!==null?y.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return A!==null?null:o(p,y,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case to:return E.key===A?l(p,y,E,T):null;case Fs:return E.key===A?u(p,y,E,T):null;case mr:return A=E._init,h(p,y,A(E._payload),T)}if(Vi(E)||Di(E))return A!==null?null:c(p,y,E,T,null);fo(p,E)}return null}function f(p,y,E,T,A){if(typeof T=="string"&&T!==""||typeof T=="number")return p=p.get(E)||null,o(y,p,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case to:return p=p.get(T.key===null?E:T.key)||null,l(y,p,T,A);case Fs:return p=p.get(T.key===null?E:T.key)||null,u(y,p,T,A);case mr:var w=T._init;return f(p,y,E,w(T._payload),A)}if(Vi(T)||Di(T))return p=p.get(E)||null,c(y,p,T,A,null);fo(y,T)}return null}function g(p,y,E,T){for(var A=null,w=null,_=y,L=y=0,b=null;_!==null&&L<E.length;L++){_.index>L?(b=_,_=null):b=_.sibling;var I=h(p,_,E[L],T);if(I===null){_===null&&(_=b);break}n&&_&&I.alternate===null&&e(p,_),y=i(I,y,L),w===null?A=I:w.sibling=I,w=I,_=b}if(L===E.length)return t(p,_),Ie&&rs(p,L),A;if(_===null){for(;L<E.length;L++)_=d(p,E[L],T),_!==null&&(y=i(_,y,L),w===null?A=_:w.sibling=_,w=_);return Ie&&rs(p,L),A}for(_=r(p,_);L<E.length;L++)b=f(_,p,L,E[L],T),b!==null&&(n&&b.alternate!==null&&_.delete(b.key===null?L:b.key),y=i(b,y,L),w===null?A=b:w.sibling=b,w=b);return n&&_.forEach(function(k){return e(p,k)}),Ie&&rs(p,L),A}function m(p,y,E,T){var A=Di(E);if(typeof A!="function")throw Error(K(150));if(E=A.call(E),E==null)throw Error(K(151));for(var w=A=null,_=y,L=y=0,b=null,I=E.next();_!==null&&!I.done;L++,I=E.next()){_.index>L?(b=_,_=null):b=_.sibling;var k=h(p,_,I.value,T);if(k===null){_===null&&(_=b);break}n&&_&&k.alternate===null&&e(p,_),y=i(k,y,L),w===null?A=k:w.sibling=k,w=k,_=b}if(I.done)return t(p,_),Ie&&rs(p,L),A;if(_===null){for(;!I.done;L++,I=E.next())I=d(p,I.value,T),I!==null&&(y=i(I,y,L),w===null?A=I:w.sibling=I,w=I);return Ie&&rs(p,L),A}for(_=r(p,_);!I.done;L++,I=E.next())I=f(_,p,L,I.value,T),I!==null&&(n&&I.alternate!==null&&_.delete(I.key===null?L:I.key),y=i(I,y,L),w===null?A=I:w.sibling=I,w=I);return n&&_.forEach(function(H){return e(p,H)}),Ie&&rs(p,L),A}function v(p,y,E,T){if(typeof E=="object"&&E!==null&&E.type===Us&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case to:e:{for(var A=E.key,w=y;w!==null;){if(w.key===A){if(A=E.type,A===Us){if(w.tag===7){t(p,w.sibling),y=s(w,E.props.children),y.return=p,p=y;break e}}else if(w.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===mr&&Cg(A)===w.type){t(p,w.sibling),y=s(w,E.props),y.ref=Ui(p,w,E),y.return=p,p=y;break e}t(p,w);break}else e(p,w);w=w.sibling}E.type===Us?(y=hs(E.props.children,p.mode,T,E.key),y.return=p,p=y):(T=Ko(E.type,E.key,E.props,null,p.mode,T),T.ref=Ui(p,y,E),T.return=p,p=T)}return a(p);case Fs:e:{for(w=E.key;y!==null;){if(y.key===w)if(y.tag===4&&y.stateNode.containerInfo===E.containerInfo&&y.stateNode.implementation===E.implementation){t(p,y.sibling),y=s(y,E.children||[]),y.return=p,p=y;break e}else{t(p,y);break}else e(p,y);y=y.sibling}y=Xu(E,p.mode,T),y.return=p,p=y}return a(p);case mr:return w=E._init,v(p,y,w(E._payload),T)}if(Vi(E))return g(p,y,E,T);if(Di(E))return m(p,y,E,T);fo(p,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,y!==null&&y.tag===6?(t(p,y.sibling),y=s(y,E),y.return=p,p=y):(t(p,y),y=qu(E,p.mode,T),y.return=p,p=y),a(p)):t(p,y)}return v}var fi=ky(!0),Cy=ky(!1),yl=Wr(null),vl=null,Ws=null,Ch=null;function Ph(){Ch=Ws=vl=null}function Dh(n){var e=yl.current;xe(yl),n._currentValue=e}function ld(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ei(n,e){vl=n,Ch=Ws=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Tt=!0),n.firstContext=null)}function Yt(n){var e=n._currentValue;if(Ch!==n)if(n={context:n,memoizedValue:e,next:null},Ws===null){if(vl===null)throw Error(K(308));Ws=n,vl.dependencies={lanes:0,firstContext:n}}else Ws=Ws.next=n;return e}var ls=null;function Nh(n){ls===null?ls=[n]:ls.push(n)}function Py(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Nh(e)):(t.next=s.next,s.next=t),e.interleaved=t,nr(n,r)}function nr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var yr=!1;function Oh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dy(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Jn(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Dr(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ue&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,nr(n,t)}return s=r.interleaved,s===null?(e.next=e,Nh(r)):(e.next=s.next,s.next=e),r.interleaved=e,nr(n,t)}function Bo(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Sh(n,t)}}function Pg(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function El(n,e,t,r){var s=n.updateQueue;yr=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;a=0,c=u=l=null,o=i;do{var h=o.lane,f=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,m=o;switch(h=e,f=t,m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=Ce({},d,h);break e;case 2:yr=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,h=s.effects,h===null?s.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,a|=h;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;h=o,o=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ys|=a,n.lanes=a,n.memoizedState=d}}function Dg(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(K(191,s));s.call(r)}}}var Ha={},Nn=Wr(Ha),xa=Wr(Ha),Ta=Wr(Ha);function us(n){if(n===Ha)throw Error(K(174));return n}function Mh(n,e){switch(ve(Ta,e),ve(xa,n),ve(Nn,Ha),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Gc(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Gc(e,n)}xe(Nn),ve(Nn,e)}function gi(){xe(Nn),xe(xa),xe(Ta)}function Ny(n){us(Ta.current);var e=us(Nn.current),t=Gc(e,n.type);e!==t&&(ve(xa,n),ve(Nn,t))}function Fh(n){xa.current===n&&(xe(Nn),xe(xa))}var we=Wr(0);function Sl(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Vu=[];function Uh(){for(var n=0;n<Vu.length;n++)Vu[n]._workInProgressVersionPrimary=null;Vu.length=0}var $o=ar.ReactCurrentDispatcher,Hu=ar.ReactCurrentBatchConfig,ms=0,Re=null,He=null,Qe=null,xl=!1,ta=!1,Ia=0,fI=0;function ot(){throw Error(K(321))}function Bh(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!gn(n[t],e[t]))return!1;return!0}function $h(n,e,t,r,s,i){if(ms=i,Re=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$o.current=n===null||n.memoizedState===null?yI:vI,n=t(r,s),ta){i=0;do{if(ta=!1,Ia=0,25<=i)throw Error(K(301));i+=1,Qe=He=null,e.updateQueue=null,$o.current=EI,n=t(r,s)}while(ta)}if($o.current=Tl,e=He!==null&&He.next!==null,ms=0,Qe=He=Re=null,xl=!1,e)throw Error(K(300));return n}function jh(){var n=Ia!==0;return Ia=0,n}function In(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qe===null?Re.memoizedState=Qe=n:Qe=Qe.next=n,Qe}function qt(){if(He===null){var n=Re.alternate;n=n!==null?n.memoizedState:null}else n=He.next;var e=Qe===null?Re.memoizedState:Qe.next;if(e!==null)Qe=e,He=n;else{if(n===null)throw Error(K(310));He=n,n={memoizedState:He.memoizedState,baseState:He.baseState,baseQueue:He.baseQueue,queue:He.queue,next:null},Qe===null?Re.memoizedState=Qe=n:Qe=Qe.next=n}return Qe}function Aa(n,e){return typeof e=="function"?e(n):e}function Ku(n){var e=qt(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=He,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,l=null,u=i;do{var c=u.lane;if((ms&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,Re.lanes|=c,ys|=c}u=u.next}while(u!==null&&u!==i);l===null?a=r:l.next=o,gn(r,e.memoizedState)||(Tt=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Re.lanes|=i,ys|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Wu(n){var e=qt(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);gn(i,e.memoizedState)||(Tt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Oy(){}function My(n,e){var t=Re,r=qt(),s=e(),i=!gn(r.memoizedState,s);if(i&&(r.memoizedState=s,Tt=!0),r=r.queue,Gh(By.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Qe!==null&&Qe.memoizedState.tag&1){if(t.flags|=2048,_a(9,Uy.bind(null,t,r,s,e),void 0,null),Je===null)throw Error(K(349));ms&30||Fy(t,e,s)}return s}function Fy(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Re.updateQueue,e===null?(e={lastEffect:null,stores:null},Re.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Uy(n,e,t,r){e.value=t,e.getSnapshot=r,$y(e)&&jy(n)}function By(n,e,t){return t(function(){$y(e)&&jy(n)})}function $y(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!gn(n,t)}catch{return!0}}function jy(n){var e=nr(n,1);e!==null&&hn(e,n,1,-1)}function Ng(n){var e=In();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:n},e.queue=n,n=n.dispatch=mI.bind(null,Re,n),[e.memoizedState,n]}function _a(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Re.updateQueue,e===null?(e={lastEffect:null,stores:null},Re.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Gy(){return qt().memoizedState}function jo(n,e,t,r){var s=In();Re.flags|=n,s.memoizedState=_a(1|e,t,void 0,r===void 0?null:r)}function su(n,e,t,r){var s=qt();r=r===void 0?null:r;var i=void 0;if(He!==null){var a=He.memoizedState;if(i=a.destroy,r!==null&&Bh(r,a.deps)){s.memoizedState=_a(e,t,i,r);return}}Re.flags|=n,s.memoizedState=_a(1|e,t,i,r)}function Og(n,e){return jo(8390656,8,n,e)}function Gh(n,e){return su(2048,8,n,e)}function Vy(n,e){return su(4,2,n,e)}function Hy(n,e){return su(4,4,n,e)}function Ky(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Wy(n,e,t){return t=t!=null?t.concat([n]):null,su(4,4,Ky.bind(null,e,n),t)}function Vh(){}function zy(n,e){var t=qt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Bh(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Yy(n,e){var t=qt();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Bh(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function qy(n,e,t){return ms&21?(gn(t,e)||(t=ey(),Re.lanes|=t,ys|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Tt=!0),n.memoizedState=t)}function gI(n,e){var t=fe;fe=t!==0&&4>t?t:4,n(!0);var r=Hu.transition;Hu.transition={};try{n(!1),e()}finally{fe=t,Hu.transition=r}}function Xy(){return qt().memoizedState}function pI(n,e,t){var r=Or(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Qy(n))Jy(e,t);else if(t=Py(n,e,t,r),t!==null){var s=gt();hn(t,n,r,s),Zy(t,e,r)}}function mI(n,e,t){var r=Or(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Qy(n))Jy(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(s.hasEagerState=!0,s.eagerState=o,gn(o,a)){var l=e.interleaved;l===null?(s.next=s,Nh(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=Py(n,e,s,r),t!==null&&(s=gt(),hn(t,n,r,s),Zy(t,e,r))}}function Qy(n){var e=n.alternate;return n===Re||e!==null&&e===Re}function Jy(n,e){ta=xl=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Zy(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Sh(n,t)}}var Tl={readContext:Yt,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useInsertionEffect:ot,useLayoutEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useMutableSource:ot,useSyncExternalStore:ot,useId:ot,unstable_isNewReconciler:!1},yI={readContext:Yt,useCallback:function(n,e){return In().memoizedState=[n,e===void 0?null:e],n},useContext:Yt,useEffect:Og,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,jo(4194308,4,Ky.bind(null,e,n),t)},useLayoutEffect:function(n,e){return jo(4194308,4,n,e)},useInsertionEffect:function(n,e){return jo(4,2,n,e)},useMemo:function(n,e){var t=In();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=In();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=pI.bind(null,Re,n),[r.memoizedState,n]},useRef:function(n){var e=In();return n={current:n},e.memoizedState=n},useState:Ng,useDebugValue:Vh,useDeferredValue:function(n){return In().memoizedState=n},useTransition:function(){var n=Ng(!1),e=n[0];return n=gI.bind(null,n[1]),In().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Re,s=In();if(Ie){if(t===void 0)throw Error(K(407));t=t()}else{if(t=e(),Je===null)throw Error(K(349));ms&30||Fy(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Og(By.bind(null,r,i,n),[n]),r.flags|=2048,_a(9,Uy.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=In(),e=Je.identifierPrefix;if(Ie){var t=qn,r=Yn;t=(r&~(1<<32-dn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ia++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=fI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},vI={readContext:Yt,useCallback:zy,useContext:Yt,useEffect:Gh,useImperativeHandle:Wy,useInsertionEffect:Vy,useLayoutEffect:Hy,useMemo:Yy,useReducer:Ku,useRef:Gy,useState:function(){return Ku(Aa)},useDebugValue:Vh,useDeferredValue:function(n){var e=qt();return qy(e,He.memoizedState,n)},useTransition:function(){var n=Ku(Aa)[0],e=qt().memoizedState;return[n,e]},useMutableSource:Oy,useSyncExternalStore:My,useId:Xy,unstable_isNewReconciler:!1},EI={readContext:Yt,useCallback:zy,useContext:Yt,useEffect:Gh,useImperativeHandle:Wy,useInsertionEffect:Vy,useLayoutEffect:Hy,useMemo:Yy,useReducer:Wu,useRef:Gy,useState:function(){return Wu(Aa)},useDebugValue:Vh,useDeferredValue:function(n){var e=qt();return He===null?e.memoizedState=n:qy(e,He.memoizedState,n)},useTransition:function(){var n=Wu(Aa)[0],e=qt().memoizedState;return[n,e]},useMutableSource:Oy,useSyncExternalStore:My,useId:Xy,unstable_isNewReconciler:!1};function on(n,e){if(n&&n.defaultProps){e=Ce({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ud(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ce({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var iu={isMounted:function(n){return(n=n._reactInternals)?As(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=gt(),s=Or(n),i=Jn(r,s);i.payload=e,t!=null&&(i.callback=t),e=Dr(n,i,s),e!==null&&(hn(e,n,s,r),Bo(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=gt(),s=Or(n),i=Jn(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Dr(n,i,s),e!==null&&(hn(e,n,s,r),Bo(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=gt(),r=Or(n),s=Jn(t,r);s.tag=2,e!=null&&(s.callback=e),e=Dr(n,s,r),e!==null&&(hn(e,n,r,t),Bo(e,n,r))}};function Mg(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!ya(t,r)||!ya(s,i):!0}function ev(n,e,t){var r=!1,s=Gr,i=e.contextType;return typeof i=="object"&&i!==null?i=Yt(i):(s=_t(e)?gs:ct.current,r=e.contextTypes,i=(r=r!=null)?di(n,s):Gr),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=iu,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Fg(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&iu.enqueueReplaceState(e,e.state,null)}function cd(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Oh(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Yt(i):(i=_t(e)?gs:ct.current,s.context=di(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(ud(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&iu.enqueueReplaceState(s,s.state,null),El(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function pi(n,e){try{var t="",r=e;do t+=zx(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function zu(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function dd(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var SI=typeof WeakMap=="function"?WeakMap:Map;function tv(n,e,t){t=Jn(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Al||(Al=!0,xd=r),dd(n,e)},t}function nv(n,e,t){t=Jn(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){dd(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){dd(n,e),typeof r!="function"&&(Nr===null?Nr=new Set([this]):Nr.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Ug(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new SI;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=NI.bind(null,n,e,t),e.then(n,n))}function Bg(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function $g(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Jn(-1,1),e.tag=2,Dr(t,e,1))),t.lanes|=1),n)}var xI=ar.ReactCurrentOwner,Tt=!1;function dt(n,e,t,r){e.child=n===null?Cy(e,null,t,r):fi(e,n.child,t,r)}function jg(n,e,t,r,s){t=t.render;var i=e.ref;return ei(e,s),r=$h(n,e,t,r,i,s),t=jh(),n!==null&&!Tt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,rr(n,e,s)):(Ie&&t&&bh(e),e.flags|=1,dt(n,e,r,s),e.child)}function Gg(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!Qh(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,rv(n,e,i,r,s)):(n=Ko(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:ya,t(a,r)&&n.ref===e.ref)return rr(n,e,s)}return e.flags|=1,n=Mr(i,r),n.ref=e.ref,n.return=e,e.child=n}function rv(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(ya(i,r)&&n.ref===e.ref)if(Tt=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Tt=!0);else return e.lanes=n.lanes,rr(n,e,s)}return hd(n,e,t,r,s)}function sv(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ve(Ys,Dt),Dt|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ve(Ys,Dt),Dt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,ve(Ys,Dt),Dt|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,ve(Ys,Dt),Dt|=r;return dt(n,e,s,t),e.child}function iv(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function hd(n,e,t,r,s){var i=_t(t)?gs:ct.current;return i=di(e,i),ei(e,s),t=$h(n,e,t,r,i,s),r=jh(),n!==null&&!Tt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,rr(n,e,s)):(Ie&&r&&bh(e),e.flags|=1,dt(n,e,t,s),e.child)}function Vg(n,e,t,r,s){if(_t(t)){var i=!0;gl(e)}else i=!1;if(ei(e,s),e.stateNode===null)Go(n,e),ev(e,t,r),cd(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Yt(u):(u=_t(t)?gs:ct.current,u=di(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&Fg(e,a,r,u),yr=!1;var h=e.memoizedState;a.state=h,El(e,r,a,s),l=e.memoizedState,o!==r||h!==l||At.current||yr?(typeof c=="function"&&(ud(e,t,c,r),l=e.memoizedState),(o=yr||Mg(e,t,o,r,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Dy(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:on(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Yt(l):(l=_t(t)?gs:ct.current,l=di(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&Fg(e,a,r,l),yr=!1,h=e.memoizedState,a.state=h,El(e,r,a,s);var g=e.memoizedState;o!==d||h!==g||At.current||yr?(typeof f=="function"&&(ud(e,t,f,r),g=e.memoizedState),(u=yr||Mg(e,t,u,r,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return fd(n,e,t,r,i,s)}function fd(n,e,t,r,s,i){iv(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&bg(e,t,!1),rr(n,e,i);r=e.stateNode,xI.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=fi(e,n.child,null,i),e.child=fi(e,null,o,i)):dt(n,e,o,i),e.memoizedState=r.state,s&&bg(e,t,!0),e.child}function av(n){var e=n.stateNode;e.pendingContext?wg(n,e.pendingContext,e.pendingContext!==e.context):e.context&&wg(n,e.context,!1),Mh(n,e.containerInfo)}function Hg(n,e,t,r,s){return hi(),kh(s),e.flags|=256,dt(n,e,t,r),e.child}var gd={dehydrated:null,treeContext:null,retryLane:0};function pd(n){return{baseLanes:n,cachePool:null,transitions:null}}function ov(n,e,t){var r=e.pendingProps,s=we.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),ve(we,s&1),n===null)return od(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=lu(a,r,0,null),n=hs(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=pd(t),e.memoizedState=gd,n):Hh(e,a));if(s=n.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return TI(n,e,a,r,o,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Mr(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=Mr(o,i):(i=hs(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?pd(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=gd,r}return i=n.child,n=i.sibling,r=Mr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Hh(n,e){return e=lu({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function go(n,e,t,r){return r!==null&&kh(r),fi(e,n.child,null,t),n=Hh(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function TI(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=zu(Error(K(422))),go(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=lu({mode:"visible",children:r.children},s,0,null),i=hs(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&fi(e,n.child,null,a),e.child.memoizedState=pd(a),e.memoizedState=gd,i);if(!(e.mode&1))return go(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(K(419)),r=zu(i,r,void 0),go(n,e,a,r)}if(o=(a&n.childLanes)!==0,Tt||o){if(r=Je,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,nr(n,s),hn(r,n,s,-1))}return Xh(),r=zu(Error(K(421))),go(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=OI.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Ot=Pr(s.nextSibling),Mt=e,Ie=!0,un=null,n!==null&&(Vt[Ht++]=Yn,Vt[Ht++]=qn,Vt[Ht++]=ps,Yn=n.id,qn=n.overflow,ps=e),e=Hh(e,r.children),e.flags|=4096,e)}function Kg(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),ld(n.return,e,t)}function Yu(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function lv(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(dt(n,e,r.children,t),r=we.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Kg(n,t,e);else if(n.tag===19)Kg(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(ve(we,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Sl(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Yu(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Sl(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Yu(e,!0,t,null,i);break;case"together":Yu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Go(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function rr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ys|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(K(153));if(e.child!==null){for(n=e.child,t=Mr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Mr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function II(n,e,t){switch(e.tag){case 3:av(e),hi();break;case 5:Ny(e);break;case 1:_t(e.type)&&gl(e);break;case 4:Mh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ve(yl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ve(we,we.current&1),e.flags|=128,null):t&e.child.childLanes?ov(n,e,t):(ve(we,we.current&1),n=rr(n,e,t),n!==null?n.sibling:null);ve(we,we.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return lv(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ve(we,we.current),r)break;return null;case 22:case 23:return e.lanes=0,sv(n,e,t)}return rr(n,e,t)}var uv,md,cv,dv;uv=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};md=function(){};cv=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,us(Nn.current);var i=null;switch(t){case"input":s=Uc(n,s),r=Uc(n,r),i=[];break;case"select":s=Ce({},s,{value:void 0}),r=Ce({},r,{value:void 0}),i=[];break;case"textarea":s=jc(n,s),r=jc(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=hl)}Vc(t,r);var a;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ca.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ca.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Se("scroll",n),i||o===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};dv=function(n,e,t,r){t!==r&&(e.flags|=4)};function Bi(n,e){if(!Ie)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function lt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function AI(n,e,t){var r=e.pendingProps;switch(Rh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lt(e),null;case 1:return _t(e.type)&&fl(),lt(e),null;case 3:return r=e.stateNode,gi(),xe(At),xe(ct),Uh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(ho(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,un!==null&&(Ad(un),un=null))),md(n,e),lt(e),null;case 5:Fh(e);var s=us(Ta.current);if(t=e.type,n!==null&&e.stateNode!=null)cv(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(K(166));return lt(e),null}if(n=us(Nn.current),ho(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Rn]=e,r[Sa]=i,n=(e.mode&1)!==0,t){case"dialog":Se("cancel",r),Se("close",r);break;case"iframe":case"object":case"embed":Se("load",r);break;case"video":case"audio":for(s=0;s<Ki.length;s++)Se(Ki[s],r);break;case"source":Se("error",r);break;case"img":case"image":case"link":Se("error",r),Se("load",r);break;case"details":Se("toggle",r);break;case"input":eg(r,i),Se("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Se("invalid",r);break;case"textarea":ng(r,i),Se("invalid",r)}Vc(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&co(r.textContent,o,n),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&co(r.textContent,o,n),s=["children",""+o]):ca.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Se("scroll",r)}switch(t){case"input":no(r),tg(r,i,!0);break;case"textarea":no(r),rg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=hl)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=B0(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Rn]=e,n[Sa]=r,uv(n,e,!1,!1),e.stateNode=n;e:{switch(a=Hc(t,r),t){case"dialog":Se("cancel",n),Se("close",n),s=r;break;case"iframe":case"object":case"embed":Se("load",n),s=r;break;case"video":case"audio":for(s=0;s<Ki.length;s++)Se(Ki[s],n);s=r;break;case"source":Se("error",n),s=r;break;case"img":case"image":case"link":Se("error",n),Se("load",n),s=r;break;case"details":Se("toggle",n),s=r;break;case"input":eg(n,r),s=Uc(n,r),Se("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Ce({},r,{value:void 0}),Se("invalid",n);break;case"textarea":ng(n,r),s=jc(n,r),Se("invalid",n);break;default:s=r}Vc(t,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?G0(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&$0(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&da(n,l):typeof l=="number"&&da(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ca.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Se("scroll",n):l!=null&&gh(n,i,l,a))}switch(t){case"input":no(n),tg(n,r,!1);break;case"textarea":no(n),rg(n);break;case"option":r.value!=null&&n.setAttribute("value",""+jr(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Xs(n,!!r.multiple,i,!1):r.defaultValue!=null&&Xs(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=hl)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return lt(e),null;case 6:if(n&&e.stateNode!=null)dv(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(K(166));if(t=us(Ta.current),us(Nn.current),ho(e)){if(r=e.stateNode,t=e.memoizedProps,r[Rn]=e,(i=r.nodeValue!==t)&&(n=Mt,n!==null))switch(n.tag){case 3:co(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&co(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Rn]=e,e.stateNode=r}return lt(e),null;case 13:if(xe(we),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ie&&Ot!==null&&e.mode&1&&!(e.flags&128))Ry(),hi(),e.flags|=98560,i=!1;else if(i=ho(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(K(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(K(317));i[Rn]=e}else hi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;lt(e),i=!1}else un!==null&&(Ad(un),un=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||we.current&1?We===0&&(We=3):Xh())),e.updateQueue!==null&&(e.flags|=4),lt(e),null);case 4:return gi(),md(n,e),n===null&&va(e.stateNode.containerInfo),lt(e),null;case 10:return Dh(e.type._context),lt(e),null;case 17:return _t(e.type)&&fl(),lt(e),null;case 19:if(xe(we),i=e.memoizedState,i===null)return lt(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Bi(i,!1);else{if(We!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Sl(n),a!==null){for(e.flags|=128,Bi(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ve(we,we.current&1|2),e.child}n=n.sibling}i.tail!==null&&Fe()>mi&&(e.flags|=128,r=!0,Bi(i,!1),e.lanes=4194304)}else{if(!r)if(n=Sl(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Bi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ie)return lt(e),null}else 2*Fe()-i.renderingStartTime>mi&&t!==1073741824&&(e.flags|=128,r=!0,Bi(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Fe(),e.sibling=null,t=we.current,ve(we,r?t&1|2:t&1),e):(lt(e),null);case 22:case 23:return qh(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Dt&1073741824&&(lt(e),e.subtreeFlags&6&&(e.flags|=8192)):lt(e),null;case 24:return null;case 25:return null}throw Error(K(156,e.tag))}function _I(n,e){switch(Rh(e),e.tag){case 1:return _t(e.type)&&fl(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return gi(),xe(At),xe(ct),Uh(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Fh(e),null;case 13:if(xe(we),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(K(340));hi()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return xe(we),null;case 4:return gi(),null;case 10:return Dh(e.type._context),null;case 22:case 23:return qh(),null;case 24:return null;default:return null}}var po=!1,ut=!1,LI=typeof WeakSet=="function"?WeakSet:Set,q=null;function zs(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ne(n,e,r)}else t.current=null}function yd(n,e,t){try{t()}catch(r){Ne(n,e,r)}}var Wg=!1;function wI(n,e){if(ed=ul,n=my(),wh(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=n,h=null;t:for(;;){for(var f;d!==t||s!==0&&d.nodeType!==3||(o=a+s),d!==i||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++u===s&&(o=a),h===i&&++c===r&&(l=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(td={focusedElem:n,selectionRange:t},ul=!1,q=e;q!==null;)if(e=q,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,q=n;else for(;q!==null;){e=q;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,v=g.memoizedState,p=e.stateNode,y=p.getSnapshotBeforeUpdate(e.elementType===e.type?m:on(e.type,m),v);p.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(T){Ne(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,q=n;break}q=e.return}return g=Wg,Wg=!1,g}function na(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&yd(e,t,i)}s=s.next}while(s!==r)}}function au(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function vd(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function hv(n){var e=n.alternate;e!==null&&(n.alternate=null,hv(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Rn],delete e[Sa],delete e[sd],delete e[uI],delete e[cI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function fv(n){return n.tag===5||n.tag===3||n.tag===4}function zg(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||fv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Ed(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=hl));else if(r!==4&&(n=n.child,n!==null))for(Ed(n,e,t),n=n.sibling;n!==null;)Ed(n,e,t),n=n.sibling}function Sd(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Sd(n,e,t),n=n.sibling;n!==null;)Sd(n,e,t),n=n.sibling}var tt=null,ln=!1;function dr(n,e,t){for(t=t.child;t!==null;)gv(n,e,t),t=t.sibling}function gv(n,e,t){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(Jl,t)}catch{}switch(t.tag){case 5:ut||zs(t,e);case 6:var r=tt,s=ln;tt=null,dr(n,e,t),tt=r,ln=s,tt!==null&&(ln?(n=tt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):tt.removeChild(t.stateNode));break;case 18:tt!==null&&(ln?(n=tt,t=t.stateNode,n.nodeType===8?ju(n.parentNode,t):n.nodeType===1&&ju(n,t),pa(n)):ju(tt,t.stateNode));break;case 4:r=tt,s=ln,tt=t.stateNode.containerInfo,ln=!0,dr(n,e,t),tt=r,ln=s;break;case 0:case 11:case 14:case 15:if(!ut&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&yd(t,e,a),s=s.next}while(s!==r)}dr(n,e,t);break;case 1:if(!ut&&(zs(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){Ne(t,e,o)}dr(n,e,t);break;case 21:dr(n,e,t);break;case 22:t.mode&1?(ut=(r=ut)||t.memoizedState!==null,dr(n,e,t),ut=r):dr(n,e,t);break;default:dr(n,e,t)}}function Yg(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new LI),e.forEach(function(r){var s=MI.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function tn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:tt=o.stateNode,ln=!1;break e;case 3:tt=o.stateNode.containerInfo,ln=!0;break e;case 4:tt=o.stateNode.containerInfo,ln=!0;break e}o=o.return}if(tt===null)throw Error(K(160));gv(i,a,s),tt=null,ln=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Ne(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)pv(e,n),e=e.sibling}function pv(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(tn(e,n),vn(n),r&4){try{na(3,n,n.return),au(3,n)}catch(m){Ne(n,n.return,m)}try{na(5,n,n.return)}catch(m){Ne(n,n.return,m)}}break;case 1:tn(e,n),vn(n),r&512&&t!==null&&zs(t,t.return);break;case 5:if(tn(e,n),vn(n),r&512&&t!==null&&zs(t,t.return),n.flags&32){var s=n.stateNode;try{da(s,"")}catch(m){Ne(n,n.return,m)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&F0(s,i),Hc(o,a);var u=Hc(o,i);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?G0(s,d):c==="dangerouslySetInnerHTML"?$0(s,d):c==="children"?da(s,d):gh(s,c,d,u)}switch(o){case"input":Bc(s,i);break;case"textarea":U0(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Xs(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?Xs(s,!!i.multiple,i.defaultValue,!0):Xs(s,!!i.multiple,i.multiple?[]:"",!1))}s[Sa]=i}catch(m){Ne(n,n.return,m)}}break;case 6:if(tn(e,n),vn(n),r&4){if(n.stateNode===null)throw Error(K(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(m){Ne(n,n.return,m)}}break;case 3:if(tn(e,n),vn(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{pa(e.containerInfo)}catch(m){Ne(n,n.return,m)}break;case 4:tn(e,n),vn(n);break;case 13:tn(e,n),vn(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(zh=Fe())),r&4&&Yg(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(ut=(u=ut)||c,tn(e,n),ut=u):tn(e,n),vn(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(q=n,c=n.child;c!==null;){for(d=q=c;q!==null;){switch(h=q,f=h.child,h.tag){case 0:case 11:case 14:case 15:na(4,h,h.return);break;case 1:zs(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){Ne(r,t,m)}}break;case 5:zs(h,h.return);break;case 22:if(h.memoizedState!==null){Xg(d);continue}}f!==null?(f.return=h,q=f):Xg(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=j0("display",a))}catch(m){Ne(n,n.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Ne(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:tn(e,n),vn(n),r&4&&Yg(n);break;case 21:break;default:tn(e,n),vn(n)}}function vn(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(fv(t)){var r=t;break e}t=t.return}throw Error(K(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(da(s,""),r.flags&=-33);var i=zg(n);Sd(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=zg(n);Ed(n,o,a);break;default:throw Error(K(161))}}catch(l){Ne(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function bI(n,e,t){q=n,mv(n)}function mv(n,e,t){for(var r=(n.mode&1)!==0;q!==null;){var s=q,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||po;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||ut;o=po;var u=ut;if(po=a,(ut=l)&&!u)for(q=s;q!==null;)a=q,l=a.child,a.tag===22&&a.memoizedState!==null?Qg(s):l!==null?(l.return=a,q=l):Qg(s);for(;i!==null;)q=i,mv(i),i=i.sibling;q=s,po=o,ut=u}qg(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,q=i):qg(n)}}function qg(n){for(;q!==null;){var e=q;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ut||au(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ut)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:on(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Dg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Dg(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&pa(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}ut||e.flags&512&&vd(e)}catch(h){Ne(e,e.return,h)}}if(e===n){q=null;break}if(t=e.sibling,t!==null){t.return=e.return,q=t;break}q=e.return}}function Xg(n){for(;q!==null;){var e=q;if(e===n){q=null;break}var t=e.sibling;if(t!==null){t.return=e.return,q=t;break}q=e.return}}function Qg(n){for(;q!==null;){var e=q;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{au(4,e)}catch(l){Ne(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Ne(e,s,l)}}var i=e.return;try{vd(e)}catch(l){Ne(e,i,l)}break;case 5:var a=e.return;try{vd(e)}catch(l){Ne(e,a,l)}}}catch(l){Ne(e,e.return,l)}if(e===n){q=null;break}var o=e.sibling;if(o!==null){o.return=e.return,q=o;break}q=e.return}}var RI=Math.ceil,Il=ar.ReactCurrentDispatcher,Kh=ar.ReactCurrentOwner,zt=ar.ReactCurrentBatchConfig,ue=0,Je=null,je=null,it=0,Dt=0,Ys=Wr(0),We=0,La=null,ys=0,ou=0,Wh=0,ra=null,xt=null,zh=0,mi=1/0,Gn=null,Al=!1,xd=null,Nr=null,mo=!1,wr=null,_l=0,sa=0,Td=null,Vo=-1,Ho=0;function gt(){return ue&6?Fe():Vo!==-1?Vo:Vo=Fe()}function Or(n){return n.mode&1?ue&2&&it!==0?it&-it:hI.transition!==null?(Ho===0&&(Ho=ey()),Ho):(n=fe,n!==0||(n=window.event,n=n===void 0?16:oy(n.type)),n):1}function hn(n,e,t,r){if(50<sa)throw sa=0,Td=null,Error(K(185));ja(n,t,r),(!(ue&2)||n!==Je)&&(n===Je&&(!(ue&2)&&(ou|=t),We===4&&Tr(n,it)),Lt(n,r),t===1&&ue===0&&!(e.mode&1)&&(mi=Fe()+500,ru&&zr()))}function Lt(n,e){var t=n.callbackNode;hT(n,e);var r=ll(n,n===Je?it:0);if(r===0)t!==null&&ag(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&ag(t),e===1)n.tag===0?dI(Jg.bind(null,n)):Ly(Jg.bind(null,n)),oI(function(){!(ue&6)&&zr()}),t=null;else{switch(ty(r)){case 1:t=Eh;break;case 4:t=J0;break;case 16:t=ol;break;case 536870912:t=Z0;break;default:t=ol}t=Av(t,yv.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function yv(n,e){if(Vo=-1,Ho=0,ue&6)throw Error(K(327));var t=n.callbackNode;if(ti()&&n.callbackNode!==t)return null;var r=ll(n,n===Je?it:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ll(n,r);else{e=r;var s=ue;ue|=2;var i=Ev();(Je!==n||it!==e)&&(Gn=null,mi=Fe()+500,ds(n,e));do try{PI();break}catch(o){vv(n,o)}while(!0);Ph(),Il.current=i,ue=s,je!==null?e=0:(Je=null,it=0,e=We)}if(e!==0){if(e===2&&(s=qc(n),s!==0&&(r=s,e=Id(n,s))),e===1)throw t=La,ds(n,0),Tr(n,r),Lt(n,Fe()),t;if(e===6)Tr(n,r);else{if(s=n.current.alternate,!(r&30)&&!kI(s)&&(e=Ll(n,r),e===2&&(i=qc(n),i!==0&&(r=i,e=Id(n,i))),e===1))throw t=La,ds(n,0),Tr(n,r),Lt(n,Fe()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(K(345));case 2:ss(n,xt,Gn);break;case 3:if(Tr(n,r),(r&130023424)===r&&(e=zh+500-Fe(),10<e)){if(ll(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){gt(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=rd(ss.bind(null,n,xt,Gn),e);break}ss(n,xt,Gn);break;case 4:if(Tr(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-dn(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Fe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*RI(r/1960))-r,10<r){n.timeoutHandle=rd(ss.bind(null,n,xt,Gn),r);break}ss(n,xt,Gn);break;case 5:ss(n,xt,Gn);break;default:throw Error(K(329))}}}return Lt(n,Fe()),n.callbackNode===t?yv.bind(null,n):null}function Id(n,e){var t=ra;return n.current.memoizedState.isDehydrated&&(ds(n,e).flags|=256),n=Ll(n,e),n!==2&&(e=xt,xt=t,e!==null&&Ad(e)),n}function Ad(n){xt===null?xt=n:xt.push.apply(xt,n)}function kI(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!gn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Tr(n,e){for(e&=~Wh,e&=~ou,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-dn(e),r=1<<t;n[t]=-1,e&=~r}}function Jg(n){if(ue&6)throw Error(K(327));ti();var e=ll(n,0);if(!(e&1))return Lt(n,Fe()),null;var t=Ll(n,e);if(n.tag!==0&&t===2){var r=qc(n);r!==0&&(e=r,t=Id(n,r))}if(t===1)throw t=La,ds(n,0),Tr(n,e),Lt(n,Fe()),t;if(t===6)throw Error(K(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ss(n,xt,Gn),Lt(n,Fe()),null}function Yh(n,e){var t=ue;ue|=1;try{return n(e)}finally{ue=t,ue===0&&(mi=Fe()+500,ru&&zr())}}function vs(n){wr!==null&&wr.tag===0&&!(ue&6)&&ti();var e=ue;ue|=1;var t=zt.transition,r=fe;try{if(zt.transition=null,fe=1,n)return n()}finally{fe=r,zt.transition=t,ue=e,!(ue&6)&&zr()}}function qh(){Dt=Ys.current,xe(Ys)}function ds(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,aI(t)),je!==null)for(t=je.return;t!==null;){var r=t;switch(Rh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&fl();break;case 3:gi(),xe(At),xe(ct),Uh();break;case 5:Fh(r);break;case 4:gi();break;case 13:xe(we);break;case 19:xe(we);break;case 10:Dh(r.type._context);break;case 22:case 23:qh()}t=t.return}if(Je=n,je=n=Mr(n.current,null),it=Dt=e,We=0,La=null,Wh=ou=ys=0,xt=ra=null,ls!==null){for(e=0;e<ls.length;e++)if(t=ls[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}ls=null}return n}function vv(n,e){do{var t=je;try{if(Ph(),$o.current=Tl,xl){for(var r=Re.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xl=!1}if(ms=0,Qe=He=Re=null,ta=!1,Ia=0,Kh.current=null,t===null||t.return===null){We=1,La=e,je=null;break}e:{var i=n,a=t.return,o=t,l=e;if(e=it,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Bg(a);if(f!==null){f.flags&=-257,$g(f,a,o,i,e),f.mode&1&&Ug(i,u,e),e=f,l=u;var g=e.updateQueue;if(g===null){var m=new Set;m.add(l),e.updateQueue=m}else g.add(l);break e}else{if(!(e&1)){Ug(i,u,e),Xh();break e}l=Error(K(426))}}else if(Ie&&o.mode&1){var v=Bg(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),$g(v,a,o,i,e),kh(pi(l,o));break e}}i=l=pi(l,o),We!==4&&(We=2),ra===null?ra=[i]:ra.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var p=tv(i,l,e);Pg(i,p);break e;case 1:o=l;var y=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Nr===null||!Nr.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=nv(i,o,e);Pg(i,T);break e}}i=i.return}while(i!==null)}xv(t)}catch(A){e=A,je===t&&t!==null&&(je=t=t.return);continue}break}while(!0)}function Ev(){var n=Il.current;return Il.current=Tl,n===null?Tl:n}function Xh(){(We===0||We===3||We===2)&&(We=4),Je===null||!(ys&268435455)&&!(ou&268435455)||Tr(Je,it)}function Ll(n,e){var t=ue;ue|=2;var r=Ev();(Je!==n||it!==e)&&(Gn=null,ds(n,e));do try{CI();break}catch(s){vv(n,s)}while(!0);if(Ph(),ue=t,Il.current=r,je!==null)throw Error(K(261));return Je=null,it=0,We}function CI(){for(;je!==null;)Sv(je)}function PI(){for(;je!==null&&!rT();)Sv(je)}function Sv(n){var e=Iv(n.alternate,n,Dt);n.memoizedProps=n.pendingProps,e===null?xv(n):je=e,Kh.current=null}function xv(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=_I(t,e),t!==null){t.flags&=32767,je=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{We=6,je=null;return}}else if(t=AI(t,e,Dt),t!==null){je=t;return}if(e=e.sibling,e!==null){je=e;return}je=e=n}while(e!==null);We===0&&(We=5)}function ss(n,e,t){var r=fe,s=zt.transition;try{zt.transition=null,fe=1,DI(n,e,t,r)}finally{zt.transition=s,fe=r}return null}function DI(n,e,t,r){do ti();while(wr!==null);if(ue&6)throw Error(K(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(K(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(fT(n,i),n===Je&&(je=Je=null,it=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||mo||(mo=!0,Av(ol,function(){return ti(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=zt.transition,zt.transition=null;var a=fe;fe=1;var o=ue;ue|=4,Kh.current=null,wI(n,t),pv(t,n),ZT(td),ul=!!ed,td=ed=null,n.current=t,bI(t),sT(),ue=o,fe=a,zt.transition=i}else n.current=t;if(mo&&(mo=!1,wr=n,_l=s),i=n.pendingLanes,i===0&&(Nr=null),oT(t.stateNode),Lt(n,Fe()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Al)throw Al=!1,n=xd,xd=null,n;return _l&1&&n.tag!==0&&ti(),i=n.pendingLanes,i&1?n===Td?sa++:(sa=0,Td=n):sa=0,zr(),null}function ti(){if(wr!==null){var n=ty(_l),e=zt.transition,t=fe;try{if(zt.transition=null,fe=16>n?16:n,wr===null)var r=!1;else{if(n=wr,wr=null,_l=0,ue&6)throw Error(K(331));var s=ue;for(ue|=4,q=n.current;q!==null;){var i=q,a=i.child;if(q.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(q=u;q!==null;){var c=q;switch(c.tag){case 0:case 11:case 15:na(8,c,i)}var d=c.child;if(d!==null)d.return=c,q=d;else for(;q!==null;){c=q;var h=c.sibling,f=c.return;if(hv(c),c===u){q=null;break}if(h!==null){h.return=f,q=h;break}q=f}}}var g=i.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}q=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,q=a;else e:for(;q!==null;){if(i=q,i.flags&2048)switch(i.tag){case 0:case 11:case 15:na(9,i,i.return)}var p=i.sibling;if(p!==null){p.return=i.return,q=p;break e}q=i.return}}var y=n.current;for(q=y;q!==null;){a=q;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,q=E;else e:for(a=y;q!==null;){if(o=q,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:au(9,o)}}catch(A){Ne(o,o.return,A)}if(o===a){q=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,q=T;break e}q=o.return}}if(ue=s,zr(),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(Jl,n)}catch{}r=!0}return r}finally{fe=t,zt.transition=e}}return!1}function Zg(n,e,t){e=pi(t,e),e=tv(n,e,1),n=Dr(n,e,1),e=gt(),n!==null&&(ja(n,1,e),Lt(n,e))}function Ne(n,e,t){if(n.tag===3)Zg(n,n,t);else for(;e!==null;){if(e.tag===3){Zg(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Nr===null||!Nr.has(r))){n=pi(t,n),n=nv(e,n,1),e=Dr(e,n,1),n=gt(),e!==null&&(ja(e,1,n),Lt(e,n));break}}e=e.return}}function NI(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=gt(),n.pingedLanes|=n.suspendedLanes&t,Je===n&&(it&t)===t&&(We===4||We===3&&(it&130023424)===it&&500>Fe()-zh?ds(n,0):Wh|=t),Lt(n,e)}function Tv(n,e){e===0&&(n.mode&1?(e=io,io<<=1,!(io&130023424)&&(io=4194304)):e=1);var t=gt();n=nr(n,e),n!==null&&(ja(n,e,t),Lt(n,t))}function OI(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Tv(n,t)}function MI(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(e),Tv(n,t)}var Iv;Iv=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||At.current)Tt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Tt=!1,II(n,e,t);Tt=!!(n.flags&131072)}else Tt=!1,Ie&&e.flags&1048576&&wy(e,ml,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Go(n,e),n=e.pendingProps;var s=di(e,ct.current);ei(e,t),s=$h(null,e,r,n,s,t);var i=jh();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_t(r)?(i=!0,gl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Oh(e),s.updater=iu,e.stateNode=s,s._reactInternals=e,cd(e,r,n,t),e=fd(null,e,r,!0,i,t)):(e.tag=0,Ie&&i&&bh(e),dt(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Go(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=UI(r),n=on(r,n),s){case 0:e=hd(null,e,r,n,t);break e;case 1:e=Vg(null,e,r,n,t);break e;case 11:e=jg(null,e,r,n,t);break e;case 14:e=Gg(null,e,r,on(r.type,n),t);break e}throw Error(K(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:on(r,s),hd(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:on(r,s),Vg(n,e,r,s,t);case 3:e:{if(av(e),n===null)throw Error(K(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Dy(n,e),El(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=pi(Error(K(423)),e),e=Hg(n,e,r,t,s);break e}else if(r!==s){s=pi(Error(K(424)),e),e=Hg(n,e,r,t,s);break e}else for(Ot=Pr(e.stateNode.containerInfo.firstChild),Mt=e,Ie=!0,un=null,t=Cy(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(hi(),r===s){e=rr(n,e,t);break e}dt(n,e,r,t)}e=e.child}return e;case 5:return Ny(e),n===null&&od(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,nd(r,s)?a=null:i!==null&&nd(r,i)&&(e.flags|=32),iv(n,e),dt(n,e,a,t),e.child;case 6:return n===null&&od(e),null;case 13:return ov(n,e,t);case 4:return Mh(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=fi(e,null,r,t):dt(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:on(r,s),jg(n,e,r,s,t);case 7:return dt(n,e,e.pendingProps,t),e.child;case 8:return dt(n,e,e.pendingProps.children,t),e.child;case 12:return dt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,ve(yl,r._currentValue),r._currentValue=a,i!==null)if(gn(i.value,a)){if(i.children===s.children&&!At.current){e=rr(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Jn(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),ld(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(K(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),ld(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}dt(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ei(e,t),s=Yt(s),r=r(s),e.flags|=1,dt(n,e,r,t),e.child;case 14:return r=e.type,s=on(r,e.pendingProps),s=on(r.type,s),Gg(n,e,r,s,t);case 15:return rv(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:on(r,s),Go(n,e),e.tag=1,_t(r)?(n=!0,gl(e)):n=!1,ei(e,t),ev(e,r,s),cd(e,r,s,t),fd(null,e,r,!0,n,t);case 19:return lv(n,e,t);case 22:return sv(n,e,t)}throw Error(K(156,e.tag))};function Av(n,e){return Q0(n,e)}function FI(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wt(n,e,t,r){return new FI(n,e,t,r)}function Qh(n){return n=n.prototype,!(!n||!n.isReactComponent)}function UI(n){if(typeof n=="function")return Qh(n)?1:0;if(n!=null){if(n=n.$$typeof,n===mh)return 11;if(n===yh)return 14}return 2}function Mr(n,e){var t=n.alternate;return t===null?(t=Wt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ko(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")Qh(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Us:return hs(t.children,s,i,e);case ph:a=8,s|=8;break;case Nc:return n=Wt(12,t,e,s|2),n.elementType=Nc,n.lanes=i,n;case Oc:return n=Wt(13,t,e,s),n.elementType=Oc,n.lanes=i,n;case Mc:return n=Wt(19,t,e,s),n.elementType=Mc,n.lanes=i,n;case N0:return lu(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case P0:a=10;break e;case D0:a=9;break e;case mh:a=11;break e;case yh:a=14;break e;case mr:a=16,r=null;break e}throw Error(K(130,n==null?n:typeof n,""))}return e=Wt(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function hs(n,e,t,r){return n=Wt(7,n,r,e),n.lanes=t,n}function lu(n,e,t,r){return n=Wt(22,n,r,e),n.elementType=N0,n.lanes=t,n.stateNode={isHidden:!1},n}function qu(n,e,t){return n=Wt(6,n,null,e),n.lanes=t,n}function Xu(n,e,t){return e=Wt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function BI(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ku(0),this.expirationTimes=ku(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ku(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Jh(n,e,t,r,s,i,a,o,l){return n=new BI(n,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Wt(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oh(i),n}function $I(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fs,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function _v(n){if(!n)return Gr;n=n._reactInternals;e:{if(As(n)!==n||n.tag!==1)throw Error(K(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_t(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(K(171))}if(n.tag===1){var t=n.type;if(_t(t))return _y(n,t,e)}return e}function Lv(n,e,t,r,s,i,a,o,l){return n=Jh(t,r,!0,n,s,i,a,o,l),n.context=_v(null),t=n.current,r=gt(),s=Or(t),i=Jn(r,s),i.callback=e??null,Dr(t,i,s),n.current.lanes=s,ja(n,s,r),Lt(n,r),n}function uu(n,e,t,r){var s=e.current,i=gt(),a=Or(s);return t=_v(t),e.context===null?e.context=t:e.pendingContext=t,e=Jn(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Dr(s,e,a),n!==null&&(hn(n,s,a,i),Bo(n,s,a)),a}function wl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function ep(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Zh(n,e){ep(n,e),(n=n.alternate)&&ep(n,e)}function jI(){return null}var wv=typeof reportError=="function"?reportError:function(n){console.error(n)};function ef(n){this._internalRoot=n}cu.prototype.render=ef.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(K(409));uu(n,e,null,null)};cu.prototype.unmount=ef.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;vs(function(){uu(null,n,null,null)}),e[tr]=null}};function cu(n){this._internalRoot=n}cu.prototype.unstable_scheduleHydration=function(n){if(n){var e=sy();n={blockedOn:null,target:n,priority:e};for(var t=0;t<xr.length&&e!==0&&e<xr[t].priority;t++);xr.splice(t,0,n),t===0&&ay(n)}};function tf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function du(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function tp(){}function GI(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=wl(a);i.call(u)}}var a=Lv(e,r,n,0,null,!1,!1,"",tp);return n._reactRootContainer=a,n[tr]=a.current,va(n.nodeType===8?n.parentNode:n),vs(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=wl(l);o.call(u)}}var l=Jh(n,0,!1,null,null,!1,!1,"",tp);return n._reactRootContainer=l,n[tr]=l.current,va(n.nodeType===8?n.parentNode:n),vs(function(){uu(e,l,t,r)}),l}function hu(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=wl(a);o.call(l)}}uu(e,a,n,s)}else a=GI(t,e,n,s,r);return wl(a)}ny=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Hi(e.pendingLanes);t!==0&&(Sh(e,t|1),Lt(e,Fe()),!(ue&6)&&(mi=Fe()+500,zr()))}break;case 13:vs(function(){var r=nr(n,1);if(r!==null){var s=gt();hn(r,n,1,s)}}),Zh(n,1)}};xh=function(n){if(n.tag===13){var e=nr(n,134217728);if(e!==null){var t=gt();hn(e,n,134217728,t)}Zh(n,134217728)}};ry=function(n){if(n.tag===13){var e=Or(n),t=nr(n,e);if(t!==null){var r=gt();hn(t,n,e,r)}Zh(n,e)}};sy=function(){return fe};iy=function(n,e){var t=fe;try{return fe=n,e()}finally{fe=t}};Wc=function(n,e,t){switch(e){case"input":if(Bc(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=nu(r);if(!s)throw Error(K(90));M0(r),Bc(r,s)}}}break;case"textarea":U0(n,t);break;case"select":e=t.value,e!=null&&Xs(n,!!t.multiple,e,!1)}};K0=Yh;W0=vs;var VI={usingClientEntryPoint:!1,Events:[Va,Gs,nu,V0,H0,Yh]},$i={findFiberByHostInstance:os,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},HI={bundleType:$i.bundleType,version:$i.version,rendererPackageName:$i.rendererPackageName,rendererConfig:$i.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ar.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=q0(n),n===null?null:n.stateNode},findFiberByHostInstance:$i.findFiberByHostInstance||jI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yo.isDisabled&&yo.supportsFiber)try{Jl=yo.inject(HI),Dn=yo}catch{}}$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VI;$t.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tf(e))throw Error(K(200));return $I(n,e,null,t)};$t.createRoot=function(n,e){if(!tf(n))throw Error(K(299));var t=!1,r="",s=wv;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Jh(n,1,!1,null,null,t,!1,r,s),n[tr]=e.current,va(n.nodeType===8?n.parentNode:n),new ef(e)};$t.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(K(188)):(n=Object.keys(n).join(","),Error(K(268,n)));return n=q0(e),n=n===null?null:n.stateNode,n};$t.flushSync=function(n){return vs(n)};$t.hydrate=function(n,e,t){if(!du(e))throw Error(K(200));return hu(null,n,e,!0,t)};$t.hydrateRoot=function(n,e,t){if(!tf(n))throw Error(K(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=wv;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Lv(e,null,n,1,t??null,s,!1,i,a),n[tr]=e.current,va(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new cu(e)};$t.render=function(n,e,t){if(!du(e))throw Error(K(200));return hu(null,n,e,!1,t)};$t.unmountComponentAtNode=function(n){if(!du(n))throw Error(K(40));return n._reactRootContainer?(vs(function(){hu(null,null,n,!1,function(){n._reactRootContainer=null,n[tr]=null})}),!0):!1};$t.unstable_batchedUpdates=Yh;$t.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!du(t))throw Error(K(200));if(n==null||n._reactInternals===void 0)throw Error(K(38));return hu(n,e,t,!1,r)};$t.version="18.3.1-next-f1338f8080-20240426";function bv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bv)}catch(n){console.error(n)}}bv(),b0.exports=$t;var KI=b0.exports,np=KI;Pc.createRoot=np.createRoot,Pc.hydrateRoot=np.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wa(){return wa=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},wa.apply(this,arguments)}var br;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(br||(br={}));const rp="popstate";function WI(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:a,hash:o}=r.location;return _d("",{pathname:i,search:a,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:bl(s)}return YI(e,t,null,n)}function ke(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function nf(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function zI(){return Math.random().toString(36).substr(2,8)}function sp(n,e){return{usr:n.state,key:n.key,idx:e}}function _d(n,e,t,r){return t===void 0&&(t=null),wa({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?_i(e):e,{state:t,key:e&&e.key||r||zI()})}function bl(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function _i(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function YI(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,o=br.Pop,l=null,u=c();u==null&&(u=0,a.replaceState(wa({},a.state,{idx:u}),""));function c(){return(a.state||{idx:null}).idx}function d(){o=br.Pop;let v=c(),p=v==null?null:v-u;u=v,l&&l({action:o,location:m.location,delta:p})}function h(v,p){o=br.Push;let y=_d(m.location,v,p);u=c()+1;let E=sp(y,u),T=m.createHref(y);try{a.pushState(E,"",T)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;s.location.assign(T)}i&&l&&l({action:o,location:m.location,delta:1})}function f(v,p){o=br.Replace;let y=_d(m.location,v,p);u=c();let E=sp(y,u),T=m.createHref(y);a.replaceState(E,"",T),i&&l&&l({action:o,location:m.location,delta:0})}function g(v){let p=s.location.origin!=="null"?s.location.origin:s.location.href,y=typeof v=="string"?v:bl(v);return y=y.replace(/ $/,"%20"),ke(p,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,p)}let m={get action(){return o},get location(){return n(s,a)},listen(v){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(rp,d),l=v,()=>{s.removeEventListener(rp,d),l=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let p=g(v);return{pathname:p.pathname,search:p.search,hash:p.hash}},push:h,replace:f,go(v){return a.go(v)}};return m}var ip;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(ip||(ip={}));function qI(n,e,t){return t===void 0&&(t="/"),XI(n,e,t)}function XI(n,e,t,r){let s=typeof e=="string"?_i(e):e,i=yi(s.pathname||"/",t);if(i==null)return null;let a=Rv(n);QI(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=lA(i);o=aA(a[l],u)}return o}function Rv(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,a,o)=>{let l={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};l.relativePath.startsWith("/")&&(ke(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=Fr([r,l.relativePath]),c=t.concat(l);i.children&&i.children.length>0&&(ke(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),Rv(i.children,e,c,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:sA(u,i.index),routesMeta:c})};return n.forEach((i,a)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))s(i,a);else for(let l of kv(i.path))s(i,a,l)}),e}function kv(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=kv(r.join("/")),o=[];return o.push(...a.map(l=>l===""?i:[i,l].join("/"))),s&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function QI(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:iA(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const JI=/^:[\w-]+$/,ZI=3,eA=2,tA=1,nA=10,rA=-2,ap=n=>n==="*";function sA(n,e){let t=n.split("/"),r=t.length;return t.some(ap)&&(r+=rA),e&&(r+=eA),t.filter(s=>!ap(s)).reduce((s,i)=>s+(JI.test(i)?ZI:i===""?tA:nA),r)}function iA(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function aA(n,e,t){let{routesMeta:r}=n,s={},i="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,c=i==="/"?e:e.slice(i.length)||"/",d=Ld({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),h=l.route;if(!d)return null;Object.assign(s,d.params),a.push({params:s,pathname:Fr([i,d.pathname]),pathnameBase:fA(Fr([i,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(i=Fr([i,d.pathnameBase]))}return a}function Ld(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=oA(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:h,isOptional:f}=c;if(h==="*"){let m=o[d]||"";a=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const g=o[d];return f&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:a,pattern:n}}function oA(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),nf(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function lA(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return nf(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function yi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const uA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cA=n=>uA.test(n);function dA(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?_i(n):n,i;if(t)if(cA(t))i=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),nf(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+t))}t.startsWith("/")?i=op(t.substring(1),"/"):i=op(t,e)}else i=e;return{pathname:i,search:gA(r),hash:pA(s)}}function op(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function Qu(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function hA(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function rf(n,e){let t=hA(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function sf(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=_i(n):(s=wa({},n),ke(!s.pathname||!s.pathname.includes("?"),Qu("?","pathname","search",s)),ke(!s.pathname||!s.pathname.includes("#"),Qu("#","pathname","hash",s)),ke(!s.search||!s.search.includes("#"),Qu("#","search","hash",s)));let i=n===""||s.pathname==="",a=i?"/":s.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!r&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;s.pathname=h.join("/")}o=d>=0?e[d]:"/"}let l=dA(s,o),u=a&&a!=="/"&&a.endsWith("/"),c=(i||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Fr=n=>n.join("/").replace(/\/\/+/g,"/"),fA=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),gA=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,pA=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function mA(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const Cv=["post","put","patch","delete"];new Set(Cv);const yA=["get",...Cv];new Set(yA);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ba(){return ba=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ba.apply(this,arguments)}const fu=P.createContext(null),Pv=P.createContext(null),or=P.createContext(null),gu=P.createContext(null),lr=P.createContext({outlet:null,matches:[],isDataRoute:!1}),Dv=P.createContext(null);function vA(n,e){let{relative:t}=e===void 0?{}:e;Li()||ke(!1);let{basename:r,navigator:s}=P.useContext(or),{hash:i,pathname:a,search:o}=pu(n,{relative:t}),l=a;return r!=="/"&&(l=a==="/"?r:Fr([r,a])),s.createHref({pathname:l,search:o,hash:i})}function Li(){return P.useContext(gu)!=null}function ur(){return Li()||ke(!1),P.useContext(gu).location}function Nv(n){P.useContext(or).static||P.useLayoutEffect(n)}function Ka(){let{isDataRoute:n}=P.useContext(lr);return n?CA():EA()}function EA(){Li()||ke(!1);let n=P.useContext(fu),{basename:e,future:t,navigator:r}=P.useContext(or),{matches:s}=P.useContext(lr),{pathname:i}=ur(),a=JSON.stringify(rf(s,t.v7_relativeSplatPath)),o=P.useRef(!1);return Nv(()=>{o.current=!0}),P.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let d=sf(u,JSON.parse(a),i,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Fr([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,a,i,n])}function Ov(){let{matches:n}=P.useContext(lr),e=n[n.length-1];return e?e.params:{}}function pu(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=P.useContext(or),{matches:s}=P.useContext(lr),{pathname:i}=ur(),a=JSON.stringify(rf(s,r.v7_relativeSplatPath));return P.useMemo(()=>sf(n,JSON.parse(a),i,t==="path"),[n,a,i,t])}function SA(n,e){return xA(n,e)}function xA(n,e,t,r){Li()||ke(!1);let{navigator:s}=P.useContext(or),{matches:i}=P.useContext(lr),a=i[i.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=ur(),c;if(e){var d;let v=typeof e=="string"?_i(e):e;l==="/"||(d=v.pathname)!=null&&d.startsWith(l)||ke(!1),c=v}else c=u;let h=c.pathname||"/",f=h;if(l!=="/"){let v=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let g=qI(n,{pathname:f}),m=LA(g&&g.map(v=>Object.assign({},v,{params:Object.assign({},o,v.params),pathname:Fr([l,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:Fr([l,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),i,t,r);return e&&m?P.createElement(gu.Provider,{value:{location:ba({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:br.Pop}},m):m}function TA(){let n=kA(),e=mA(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},e),t?P.createElement("pre",{style:s},t):null,null)}const IA=P.createElement(TA,null);class AA extends P.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?P.createElement(lr.Provider,{value:this.props.routeContext},P.createElement(Dv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _A(n){let{routeContext:e,match:t,children:r}=n,s=P.useContext(fu);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),P.createElement(lr.Provider,{value:e},r)}function LA(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,o=(s=t)==null?void 0:s.errors;if(o!=null){let c=a.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);c>=0||ke(!1),a=a.slice(0,Math.min(a.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let d=a[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:h,errors:f}=t,g=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((c,d,h)=>{let f,g=!1,m=null,v=null;t&&(f=o&&d.route.id?o[d.route.id]:void 0,m=d.route.errorElement||IA,l&&(u<0&&h===0?(PA("route-fallback"),g=!0,v=null):u===h&&(g=!0,v=d.route.hydrateFallbackElement||null)));let p=e.concat(a.slice(0,h+1)),y=()=>{let E;return f?E=m:g?E=v:d.route.Component?E=P.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,P.createElement(_A,{match:d,routeContext:{outlet:c,matches:p,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?P.createElement(AA,{location:t.location,revalidation:t.revalidation,component:m,error:f,children:y(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):y()},null)}var Mv=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(Mv||{}),Fv=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Fv||{});function wA(n){let e=P.useContext(fu);return e||ke(!1),e}function bA(n){let e=P.useContext(Pv);return e||ke(!1),e}function RA(n){let e=P.useContext(lr);return e||ke(!1),e}function Uv(n){let e=RA(),t=e.matches[e.matches.length-1];return t.route.id||ke(!1),t.route.id}function kA(){var n;let e=P.useContext(Dv),t=bA(),r=Uv();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function CA(){let{router:n}=wA(Mv.UseNavigateStable),e=Uv(Fv.UseNavigateStable),t=P.useRef(!1);return Nv(()=>{t.current=!0}),P.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,ba({fromRouteId:e},i)))},[n,e])}const lp={};function PA(n,e,t){lp[n]||(lp[n]=!0)}function DA(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function mu(n){let{to:e,replace:t,state:r,relative:s}=n;Li()||ke(!1);let{future:i,static:a}=P.useContext(or),{matches:o}=P.useContext(lr),{pathname:l}=ur(),u=Ka(),c=sf(e,rf(o,i.v7_relativeSplatPath),l,s==="path"),d=JSON.stringify(c);return P.useEffect(()=>u(JSON.parse(d),{replace:t,state:r,relative:s}),[u,d,s,t,r]),null}function et(n){ke(!1)}function NA(n){let{basename:e="/",children:t=null,location:r,navigationType:s=br.Pop,navigator:i,static:a=!1,future:o}=n;Li()&&ke(!1);let l=e.replace(/^\/*/,"/"),u=P.useMemo(()=>({basename:l,navigator:i,static:a,future:ba({v7_relativeSplatPath:!1},o)}),[l,o,i,a]);typeof r=="string"&&(r=_i(r));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:g="default"}=r,m=P.useMemo(()=>{let v=yi(c,l);return v==null?null:{location:{pathname:v,search:d,hash:h,state:f,key:g},navigationType:s}},[l,c,d,h,f,g,s]);return m==null?null:P.createElement(or.Provider,{value:u},P.createElement(gu.Provider,{children:t,value:m}))}function OA(n){let{children:e,location:t}=n;return SA(wd(e),t)}new Promise(()=>{});function wd(n,e){e===void 0&&(e=[]);let t=[];return P.Children.forEach(n,(r,s)=>{if(!P.isValidElement(r))return;let i=[...e,s];if(r.type===P.Fragment){t.push.apply(t,wd(r.props.children,i));return}r.type!==et&&ke(!1),!r.props.index||!r.props.children||ke(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=wd(r.props.children,i)),t.push(a)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Rl(){return Rl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Rl.apply(this,arguments)}function Bv(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function MA(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function FA(n,e){return n.button===0&&(!e||e==="_self")&&!MA(n)}const UA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],BA=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],$A="6";try{window.__reactRouterVersion=$A}catch{}const jA=P.createContext({isTransitioning:!1}),GA="startTransition",up=Nx[GA];function VA(n){let{basename:e,children:t,future:r,window:s}=n,i=P.useRef();i.current==null&&(i.current=WI({window:s,v5Compat:!0}));let a=i.current,[o,l]=P.useState({action:a.action,location:a.location}),{v7_startTransition:u}=r||{},c=P.useCallback(d=>{u&&up?up(()=>l(d)):l(d)},[l,u]);return P.useLayoutEffect(()=>a.listen(c),[a,c]),P.useEffect(()=>DA(r),[r]),P.createElement(NA,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:r})}const HA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",KA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ze=P.forwardRef(function(e,t){let{onClick:r,relative:s,reloadDocument:i,replace:a,state:o,target:l,to:u,preventScrollReset:c,viewTransition:d}=e,h=Bv(e,UA),{basename:f}=P.useContext(or),g,m=!1;if(typeof u=="string"&&KA.test(u)&&(g=u,HA))try{let E=new URL(window.location.href),T=u.startsWith("//")?new URL(E.protocol+u):new URL(u),A=yi(T.pathname,f);T.origin===E.origin&&A!=null?u=A+T.search+T.hash:m=!0}catch{}let v=vA(u,{relative:s}),p=zA(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:s,viewTransition:d});function y(E){r&&r(E),E.defaultPrevented||p(E)}return P.createElement("a",Rl({},h,{href:g||v,onClick:m||i?r:y,ref:t,target:l}))}),nn=P.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:s=!1,className:i="",end:a=!1,style:o,to:l,viewTransition:u,children:c}=e,d=Bv(e,BA),h=pu(l,{relative:d.relative}),f=ur(),g=P.useContext(Pv),{navigator:m,basename:v}=P.useContext(or),p=g!=null&&YA(h)&&u===!0,y=m.encodeLocation?m.encodeLocation(h).pathname:h.pathname,E=f.pathname,T=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;s||(E=E.toLowerCase(),T=T?T.toLowerCase():null,y=y.toLowerCase()),T&&v&&(T=yi(T,v)||T);const A=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let w=E===y||!a&&E.startsWith(y)&&E.charAt(A)==="/",_=T!=null&&(T===y||!a&&T.startsWith(y)&&T.charAt(y.length)==="/"),L={isActive:w,isPending:_,isTransitioning:p},b=w?r:void 0,I;typeof i=="function"?I=i(L):I=[i,w?"active":null,_?"pending":null,p?"transitioning":null].filter(Boolean).join(" ");let k=typeof o=="function"?o(L):o;return P.createElement(ze,Rl({},d,{"aria-current":b,className:I,ref:t,style:k,to:l,viewTransition:u}),typeof c=="function"?c(L):c)});var bd;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(bd||(bd={}));var cp;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(cp||(cp={}));function WA(n){let e=P.useContext(fu);return e||ke(!1),e}function zA(n,e){let{target:t,replace:r,state:s,preventScrollReset:i,relative:a,viewTransition:o}=e===void 0?{}:e,l=Ka(),u=ur(),c=pu(n,{relative:a});return P.useCallback(d=>{if(FA(d,t)){d.preventDefault();let h=r!==void 0?r:bl(u)===bl(c);l(n,{replace:h,state:s,preventScrollReset:i,relative:a,viewTransition:o})}},[u,l,c,r,s,t,n,i,a,o])}function YA(n,e){e===void 0&&(e={});let t=P.useContext(jA);t==null&&ke(!1);let{basename:r}=WA(bd.useViewTransitionState),s=pu(n,{relative:e.relative});if(!t.isTransitioning)return!1;let i=yi(t.currentLocation.pathname,r)||t.currentLocation.pathname,a=yi(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Ld(s.pathname,a)!=null||Ld(s.pathname,i)!=null}const qA=()=>{};var dp={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},XA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],o=n[t++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},jv={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,o=a?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,c=i>>2,d=(i&3)<<4|o>>4;let h=(o&15)<<2|u>>6,f=u&63;l||(f=64,a||(h=64)),r.push(t[c],t[d],t[h],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray($v(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):XA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],o=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const d=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||o==null||u==null||d==null)throw new QA;const h=i<<2|o>>4;if(r.push(h),u!==64){const f=o<<4&240|u>>2;if(r.push(f),d!==64){const g=u<<6&192|d;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class QA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const JA=function(n){const e=$v(n);return jv.encodeByteArray(e,!0)},Gv=function(n){return JA(n).replace(/\./g,"")},Vv=function(n){try{return jv.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e_=()=>ZA().__FIREBASE_DEFAULTS__,t_=()=>{if(typeof process>"u"||typeof dp>"u")return;const n=dp.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},n_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Vv(n[1]);return e&&JSON.parse(e)},af=()=>{try{return qA()||e_()||t_()||n_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},r_=n=>{var e,t;return(t=(e=af())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Hv=()=>{var n;return(n=af())==null?void 0:n.config},Kv=n=>{var e;return(e=af())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yu(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function i_(n){return(await fetch(n,{credentials:"include"})).ok}const ia={};function a_(){const n={prod:[],emulator:[]};for(const e of Object.keys(ia))ia[e]?n.emulator.push(e):n.prod.push(e);return n}function o_(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let hp=!1;function l_(n,e){if(typeof window>"u"||typeof document>"u"||!yu(window.location.host)||ia[n]===e||ia[n]||hp)return;ia[n]=e;function t(h){return`__firebase__banner__${h}`}const r="__firebase__banner",i=a_().prod.length>0;function a(){const h=document.getElementById(r);h&&h.remove()}function o(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,f){h.setAttribute("width","24"),h.setAttribute("id",f),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function u(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{hp=!0,a()},h}function c(h,f){h.setAttribute("id",f),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function d(){const h=o_(r),f=t("text"),g=document.getElementById(f)||document.createElement("span"),m=t("learnmore"),v=document.getElementById(m)||document.createElement("a"),p=t("preprendIcon"),y=document.getElementById(p)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const E=h.element;o(E),c(v,m);const T=u();l(y,p),E.append(y,g,v,T),document.body.appendChild(E)}i?(g.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function u_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pt())}function c_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function d_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function h_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function f_(){const n=pt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function g_(){try{return typeof indexedDB=="object"}catch{return!1}}function p_(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_="FirebaseError";class Yr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=m_,Object.setPrototypeOf(this,Yr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wa.prototype.create)}}class Wa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?y_(i,r):"Error",o=`${this.serviceName}: ${a} (${s}).`;return new Yr(s,o,r)}}function y_(n,e){return n.replace(v_,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const v_=/\{\$([^}]+)}/g;function E_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function vi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(fp(i)&&fp(a)){if(!vi(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function fp(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Wi(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function zi(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function S_(n,e){const t=new x_(n,e);return t.subscribe.bind(t)}class x_{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");T_(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ju),s.error===void 0&&(s.error=Ju),s.complete===void 0&&(s.complete=Ju);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function T_(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ju(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(n){return n&&n._delegate?n._delegate:n}class Ei{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new s_;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(__(e))try{this.getOrInitializeService({instanceIdentifier:is})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=is){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=is){return this.instances.has(e)}getOptions(e=is){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(i);r===o&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:A_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=is){return this.component?this.component.multipleInstances?e:is:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function A_(n){return n===is?void 0:n}function __(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new I_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(pe||(pe={}));const w_={debug:pe.DEBUG,verbose:pe.VERBOSE,info:pe.INFO,warn:pe.WARN,error:pe.ERROR,silent:pe.SILENT},b_=pe.INFO,R_={[pe.DEBUG]:"log",[pe.VERBOSE]:"log",[pe.INFO]:"info",[pe.WARN]:"warn",[pe.ERROR]:"error"},k_=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=R_[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Wv=class{constructor(e){this.name=e,this._logLevel=b_,this._logHandler=k_,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?w_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,pe.DEBUG,...e),this._logHandler(this,pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,pe.VERBOSE,...e),this._logHandler(this,pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,pe.INFO,...e),this._logHandler(this,pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,pe.WARN,...e),this._logHandler(this,pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,pe.ERROR,...e),this._logHandler(this,pe.ERROR,...e)}};const C_=(n,e)=>e.some(t=>n instanceof t);let gp,pp;function P_(){return gp||(gp=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function D_(){return pp||(pp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zv=new WeakMap,Rd=new WeakMap,Yv=new WeakMap,Zu=new WeakMap,of=new WeakMap;function N_(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(Ur(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&zv.set(t,n)}).catch(()=>{}),of.set(e,n),e}function O_(n){if(Rd.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Rd.set(n,e)}let kd={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Rd.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Yv.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ur(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function M_(n){kd=n(kd)}function F_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ec(this),e,...t);return Yv.set(r,e.sort?e.sort():[e]),Ur(r)}:D_().includes(n)?function(...e){return n.apply(ec(this),e),Ur(zv.get(this))}:function(...e){return Ur(n.apply(ec(this),e))}}function U_(n){return typeof n=="function"?F_(n):(n instanceof IDBTransaction&&O_(n),C_(n,P_())?new Proxy(n,kd):n)}function Ur(n){if(n instanceof IDBRequest)return N_(n);if(Zu.has(n))return Zu.get(n);const e=U_(n);return e!==n&&(Zu.set(n,e),of.set(e,n)),e}const ec=n=>of.get(n);function B_(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),o=Ur(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Ur(a.result),l.oldVersion,l.newVersion,Ur(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const $_=["get","getKey","getAll","getAllKeys","count"],j_=["put","add","delete","clear"],tc=new Map;function mp(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(tc.get(e))return tc.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=j_.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||$_.includes(t)))return;const i=async function(a,...o){const l=this.transaction(a,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(o.shift())),(await Promise.all([u[t](...o),s&&l.done]))[0]};return tc.set(e,i),i}M_(n=>({...n,get:(e,t,r)=>mp(e,t)||n.get(e,t,r),has:(e,t)=>!!mp(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(V_(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function V_(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Cd="@firebase/app",yp="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sr=new Wv("@firebase/app"),H_="@firebase/app-compat",K_="@firebase/analytics-compat",W_="@firebase/analytics",z_="@firebase/app-check-compat",Y_="@firebase/app-check",q_="@firebase/auth",X_="@firebase/auth-compat",Q_="@firebase/database",J_="@firebase/data-connect",Z_="@firebase/database-compat",eL="@firebase/functions",tL="@firebase/functions-compat",nL="@firebase/installations",rL="@firebase/installations-compat",sL="@firebase/messaging",iL="@firebase/messaging-compat",aL="@firebase/performance",oL="@firebase/performance-compat",lL="@firebase/remote-config",uL="@firebase/remote-config-compat",cL="@firebase/storage",dL="@firebase/storage-compat",hL="@firebase/firestore",fL="@firebase/ai",gL="@firebase/firestore-compat",pL="firebase",mL="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd="[DEFAULT]",yL={[Cd]:"fire-core",[H_]:"fire-core-compat",[W_]:"fire-analytics",[K_]:"fire-analytics-compat",[Y_]:"fire-app-check",[z_]:"fire-app-check-compat",[q_]:"fire-auth",[X_]:"fire-auth-compat",[Q_]:"fire-rtdb",[J_]:"fire-data-connect",[Z_]:"fire-rtdb-compat",[eL]:"fire-fn",[tL]:"fire-fn-compat",[nL]:"fire-iid",[rL]:"fire-iid-compat",[sL]:"fire-fcm",[iL]:"fire-fcm-compat",[aL]:"fire-perf",[oL]:"fire-perf-compat",[lL]:"fire-rc",[uL]:"fire-rc-compat",[cL]:"fire-gcs",[dL]:"fire-gcs-compat",[hL]:"fire-fst",[gL]:"fire-fst-compat",[fL]:"fire-vertex","fire-js":"fire-js",[pL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra=new Map,vL=new Map,Dd=new Map;function vp(n,e){try{n.container.addComponent(e)}catch(t){sr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ka(n){const e=n.name;if(Dd.has(e))return sr.debug(`There were multiple attempts to register component ${e}.`),!1;Dd.set(e,n);for(const t of Ra.values())vp(t,n);for(const t of vL.values())vp(t,n);return!0}function qv(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Kt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Br=new Wa("app","Firebase",EL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ei("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Br.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=mL;function Xv(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Pd,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Br.create("bad-app-name",{appName:String(s)});if(t||(t=Hv()),!t)throw Br.create("no-options");const i=Ra.get(s);if(i){if(vi(t,i.options)&&vi(r,i.config))return i;throw Br.create("duplicate-app",{appName:s})}const a=new L_(s);for(const l of Dd.values())a.addComponent(l);const o=new SL(t,r,a);return Ra.set(s,o),o}function Qv(n=Pd){const e=Ra.get(n);if(!e&&n===Pd&&Hv())return Xv();if(!e)throw Br.create("no-app",{appName:n});return e}function xL(){return Array.from(Ra.values())}function ni(n,e,t){let r=yL[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),sr.warn(a.join(" "));return}ka(new Ei(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL="firebase-heartbeat-database",IL=1,Ca="firebase-heartbeat-store";let nc=null;function Jv(){return nc||(nc=B_(TL,IL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ca)}catch(t){console.warn(t)}}}}).catch(n=>{throw Br.create("idb-open",{originalErrorMessage:n.message})})),nc}async function AL(n){try{const t=(await Jv()).transaction(Ca),r=await t.objectStore(Ca).get(Zv(n));return await t.done,r}catch(e){if(e instanceof Yr)sr.warn(e.message);else{const t=Br.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});sr.warn(t.message)}}}async function Ep(n,e){try{const r=(await Jv()).transaction(Ca,"readwrite");await r.objectStore(Ca).put(e,Zv(n)),await r.done}catch(t){if(t instanceof Yr)sr.warn(t.message);else{const r=Br.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});sr.warn(r.message)}}}function Zv(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _L=1024,LL=30;class wL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new RL(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Sp();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>LL){const a=kL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){sr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sp(),{heartbeatsToSend:r,unsentEntries:s}=bL(this._heartbeatsCache.heartbeats),i=Gv(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return sr.warn(t),""}}}function Sp(){return new Date().toISOString().substring(0,10)}function bL(n,e=_L){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),xp(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),xp(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class RL{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return g_()?p_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await AL(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ep(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ep(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function xp(n){return Gv(JSON.stringify({version:2,heartbeats:n})).length}function kL(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CL(n){ka(new Ei("platform-logger",e=>new G_(e),"PRIVATE")),ka(new Ei("heartbeat",e=>new wL(e),"PRIVATE")),ni(Cd,yp,n),ni(Cd,yp,"esm2020"),ni("fire-js","")}CL("");function eE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const PL=eE,tE=new Wa("auth","Firebase",eE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl=new Wv("@firebase/auth");function DL(n,...e){kl.logLevel<=pe.WARN&&kl.warn(`Auth (${Ya}): ${n}`,...e)}function Wo(n,...e){kl.logLevel<=pe.ERROR&&kl.error(`Auth (${Ya}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(n,...e){throw uf(n,...e)}function fn(n,...e){return uf(n,...e)}function lf(n,e,t){const r={...PL(),[e]:t};return new Wa("auth","Firebase",r).create(e,{appName:n.name})}function Zn(n){return lf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function NL(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Xt(n,"argument-error"),lf(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function uf(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return tE.create(n,...e)}function Z(n,e,...t){if(!n)throw uf(e,...t)}function Xn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Wo(e),new Error(e)}function ir(n,e){n||Xn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function OL(){return Tp()==="http:"||Tp()==="https:"}function Tp(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ML(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(OL()||d_()||"connection"in navigator)?navigator.onLine:!0}function FL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e,t){this.shortDelay=e,this.longDelay=t,ir(t>e,"Short delay should be less than long delay!"),this.isMobile=u_()||h_()}get(){return ML()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(n,e){ir(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],$L=new qa(3e4,6e4);function qr(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Un(n,e,t,r,s={}){return rE(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const o=za({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return c_()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&yu(n.emulatorConfig.host)&&(u.credentials="include"),nE.fetch()(await sE(n,n.config.apiHost,t,o),u)})}async function rE(n,e,t){n._canInitEmulator=!1;const r={...UL,...e};try{const s=new GL(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw vo(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const o=i.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw vo(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw vo(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw vo(n,"user-disabled",a);const c=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw lf(n,c,u);Xt(n,c)}}catch(s){if(s instanceof Yr)throw s;Xt(n,"network-request-failed",{message:String(s)})}}async function Xa(n,e,t,r,s={}){const i=await Un(n,e,t,r,s);return"mfaPendingCredential"in i&&Xt(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function sE(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?cf(n.config,s):`${n.config.apiScheme}://${s}`;return BL.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function jL(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class GL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(fn(this.auth,"network-request-failed")),$L.get())})}}function vo(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=fn(n,e,r);return s.customData._tokenResponse=t,s}function Ip(n){return n!==void 0&&n.enterprise!==void 0}class VL{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function HL(n,e){return Un(n,"GET","/v2/recaptchaConfig",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KL(n,e){return Un(n,"POST","/v1/accounts:delete",e)}async function Cl(n,e){return Un(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function WL(n,e=!1){const t=pn(n),r=await t.getIdToken(e),s=df(r);Z(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:aa(rc(s.auth_time)),issuedAtTime:aa(rc(s.iat)),expirationTime:aa(rc(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function rc(n){return Number(n)*1e3}function df(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Wo("JWT malformed, contained fewer than 3 sections"),null;try{const s=Vv(t);return s?JSON.parse(s):(Wo("Failed to decode base64 JWT payload"),null)}catch(s){return Wo("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ap(n){const e=df(n);return Z(e,"internal-error"),Z(typeof e.exp<"u","internal-error"),Z(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Es(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Yr&&zL(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function zL({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=aa(this.lastLoginAt),this.creationTime=aa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pl(n){var d;const e=n.auth,t=await n.getIdToken(),r=await Es(n,Cl(e,{idToken:t}));Z(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(d=s.providerUserInfo)!=null&&d.length?iE(s.providerUserInfo):[],a=XL(n.providerData,i),o=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Od(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,c)}async function qL(n){const e=pn(n);await Pl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function XL(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function iE(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QL(n,e){const t=await rE(n,{},async()=>{const r=za({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await sE(n,s,"/v1/token",`key=${i}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:r};return n.emulatorConfig&&yu(n.emulatorConfig.host)&&(l.credentials="include"),nE.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function JL(n,e){return Un(n,"POST","/v2/accounts:revokeToken",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Z(e.idToken,"internal-error"),Z(typeof e.idToken<"u","internal-error"),Z(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ap(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Z(e.length!==0,"internal-error");const t=Ap(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Z(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await QL(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new ri;return r&&(Z(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Z(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Z(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ri,this.toJSON())}_performRefresh(){return Xn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(n,e){Z(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class cn{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new YL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Od(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Es(this,this.stsTokenManager.getToken(this.auth,e));return Z(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return WL(this,e)}reload(){return qL(this)}_assign(e){this!==e&&(Z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new cn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Pl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Kt(this.auth.app))return Promise.reject(Zn(this.auth));const e=await this.getIdToken();return await Es(this,KL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:d,emailVerified:h,isAnonymous:f,providerData:g,stsTokenManager:m}=t;Z(d&&m,e,"internal-error");const v=ri.fromJSON(this.name,m);Z(typeof d=="string",e,"internal-error"),hr(r,e.name),hr(s,e.name),Z(typeof h=="boolean",e,"internal-error"),Z(typeof f=="boolean",e,"internal-error"),hr(i,e.name),hr(a,e.name),hr(o,e.name),hr(l,e.name),hr(u,e.name),hr(c,e.name);const p=new cn({uid:d,auth:e,email:s,emailVerified:h,displayName:r,isAnonymous:f,photoURL:a,phoneNumber:i,tenantId:o,stsTokenManager:v,createdAt:u,lastLoginAt:c});return g&&Array.isArray(g)&&(p.providerData=g.map(y=>({...y}))),l&&(p._redirectEventId=l),p}static async _fromIdTokenResponse(e,t,r=!1){const s=new ri;s.updateFromServerResponse(t);const i=new cn({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Pl(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Z(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?iE(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),o=new ri;o.updateFromIdToken(r);const l=new cn({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Od(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _p=new Map;function Qn(n){ir(n instanceof Function,"Expected a class definition");let e=_p.get(n);return e?(ir(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,_p.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}aE.type="NONE";const Lp=aE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zo(n,e,t){return`firebase:${n}:${e}:${t}`}class si{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=zo(this.userKey,s.apiKey,i),this.fullPersistenceKey=zo("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Cl(this.auth,{idToken:e}).catch(()=>{});return t?cn._fromGetAccountInfoResponse(this.auth,t,e):null}return cn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new si(Qn(Lp),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Qn(Lp);const a=zo(r,e.config.apiKey,e.name);let o=null;for(const u of t)try{const c=await u._get(a);if(c){let d;if(typeof c=="string"){const h=await Cl(e,{idToken:c}).catch(()=>{});if(!h)break;d=await cn._fromGetAccountInfoResponse(e,h,c)}else d=cn._fromJSON(e,c);u!==i&&(o=d),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new si(i,e,r):(i=l[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(a)}catch{}})),new si(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wp(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(cE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(oE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hE(e))return"Blackberry";if(fE(e))return"Webos";if(lE(e))return"Safari";if((e.includes("chrome/")||uE(e))&&!e.includes("edge/"))return"Chrome";if(dE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function oE(n=pt()){return/firefox\//i.test(n)}function lE(n=pt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uE(n=pt()){return/crios\//i.test(n)}function cE(n=pt()){return/iemobile/i.test(n)}function dE(n=pt()){return/android/i.test(n)}function hE(n=pt()){return/blackberry/i.test(n)}function fE(n=pt()){return/webos/i.test(n)}function hf(n=pt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ZL(n=pt()){var e;return hf(n)&&!!((e=window.navigator)!=null&&e.standalone)}function ew(){return f_()&&document.documentMode===10}function gE(n=pt()){return hf(n)||dE(n)||fE(n)||hE(n)||/windows phone/i.test(n)||cE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pE(n,e=[]){let t;switch(n){case"Browser":t=wp(pt());break;case"Worker":t=`${wp(pt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ya}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,o)=>{try{const l=e(i);a(l)}catch(l){o(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nw(n,e={}){return Un(n,"GET","/v2/passwordPolicy",qr(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rw=6;class sw{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rw,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bp(this),this.idTokenSubscription=new bp(this),this.beforeStateQueue=new tw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Qn(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await si.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Cl(this,{idToken:e}),r=await cn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Kt(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(i=this.redirectUser)==null?void 0:i._redirectEventId,o=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Z(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pl(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=FL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Kt(this.app))return Promise.reject(Zn(this));const t=e?pn(e):null;return t&&Z(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Z(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Kt(this.app)?Promise.reject(Zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Kt(this.app)?Promise.reject(Zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Qn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await nw(this),t=new sw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Wa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await JL(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Qn(e)||this._popupRedirectResolver;Z(t,this,"argument-error"),this.redirectPersistenceManager=await si.create(this,[Qn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Z(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Z(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Kt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&DL(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Xr(n){return pn(n)}class bp{constructor(e){this.auth=e,this.observer=null,this.addObserver=S_(t=>this.observer=t)}get next(){return Z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function aw(n){vu=n}function mE(n){return vu.loadJS(n)}function ow(){return vu.recaptchaEnterpriseScript}function lw(){return vu.gapiScript}function uw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class cw{constructor(){this.enterprise=new dw}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class dw{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const hw="recaptcha-enterprise",yE="NO_RECAPTCHA";class fw{constructor(e){this.type=hw,this.auth=Xr(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,o)=>{HL(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new VL(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function s(i,a,o){const l=window.grecaptcha;Ip(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{a(u)}).catch(()=>{a(yE)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new cw().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(o=>{if(!t&&Ip(window.grecaptcha))s(o,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ow();l.length!==0&&(l+=o),mE(l).then(()=>{s(o,i,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function Rp(n,e,t,r=!1,s=!1){const i=new fw(n);let a;if(s)a=yE;else try{a=await i.verify(t)}catch{a=await i.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Md(n,e,t,r,s){var i;if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Rp(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Rp(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n,e){const t=qv(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(vi(i,e??{}))return s;Xt(s,"already-initialized")}return t.initialize({options:e})}function pw(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Qn);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function mw(n,e,t){const r=Xr(n);Z(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=vE(e),{host:a,port:o}=yw(e),l=o===null?"":`:${o}`,u={url:`${i}//${a}${l}/`},c=Object.freeze({host:a,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Z(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Z(vi(u,r.config.emulator)&&vi(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,yu(a)?(i_(`${i}//${a}${l}`),l_("Auth",!0)):vw()}function vE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function yw(n){const e=vE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:kp(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:kp(a)}}}function kp(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function vw(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xn("not implemented")}_getIdTokenResponse(e){return Xn("not implemented")}_linkToIdToken(e,t){return Xn("not implemented")}_getReauthenticationResolver(e){return Xn("not implemented")}}async function Ew(n,e){return Un(n,"POST","/v1/accounts:update",e)}async function Sw(n,e){return Un(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xw(n,e){return Xa(n,"POST","/v1/accounts:signInWithPassword",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tw(n,e){return Xa(n,"POST","/v1/accounts:signInWithEmailLink",qr(n,e))}async function Iw(n,e){return Xa(n,"POST","/v1/accounts:signInWithEmailLink",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa extends ff{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Pa(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Pa(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Md(e,t,"signInWithPassword",xw);case"emailLink":return Tw(e,{email:this._email,oobCode:this._password});default:Xt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Md(e,r,"signUpPassword",Sw);case"emailLink":return Iw(e,{idToken:t,email:this._email,oobCode:this._password});default:Xt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ii(n,e){return Xa(n,"POST","/v1/accounts:signInWithIdp",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aw="http://localhost";class Ss extends ff{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ss(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Xt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new Ss(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ii(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ii(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ii(e,t)}buildRequest(){const e={requestUri:Aw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=za(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _w(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Lw(n){const e=Wi(zi(n)).link,t=e?Wi(zi(e)).deep_link_id:null,r=Wi(zi(n)).deep_link_id;return(r?Wi(zi(r)).link:null)||r||t||e||n}class gf{constructor(e){const t=Wi(zi(e)),r=t.apiKey??null,s=t.oobCode??null,i=_w(t.mode??null);Z(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Lw(e);try{return new gf(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(){this.providerId=wi.PROVIDER_ID}static credential(e,t){return Pa._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=gf.parseLink(t);return Z(r,"argument-error"),Pa._fromEmailAndCode(e,r.code,r.tenantId)}}wi.PROVIDER_ID="password";wi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";wi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa extends pf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir extends Qa{constructor(){super("facebook.com")}static credential(e){return Ss._fromParams({providerId:Ir.PROVIDER_ID,signInMethod:Ir.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ir.credentialFromTaggedObject(e)}static credentialFromError(e){return Ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ir.credential(e.oauthAccessToken)}catch{return null}}}Ir.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ir.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn extends Qa{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ss._fromParams({providerId:zn.PROVIDER_ID,signInMethod:zn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return zn.credentialFromTaggedObject(e)}static credentialFromError(e){return zn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return zn.credential(t,r)}catch{return null}}}zn.GOOGLE_SIGN_IN_METHOD="google.com";zn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar extends Qa{constructor(){super("github.com")}static credential(e){return Ss._fromParams({providerId:Ar.PROVIDER_ID,signInMethod:Ar.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ar.credentialFromTaggedObject(e)}static credentialFromError(e){return Ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ar.credential(e.oauthAccessToken)}catch{return null}}}Ar.GITHUB_SIGN_IN_METHOD="github.com";Ar.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends Qa{constructor(){super("twitter.com")}static credential(e,t){return Ss._fromParams({providerId:_r.PROVIDER_ID,signInMethod:_r.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return _r.credentialFromTaggedObject(e)}static credentialFromError(e){return _r.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return _r.credential(t,r)}catch{return null}}}_r.TWITTER_SIGN_IN_METHOD="twitter.com";_r.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ww(n,e){return Xa(n,"POST","/v1/accounts:signUp",qr(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await cn._fromIdTokenResponse(e,r,s),a=Cp(r);return new xs({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Cp(r);return new xs({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Cp(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl extends Yr{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dl.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dl(e,t,r,s)}}function EE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dl._fromErrorAndOperation(n,i,e,r):i})}async function bw(n,e,t=!1){const r=await Es(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return xs._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rw(n,e,t=!1){const{auth:r}=n;if(Kt(r.app))return Promise.reject(Zn(r));const s="reauthenticate";try{const i=await Es(n,EE(r,s,e,n),t);Z(i.idToken,r,"internal-error");const a=df(i.idToken);Z(a,r,"internal-error");const{sub:o}=a;return Z(n.uid===o,r,"user-mismatch"),xs._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Xt(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SE(n,e,t=!1){if(Kt(n.app))return Promise.reject(Zn(n));const r="signIn",s=await EE(n,r,e),i=await xs._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function kw(n,e){return SE(Xr(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xE(n){const e=Xr(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Cw(n,e,t){if(Kt(n.app))return Promise.reject(Zn(n));const r=Xr(n),a=await Md(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ww).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&xE(n),l}),o=await xs._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function Pw(n,e,t){return Kt(n.app)?Promise.reject(Zn(n)):kw(pn(n),wi.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xE(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dw(n,e){return Un(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pp(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=pn(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await Es(r,Dw(r.auth,i));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const o=r.providerData.find(({providerId:l})=>l==="password");o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function Nw(n,e){return Ow(pn(n),null,e)}async function Ow(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};t&&(i.password=t);const a=await Es(n,Ew(r,i));await n._updateTokensIfNecessary(a,!0)}function Mw(n,e,t,r){return pn(n).onIdTokenChanged(e,t,r)}function Fw(n,e,t){return pn(n).beforeAuthStateChanged(e,t)}function Uw(n,e,t,r){return pn(n).onAuthStateChanged(e,t,r)}function Bw(n){return pn(n).signOut()}const Nl="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nl,"1"),this.storage.removeItem(Nl),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w=1e3,jw=10;class IE extends TE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);ew()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,jw):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},$w)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}IE.type="LOCAL";const Gw=IE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE extends TE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}AE.type="SESSION";const _E=AE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Eu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const o=Array.from(a).map(async u=>u(t.origin,i)),l=await Vw(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Eu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((o,l)=>{const u=mf("",20);s.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(d){const h=d;if(h.data.eventId===u)switch(h.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(h.data.response);break;default:clearTimeout(c),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(){return window}function Kw(n){On().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LE(){return typeof On().WorkerGlobalScope<"u"&&typeof On().importScripts=="function"}async function Ww(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function zw(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function Yw(){return LE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE="firebaseLocalStorageDb",qw=1,Ol="firebaseLocalStorage",bE="fbase_key";class Ja{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Su(n,e){return n.transaction([Ol],e?"readwrite":"readonly").objectStore(Ol)}function Xw(){const n=indexedDB.deleteDatabase(wE);return new Ja(n).toPromise()}function Fd(){const n=indexedDB.open(wE,qw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ol,{keyPath:bE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ol)?e(r):(r.close(),await Xw(),e(await Fd()))})})}async function Dp(n,e,t){const r=Su(n,!0).put({[bE]:e,value:t});return new Ja(r).toPromise()}async function Qw(n,e){const t=Su(n,!1).get(e),r=await new Ja(t).toPromise();return r===void 0?null:r.value}function Np(n,e){const t=Su(n,!0).delete(e);return new Ja(t).toPromise()}const Jw=800,Zw=3;class RE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Fd(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Zw)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return LE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Eu._getInstance(Yw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await Ww(),!this.activeServiceWorker)return;this.sender=new Hw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||zw()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Fd();return await Dp(e,Nl,"1"),await Np(e,Nl),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Dp(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Qw(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Np(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Su(s,!1).getAll();return new Ja(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Jw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}RE.type="LOCAL";const eb=RE;new qa(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kE(n,e){return e?Qn(e):(Z(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf extends ff{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ii(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ii(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ii(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tb(n){return SE(n.auth,new yf(n),n.bypassAuthState)}function nb(n){const{auth:e,user:t}=n;return Z(t,e,"internal-error"),Rw(t,new yf(n),n.bypassAuthState)}async function rb(n){const{auth:e,user:t}=n;return Z(t,e,"internal-error"),bw(t,new yf(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tb;case"linkViaPopup":case"linkViaRedirect":return rb;case"reauthViaPopup":case"reauthViaRedirect":return nb;default:Xt(this.auth,"internal-error")}}resolve(e){ir(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ir(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sb=new qa(2e3,1e4);async function ib(n,e,t){if(Kt(n.app))return Promise.reject(fn(n,"operation-not-supported-in-this-environment"));const r=Xr(n);NL(n,e,pf);const s=kE(r,t);return new cs(r,"signInViaPopup",e,s).executeNotNull()}class cs extends CE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,cs.currentPopupAction&&cs.currentPopupAction.cancel(),cs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Z(e,this.auth,"internal-error"),e}async onExecution(){ir(this.filter.length===1,"Popup operations only handle one event");const e=mf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(fn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(fn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,sb.get())};e()}}cs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab="pendingRedirect",Yo=new Map;class ob extends CE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Yo.get(this.auth._key());if(!e){try{const r=await lb(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Yo.set(this.auth._key(),e)}return this.bypassAuthState||Yo.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lb(n,e){const t=db(e),r=cb(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function ub(n,e){Yo.set(n._key(),e)}function cb(n){return Qn(n._redirectPersistence)}function db(n){return zo(ab,n.config.apiKey,n.name)}async function hb(n,e,t=!1){if(Kt(n.app))return Promise.reject(Zn(n));const r=Xr(n),s=kE(r,e),a=await new ob(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fb=10*60*1e3;class gb{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pb(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!PE(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(fn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=fb&&this.cachedEventUids.clear(),this.cachedEventUids.has(Op(e))}saveEventToCache(e){this.cachedEventUids.add(Op(e)),this.lastProcessedEventTime=Date.now()}}function Op(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function PE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pb(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return PE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mb(n,e={}){return Un(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yb=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vb=/^https?/;async function Eb(n){if(n.config.emulator)return;const{authorizedDomains:e}=await mb(n);for(const t of e)try{if(Sb(t))return}catch{}Xt(n,"unauthorized-domain")}function Sb(n){const e=Nd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!vb.test(t))return!1;if(yb.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=new qa(3e4,6e4);function Mp(){const n=On().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Tb(n){return new Promise((e,t)=>{var s,i,a;function r(){Mp(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Mp(),t(fn(n,"network-request-failed"))},timeout:xb.get()})}if((i=(s=On().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((a=On().gapi)!=null&&a.load)r();else{const o=uw("iframefcb");return On()[o]=()=>{gapi.load?r():t(fn(n,"network-request-failed"))},mE(`${lw()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw qo=null,e})}let qo=null;function Ib(n){return qo=qo||Tb(n),qo}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ab=new qa(5e3,15e3),_b="__/auth/iframe",Lb="emulator/auth/iframe",wb={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bb=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Rb(n){const e=n.config;Z(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?cf(e,Lb):`https://${n.config.authDomain}/${_b}`,r={apiKey:e.apiKey,appName:n.name,v:Ya},s=bb.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${za(r).slice(1)}`}async function kb(n){const e=await Ib(n),t=On().gapi;return Z(t,n,"internal-error"),e.open({where:document.body,url:Rb(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wb,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=fn(n,"network-request-failed"),o=On().setTimeout(()=>{i(a)},Ab.get());function l(){On().clearTimeout(o),s(r)}r.ping(l).then(l,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Pb=500,Db=600,Nb="_blank",Ob="http://localhost";class Fp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Mb(n,e,t,r=Pb,s=Db){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l={...Cb,width:r.toString(),height:s.toString(),top:i,left:a},u=pt().toLowerCase();t&&(o=uE(u)?Nb:t),oE(u)&&(e=e||Ob,l.scrollbars="yes");const c=Object.entries(l).reduce((h,[f,g])=>`${h}${f}=${g},`,"");if(ZL(u)&&o!=="_self")return Fb(e||"",o),new Fp(null);const d=window.open(e||"",o,c);Z(d,n,"popup-blocked");try{d.focus()}catch{}return new Fp(d)}function Fb(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub="__/auth/handler",Bb="emulator/auth/handler",$b=encodeURIComponent("fac");async function Up(n,e,t,r,s,i){Z(n.config.authDomain,n,"auth-domain-config-required"),Z(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ya,eventId:s};if(e instanceof pf){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",E_(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,d]of Object.entries({}))a[c]=d}if(e instanceof Qa){const c=e.getScopes().filter(d=>d!=="");c.length>0&&(a.scopes=c.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];const l=await n._getAppCheckToken(),u=l?`#${$b}=${encodeURIComponent(l)}`:"";return`${jb(n)}?${za(o).slice(1)}${u}`}function jb({config:n}){return n.emulator?cf(n,Bb):`https://${n.authDomain}/${Ub}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="webStorageSupport";class Gb{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_E,this._completeRedirectFn=hb,this._overrideRedirectResult=ub}async _openPopup(e,t,r,s){var a;ir((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const i=await Up(e,t,r,Nd(),s);return Mb(e,i,mf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Up(e,t,r,Nd(),s);return Kw(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ir(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await kb(e),r=new gb(e);return t.register("authEvent",s=>(Z(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(sc,{type:sc},s=>{var a;const i=(a=s==null?void 0:s[0])==null?void 0:a[sc];i!==void 0&&t(!!i),Xt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Eb(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return gE()||lE()||hf()}}const Vb=Gb;var Bp="@firebase/auth",$p="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Wb(n){ka(new Ei("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;Z(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pE(n)},u=new iw(r,s,i,l);return pw(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ka(new Ei("auth-internal",e=>{const t=Xr(e.getProvider("auth").getImmediate());return(r=>new Hb(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ni(Bp,$p,Kb(n)),ni(Bp,$p,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zb=5*60,Yb=Kv("authIdTokenMaxAge")||zb;let jp=null;const qb=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Yb)return;const s=t==null?void 0:t.token;jp!==s&&(jp=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Xb(n=Qv()){const e=qv(n,"auth");if(e.isInitialized())return e.getImmediate();const t=gw(n,{popupRedirectResolver:Vb,persistence:[eb,Gw,_E]}),r=Kv("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=qb(i.toString());Fw(t,a,()=>a(t.currentUser)),Mw(t,o=>a(o))}}const s=r_("auth");return s&&mw(t,`http://${s}`),t}function Qb(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}aw({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=fn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Qb().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Wb("Browser");var Jb="firebase",Zb="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ni(Jb,Zb,"app");const Yi={apiKey:"AIzaSyAXwrTMoVbw4O4ExiP1DjEKrq7ERZC4ncs",authDomain:"webanime-b4e20.firebaseapp.com",projectId:"webanime-b4e20",storageBucket:"webanime-b4e20.firebasestorage.app",messagingSenderId:"545359272392",appId:"1:545359272392:web:069bed61b416cbf75d88fd"},Ud=!!(Yi.apiKey&&Yi.authDomain&&Yi.projectId&&Yi.appId),Gp=Ud?xL().length?Qv():Xv(Yi):null,fr=Gp?Xb(Gp):null,eR=new zn;function tR(n){return!Array.isArray(n)||n.length===0?"":n[Math.floor(Math.random()*n.length)]}const nR=["anime-boy-kaito","anime-boy-ren","anime-boy-haruto","anime-boy-shin","anime-boy-yuki","anime-boy-riku"],rR=["anime-girl-akari","anime-girl-hina","anime-girl-mio","anime-girl-yuna","anime-girl-sora","anime-girl-rin"];function sR(){const n=Math.random()<.5,e=tR(n?nR:rR);return`https://api.dicebear.com/7.x/adventurer/svg?seed=${encodeURIComponent(e)}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`}const DE=P.createContext(null),NE="animex_users",OE="animex_ad_slot",ME="animex_ad_link",vf=new Set(["top-center","bottom-right","bottom-left","middle-right","middle-left"]);function Ef(n){const e=String(n||"").trim();return e?/^https?:\/\//i.test(e)?e:`https://${e}`:""}function iR(){const n="admin@animex.local";return new Set(n.split(",").map(e=>e.trim().toLowerCase()).filter(Boolean))}function aR(n){return!(n!=null&&n.active)||!(n!=null&&n.expireAt)?!1:new Date(n.expireAt).getTime()>Date.now()}function vr(n){var t,r,s;const e=aR(n==null?void 0:n.premium);return{id:String((n==null?void 0:n.id)||""),email:String((n==null?void 0:n.email)||"").trim().toLowerCase(),username:String((n==null?void 0:n.username)||"User"),photoUrl:String((n==null?void 0:n.photoUrl)||""),role:(n==null?void 0:n.role)==="admin"?"admin":"user",premium:{active:e,plan:e&&((t=n==null?void 0:n.premium)==null?void 0:t.plan)||"",days:e?Number(((r=n==null?void 0:n.premium)==null?void 0:r.days)||0):0,expireAt:e&&((s=n==null?void 0:n.premium)==null?void 0:s.expireAt)||""},watchHistory:Array.isArray(n==null?void 0:n.watchHistory)?n.watchHistory.slice(0,200):[],watchlist:Array.isArray(n==null?void 0:n.watchlist)?n.watchlist.slice(0,200):[],watchedEpisodes:n!=null&&n.watchedEpisodes&&typeof n.watchedEpisodes=="object"?n.watchedEpisodes:{}}}function oR(){try{const n=localStorage.getItem(NE),e=n?JSON.parse(n):[];return Array.isArray(e)?e.map(vr):[]}catch{return[]}}function Vp(n){localStorage.setItem(NE,JSON.stringify(n.map(vr)))}function lR(){const n=localStorage.getItem(OE)||"top-center";return vf.has(n)?n:"top-center"}function uR(n){vf.has(n)&&localStorage.setItem(OE,n)}function cR(){return Ef(localStorage.getItem(ME)||"")}function dR(n){localStorage.setItem(ME,Ef(n))}function hR(n,e){return String((n==null?void 0:n.code)||"")==="auth/invalid-credential"?"Mungkin Email/Password yang kamu masukkan salah":(n==null?void 0:n.message)||e}function fR({children:n}){const[e,t]=P.useState(()=>oR()),[r,s]=P.useState(null),[i,a]=P.useState(!1),[o,l]=P.useState(()=>lR()),[u,c]=P.useState(()=>cR()),d=P.useMemo(()=>iR(),[]),h=C=>{const F=C.map(vr);t(F),Vp(F)};P.useEffect(()=>{if(!Ud||!fr){a(!0);return}const C=Uw(fr,F=>{var B;if(s(F||null),F){const O=String(F.email||"").toLowerCase(),R=d.has(O)?"admin":"user",M=[...e],G=M.findIndex($=>$.id===F.uid),V={id:F.uid,email:O,username:F.displayName||O.split("@")[0]||"User",photoUrl:sR(),role:R,premium:{active:!1,plan:"",days:0,expireAt:""},watchHistory:[],watchlist:[],watchedEpisodes:{}};if(G>=0){const $=String(((B=M[G])==null?void 0:B.photoUrl)||"").trim();M[G]=vr({...M[G],...V,photoUrl:$||V.photoUrl,role:M[G].role||R})}else M.push(vr(V));h(M)}a(!0)});return()=>C()},[d]);const f=P.useMemo(()=>r&&e.find(C=>C.id===r.uid)||null,[e,r]),g=()=>!Ud||!fr?{ok:!1,error:"Layanan autentikasi belum tersedia. Coba lagi beberapa saat."}:null,m=async({email:C,username:F,password:B})=>{const O=g();if(O)return O;try{const R=await Cw(fr,String(C||"").trim(),String(B||""));return F&&await Pp(R.user,{displayName:String(F).trim()}),s(R.user),{ok:!0}}catch(R){return{ok:!1,error:(R==null?void 0:R.message)||"Signup gagal."}}},v=async({email:C,password:F})=>{const B=g();if(B)return B;try{const O=await Pw(fr,String(C||"").trim(),String(F||""));return await O.user.reload(),s(fr.currentUser||O.user),{ok:!0}}catch(O){return{ok:!1,error:hR(O,"Login gagal.")}}},p=async()=>{const C=g();if(C)return C;try{const F=await ib(fr,eR);return s(F.user),{ok:!0}}catch(F){return{ok:!1,error:(F==null?void 0:F.message)||"Login Google gagal."}}},y=async()=>{g()||await Bw(fr)},E=C=>{if(!f)return{ok:!1,error:"User tidak ditemukan."};const F=e.map(B=>B.id===f.id?vr(C(B)):B);return h(F),{ok:!0}},T=async C=>{if(!f||!r)return{ok:!1,error:"User tidak ditemukan."};try{if(await Pp(r,{displayName:(C==null?void 0:C.username)??f.username}),C!=null&&C.password)try{await Nw(r,String(C.password))}catch{return{ok:!1,error:"Gagal update password. Login ulang lalu coba lagi."}}return E(F=>({...F,username:(C==null?void 0:C.username)??F.username}))}catch(F){return{ok:!1,error:(F==null?void 0:F.message)||"Update profile gagal."}}},A=(C,F)=>!f||f.role!=="admin"?{ok:!1,error:"Akses admin dibutuhkan."}:e.find(O=>O.id===C)?E(O=>{const R=e.map(M=>M.id!==C?M:vr({...M,username:(F==null?void 0:F.username)??M.username}));return Vp(R),t(R),O}):{ok:!1,error:"User tidak ditemukan."},w=(C,{plan:F,days:B})=>{if(!f||f.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};if(!e.find($=>$.id===C))return{ok:!1,error:"User tidak ditemukan."};const R=Math.max(0,Number(B||0)),M=new Date(Date.now()+R*864e5).toISOString(),G=R>0?{active:!0,plan:String(F||"Premium"),days:R,expireAt:M}:{active:!1,plan:"",days:0,expireAt:""},V=e.map($=>$.id===C?vr({...$,premium:G}):$);return h(V),{ok:!0}},_=({email:C,days:F})=>{if(!f||f.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const B=String(C||"").trim().toLowerCase(),O=e.find(R=>String(R.email).toLowerCase()===B);return O?w(O.id,{plan:"Premium Plan",days:F}):{ok:!1,error:"Email user tidak ditemukan."}},L=C=>{const F=String((C==null?void 0:C.animeId)||"").trim();return F?E(B=>{const R=(Array.isArray(B.watchlist)?B.watchlist:[]).filter(M=>String(M==null?void 0:M.animeId)!==F);return{...B,watchlist:[{animeId:F,title:(C==null?void 0:C.title)||"Untitled Donghua",poster:(C==null?void 0:C.poster)||"",source:(C==null?void 0:C.source)||"anichin",slug:(C==null?void 0:C.slug)||"",addedAt:new Date().toISOString()},...R].slice(0,200)}}):{ok:!1,error:"animeId wajib ada."}},b=C=>{const F=String(C||"").trim();return F?E(B=>({...B,watchlist:(Array.isArray(B.watchlist)?B.watchlist:[]).filter(O=>String(O==null?void 0:O.animeId)!==F)})):{ok:!1,error:"animeId wajib ada."}},I=C=>{const F=String((C==null?void 0:C.animeId)||"").trim();if(!F)return{ok:!1,error:"animeId wajib ada."};const B=String((C==null?void 0:C.episodeId)||(C==null?void 0:C.episodeNumber)||"").trim();return B?E(O=>{const R={...(O==null?void 0:O.watchedEpisodes)||{}},M=Array.isArray(R[F])?R[F]:[];M.includes(B)||(R[F]=[B,...M].slice(0,300));const G=Array.isArray(O==null?void 0:O.watchHistory)?O.watchHistory:[],V=`${F}:${B}`,$={id:V,animeId:F,episodeId:(C==null?void 0:C.episodeId)||"",episodeNumber:(C==null?void 0:C.episodeNumber)||null,title:(C==null?void 0:C.title)||"Untitled Donghua",episodeTitle:(C==null?void 0:C.episodeTitle)||"",poster:(C==null?void 0:C.poster)||"",source:(C==null?void 0:C.source)||"anichin",slug:(C==null?void 0:C.slug)||"",watchedAt:new Date().toISOString()};return{...O,watchedEpisodes:R,watchHistory:[$,...G.filter(Q=>(Q==null?void 0:Q.id)!==V)].slice(0,200)}}):{ok:!1,error:"episodeId/episodeNumber wajib ada."}},k=C=>!f||f.role!=="admin"?{ok:!1,error:"Akses admin dibutuhkan."}:vf.has(C)?(l(C),uR(C),{ok:!0}):{ok:!1,error:"Posisi slot tidak valid."},H=C=>{if(!f||f.role!=="admin")return{ok:!1,error:"Akses admin dibutuhkan."};const F=Ef(C);return F&&!/^https?:\/\/[^\s]+$/i.test(F)?{ok:!1,error:"Format link iklan tidak valid."}:(c(F),dR(F),{ok:!0})},U=P.useMemo(()=>({user:f,users:e,ready:i,isLoggedIn:!!(r!=null&&r.uid),isAdmin:(f==null?void 0:f.role)==="admin",signUp:m,signIn:v,signInWithGoogle:p,signOut:y,updateProfile:T,adminUpdateUser:A,adminSetPremium:w,adminSetPremiumByEmail:_,watchHistory:Array.isArray(f==null?void 0:f.watchHistory)?f.watchHistory:[],watchlist:Array.isArray(f==null?void 0:f.watchlist)?f.watchlist:[],watchedEpisodes:(f==null?void 0:f.watchedEpisodes)||{},addToWatchlist:L,removeFromWatchlist:b,markEpisodeWatched:I,adSlot:o,adminSetAdSlot:k,adLink:u,adminSetAdLink:H}),[f,e,i,o,u,r]);return x.jsx(DE.Provider,{value:U,children:n})}function wt(){const n=P.useContext(DE);if(!n)throw new Error("useAuth must be used inside AuthProvider");return n}function gR(){var l;const{user:n,isLoggedIn:e,isAdmin:t,signOut:r}=wt(),s=Ka(),[i,a]=P.useState(!1),o=({isActive:u})=>`rounded-full px-3 py-1.5 text-sm transition ${u?"bg-white/10 text-white":"text-slate-300 hover:text-white"}`;return x.jsxs("header",{className:"sticky top-0 z-40 border-b border-white/10 bg-slate-950/75 backdrop-blur-xl",children:[x.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8",children:[x.jsxs(ze,{to:"/",className:"font-heading text-xl font-bold tracking-tight text-white",children:["Donghua",x.jsx("span",{className:"bg-gradient-to-r from-fuchsia-400 to-cyan-300 bg-clip-text text-transparent",children:"X"})]}),x.jsxs("button",{type:"button",className:"rounded-lg border border-white/15 p-2 text-slate-300 md:hidden",onClick:()=>a(u=>!u),"aria-expanded":i,"aria-controls":"mobile-nav",children:[x.jsx("span",{className:"sr-only",children:"Toggle menu"}),i?x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:x.jsx("path",{d:"M6 6L18 18M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}):x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:x.jsx("path",{d:"M4 7H20M4 12H20M4 17H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),x.jsxs("nav",{className:"hidden items-center gap-2 md:flex",children:[x.jsx(nn,{to:"/",className:o,children:"Donghua"}),x.jsx(nn,{to:"/history",className:o,children:"Riwayat"}),x.jsx(nn,{to:"/watchlist",className:o,children:"Watchlist"}),e?x.jsxs("details",{className:"relative ml-2",children:[x.jsxs("summary",{className:"flex cursor-pointer list-none items-center gap-2 rounded-full border border-white/15 bg-white/5 px-2 py-1.5",children:[x.jsx("div",{className:"h-8 w-8 overflow-hidden rounded-full border border-white/20 bg-slate-800",children:n!=null&&n.photoUrl?x.jsx("img",{src:n.photoUrl,alt:n.username||"Profile",className:"h-full w-full object-cover"}):null}),x.jsx("span",{className:"max-w-40 truncate text-sm font-semibold text-white",children:(n==null?void 0:n.username)||(n==null?void 0:n.email)})]}),x.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-2xl border border-white/15 bg-slate-950/95 p-2 shadow-xl",children:[x.jsxs("div",{className:"mb-1 rounded-xl bg-white/5 px-3 py-2",children:[x.jsx("p",{className:"text-xs text-slate-300",children:n==null?void 0:n.email}),(l=n==null?void 0:n.premium)!=null&&l.active?x.jsx("p",{className:"mt-1 text-xs font-semibold text-amber-300",children:n.premium.plan}):x.jsx("p",{className:"mt-1 text-xs font-semibold text-slate-400",children:"Free Plan"})]}),x.jsx(ze,{to:"/account",className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Account"}),x.jsx(ze,{to:"/premium",className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Premium"}),t?x.jsx(ze,{to:"/admin",className:"block rounded-xl px-3 py-2 text-sm text-slate-200 hover:bg-white/10",children:"Admin Panel"}):null,x.jsx("button",{onClick:()=>{r(),s("/login")},className:"mt-1 block w-full rounded-xl px-3 py-2 text-left text-sm text-slate-200 hover:bg-white/10",type:"button",children:"Logout"})]})]}):x.jsx(nn,{to:"/login",className:"rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Login"})]})]}),i?x.jsx("div",{id:"mobile-nav",className:"border-t border-white/10 bg-slate-950/95 px-4 py-3 md:hidden",children:x.jsxs("div",{className:"flex flex-col gap-2",children:[x.jsx(nn,{to:"/",className:o,onClick:()=>a(!1),children:"Donghua"}),x.jsx(nn,{to:"/history",className:o,onClick:()=>a(!1),children:"Riwayat"}),x.jsx(nn,{to:"/watchlist",className:o,onClick:()=>a(!1),children:"Watchlist"}),e?x.jsxs(x.Fragment,{children:[x.jsx(nn,{to:"/account",className:o,onClick:()=>a(!1),children:"Account"}),x.jsx(nn,{to:"/premium",className:o,onClick:()=>a(!1),children:"Premium"}),t?x.jsx(nn,{to:"/admin",className:o,onClick:()=>a(!1),children:"Admin Panel"}):null,x.jsx("button",{type:"button",onClick:()=>{a(!1),r(),s("/login")},className:"rounded-full border border-white/15 bg-white/5 px-3 py-1.5 text-left text-sm text-slate-200 transition hover:bg-white/10",children:"Logout"})]}):x.jsx(nn,{to:"/login",onClick:()=>a(!1),className:"rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Login"})]})}):null]})}function pR(){return x.jsx("footer",{className:"mt-8 border-t border-white/10 bg-slate-950/70",children:x.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-col gap-3 px-3 py-5 text-sm text-slate-300 sm:px-5 md:flex-row md:items-center md:justify-between lg:px-8",children:[x.jsxs("p",{className:"text-xs text-slate-400",children:[" ",new Date().getFullYear()," DonghuaX. All rights reserved."]}),x.jsxs("nav",{className:"flex flex-wrap items-center gap-3",children:[x.jsx(ze,{to:"/about",className:"transition hover:text-white",children:"About"}),x.jsx(ze,{to:"/contact",className:"transition hover:text-white",children:"Contact"}),x.jsx(ze,{to:"/privacy-policy",className:"transition hover:text-white",children:"Privacy Policy"})]})]})})}function mR(){var d;const{user:n,updateProfile:e}=wt(),[t,r]=P.useState(n.username||""),[s,i]=P.useState(n.email||""),[a,o]=P.useState(n.password||""),[l,u]=P.useState(""),c=h=>{h.preventDefault();const f=e({username:t,email:s,password:a});u(f.ok?"Profile berhasil diupdate.":f.error)};return x.jsxs("section",{className:"mx-auto max-w-3xl rounded-3xl border border-cyan-400/20 bg-zinc-950/90 p-5 sm:p-6",children:[x.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Account"}),x.jsx("p",{className:"mt-1 text-sm text-zinc-300",children:"Ubah profil akun kapan saja."})]}),x.jsxs("div",{className:"relative h-16 w-16 overflow-hidden rounded-2xl border border-cyan-400/20 bg-zinc-900",children:[n!=null&&n.photoUrl?x.jsx("img",{src:n.photoUrl,alt:t||"Profile",className:"h-full w-full object-cover"}):null,x.jsx("span",{className:"absolute bottom-1 left-1 rounded-full bg-black/70 px-2 py-0.5 text-[10px] font-semibold text-amber-300",children:(d=n==null?void 0:n.premium)!=null&&d.active?n.premium.plan:"Free"})]})]}),x.jsxs("form",{onSubmit:c,className:"mt-5 space-y-3",children:[x.jsxs("label",{className:"block text-sm text-zinc-300",children:["Username",x.jsx("input",{className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:t,onChange:h=>r(h.target.value),required:!0})]}),x.jsxs("label",{className:"block text-sm text-zinc-300",children:["Email",x.jsx("input",{type:"email",className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:s,onChange:h=>i(h.target.value),required:!0})]}),x.jsxs("label",{className:"block text-sm text-zinc-300",children:["Password",x.jsx("input",{type:"text",className:"mt-1 w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-2.5 text-zinc-100 outline-none focus:border-cyan-300/60",value:a,onChange:h=>o(h.target.value),required:!0})]}),x.jsx("p",{className:"text-xs text-zinc-400",children:"Foto profil dikunci otomatis oleh sistem avatar random donghua."}),l?x.jsx("p",{className:"text-sm text-cyan-200",children:l}):null,x.jsx("button",{className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",type:"submit",children:"Save Changes"})]})]})}function yR(){var b;const{users:n,user:e,adminUpdateUser:t,adminSetPremiumByEmail:r,adSlot:s,adminSetAdSlot:i,adLink:a,adminSetAdLink:o}=wt(),l=P.useMemo(()=>n.filter(I=>I.role!=="admin"||I.id===(e==null?void 0:e.id)),[n,e==null?void 0:e.id]),[u,c]=P.useState(((b=l[0])==null?void 0:b.id)||""),[d,h]=P.useState(""),[f,g]=P.useState({email:"",days:30}),[m,v]=P.useState(a||""),p=P.useMemo(()=>l.find(I=>I.id===u)||null,[l,u]),[y,E]=P.useState({username:"",email:"",password:""}),T=I=>{var k;E({username:(I==null?void 0:I.username)||"",email:(I==null?void 0:I.email)||"",password:(I==null?void 0:I.password)||""}),g({email:(I==null?void 0:I.email)||"",days:Number(((k=I==null?void 0:I.premium)==null?void 0:k.days)||30)})},A=I=>{c(I),h("")};P.useEffect(()=>{if(!l.length)return;if(!u||!l.some(k=>k.id===u)){c(l[0].id);return}const I=l.find(k=>k.id===u);T(I)},[l,u]);const w=I=>{if(I.preventDefault(),!p)return;const k=t(p.id,{username:y.username,email:y.email,password:y.password});h(k.ok?"User berhasil diupdate.":k.error)},_=()=>{const I=r({email:f.email,days:Number(f.days)});h(I.ok?"Premium plan berhasil diupdate.":I.error)},L=[{value:"top-center",label:"Atas Tengah"},{value:"bottom-right",label:"Kanan Bawah"},{value:"bottom-left",label:"Kiri Bawah"},{value:"middle-right",label:"Kanan Tengah"},{value:"middle-left",label:"Kiri Tengah"}];return x.jsxs("section",{className:"space-y-6",children:[x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-5 backdrop-blur xl:p-7",children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Admin Panel"}),x.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Kelola data user, reset password, update email/username, dan atur premium plan."})]}),x.jsxs("div",{className:"grid gap-6 lg:grid-cols-[320px,1fr]",children:[x.jsxs("aside",{className:"rounded-3xl border border-white/10 bg-slate-950/60 p-4",children:[x.jsx("p",{className:"mb-3 text-xs uppercase tracking-[0.2em] text-slate-400",children:"User List"}),x.jsx("div",{className:"space-y-2",children:l.map(I=>{var k;return x.jsxs("button",{type:"button",onClick:()=>A(I.id),className:`w-full rounded-2xl border px-3 py-3 text-left transition ${u===I.id?"border-cyan-300/60 bg-cyan-400/10":"border-white/10 bg-white/5 hover:border-white/20"}`,children:[x.jsx("p",{className:"font-semibold text-white",children:I.username}),x.jsx("p",{className:"text-xs text-slate-400",children:I.email}),x.jsx("p",{className:"mt-1 text-[11px] text-amber-300",children:(k=I.premium)!=null&&k.active?`${I.premium.plan} (${I.premium.days} hari)`:"Free Plan"})]},I.id)})})]}),x.jsx("div",{className:"rounded-3xl border border-white/10 bg-slate-950/60 p-5",children:p?x.jsxs("form",{onSubmit:w,className:"space-y-4",children:[x.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[x.jsxs("label",{className:"text-sm text-slate-300",children:["Username",x.jsx("input",{value:y.username,onChange:I=>E(k=>({...k,username:I.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]}),x.jsxs("label",{className:"text-sm text-slate-300",children:["Email",x.jsx("input",{type:"email",value:y.email,onChange:I=>E(k=>({...k,email:I.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]}),x.jsxs("label",{className:"text-sm text-slate-300",children:["Password",x.jsx("input",{value:y.password,onChange:I=>E(k=>({...k,password:I.target.value})),className:"mt-1 w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",required:!0})]})]}),x.jsx("p",{className:"text-xs text-slate-400",children:"Foto profil dikunci otomatis (random donghua avatar) dan tidak bisa diubah admin."}),x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-sm font-semibold text-white",children:"Premium Plan"}),x.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-[1fr,120px,auto]",children:[x.jsx("input",{value:f.email,onChange:I=>g(k=>({...k,email:I.target.value})),className:"rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",placeholder:"email user"}),x.jsx("input",{type:"number",min:"0",value:f.days,onChange:I=>g(k=>({...k,days:I.target.value})),className:"rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60"}),x.jsx("button",{type:"button",onClick:_,className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Set Premium"})]})]}),x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-sm font-semibold text-white",children:"Advertisement Slot"}),x.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Posisi overlay iklan untuk user Free Plan di halaman watch."}),x.jsxs("div",{className:"mt-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[x.jsx("select",{value:s,onChange:I=>{const k=i(I.target.value);h(k.ok?"Posisi iklan berhasil diupdate.":k.error)},className:"w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60 sm:max-w-xs",children:L.map(I=>x.jsx("option",{value:I.value,children:I.label},I.value))}),x.jsxs("p",{className:"text-xs text-slate-300",children:["Posisi aktif: ",s]})]}),x.jsxs("div",{className:"mt-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[x.jsx("input",{value:m,onChange:I=>v(I.target.value),className:"w-full rounded-xl border border-white/10 bg-slate-900 px-4 py-2.5 outline-none focus:border-cyan-300/60",placeholder:"https://sponsor.com/promo"}),x.jsx("button",{type:"button",onClick:()=>{const I=o(m);h(I.ok?"Link iklan berhasil diupdate.":I.error)},className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Simpan Link"})]}),x.jsxs("p",{className:"mt-2 text-xs text-slate-300",children:["Link aktif: ",a||"-"]}),x.jsxs("div",{className:"mt-4 rounded-xl border border-cyan-400/20 bg-cyan-500/5 p-3",children:[x.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-cyan-200",children:"Tutorial"}),x.jsxs("ol",{className:"mt-2 list-decimal space-y-1 pl-4 text-xs text-slate-300",children:[x.jsx("li",{children:"Pilih posisi slot iklan dari dropdown."}),x.jsx("li",{children:"Isi URL iklan pada box link, lalu klik Simpan Link."}),x.jsx("li",{children:"Perubahan tersimpan otomatis dan langsung aktif di Watch Page."}),x.jsx("li",{children:"User Free melihat iklan sesuai posisi ini, user Premium tidak melihat iklan."})]})]})]}),d?x.jsx("p",{className:"text-sm text-cyan-200",children:d}):null,x.jsx("button",{type:"submit",className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Save User Changes"})]}):x.jsx("p",{className:"text-sm text-slate-400",children:"Pilih user terlebih dahulu."})})]})]})}const vR="https://anichinapi-production.up.railway.app",Hp=String(vR).replace(/\/+$/,""),sn=2e4,ER="donghuax_cache_v1",Bd=new Map,ic=new Map,Wn="anichin";function le(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function SR(n={}){const e=new URLSearchParams;Object.entries(n).forEach(([r,s])=>{s==null||s===""||e.set(r,String(s))});const t=e.toString();return t?`?${t}`:""}function Ml(n){const e=le(n).trim().replace(/\\\//g,"/");return e?/^https?:\/\//i.test(e)?e:e.startsWith("//")?`https:${e}`:/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(e)?`https://${e}`:"":""}function ac(n){return Fl(n,"").toLowerCase().replace(/[^a-z0-9]/g,"")}function $d(n){const e=le(n).trim();return e?e.replace(/-episode-\d+.*$/i,"").trim()||e:""}function jd(n){const e=le(n);if(!e)return null;const t=e.match(/(\d+)/);if(!t)return null;const r=Number.parseInt(t[1],10);return Number.isFinite(r)?r:null}function xR(n){const t=le(n).replace(",",".").match(/(\d+(\.\d+)?)/);if(!t)return null;const r=Number.parseFloat(t[1]);return Number.isFinite(r)?r:null}function Fl(n,e="Source"){let t=le(n,e).trim();return t?(t=t.replace(/https?:\/\/[^\s]+/gi,"").replace(/\b(?:www\.)?anichin\.(?:care|club|moe)\b/gi,"").replace(/\bmega\b/gi,"").replace(/\[[^\]]*ads[^\]]*\]/gi,"").replace(/\(.*?ads.*?\)/gi,"").replace(/\s{2,}/g," ").trim(),t||e):e}function TR(n){return`${ER}:${n}`}function Kp(n){const e=Date.now(),t=Bd.get(n);if(t&&t.expiresAt>e)return t.value;try{const r=localStorage.getItem(n);if(!r)return null;const s=JSON.parse(r);return!s||s.expiresAt<=e?(localStorage.removeItem(n),null):(Bd.set(n,s),s.value)}catch{return null}}function IR(n,e,t){const r={value:e,expiresAt:Date.now()+Math.max(t,1e3)};Bd.set(n,r);try{localStorage.setItem(n,JSON.stringify(r))}catch{}}async function En(n,e={},t={},r=sn,s=0){if(!Hp)throw new Error("VITE_API_BASE_URL belum diatur.");const i=`${Hp}${n}${SR(e)}`,a=TR(i),l=String((t==null?void 0:t.method)||"GET").toUpperCase()==="GET"&&s>0;if(l){const h=Kp(a);if(h!=null)return h;const f=ic.get(a);if(f)return f}const u=new AbortController,c=setTimeout(()=>u.abort(),r),d=(async()=>{try{const h=await fetch(i,{...t,signal:u.signal,headers:{Accept:"application/json",...t.headers||{}}});if(!h.ok)throw new Error(`Permintaan gagal (${h.status}).`);const f=await h.json();return l&&IR(a,f,s),f}catch(h){if((h==null?void 0:h.name)==="AbortError")throw new Error("Koneksi timeout. Coba lagi.");if(l){const f=Kp(a);if(f!=null)return f}throw h}finally{clearTimeout(c),l&&ic.delete(a)}})();return l&&ic.set(a,d),d}function Ul(n){if(!n||typeof n!="object")return null;const e=le(n.slug||n.animeId||n.id),t=$d(e)||e,r=le(n.title)||le(n.name)||le(n.headline)||"Untitled Donghua",s=jd(n.eps||n.episode||n.status||""),i=le(n.status||n.headline||n.type||""),a=Ml(n.thumbnail||n.poster||n.image||""),o=n.sinopsis,l=typeof o=="string"?o:Array.isArray(o==null?void 0:o.paragraphs)?o.paragraphs.join(" "):le(n.synopsis||n.description||"");return{...n,id:t||r,animeId:t||r,animeSlug:t||"",episodeSlug:e,mediaType:"anime",source:Wn,title:r,poster:a,synopsis:l,score:xR(n.rating||n.score),rank:null,status:i,episodes:s,episodesText:s?`${s} eps`:i||"Episode tersedia"}}function AR(n){var r;const e=n==null?void 0:n.result;if(!e||typeof e!="object")return!1;const t=le(e==null?void 0:e.name).trim().toLowerCase();return!!(t&&t!=="unknown title"||Array.isArray(e==null?void 0:e.episode)&&e.episode.length>0||le(e==null?void 0:e.sinopsis).trim()||Array.isArray((r=e==null?void 0:e.sinopsis)==null?void 0:r.paragraphs)&&e.sinopsis.paragraphs.length>0)}function ks(n,e){const t=Array.isArray(n==null?void 0:n.results)?n.results:[];if(!t.length)return[];const r=e.map(i=>String(i).toLowerCase()),s=t.filter(i=>r.includes(String((i==null?void 0:i.section)||"").toLowerCase())).flatMap(i=>Array.isArray(i==null?void 0:i.cards)?i.cards:[]);return s.length?s.map(Ul).filter(Boolean):t.flatMap(i=>Array.isArray(i==null?void 0:i.cards)?i.cards:[]).map(Ul).filter(Boolean)}function Zr(n){const e=new Set;return(Array.isArray(n)?n:[]).filter(t=>{const r=le((t==null?void 0:t.animeId)||(t==null?void 0:t.id));return!r||e.has(r)?!1:(e.add(r),!0)})}function oc(n){return(Array.isArray(n==null?void 0:n.results)?n.results:Array.isArray(n==null?void 0:n.data)?n.data:[]).map(Ul).filter(Boolean)}function _R(n){return(Array.isArray(n==null?void 0:n.genres)?n.genres:[]).map(t=>({name:le(t==null?void 0:t.name),slug:le(t==null?void 0:t.slug)})).filter(t=>t.name&&t.slug)}function FE(n){var i,a;const e=n!=null&&n.result&&typeof n.result=="object"?n.result:{},t=Ul(e)||{},r=le((i=e==null?void 0:e.sinopsis)==null?void 0:i.title),s=Array.isArray((a=e==null?void 0:e.sinopsis)==null?void 0:a.paragraphs)?e.sinopsis.paragraphs.filter(Boolean).join(`

`):"";return{...t,animeId:t.animeId||le(e==null?void 0:e.slug)||le(n==null?void 0:n.slug)||"",animeSlug:t.animeSlug||le(e==null?void 0:e.slug)||le(n==null?void 0:n.slug)||"",title:t.title||le(e==null?void 0:e.name)||"Untitled Donghua",poster:t.poster||Ml((e==null?void 0:e.thumbnail)||""),synopsis:[r,s,t.synopsis].filter(Boolean).join(`

`),status:t.status||le((e==null?void 0:e.status)||""),episodes:Array.isArray(e==null?void 0:e.episode)?e.episode.length:t.episodes,score:t.score,genre:Array.isArray(e==null?void 0:e.genre)?e.genre:[]}}function LR(n){const e=ks(n,["latest_release"]),t=ks(n,["popular_today"]),r=ks(n,["recommendation"]),s=ks(n,["upcoming_donghua"]),i=ks(n,["dropped_project"]),a=ks(n,["movie"]);return{spotlight:Zr(r).slice(0,16),trending:Zr(a).slice(0,16),latestEpisodes:Zr(e).slice(0,16),topAiring:Zr(i).slice(0,16),mostPopular:Zr(t).slice(0,16),latestCompleted:Zr(a).slice(0,16),topUpcoming:Zr(s).slice(0,16)}}function UE(n){var t,r;return(Array.isArray((t=n==null?void 0:n.result)==null?void 0:t.episode)?n.result.episode:Array.isArray((r=n==null?void 0:n.data)==null?void 0:r.episodes)?n.data.episodes:[]).map(s=>{const i=le((s==null?void 0:s.slug)||(s==null?void 0:s.episodeId)||(s==null?void 0:s.id)),a=jd((s==null?void 0:s.episode)||(s==null?void 0:s.subtitle)||(s==null?void 0:s.name)||i),o=le(s==null?void 0:s.subtitle)||le(s==null?void 0:s.name),l=jd(i)||0,u=a||l,c=o?/^episode\s*\d+/i.test(o)?o:u?`Episode ${u} - ${o}`:o:u?`Episode ${u}`:"Episode";return{...s,id:i||c,episodeId:i,number:a,title:c,animeId:le((s==null?void 0:s.root)||(n==null?void 0:n.slug)||""),animeSlug:le((s==null?void 0:s.root)||(n==null?void 0:n.slug)||"")}}).filter(s=>s.episodeId||s.id)}function wR(){return[]}function bR(){return[]}function RR(){return[]}function kR(n){return Array.isArray(n)?n.map((e,t)=>{const r=Fl(e==null?void 0:e.name,`Server ${t+1}`);return r?{serverName:r,serverId:r,name:r}:null}).filter(Boolean):[]}function CR(n,e,t){const r=Array.isArray(n)?n:[],s=ac(e);let i=r;if(s){const d=r.filter(h=>ac(h==null?void 0:h.name)===s);if(d.length>0)i=d;else{const h=r.filter(f=>{const g=ac(f==null?void 0:f.name);return g&&(g.includes(s)||s.includes(g))});i=h.length>0?h:r}}const a=i.map((d,h)=>{const f=Ml((d==null?void 0:d.url)||(d==null?void 0:d.src)||(d==null?void 0:d.link)||(d==null?void 0:d.file));return f?{quality:Fl(d==null?void 0:d.name,`Player ${h+1}`),url:f}:null}).filter(Boolean),o=Array.isArray(t==null?void 0:t.medias)?t.medias.map((d,h)=>{const f=Ml(d==null?void 0:d.url);return f?{quality:Fl(d==null?void 0:d.quality)||le(d==null?void 0:d.resolution)||le(d==null?void 0:d.format)||`Media ${h+1}`,url:f}:null}).filter(Boolean):[],l=new Set,u=[...o,...a].filter(d=>!(d!=null&&d.url)||l.has(d.url)?!1:(l.add(d.url),!0)),c=d=>{const h=le(d==null?void 0:d.quality).toLowerCase(),f=le(d==null?void 0:d.url).toLowerCase();let g=100;return/\.(m3u8|mp4|webm)(\?|$)/i.test(f)&&(g-=60),(f.includes("ok.ru")||f.includes("dailymotion.com")||f.includes("rumble.com"))&&(g-=30),(f.includes("videoembed")||f.includes("/embed"))&&(g-=20),h.includes("new player")&&(g-=10),(h.includes("ads")||f.includes("short.")||f.includes("rpmvid"))&&(g+=25),g};return[...u].sort((d,h)=>c(d)-c(h))}const ht={getHome:()=>En("/",{},{},sn,12e4),searchAnime:n=>En(`/search/${encodeURIComponent(n||"")}`,{},{},sn,18e4),getSearchSuggestions:()=>Promise.resolve({data:[]}),getAzList:()=>Promise.resolve({data:[]}),getAnimeQtip:()=>Promise.resolve({data:{}}),getCategoryAnime:()=>Promise.resolve({data:[]}),getGenres:()=>En("/genres",{},{},sn,216e5),getGenreAnime:(n,e=1)=>En(`/genre/${encodeURIComponent(n||"")}`,{page:e},{},sn,3e5),getProducerAnime:()=>Promise.resolve({data:[]}),getSchedule:()=>Promise.resolve({data:[]}),getNextEpisodeSchedule:()=>Promise.resolve({data:{}}),getAnimeDetail:async n=>{var i,a;const e=le(n).trim(),t=$d(e)||e;let r=null;try{r=await En(`/${encodeURIComponent(t)}`,{},{},sn,6e5)}catch{r=null}if(!AR(r))try{const o=await En(`/episode/${encodeURIComponent(e)}`,{},{},sn,3e5),l=$d(le((i=o==null?void 0:o.result)==null?void 0:i.root))||t;r={...await En(`/${encodeURIComponent(l)}`,{},{},sn,6e5)||{},selectedEpisodeSlug:e}}catch{}const s=r&&typeof r=="object"?r:{result:{}};return{...s,result:{...(s==null?void 0:s.result)||{},slug:le(((a=s==null?void 0:s.result)==null?void 0:a.slug)||t||e)},slug:le((s==null?void 0:s.slug)||t||e)}},getAnimeEpisodes:n=>ht.getAnimeDetail(n),getAnimeCharacters:()=>Promise.resolve({data:[]}),getAnimeStreaming:()=>Promise.resolve({data:[]}),getAnimeVideos:()=>Promise.resolve({data:[]}),getAnimeRecommendations:()=>Promise.resolve({data:[]}),getEpisodeServers:async n=>{var r;const e=await En(`/episode/${encodeURIComponent(n)}`,{},{},sn,3e5),t=Array.isArray((r=e==null?void 0:e.result)==null?void 0:r.players)?e.result.players:[];return{data:{sub:kR(t),dub:[],raw:[]},payload:e}},getEpisodeSources:async({animeEpisodeId:n,server:e=""})=>{var a;const t=await En(`/episode/${encodeURIComponent(n)}`,{},{},sn,3e5);let r=null;try{r=await En(`/video-source/${encodeURIComponent(n)}`,{},{},sn,3e5)}catch{r=null}const s=Array.isArray((a=t==null?void 0:t.result)==null?void 0:a.players)?t.result.players:[];return{data:{sources:CR(s,e,r)}}},getTopManga:()=>Promise.resolve({data:[]}),searchManga:()=>Promise.resolve({data:[]}),getMangaDetail:()=>Promise.resolve({data:{}}),getMangaCharacters:()=>Promise.resolve({data:[]}),getMangaRecommendations:()=>Promise.resolve({data:[]})};function PR(n){if(typeof n=="number")return Number.isFinite(n)?n:null;const t=String(n??"").replace(",",".").match(/(\d+(\.\d+)?)/);if(!t)return null;const r=Number.parseFloat(t[1]);return Number.isFinite(r)?r:null}function Wp(){const{watchlist:n,addToWatchlist:e,removeFromWatchlist:t,watchedEpisodes:r,markEpisodeWatched:s}=wt(),{animeId:i,source:a}=Ov(),o=Ka(),l=ur(),u=new URLSearchParams(l.search).get("slug")||"",c=a||Wn,d=c==="hianime"?Wn:c,[h,f]=P.useState(!0),[g,m]=P.useState({}),[v,p]=P.useState([]),[y,E]=P.useState([]),[T,A]=P.useState([]),[w,_]=P.useState("");P.useEffect(()=>{let U=!0;return(async()=>{try{f(!0),_("");const[C,F,B,O]=await Promise.allSettled([ht.getAnimeDetail(i,{source:d,slug:u}),ht.getAnimeEpisodes(i,1,{source:d,slug:u}),ht.getAnimeCharacters(i,{source:d,slug:u}),ht.getAnimeRecommendations(i,{source:d,slug:u})]);if(!U)return;const R=C.status==="fulfilled"?FE(C.value,"anime"):{animeId:i,title:String(i||"").replace(/[-_]+/g," ").trim()||i,source:d,synopsis:""};m(R),p(F.status==="fulfilled"?UE(F.value):[]),E(B.status==="fulfilled"?wR(B.value):[]),A(O.status==="fulfilled"?RR(O.value,"anime"):[]),C.status==="rejected"&&_("Detail donghua belum lengkap, menampilkan data fallback sementara.")}catch(C){_(C.message||"Gagal load detail donghua.")}finally{U&&f(!1)}})(),()=>{U=!1}},[i,d,u]);const L=P.useMemo(()=>g.synopsis||"No synopsis available.",[g]),b=g.animeSlug||u,I=P.useMemo(()=>n.some(U=>String(U==null?void 0:U.animeId)===String(g.animeId||i)),[n,g.animeId,i]),k=P.useMemo(()=>{const U=String(g.animeId||i),C=r==null?void 0:r[U];return new Set(Array.isArray(C)?C.map(F=>String(F)):[])},[r,g.animeId,i]),H=P.useMemo(()=>{var C,F;const U=PR((g==null?void 0:g.score)??((C=g==null?void 0:g.moreInfo)==null?void 0:C.malscore)??((F=g==null?void 0:g.jikan)==null?void 0:F.score));return U==null?"N/A":U.toFixed(2)},[g]);return h?x.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:x.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})}):x.jsxs("section",{className:"space-y-6",children:[w?x.jsx("p",{className:"text-sm text-red-400",children:w}):null,x.jsx("button",{type:"button",onClick:()=>o(-1),className:"inline-flex rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20",children:"Kembali"}),x.jsxs("div",{className:"grid gap-6 rounded-3xl border border-white/10 bg-slate-900/60 p-4 md:grid-cols-[220px,1fr]",children:[x.jsx("div",{className:"overflow-hidden rounded-2xl bg-slate-800",children:g.poster?x.jsx("img",{src:g.poster,alt:g.title||"Donghua",className:"h-full w-full object-cover"}):null}),x.jsxs("div",{children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:g.title||i}),x.jsx("p",{className:"mt-2 text-sm text-slate-300",children:L}),x.jsxs("div",{className:"mt-4 grid gap-2 text-xs text-slate-300 sm:grid-cols-2 lg:grid-cols-3",children:[x.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Status: ",g.status||"Unknown"]}),x.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Episodes: ",g.episodes||"?"]}),x.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/20 p-2",children:["Score: ",H]})]}),x.jsx(ze,{to:`/watch/${encodeURIComponent(d)}/${encodeURIComponent(g.animeId||i)}${b?`?slug=${encodeURIComponent(b)}`:""}`,className:"mt-4 inline-flex rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white transition hover:brightness-110",children:"Open Streaming Links"}),x.jsx("button",{type:"button",onClick:()=>{if(I){t(g.animeId||i);return}e({animeId:g.animeId||i,title:g.title||i,poster:g.poster||"",source:d,slug:b})},className:"ml-2 mt-4 inline-flex rounded-full border border-white/20 bg-white/5 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/10",children:I?"Remove Watchlist":"Add Watchlist"})]})]}),x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[x.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Episodes"}),x.jsxs("div",{className:"mt-4 grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:[v.map(U=>x.jsx(ze,{onClick:()=>s({animeId:g.animeId||i,episodeId:U.episodeId||"",episodeNumber:U.number||null,title:g.title||i,episodeTitle:U.title||"",poster:g.poster||"",source:d,slug:b}),to:`/watch/${encodeURIComponent(d)}/${encodeURIComponent(g.animeId||i)}${b?`?slug=${encodeURIComponent(b)}`:""}${U.number?`${b?"&":"?"}ep=${encodeURIComponent(U.number)}`:""}${U.episodeId?`${b||U.number?"&":"?"}epid=${encodeURIComponent(U.episodeId)}`:""}`,className:`rounded-xl border px-3 py-2 text-sm transition hover:border-cyan-300/60 ${k.has(String(U.episodeId||U.number||""))?"border-white/10 bg-slate-950/40 text-slate-500":"border-white/10 bg-slate-950 text-white"}`,children:U.title},U.id||U.title)),v.length===0?x.jsxs("div",{className:"space-y-2 rounded-xl border border-amber-400/30 bg-amber-400/10 p-3 text-sm text-amber-200",children:[x.jsx("p",{children:"Daftar episode belum tersedia."}),x.jsx(ze,{to:`/watch/${encodeURIComponent(d)}/${encodeURIComponent(g.animeId||i)}${b?`?slug=${encodeURIComponent(b)}`:""}`,className:"inline-flex rounded-full border border-amber-300/50 px-3 py-1.5 text-xs font-semibold text-amber-100 transition hover:bg-amber-300/10",children:"Coba Buka Halaman Nonton"})]}):null]})]}),y.length>0?x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[x.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Characters"}),x.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-6",children:y.slice(0,12).map(U=>x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-2",children:[U.image?x.jsx("img",{src:U.image,alt:U.name,className:"aspect-[3/4] w-full rounded-lg object-cover"}):null,x.jsx("p",{className:"mt-2 line-clamp-2 text-xs font-semibold text-white",children:U.name}),x.jsx("p",{className:"text-[11px] text-slate-400",children:U.role||"Character"})]},U.id))})]}):null,T.length>0?x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[x.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Recommendations"}),x.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-5",children:T.slice(0,10).map(U=>x.jsxs(ze,{to:`/anime/${encodeURIComponent(U.source||d)}/${encodeURIComponent(U.animeId)}${U.animeSlug?`?slug=${encodeURIComponent(U.animeSlug)}`:""}`,className:"rounded-xl border border-white/10 bg-black/20 p-2",children:[U.poster?x.jsx("img",{src:U.poster,alt:U.title,className:"aspect-[3/4] w-full rounded-lg object-cover"}):null,x.jsx("p",{className:"mt-2 line-clamp-2 text-xs font-semibold text-white",children:U.title})]},U.animeId))})]}):null]})}function DR(){return x.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[x.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Contact"}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Untuk pertanyaan bisnis, laporan konten, atau kerja sama, hubungi kami melalui email berikut:"}),x.jsx("a",{href:"mailto:akuryzel@gmail.com",className:"inline-flex rounded-xl border border-white/15 bg-white/5 px-4 py-2 text-sm text-white",children:"akuryzel@gmail.com"}),x.jsx("p",{className:"text-xs text-slate-400",children:"Silakan ganti email ini dengan email resmi domain kamu sebelum publish."})]})}function NR(){const{watchHistory:n}=wt();return x.jsxs("section",{className:"space-y-5",children:[x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-5",children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Riwayat Tontonan"}),x.jsx("p",{className:"mt-1 text-sm text-slate-300",children:"Episode yang pernah kamu buka akan muncul di sini."})]}),n.length===0?x.jsx("p",{className:"text-sm text-slate-400",children:"Belum ada riwayat tontonan."}):x.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>{const t=[e.slug?`slug=${encodeURIComponent(e.slug)}`:"",e.episodeNumber?`ep=${encodeURIComponent(e.episodeNumber)}`:"",e.episodeId?`epid=${encodeURIComponent(e.episodeId)}`:""].filter(Boolean).join("&"),r=`/watch/${encodeURIComponent(e.source||"anichin")}/${encodeURIComponent(e.animeId)}${t?`?${t}`:""}`;return x.jsx(ze,{to:r,className:"rounded-2xl border border-white/10 bg-slate-900/70 p-3 transition hover:border-cyan-300/60",children:x.jsxs("div",{className:"flex gap-3",children:[x.jsx("div",{className:"h-20 w-14 shrink-0 overflow-hidden rounded-lg bg-slate-800",children:e.poster?x.jsx("img",{src:e.poster,alt:e.title,className:"h-full w-full object-cover"}):null}),x.jsxs("div",{className:"min-w-0",children:[x.jsx("p",{className:"line-clamp-2 text-sm font-semibold text-white",children:e.title}),x.jsxs("p",{className:"mt-1 text-xs text-cyan-200",children:["Episode ",e.episodeNumber||"?"," ",e.episodeTitle?`- ${e.episodeTitle}`:""]}),x.jsx("p",{className:"mt-1 text-[11px] text-slate-400",children:e.watchedAt?new Date(e.watchedAt).toLocaleString("id-ID"):""})]})]})},e.id)})})]})}function St(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function OR(n){const e=St(n==null?void 0:n.source),t=St((n==null?void 0:n.animeId)||(n==null?void 0:n.id)),r=St(n==null?void 0:n.animeSlug);return t?e?`/anime/${encodeURIComponent(e)}/${encodeURIComponent(t)}${r?`?slug=${encodeURIComponent(r)}`:""}`:`/anime/${encodeURIComponent(t)}`:"#"}function MR({anime:n}){const e=St(n==null?void 0:n.title,St(n==null?void 0:n.name,"Welcome to DonghuaX")),t=(n==null?void 0:n.animeId)||(n==null?void 0:n.id)||"",r=St(n==null?void 0:n.poster,St(n==null?void 0:n.thumbnail,St(n==null?void 0:n.image,""))),s=[St(n==null?void 0:n.episodesText),St(n==null?void 0:n.status),St(n==null?void 0:n.season)].filter(Boolean).join("  "),i=St(n==null?void 0:n.synopsis)||St(n==null?void 0:n.description)||St(n==null?void 0:n.plot)||(s?`${e}  ${s}`:`${e} sedang populer minggu ini.`),a=OR(n);return x.jsxs("section",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-slate-900/70 animate-fade-in",children:[r?x.jsx("img",{src:r,alt:e,className:"h-56 w-full object-cover opacity-60 sm:h-72 lg:h-96"}):x.jsx("div",{className:"h-56 w-full bg-gradient-to-r from-slate-950 via-slate-800 to-slate-900 sm:h-72 lg:h-96"}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-950 via-slate-950/75 to-slate-950/30"}),x.jsxs("div",{className:"absolute inset-0 flex max-w-3xl flex-col justify-end p-4 sm:p-6 lg:p-8",children:[x.jsx("p",{className:"mb-2 inline-flex w-fit rounded-full bg-cyan-400/20 px-3 py-1 text-xs font-bold uppercase tracking-wider text-cyan-200",children:"Featured Pick"}),x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-4xl lg:text-5xl",children:e}),x.jsx("p",{className:"mt-3 line-clamp-3 max-w-2xl text-sm text-slate-200 sm:line-clamp-none sm:text-base",children:i}),t?x.jsx(ze,{to:a,className:"mt-5 inline-flex w-fit rounded-full bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-5 py-2.5 text-sm font-semibold text-white transition hover:brightness-110",children:"Lihat Detail"}):null]})]})}function _n(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function FR(n){const e=_n(n==null?void 0:n.source),t=_n((n==null?void 0:n.animeId)||(n==null?void 0:n.id)),r=_n(n==null?void 0:n.animeSlug);return t?e?`/anime/${encodeURIComponent(e)}/${encodeURIComponent(t)}${r?`?slug=${encodeURIComponent(r)}`:""}`:`/anime/${encodeURIComponent(t)}`:"#"}function UR({anime:n}){const e="donghua";n!=null&&n.animeId||n!=null&&n.id;const t=_n(n==null?void 0:n.title,_n(n==null?void 0:n.name,`Untitled ${e}`)),r=_n(n==null?void 0:n.poster,_n(n==null?void 0:n.thumbnail,_n(n==null?void 0:n.image,""))),s=_n(n==null?void 0:n.episodesText)||_n(n==null?void 0:n.status)||(typeof(n==null?void 0:n.score)=="number"?`Score ${n.score}`:"No score yet"),i=FR(n);return x.jsxs(ze,{to:i,className:"group w-36 shrink-0 overflow-hidden rounded-2xl border border-white/10 bg-slate-900/80 transition duration-300 hover:-translate-y-1 hover:border-cyan-300/50 sm:w-40 md:w-44 lg:w-52",children:[x.jsxs("div",{className:"relative aspect-[3/4] w-full bg-slate-800",children:[r?x.jsx("img",{src:r,alt:t,className:"h-full w-full object-cover transition duration-500 group-hover:scale-110"}):null,x.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-slate-950/75 via-transparent to-transparent"}),x.jsx("p",{className:"absolute right-2 top-2 rounded-full bg-black/60 px-2 py-1 text-[10px] font-bold uppercase tracking-wide text-cyan-200",children:e})]}),x.jsxs("div",{className:"p-2.5 sm:p-3",children:[x.jsx("p",{className:"line-clamp-2 text-sm font-semibold text-slate-100",children:t}),x.jsx("p",{className:"mt-1 text-xs text-cyan-200/85",children:s})]})]})}function es({title:n,items:e}){return!Array.isArray(e)||e.length===0?null:x.jsxs("section",{className:"animate-slide-up",children:[x.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[x.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:n}),x.jsxs("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-400",children:[e.length," titles"]})]}),x.jsx("div",{className:"horizontal-rail flex gap-3 pb-3 sm:gap-4",children:e.map(t=>x.jsx(UR,{anime:t},`${(t==null?void 0:t.mediaType)||"anime"}-${(t==null?void 0:t.animeId)||(t==null?void 0:t.mangaId)||(t==null?void 0:t.id)||(t==null?void 0:t.title)}`))})]})}const zp="donghuax_search_history_v1",Yp=12;function Ln(n){return String(n||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim()}function BR(n,e){const t=Ln(n),r=Ln(e),s=t.length+1,i=r.length+1,a=Array.from({length:s},()=>Array(i).fill(0));for(let o=0;o<s;o+=1)a[o][0]=o;for(let o=0;o<i;o+=1)a[0][o]=o;for(let o=1;o<s;o+=1)for(let l=1;l<i;l+=1){const u=t[o-1]===r[l-1]?0:1;a[o][l]=Math.min(a[o-1][l]+1,a[o][l-1]+1,a[o-1][l-1]+u)}return a[s-1][i-1]}function qp(n,e=[]){const t=Ln(n);if(!t||!Array.isArray(e)||e.length===0)return"";let r="",s=Number.POSITIVE_INFINITY;return e.forEach(i=>{const a=String(i||"").trim();if(!a)return;const o=Ln(a);if(!o||o===t)return;const l=BR(t,o),u=Math.max(t.length,o.length,1),c=l/u;c<s&&(s=c,r=a)}),s<=.45?r:""}function $R(){var F,B;const{user:n}=wt(),[e,t]=P.useState(!0),[r,s]=P.useState(""),[i,a]=P.useState({spotlight:[],trending:[],latestEpisodes:[],topAiring:[],mostPopular:[],latestCompleted:[],topUpcoming:[]}),[o,l]=P.useState(""),[u,c]=P.useState([]),[d,h]=P.useState([]),[f,g]=P.useState(""),[m,v]=P.useState([]),[p,y]=P.useState(""),[E,T]=P.useState([]),[A,w]=P.useState(!1),[_,L]=P.useState(0);P.useEffect(()=>{try{const O=localStorage.getItem(zp),R=O?JSON.parse(O):[];h(Array.isArray(R)?R.filter(Boolean).slice(0,Yp):[])}catch{h([])}},[]),P.useEffect(()=>{let O=!0;return(async()=>{try{t(!0),s("");const[R,M]=await Promise.allSettled([ht.getHome(),ht.getGenres()]);if(!O)return;a(LR(R.status==="fulfilled"?R.value:{}));const G=_R(M.status==="fulfilled"?M.value:{});v(G),G.length>0&&y(G[0].slug)}catch(R){if(!O)return;s(R.message||"Gagal load homepage donghua.")}finally{O&&t(!1)}})(),()=>{O=!1}},[]),P.useEffect(()=>{let O=!0;if(!p){T([]);return}return(async()=>{try{w(!0);const R=await ht.getGenreAnime(p,1);if(!O)return;T(oc(R).slice(0,18))}catch{if(!O)return;T([])}finally{O&&w(!1)}})(),()=>{O=!1}},[p]);const b=P.useMemo(()=>{const O=[...Array.isArray(i.spotlight)?i.spotlight:[],...Array.isArray(i.trending)?i.trending:[],...Array.isArray(i.latestEpisodes)?i.latestEpisodes:[]],R=new Set;return O.filter(M=>{const G=String((M==null?void 0:M.animeId)||(M==null?void 0:M.id)||(M==null?void 0:M.title)||"");return!G||R.has(G)?!1:(R.add(G),!0)})},[i.spotlight,i.trending,i.latestEpisodes]);P.useEffect(()=>{L(0)},[b.length]),P.useEffect(()=>{if(b.length<=1)return;const O=setInterval(()=>{L(R=>(R+1)%b.length)},5e3);return()=>clearInterval(O)},[b.length]);const I=P.useMemo(()=>{var O,R,M;return b[_]||((O=i.topAiring)==null?void 0:O[0])||((R=i.mostPopular)==null?void 0:R[0])||((M=i.latestEpisodes)==null?void 0:M[0])||null},[b,_,i.topAiring,i.mostPopular,i.latestEpisodes]),k=P.useMemo(()=>{const O=Ln(o);return O?d.filter(R=>Ln(R).includes(O)).slice(0,6):d.slice(0,6)},[d,o]),H=O=>{const R=String(O||"").trim();R&&h(M=>{const G=[R,...M.filter(V=>Ln(V)!==Ln(R))].slice(0,Yp);try{localStorage.setItem(zp,JSON.stringify(G))}catch{}return G})},U=async O=>{const R=String(O||"").trim();if(!R){c([]),g("");return}try{s(""),g("");const M=await ht.searchAnime(R),G=oc(M);if(c(G),H(R),G.length>0){const $=qp(R,G.map(Q=>(Q==null?void 0:Q.title)||(Q==null?void 0:Q.headline)||""));$&&g($);return}const V=R.split(/\s+/).find($=>$.length>=3)||"";if(V&&Ln(V)!==Ln(R))try{const $=await ht.searchAnime(V),Q=oc($),re=qp(R,Q.map(J=>(J==null?void 0:J.title)||(J==null?void 0:J.headline)||""));re&&g(re)}catch{}}catch(M){s(M.message||"Search donghua gagal."),c([]),g("")}},C=async O=>{O.preventDefault(),await U(o)};return e?x.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:x.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300",role:"status","aria-label":"Loading"})}):x.jsxs("div",{className:"space-y-6 pb-4 sm:space-y-8",children:[x.jsxs("section",{className:"grid gap-3 sm:grid-cols-2 sm:gap-4 lg:grid-cols-3",children:[x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Welcome"}),x.jsx("p",{className:"mt-1 text-base font-semibold text-white sm:text-lg",children:(n==null?void 0:n.username)||"User"})]}),x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Account Plan"}),x.jsx("p",{className:"mt-1 text-base font-semibold text-amber-300 sm:text-lg",children:(F=n==null?void 0:n.premium)!=null&&F.active?n.premium.plan:"Free Plan"})]}),x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-slate-400",children:"Donghua Catalog"}),x.jsx("p",{className:"mt-1 text-base font-semibold text-cyan-200 sm:text-lg",children:"Live"})]})]}),x.jsx("div",{children:x.jsx(MR,{anime:I})},`featured-${(I==null?void 0:I.animeId)||(I==null?void 0:I.id)||_}`),x.jsxs("section",{className:"rounded-3xl border border-white/10 bg-slate-900/50 p-4 sm:p-5",children:[x.jsxs("form",{onSubmit:C,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[x.jsx("input",{className:"w-full rounded-xl border border-white/15 bg-slate-900/80 px-4 py-3 text-sm outline-none transition focus:border-cyan-300/60",placeholder:"Cari donghua favorit...",value:o,onChange:O=>l(O.target.value)}),x.jsx("button",{type:"submit",className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-5 py-3 text-sm font-semibold text-white transition hover:brightness-110 sm:w-auto",children:"Search"})]}),k.length>0?x.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[x.jsx("span",{className:"text-xs uppercase tracking-wider text-slate-400",children:"Riwayat"}),k.map(O=>x.jsx("button",{type:"button",onClick:()=>{l(O),U(O)},className:"rounded-full border border-white/15 bg-white/5 px-3 py-1 text-xs text-slate-200 transition hover:border-cyan-300/50 hover:text-white",children:O},O))]}):null,f?x.jsxs("p",{className:"mt-3 text-xs text-amber-300",children:["Mungkin maksud kamu:"," ",x.jsx("button",{type:"button",className:"font-semibold underline underline-offset-2",onClick:()=>{l(f),U(f)},children:f})]}):null]}),r?x.jsx("p",{className:"text-sm text-red-400",children:r}):null,u.length>0?x.jsx(es,{title:"Hasil Pencarian Donghua",items:u}):null,m.length>0?x.jsxs("section",{className:"rounded-3xl border border-white/10 bg-slate-900/50 p-4 sm:p-5",children:[x.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[x.jsx("h2",{className:"font-heading text-xl font-bold text-white",children:"Pilih Genre"}),A?x.jsx("p",{className:"text-xs text-slate-400",children:"Loading genre..."}):null]}),x.jsx("div",{className:"flex flex-wrap gap-2",children:m.slice(0,24).map(O=>x.jsx("button",{type:"button",onClick:()=>y(O.slug),className:`rounded-full px-3 py-1.5 text-xs font-semibold uppercase tracking-wide transition ${p===O.slug?"bg-cyan-300 text-slate-950":"border border-white/15 bg-white/5 text-slate-300 hover:border-cyan-300/50"}`,children:O.name},O.slug))})]}):null,p&&E.length>0?x.jsx(es,{title:`Genre: ${((B=m.find(O=>O.slug===p))==null?void 0:B.name)||p}`,items:E}):null,x.jsx(es,{title:"Terbaru Rilis",items:i.latestEpisodes}),x.jsx(es,{title:"Populer Hari Ini",items:i.mostPopular}),x.jsx(es,{title:"Rekomendasi Donghua",items:i.spotlight}),x.jsx(es,{title:"Movie Donghua",items:i.trending}),x.jsx(es,{title:"Upcoming Donghua",items:i.topUpcoming})]})}function jR(){const{signIn:n,signInWithGoogle:e}=wt(),[t,r]=P.useState({email:"",password:""}),[s,i]=P.useState(""),[a,o]=P.useState(!1),l=async c=>{c.preventDefault(),o(!0);const d=await n(t);if(o(!1),!d.ok){i(d.error||"Login gagal.");return}},u=async()=>{o(!0);const c=await e();if(o(!1),!c.ok){i(c.error||"Login Google gagal.");return}};return x.jsxs("section",{className:"mx-auto grid min-h-[76vh] max-w-6xl overflow-hidden rounded-3xl border border-cyan-400/20 bg-zinc-950/90 shadow-2xl md:grid-cols-2",children:[x.jsx("div",{className:"hidden bg-[radial-gradient(circle_at_65%_22%,rgba(217,70,239,.35),transparent_35%),radial-gradient(circle_at_20%_78%,rgba(34,211,238,.4),transparent_35%),linear-gradient(155deg,#020617,#131a2f)] p-8 md:block",children:x.jsxs("div",{className:"animate-float rounded-2xl border border-cyan-400/20 bg-black/35 p-6 backdrop-blur",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"DonghuaX Streaming"}),x.jsx("h2",{className:"mt-3 font-heading text-3xl font-bold text-white",children:"Masuk untuk lanjut nonton."}),x.jsx("p",{className:"mt-4 text-sm text-zinc-300",children:"Gunakan email/password atau akun Google."})]})}),x.jsxs("div",{className:"p-6 sm:p-10",children:[x.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Login"}),x.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Akses akun untuk membuka katalog donghua."}),x.jsxs("form",{onSubmit:l,className:"mt-6 space-y-3",children:[x.jsx("input",{type:"email",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Email",value:t.email,onChange:c=>r(d=>({...d,email:c.target.value})),required:!0}),x.jsx("input",{type:"password",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Password",value:t.password,onChange:c=>r(d=>({...d,password:c.target.value})),required:!0}),s?x.jsx("p",{className:"text-sm text-red-400",children:s}):null,x.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 py-3 font-semibold text-white transition hover:brightness-110 disabled:opacity-60",type:"submit",disabled:a,children:a?"Loading...":"Login"}),x.jsx("button",{type:"button",onClick:u,disabled:a,className:"w-full rounded-xl border border-zinc-700 bg-zinc-900/80 py-3 text-sm font-semibold text-zinc-100 transition hover:bg-zinc-800 disabled:opacity-60",children:"Login dengan Google"})]}),x.jsxs("p",{className:"mt-4 text-sm text-zinc-300",children:["Belum punya akun?"," ",x.jsx(ze,{to:"/signup",className:"font-semibold text-cyan-200 underline",children:"Daftar"})]})]})]})}function GR(){return x.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[x.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"About DonghuaX"}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"DonghuaX adalah platform hiburan untuk menelusuri katalog donghua secara cepat, responsif, dan nyaman di berbagai perangkat."}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami berfokus pada pengalaman pengguna yang sederhana, informasi judul yang jelas, serta navigasi yang mudah untuk penonton."})]})}function VR(){var t,r;const{user:n}=wt(),e=(t=n==null?void 0:n.premium)!=null&&t.expireAt?new Date(n.premium.expireAt).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-";return x.jsx("section",{className:"mx-auto max-w-3xl space-y-4",children:x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/70 p-5 sm:p-6",children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Premium"}),x.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Aktivasi via admin. Admin bisa atur plan + durasi hari langsung dari Admin Panel."}),x.jsxs("div",{className:"mt-4 rounded-2xl border border-white/10 bg-white/5 p-4",children:[x.jsx("p",{className:"text-sm text-slate-300",children:"Status saat ini"}),x.jsx("p",{className:"mt-1 text-lg font-semibold text-amber-300",children:(r=n==null?void 0:n.premium)!=null&&r.active?n.premium.plan:"Free Plan"}),x.jsxs("p",{className:"text-sm text-slate-400",children:["Expired: ",e]})]}),x.jsxs("ul",{className:"mt-4 space-y-2 text-sm text-slate-300",children:[x.jsx("li",{children:"No ads saat play episode."}),x.jsx("li",{children:"Badge premium di profile."}),x.jsx("li",{children:"Prioritas support dari admin."})]}),x.jsx("a",{href:"https://wa.me/6280000000000",target:"_blank",rel:"noreferrer",className:"mt-4 inline-flex rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2.5 text-sm font-semibold text-white",children:"Hubungi WhatsApp Admin"})]})})}function HR(){return x.jsxs("section",{className:"mx-auto max-w-4xl space-y-4 rounded-3xl border border-white/10 bg-slate-900/60 p-5 sm:p-6",children:[x.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Privacy Policy"}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami menghormati privasi pengguna. Informasi akun digunakan untuk autentikasi, personalisasi pengalaman, serta fitur seperti riwayat tontonan dan watchlist."}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Kami dapat menggunakan cookie atau penyimpanan lokal untuk meningkatkan performa situs. Data tidak diperjualbelikan kepada pihak ketiga."}),x.jsx("p",{className:"text-sm leading-6 text-slate-300",children:"Dengan menggunakan situs ini, kamu menyetujui kebijakan privasi ini. Kebijakan dapat diperbarui sewaktu-waktu."})]})}function KR(){const{signUp:n,signInWithGoogle:e}=wt(),[t,r]=P.useState({username:"",email:"",password:""}),[s,i]=P.useState(""),[a,o]=P.useState(!1),l=async c=>{c.preventDefault(),o(!0);const d=await n(t);if(o(!1),!d.ok){i(d.error||"Signup gagal.");return}},u=async()=>{o(!0);const c=await e();if(o(!1),!c.ok){i(c.error||"Signup Google gagal.");return}};return x.jsxs("section",{className:"mx-auto grid min-h-[76vh] max-w-6xl overflow-hidden rounded-3xl border border-cyan-400/20 bg-zinc-950/90 shadow-2xl md:grid-cols-2",children:[x.jsx("div",{className:"hidden bg-[radial-gradient(circle_at_30%_18%,rgba(244,114,182,.35),transparent_35%),radial-gradient(circle_at_78%_12%,rgba(56,189,248,.3),transparent_38%),linear-gradient(145deg,#020617,#121b31)] p-8 md:block",children:x.jsxs("div",{className:"animate-float rounded-2xl border border-cyan-400/20 bg-black/35 p-6 backdrop-blur",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"Create account"}),x.jsx("h2",{className:"mt-3 font-heading text-3xl font-bold text-white",children:"Buat akun dan mulai sekarang."}),x.jsx("p",{className:"mt-4 text-sm text-zinc-300",children:"Daftar via email/password atau akun Google."})]})}),x.jsxs("div",{className:"p-6 sm:p-10",children:[x.jsx("h1",{className:"font-heading text-3xl font-bold text-white",children:"Daftar"}),x.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Bikin akun untuk akses penuh website."}),x.jsxs("form",{onSubmit:l,className:"mt-6 space-y-3",children:[x.jsx("input",{className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Username",value:t.username,onChange:c=>r(d=>({...d,username:c.target.value})),required:!0}),x.jsx("input",{type:"email",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Email",value:t.email,onChange:c=>r(d=>({...d,email:c.target.value})),required:!0}),x.jsx("input",{type:"password",className:"w-full rounded-xl border border-zinc-700 bg-black/60 px-4 py-3 text-sm text-zinc-100 outline-none transition focus:border-cyan-300/60",placeholder:"Password",value:t.password,onChange:c=>r(d=>({...d,password:c.target.value})),required:!0}),s?x.jsx("p",{className:"text-sm text-red-400",children:s}):null,x.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 py-3 font-semibold text-white transition hover:brightness-110 disabled:opacity-60",type:"submit",disabled:a,children:a?"Loading...":"Daftar"}),x.jsx("button",{type:"button",onClick:u,disabled:a,className:"w-full rounded-xl border border-zinc-700 bg-zinc-900/80 py-3 text-sm font-semibold text-zinc-100 transition hover:bg-zinc-800 disabled:opacity-60",children:"Lanjut dengan Google"})]}),x.jsxs("p",{className:"mt-4 text-sm text-zinc-300",children:["Sudah punya akun?"," ",x.jsx(ze,{to:"/login",className:"font-semibold text-cyan-200 underline",children:"Masuk"})]})]})]})}const W=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},WR=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=zR},zR=Number.MAX_SAFE_INTEGER||9007199254740991;let X=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),N=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),S=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var ie={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Y={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Cs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class YR{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Cs(e),this.fast_=new Cs(t),this.defaultTTFB_=s,this.ttfb_=new Cs(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Cs(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Cs(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Cs(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function qR(n,e,t){return(e=QR(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ge(){return ge=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ge.apply(null,arguments)}function Xp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function de(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xp(Object(t),!0).forEach(function(r){qR(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function XR(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function QR(n){var e=XR(n,"string");return typeof e=="symbol"?e:e+""}class Jt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Er,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Er=function(){},JR={trace:Er,debug:Er,log:Er,warn:Er,info:Er,error:Er};function Gd(){return ge({},JR)}function ZR(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Er}function Qp(n,e,t){return e[n]?e[n].bind(e):ZR(n,t)}const Vd=Gd();function e1(n,e,t){const r=Gd();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=Qp(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Gd()}s.forEach(i=>{Vd[i]=Qp(i,n)})}else ge(Vd,r);return r}const he=Vd;function Vr(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function t1(n){return typeof self<"u"&&n===self.ManagedMediaSource}function BE(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(a=>r.indexOf(a)===-1)}function Ft(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,s,i,a="",o=0;for(;o<t;){if(r=n[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:s=n[o++],a+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[o++],i=n[o++],a+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return a}function rt(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function $E(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function n1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lc={exports:{}},Jp;function r1(){return Jp||(Jp=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var g=s.exec(f.path);f.netLoc=g[1],f.path=g[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(m.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)m.path=f.path,h.params||(m.params=f.params,h.query||(m.query=f.query));else{var v=f.path,p=v.substring(0,v.lastIndexOf("/")+1)+h.path;m.path=o.normalizePath(p)}return m.path===null&&(m.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(m)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}(lc)),lc.exports}var Sf=r1();class xf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var me={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class jE{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,i1(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[me.AUDIO]:null,[me.VIDEO]:null,[me.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[me.AUDIO]=null,e[me.VIDEO]=null,e[me.AUDIOVIDEO]=null}}function Ue(n){return n.sn!=="initSegment"}class uc extends jE{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(W(e)&&W(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=W(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!W(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ue(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class s1 extends jE{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function GE(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||GE(t,e)}}function i1(n,e){const t=GE(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Zp=Math.pow(2,32)-1,a1=[].push,VE={video:1,audio:2,id3:3,text:4};function Ve(n){return String.fromCharCode.apply(null,n)}function HE(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ee(n,e){const t=KE(n,e);return t<0?4294967296+t:t}function em(n,e){let t=ee(n,e);return t*=Math.pow(2,32),t+=ee(n,e+4),t}function KE(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function o1(n){const e=n.byteLength;for(let t=0;t<e;){const r=ee(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function se(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=ee(n,s),a=Ve(n.subarray(s+4,s+8)),o=i>1?s+i:r;if(a===e[0])if(e.length===1)t.push(n.subarray(s+8,o));else{const l=se(n.subarray(s+8,o),e.slice(1));l.length&&a1.apply(t,l)}s=o}return t}function l1(n){const e=[],t=n[0];let r=8;const s=ee(n,r);r+=4;let i=0,a=0;t===0?(i=ee(n,r),a=ee(n,r+4),r+=8):(i=em(n,r),a=em(n,r+8),r+=16),r+=2;let o=n.length+a;const l=HE(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=ee(n,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return he.warn("SIDX has hierarchical references (not supported)"),null;const g=ee(n,c);c+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/s,start:o,end:o+h-1}}),o+=h,c+=4,r=c}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function WE(n){const e=[],t=se(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],a=se(i,["tkhd"])[0];if(a){let o=a[0];const l=ee(a,o===0?12:20),u=se(i,["mdia","mdhd"])[0];if(u){o=u[0];const c=ee(u,o===0?12:20),d=se(i,["mdia","hdlr"])[0];if(d){const h=Ve(d.subarray(8,12)),f={soun:me.AUDIO,vide:me.VIDEO}[h],g=se(i,["mdia","minf","stbl","stsd"])[0],m=u1(g);f?(e[l]={timescale:c,type:f,stsd:m},e[f]=de({timescale:c,id:l},m)):e[l]={timescale:c,type:h,stsd:m}}}}}return se(n,["moov","mvex","trex"]).forEach(s=>{const i=ee(s,4),a=e[i];a&&(a.default={duration:ee(s,12),flags:ee(s,20)})}),e}function u1(n){const e=n.subarray(8),t=e.subarray(86),r=Ve(e.subarray(4,8));let s=r,i;const a=r==="enca"||r==="encv";if(a){const u=se(e,[r])[0].subarray(r==="enca"?28:78);se(u,["sinf"]).forEach(d=>{const h=se(d,["schm"])[0];if(h){const f=Ve(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const g=se(d,["frma"])[0];g&&(s=Ve(g))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=se(t,["avcC"])[0];l&&l.length>3&&(s+="."+So(l[1])+So(l[2])+So(l[3]),i=Eo(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=se(e,[r])[0],u=se(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=cc(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=cc(u,c);const h=u[c++];if(h===64)s+="."+So(h);else break;if(c+=12,u[c++]!==5)break;c=cc(u,c);const f=u[c++];let g=(f&248)>>3;g===31&&(g+=1+((f&7)<<3)+((u[c]&224)>>5)),s+="."+g}break}case"hvc1":case"hev1":{const l=se(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=ee(l,2),f=(u&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);s+="."+c+d,s+="."+c1(h).toString(16).toUpperCase(),s+="."+f+g;let v="";for(let p=m.length;p--;){const y=m[p];(y||v)&&(v="."+y.toString(16).toUpperCase()+v)}s+=v}i=Eo(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Eo(s,t)||s;break}case"vp09":{const l=se(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;s+="."+An(u)+"."+An(c)+"."+An(d)}break}case"av01":{const l=se(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,g=u===2&&h?f?12:10:h?10:8,m=(l[2]&16)>>4,v=(l[2]&8)>>3,p=(l[2]&4)>>2,y=l[2]&3;s+="."+u+"."+An(c)+d+"."+An(g)+"."+m+"."+v+p+y+"."+An(1)+"."+An(1)+"."+An(1)+"."+0,i=Eo("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:i}}function Eo(n,e){const t=se(e,["dvvC"]),r=t.length?t[0]:se(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+An(s)+"."+An(i)}}function c1(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function cc(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function So(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function An(n){return(n<10?"0":"")+n}function d1(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&zE(n,(r,s)=>{const i=r.subarray(8,24);i.some(a=>a!==0)||(he.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${rt(i)} -> ${rt(t)}`),r.set(t,8))})}function h1(n){const e=[];return zE(n,t=>e.push(t.subarray(8,24))),e}function zE(n,e){se(n,["moov","trak"]).forEach(r=>{const s=se(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let a=se(i,["enca"]);const o=a.length>0;o||(a=se(i,["encv"])),a.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);se(u,["sinf"]).forEach(d=>{const h=YE(d);h&&e(h,o)})})})}function YE(n){const e=se(n,["schm"])[0];if(e){const t=Ve(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=se(n,["schi","tenc"])[0];if(r)return r}}}function f1(n,e,t){const r={},s=se(n,["moof","traf"]);for(let i=0;i<s.length;i++){const a=s[i],o=se(a,["tfhd"])[0],l=ee(o,4),u=e[l];if(!u)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=r[l],d=se(a,["tfdt"])[0];if(d){const E=d[0];let T=ee(d,4);E===1&&(T===Zp?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=Zp+1,T+=ee(d,8))),W(T)&&(!W(c.start)||T<c.start)&&(c.start=T)}const h=u.default,f=ee(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;f&8&&(f&2?g=ee(o,12):g=ee(o,8));const m=se(a,["trun"]);let v=c.start||0,p=0,y=g;for(let E=0;E<m.length;E++){const T=m[E],A=ee(T,4),w=c.sampleCount;c.sampleCount+=A;const _=T[3]&1,L=T[3]&4,b=T[2]&1,I=T[2]&2,k=T[2]&4,H=T[2]&8;let U=8,C=A;for(_&&(U+=4),L&&A&&(!(T[U+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=w),U+=4,b?(y=ee(T,U),U+=4):y=g,I&&(U+=4),H&&(U+=4),v+=y,p+=y,C--);C--;)b?(y=ee(T,U),U+=4):y=g,I&&(U+=4),k&&(T[U+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(C+1),c.keyFrameStart=v),U+=4),H&&(U+=4),v+=y,p+=y;!p&&g&&(p+=g*A)}c.duration+=p}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,a=0;const o=se(n,["sidx"]);for(let l=0;l<o.length;l++){const u=l1(o[l]);if(u!=null&&u.references){i=Math.min(i,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&W(a)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=a*r[l].timescale-r[l].start)})}return r}function g1(n){const e={valid:null,remainder:null},t=se(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Qt(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function tm(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let a=!1;return se(r,["moof"]).map(l=>{const u=l.byteOffset-8;se(l,["traf"]).map(d=>{const h=se(d,["tfdt"]).map(f=>{const g=f[0];let m=ee(f,4);return g===1&&(m*=Math.pow(2,32),m+=ee(f,8)),m/s})[0];return h!==void 0&&(n=h),se(d,["tfhd"]).map(f=>{const g=ee(f,4),m=ee(f,0)&16777215,v=(m&1)!==0,p=(m&2)!==0,y=(m&8)!==0;let E=0;const T=(m&16)!==0;let A=0;const w=(m&32)!==0;let _=8;g===i&&(v&&(_+=8),p&&(_+=4),y&&(E=ee(f,_),_+=4),T&&(A=ee(f,_),_+=4),w&&(_+=4),e.type==="video"&&(a=xu(e.codec)),se(d,["trun"]).map(L=>{const b=L[0],I=ee(L,0)&16777215,k=(I&1)!==0;let H=0;const U=(I&4)!==0,C=(I&256)!==0;let F=0;const B=(I&512)!==0;let O=0;const R=(I&1024)!==0,M=(I&2048)!==0;let G=0;const V=ee(L,4);let $=8;k&&(H=ee(L,$),$+=4),U&&($+=4);let Q=H+u;for(let re=0;re<V;re++){if(C?(F=ee(L,$),$+=4):F=E,B?(O=ee(L,$),$+=4):O=A,R&&($+=4),M&&(b===0?G=ee(L,$):G=KE(L,$),$+=4),e.type===me.VIDEO){let J=0;for(;J<O;){const te=ee(r,Q);if(Q+=4,p1(a,r[Q])){const Ae=r.subarray(Q,Q+te);Tf(Ae,a?2:1,n+G/s,t)}Q+=te,J+=te+4}}n+=F/s}}))})})}),t}function xu(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function p1(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Tf(n,e,t,r){const s=qE(n);let i=0;i+=e;let a=0,o=0,l=0;for(;i<s.length;){a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);const u=s.length-i;let c=i;if(o<u)i+=o;else if(o>u){he.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(s[c++]===181){const h=HE(s,c);if(c+=2,h===49){const f=ee(s,c);if(c+=4,f===1195456820){const g=s[c++];if(g===3){const m=s[c++],v=31&m,p=64&m,y=p?2+v*3:0,E=new Uint8Array(y);if(p){E[0]=m;for(let T=1;T<y;T++)E[T]=s[c++]}r.push({type:g,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const m=s[c++].toString(16);d.push(m.length==1?"0"+m:m),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,f=new Uint8Array(h);for(let g=0;g<h;g++)f[g]=s[c++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:Ft(f),userDataBytes:f})}}}function qE(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===t[0]&&(a++,t.shift()),i[r]=n[a];return i}function m1(n){const e=n[0];let t="",r="",s=0,i=0,a=0,o=0,l=0,u=0;if(e===0){for(;Ve(n.subarray(u,u+1))!=="\0";)t+=Ve(n.subarray(u,u+1)),u+=1;for(t+=Ve(n.subarray(u,u+1)),u+=1;Ve(n.subarray(u,u+1))!=="\0";)r+=Ve(n.subarray(u,u+1)),u+=1;r+=Ve(n.subarray(u,u+1)),u+=1,s=ee(n,12),i=ee(n,16),o=ee(n,20),l=ee(n,24),u=28}else if(e===1){u+=4,s=ee(n,u),u+=4;const d=ee(n,u);u+=4;const h=ee(n,u);for(u+=4,a=2**32*d+h,WR(a)||(a=Number.MAX_SAFE_INTEGER,he.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ee(n,u),u+=4,l=ee(n,u),u+=4;Ve(n.subarray(u,u+1))!=="\0";)t+=Ve(n.subarray(u,u+1)),u+=1;for(t+=Ve(n.subarray(u,u+1)),u+=1;Ve(n.subarray(u,u+1))!=="\0";)r+=Ve(n.subarray(u,u+1)),u+=1;r+=Ve(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:c}}function y1(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function v1(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),y1([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,a,t)}function E1(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=S1(s);e.push(i),r+=i.size}}return e}function S1(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const a=n.buffer,o=rt(new Uint8Array(a,t+12,16));let l=null,u=null,c=0;if(i===0)c=28;else{const h=n.getUint32(28);if(!h||r<32+h*16)return{offset:t,size:e};l=[];for(let f=0;f<h;f++)l.push(new Uint8Array(a,t+32+f*16,16));c=32+h*16}if(!c)return{offset:t,size:e};const d=n.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(a,t+c+4,d),{version:i,systemId:o,kids:l,data:u,offset:t,size:e})}const XE=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Si={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function If(n,e){const t=Si[e];return!!t&&!!t[n.slice(0,4)]}function Da(n,e,t=!0){return!n.split(",").some(r=>!Af(r,e,t))}function Af(n,e,t=!0){var r;const s=Vr(t);return(r=s==null?void 0:s.isTypeSupported(Na(n,e)))!=null?r:!1}function Na(n,e){return`${e}/mp4;codecs=${n}`}function nm(n){if(n){const e=n.substring(0,4);return Si.video[e]}return 2}function Bl(n){const e=XE();return n.split(",").reduce((t,r)=>{const i=e&&xu(r)?9:Si.video[r];return i?(i*2+t)/(t?3:2):(Si.audio[r]+t)/(t?2:1)},0)}const dc={};function x1(n,e=!0){if(dc[n])return dc[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(Af(t[s],"audio",e))return dc[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Vr(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const T1=/flac|opus|mp4a\.40\.34/i;function $l(n,e=!0){return n.replace(T1,t=>x1(t.toLowerCase(),e))}function I1(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)If(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function Xo(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(rm(n,"audio")||rm(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function rm(n,e){return If(n,e)&&Af(n,e)}function A1(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function _1(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function sm(n){const e=Vr(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Hd(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const L1={supported:!0,powerEfficient:!0,smooth:!0},w1={supported:!1,smooth:!1,powerEfficient:!1},QE={supported:!0,configurations:[],decodingInfoResults:[L1]};function JE(n,e){return{supported:!1,configurations:e,decodingInfoResults:[w1],error:n}}function b1(n,e,t,r,s,i){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,l=i==null?void 0:i.audioCodec,u=i==null?void 0:i.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((h,f)=>{if(f){const g=e.groups[f];if(!g)throw new Error(`Audio track group ${f} not found`);Object.keys(g.channels).forEach(m=>{h[m]=(h[m]||0)+g.channels[m]})}return h},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(h=>xu(h))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!d&&W(c)&&Object.keys(d).some(h=>parseInt(h)>c)}function ZE(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(QE);const i=[],a=R1(n),o=a.length,l=k1(n,e,o>0),u=l.length;for(let c=o||1*u||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),u){d.audio=l[c%u];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}i.push(d)}if(s){const c=navigator.userAgent;if(s.split(",").some(d=>xu(d))&&XE())return Promise.resolve(JE(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),i))}return Promise.all(i.map(c=>{const d=P1(c);return r[d]||(r[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:i,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:i,decodingInfoResults:[],error:c}))}function R1(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=eS(n),s=n.width||640,i=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:Na(_1(l),"video"),width:s,height:i,bitrate:r,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function k1(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=eS(n);return s&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var l;const u=o?(l=e.groups[o])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===o){const h=parseFloat(d.channels||"");s.forEach(f=>{const g={contentType:Na(f,"audio"),bitrate:t?C1(f,i):i};h&&(g.channels=""+h),c.push(g)})}return c},a):a},[]):[]}function C1(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function eS(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function P1(n){let e="";const{audio:t,video:r}=n;if(r){const s=Hd(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=Hd(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const Kd=["NONE","TYPE-0","TYPE-1",null];function D1(n){return Kd.indexOf(n)>-1}const jl=["SDR","PQ","HLG"];function N1(n){return!!n&&jl.indexOf(n)>-1}var Qo={No:"",Yes:"YES",v2:"v2"};function im(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Qo.v2:Qo.Yes:Qo.No}class am{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Oa{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return om(this._audioGroups,e)}hasSubtitleGroup(e){return om(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function om(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function O1(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function M1(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||jl.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&O1(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const F1=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},ye=(n,e)=>JSON.stringify(n,F1(e));function U1(n,e,t,r,s){const i=Object.keys(n),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=s==null?void 0:s.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,h=1/0,f=1/0,g=1/0,m=1/0,v=0,p=[];const{preferHDR:y,allowedVideoRanges:E}=M1(e,s);for(let L=i.length;L--;){const b=n[i[L]];c||(c=b.channels[2]>0),h=Math.min(h,b.minHeight),f=Math.min(f,b.minFramerate),g=Math.min(g,b.minBitrate),E.filter(k=>b.videoRanges[k]>0).length>0&&(d=!0)}h=W(h)?h:0,f=W(f)?f:0;const T=Math.max(1080,h),A=Math.max(30,f);g=W(g)?g:t,t=Math.max(g,t),d||(e=void 0);const w=i.length>1;return{codecSet:i.reduce((L,b)=>{const I=n[b];if(b===L)return L;if(p=d?E.filter(k=>I.videoRanges[k]>0):[],w){if(I.minBitrate>t)return Sn(b,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),L;if(!I.hasDefaultAudio)return Sn(b,"no renditions with default or auto-select sound found"),L;if(o&&b.indexOf(o.substring(0,4))%5!==0)return Sn(b,`audio codec preference "${o}" not found`),L;if(a&&!u){if(!I.channels[a])return Sn(b,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),L}else if((!o||u)&&c&&I.channels[2]===0)return Sn(b,"no renditions with stereo sound found"),L;if(I.minHeight>T)return Sn(b,`min resolution of ${I.minHeight} > maximum of ${T}`),L;if(I.minFramerate>A)return Sn(b,`min framerate of ${I.minFramerate} > maximum of ${A}`),L;if(!p.some(k=>I.videoRanges[k]>0))return Sn(b,`no variants with VIDEO-RANGE of ${ye(p)} found`),L;if(l&&b.indexOf(l.substring(0,4))%5!==0)return Sn(b,`video codec preference "${l}" not found`),L;if(I.maxScore<v)return Sn(b,`max score of ${I.maxScore} < selected max of ${v}`),L}return L&&(Bl(b)>=Bl(L)||I.fragmentError>n[L].fragmentError)?L:(m=I.minIndex,v=I.maxScore,b)},void 0),videoRanges:p,preferHDR:y,minFramerate:f,minBitrate:g,minIndex:m}}function Sn(n,e){he.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function tS(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function B1(n,e,t,r){return n.slice(t,r+1).reduce((s,i,a)=>{if(!i.codecSet)return s;const o=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const u=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),s},{})}function lm(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function Cn(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(fs(n,s,t))return r}return-1}function fs(n,e,t){const{groupId:r,name:s,lang:i,assocLang:a,default:o}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||$1(i,e.lang))&&(i===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||j1(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function $1(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function j1(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function as(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function G1(n,e,t,r,s){const i=e[r],o=e.reduce((h,f,g)=>{const m=f.uri;return(h[m]||(h[m]=[])).push(g),h},{})[i.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=um(e,r,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Cn(n,g,s)>-1});return d>-1?d:um(e,r,h=>{const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Cn(n,g,s)>-1})}function um(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function Gl(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class V1 extends Jt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!s||!l)return;const u=performance.now(),c=i?i.stats:s.stats,d=i?i.duration:s.duration,h=u-c.loading.start,f=a.minAutoLevel,g=s.level,m=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const v=m>-1&&m!==g,p=!!t||v;if(!p&&(l.paused||!l.playbackRate||!l.readyState))return;const y=a.mainForwardBufferInfo;if(!p&&y===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(h<=Math.max(E,1e3*(d/(T*2))))return;const A=y?y.len/T:0,w=c.loading.first?c.loading.first-c.loading.start:-1,_=c.loaded&&w>-1,L=this.getBwEstimate(),b=a.levels,I=b[g],k=Math.max(c.loaded,Math.round(d*(s.bitrate||I.averageBitrate)/8));let H=_?h-w:h;H<1&&_&&(H=Math.min(h,c.loaded*8/L));const U=_?c.loaded*1e3/H:0,C=E/1e3,F=U?(k-c.loaded)/U:k*8/L+C;if(F<=A)return;const B=U?U*8:L,O=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,R=this.hls.config.abrBandWidthUpFactor;let M=Number.POSITIVE_INFINITY,G;for(G=g-1;G>f;G--){const re=b[G].maxBitrate,J=!b[G].details||O;if(M=this.getTimeToLoadFrag(C,B,d*re,J),M<Math.min(A,d+C))break}if(M>=F||M>d*10)return;_?this.bwEstimator.sample(h-Math.min(E,w),c.loaded):this.bwEstimator.sampleTTFB(h);const V=b[G].maxBitrate;this.getBwEstimate()*R>V&&this.resetEstimator(V);const $=this.findBestLevel(V,f,G,0,A,1,1);$>-1&&(G=$),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${F.toFixed(3)} s
      Estimated load time for down switch fragment: ${M.toFixed(3)} s
      TTFB estimate: ${w|0} ms
      Current BW estimate: ${W(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${G} @ ${V|0} bps`),a.nextLoadLevel=a.nextAutoLevel=G,this.clearTimer();const Q=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===G&&G>0){const re=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${G>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${re.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,G>f){let J=this.findBestLevel(this.hls.levels[f].bitrate,f,G,0,re,1,1);J===-1&&(J=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=J,this.resetEstimator(this.hls.levels[J].bitrate)}}};v||F>M*2?Q():this.timer=self.setInterval(Q,M*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new YR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case N.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const a=performance.now(),o=i?i.stats:r.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,a=s?e+this.lastLevelLoadSec:0;return i+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;W(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===Y.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+s.loaded,l=(a.loaded?a.loaded.duration:0)+i;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Y.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,i)&&a[e].loadError<=a[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){const v=this.findBestLevel(l,a,s,u,0,c,d);if(v>=0)return this.rebufferNotice=-1,v}let h=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const v=this.bitrateTestDelay;v&&(h=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const f=this.findBestLevel(l,a,s,u,h,c,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const g=r.levels[a],m=r.loadLevelObj;return m&&(g==null?void 0:g.bitrate)<m.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,a,o){var l;const u=s+i,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:f}=this,{levels:g,allAudioTracks:m,loadLevel:v,config:p}=this.hls;if(g.length===1)return 0;const y=g[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=v===-1||c===-1;let A,w="SDR",_=(y==null?void 0:y.frameRate)||0;const{audioPreference:L,videoPreference:b}=p,I=this.audioTracksByGroup||(this.audioTracksByGroup=tS(m));let k=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=B1(g,I,t,r)),O=U1(B,w,e,L,b),{codecSet:R,videoRanges:M,minFramerate:G,minBitrate:V,minIndex:$,preferHDR:Q}=O;k=$,A=R,w=Q?M[M.length-1]:M[0],_=G,e=Math.max(e,V),this.log(`picked start tier ${ye(O)}`)}else A=y==null?void 0:y.codecSet,w=y==null?void 0:y.videoRange;const H=f?f.duration:h?h.duration:0,U=this.bwEstimator.getEstimateTTFB()/1e3,C=[];for(let B=r;B>=t;B--){var F;const O=g[B],R=B>d;if(!O)continue;if(p.useMediaCapabilities&&!O.supportedResult&&!O.supportedPromise){const J=navigator.mediaCapabilities;typeof(J==null?void 0:J.decodingInfo)=="function"&&b1(O,I,w,_,e,L)?(O.supportedPromise=ZE(O,I,J,this.supportedCache),O.supportedPromise.then(te=>{if(!this.hls)return;O.supportedResult=te;const Ae=this.hls.levels,Be=Ae.indexOf(O);te.error?this.warn(`MediaCapabilities decodingInfo error: "${te.error}" for level ${Be} ${ye(te)}`):te.supported?te.decodingInfoResults.some(Oe=>Oe.smooth===!1||Oe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Be} not smooth or powerEfficient: ${ye(te)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Be} ${ye(te)}`),Be>-1&&Ae.length>1&&(this.log(`Removing unsupported level ${Be}`),this.hls.removeLevel(Be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(te=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${te}`)})):O.supportedResult=QE}if((A&&O.codecSet!==A||w&&O.videoRange!==w||R&&_>O.frameRate||!R&&_>0&&_<O.frameRate||(F=O.supportedResult)!=null&&(F=F.decodingInfoResults)!=null&&F.some(J=>J.smooth===!1))&&(!T||B!==k)){C.push(B);continue}const M=O.details,G=(f?M==null?void 0:M.partTarget:M==null?void 0:M.averagetargetduration)||H;let V;R?V=o*e:V=a*e;const $=H&&s>=H*2&&i===0?O.averageBitrate:O.maxBitrate,Q=this.getTimeToLoadFrag(U,V,$*G,M===void 0);if(V>=$&&(B===c||O.loadError===0&&O.fragmentError===0)&&(Q<=U||!W(Q)||E&&!this.bitrateTestDelay||Q<u)){const J=this.forcedAutoLevel;return B!==v&&(J===-1||J!==v)&&(C.length&&this.trace(`Skipped level(s) ${C.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[C[0]].codecs}" ${g[C[0]].videoRange}; not compatible with "${A}" ${w}`),this.info(`switch candidate:${d}->${B} adjustedbw(${Math.round(V)})-bitrate=${Math.round(V-$)} ttfb:${U.toFixed(1)} avgDuration:${G.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${Q.toFixed(1)} firstSelection:${T} codecSet:${O.codecSet} videoRange:${O.videoRange} hls.loadLevel:${v}`)),T&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const nS={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const a=e(i);if(a>0)t=s+1;else if(a<0)r=s-1;else return i}return null}};function H1(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!W(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const a=n[i];if(W1(e,t,a))return a}return null}function Ts(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&cm(t,r,i)===0||K1(i,n,Math.min(s,r))))return i;const a=nS.search(e,cm.bind(null,t,r));return a&&(a!==n||!i)?a:i}function K1(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function cm(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function W1(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function rS(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return nS.search(r,a=>a.cc<e?1:a.cc>e?-1:(i=a,a.end<=t?1:a.start>t?-1:0)),i||null}return null}function Vl(n){switch(n.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function sS(n){return n.details.startsWith("key")}function iS(n){return sS(n)&&!!n.frag&&!n.frag.decryptdata}function dm(n,e){const t=Vl(e);return n.default[`${t?"timeout":"error"}Retry`]}function _f(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function hm(n){return de(de({},n),{errorRetry:null,timeoutRetry:null})}function Hl(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(z1(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function z1(n){return Wd(n)||!!n&&(n<400||n>499)}function Wd(n){return n===0&&navigator.onLine===!1}var nt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ct={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Y1 extends Jt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Y.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case N.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=ai();return}case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=nt.SendAlternateToPenaltyBox;return}case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:{var a;const l=t.parent===Y.MAIN?t.level:s.loadLevel;t.details===N.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===ie.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===ie.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=nt.SendAlternateToPenaltyBox,t.errorAction.flags=Ct.MoveAllAlternatesMatchingHost;return}}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:nt.SendAlternateToPenaltyBox,flags:Ct.MoveAllAlternatesMatchingHDCP};return;case N.KEY_SYSTEM_SESSION_UPDATE_FAILED:case N.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case N.KEY_SYSTEM_NO_SESSION:t.errorAction={action:nt.SendAlternateToPenaltyBox,flags:Ct.MoveAllAlternatesMatchingKey};return;case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:case N.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:s.loadLevel)}return;case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:t.errorAction=ai();return}t.type===X.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ai())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=dm(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(Hl(s,i,Vl(e),e.response))return{action:nt.RetryRequest,flags:Ct.None,retryConfig:s,retryCount:i};const o=this.getLevelSwitchAction(e,t);return s&&(o.retryConfig=s,o.retryCount=i),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,o=dm(sS(e)?a:i,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(s&&(e.details!==N.FRAG_GAP&&s.fragmentError++,!iS(e)&&Hl(o,l,Vl(e),e.response)))return{action:nt.RetryRequest,flags:Ct.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,r);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,a;const u=e.details;s.loadError++,u===N.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const m=(i=e.frag)==null?void 0:i.type,p=(m===Y.AUDIO&&u===N.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===N.BUFFER_ADD_CODEC_ERROR||u===N.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:w})=>s.audioCodec!==w),E=e.sourceBufferName==="video"&&(u===N.BUFFER_ADD_CODEC_ERROR||u===N.BUFFER_APPEND_ERROR)&&d.some(({codecSet:w,audioCodec:_})=>s.codecSet!==w&&s.audioCodec===_),{type:T,groupId:A}=(a=e.context)!=null?a:{};for(let w=d.length;w--;){const _=(w+h)%d.length;if(_!==h&&_>=f&&_<=g&&d[_].loadError===0){var o,l;const L=d[_];if(u===N.FRAG_GAP&&m===Y.MAIN&&e.frag){const b=d[_].details;if(b){const I=Ts(e.frag,b.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(T===ie.AUDIO_TRACK&&L.hasAudioGroup(A)||T===ie.SUBTITLE_TRACK&&L.hasSubtitleGroup(A))continue;if(m===Y.AUDIO&&(o=s.audioGroups)!=null&&o.some(b=>L.hasAudioGroup(b))||m===Y.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(b=>L.hasSubtitleGroup(b))||p&&s.audioCodec===L.audioCodec||E&&s.codecSet===L.codecSet||!p&&s.codecSet!==L.codecSet)continue}c=_;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:nt.SendAlternateToPenaltyBox,flags:Ct.None,nextAutoLevel:c}}return{action:nt.SendAlternateToPenaltyBox,flags:Ct.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case nt.DoNothing:break;case nt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==N.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Ct.None:this.switchLevel(e,i);break;case Ct.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(r.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=Kd[Kd.indexOf(c)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ct.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let h=c;h--;)if(this.variantHasKey(u[h],l)){var a,o;this.log(`Banned key found in level ${h} (${u[h].bitrate}bps) or audio group "${(a=u[h].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${rt(l.keyId||[])}`),u[h].fragmentError++,u[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<c)r.resolved=!0;else if(d&&d.type!==Y.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===N.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=Hd(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function ai(n){const e={action:nt.DoNothing,flags:Ct.None};return n&&(e.resolved=!0),e}var Ke={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class q1{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let a=i.length;a--;){const o=s[i[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=Ps(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const l=r.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;i.range[o]=this.getBufferedTimes(r,e.part,c,u)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),xo(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=fm(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Ps(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,h=s.end(c)+this.bufferPadding;if(u>=d&&l<=h){i.time.push({startPTS:Math.max(a,s.start(c)),endPTS:Math.min(o,s.end(c))});break}else if(a<h&&o>d){const f=Math.max(a,s.start(c)),g=Math.min(o,s.end(c));g>f&&(i.partial=!0,i.time.push({startPTS:f,endPTS:g}))}else if(o<=d)break}return i}getPartialFragment(e){let t=null,r,s,i,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&xo(c)&&(s=c.body.start-o,i=c.body.end+o,e>=s&&e<=i&&(r=Math.min(e-s,i-e),a<=r&&(t=c.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||xo(t))}getState(e){const t=Ps(e),r=this.fragments[t];return r?r.buffered?xo(r)?Ke.PARTIAL:Ke.OK:Ke.APPENDING:Ke.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let a=0;a<r.length;a++){if(s=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=Ps(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(s){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(s)}this.timeRanges=i;const l=i[a];this.detectEvictedFragments(a,l,o,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ps(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Ps(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=fm(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function xo(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Ps(n){return`${n.type}_${n.level}_${n.sn}`}function fm(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Hr={cbc:0,ctr:1};class X1{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Hr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Hr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Q1(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class J1{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],a=r[2],o=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let g=0,m=0,v=0;for(v=0;v<256;v++)v<128?f[v]=v<<1:f[v]=v<<1^283;for(v=0;v<256;v++){let p=m^m<<1^m<<2^m<<3^m<<4;p=p>>>8^p&255^99,e[g]=p,t[p]=g;const y=f[g],E=f[y],T=f[E];let A=f[p]*257^p*16843008;s[g]=A<<24|A>>>8,i[g]=A<<16|A>>>16,a[g]=A<<8|A>>>24,o[g]=A,A=T*16843009^E*65537^y*257^g*16843008,u[p]=A<<24|A>>>8,c[p]=A<<16|A>>>16,d[p]=A<<8|A>>>24,h[p]=A,g?(g=y^f[f[f[T^y]]],m^=f[f[m]]):g=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const a=this.ksRows=(i+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,f=this.invSubMix,g=f[0],m=f[1],v=f[2],p=f[3];let y,E;for(o=0;o<a;o++){if(o<i){y=u[o]=t[o];continue}E=y,o%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[o/i|0]<<24):i>6&&o%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[o]=y=(u[o-i]^E)>>>0}for(l=0;l<a;l++)o=a-l,l&3?E=u[o]:E=u[o-4],l<4||o<=4?c[l]=E:c[l]=g[d[E>>>24]]^m[d[E>>>16&255]]^v[d[E>>>8&255]]^p[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(r);let f=h[0],g=h[1],m=h[2],v=h[3];const p=new Int32Array(e),y=new Int32Array(p.length);let E,T,A,w,_,L,b,I,k,H,U,C,F,B;const O=this.networkToHostOrderSwap;for(;t<p.length;){for(k=O(p[t]),H=O(p[t+1]),U=O(p[t+2]),C=O(p[t+3]),_=k^i[0],L=C^i[1],b=U^i[2],I=H^i[3],F=4,B=1;B<s;B++)E=l[_>>>24]^u[L>>16&255]^c[b>>8&255]^d[I&255]^i[F],T=l[L>>>24]^u[b>>16&255]^c[I>>8&255]^d[_&255]^i[F+1],A=l[b>>>24]^u[I>>16&255]^c[_>>8&255]^d[L&255]^i[F+2],w=l[I>>>24]^u[_>>16&255]^c[L>>8&255]^d[b&255]^i[F+3],_=E,L=T,b=A,I=w,F=F+4;E=a[_>>>24]<<24^a[L>>16&255]<<16^a[b>>8&255]<<8^a[I&255]^i[F],T=a[L>>>24]<<24^a[b>>16&255]<<16^a[I>>8&255]<<8^a[_&255]^i[F+1],A=a[b>>>24]<<24^a[I>>16&255]<<16^a[_>>8&255]<<8^a[L&255]^i[F+2],w=a[I>>>24]<<24^a[_>>16&255]<<16^a[L>>8&255]<<8^a[b&255]^i[F+3],y[t]=O(E^f),y[t+1]=O(w^g),y[t+2]=O(A^m),y[t+3]=O(T^v),f=k,g=H,m=U,v=C,t=t+4}return y.buffer}}class Z1{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=ek(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function ek(n){switch(n){case Hr.cbc:return"AES-CBC";case Hr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const tk=16;class Lf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Q1(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,s);const l=this.flush();l?i(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:a,remainderData:o}=this;if(s!==Hr.cbc||t.byteLength!==16)return he.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Qt(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new J1),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new Z1(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new X1(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(he.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%tk;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(he.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const gm=Math.pow(2,17);class nk{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Vn({type:X.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(mm(e));return}else e.gap=!1;const u=this.loader=i?new i(s):new a(s),c=pm(e);e.loader=u;const d=hm(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:gm};e.stats=u.stats;const f={onSuccess:(g,m,v,p)=>{this.resetLoader(e,u);let y=g.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:e,part:null,payload:y,networkDetails:p})},onError:(g,m,v,p)=>{this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:de({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:v,stats:p}))},onAbort:(g,m,v)=>{this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:g}))},onTimeout:(g,m,v)=>{this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:v,stats:g}))}};t&&(f.onProgress=(g,m,v,p)=>t({frag:e,part:null,payload:v,networkDetails:p})),u.load(c,h,f)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(mm(e,t));return}const u=this.loader=i?new i(s):new a(s),c=pm(e,t);e.loader=u;const d=hm(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:gm};t.stats=u.stats,u.load(c,h,{onSuccess:(f,g,m,v)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const p={frag:e,part:t,payload:f.data,networkDetails:v};r(p),o(p)},onError:(f,g,m,v)=>{this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:de({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:v}))},onAbort:(f,g,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,g,m)=>{this.resetLoader(e,u),l(new Vn({type:X.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/i),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=s.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function pm(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(W(s)&&W(i)){var a;let o=s,l=i;if(n.sn==="initSegment"&&rk((a=n.decryptdata)==null?void 0:a.method)){const u=i-s;u%16&&(l=i+(16-u%16)),s!==0&&(r.resetIV=!0,o=s-16)}r.rangeStart=o,r.rangeEnd=l}return r}function mm(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:X.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Vn(r)}function rk(n){return n==="AES-128"||n==="AES-256"}class Vn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class aS extends Jt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class wf{constructor(e,t,r,s=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=To(),this.buffering={audio:To(),video:To(),audiovideo:To()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=a}}function To(){return{start:0,executeStart:0,executeEnd:0,end:0}}const ym={length:0,start:()=>0,end:()=>0};class ne{static isBuffered(e,t){if(e){const r=ne.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=ne.getBuffered(e);return ne.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=ne.bufferedRanges(e);if(s.length)return ne.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let s=-1,i=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(s=c);const d=i.length;if(d){const h=i[d-1].end;e[c].start-h<r?e[c].end>h&&(i[d-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let a=0,o,l=t,u=t;for(let c=0;c<i.length;c++){const d=i[c].start,h=i[c].end;if(s===-1&&t>=d&&t<=h&&(s=c),t+r>=d&&t<h)l=d,u=h,a=u-t;else if(t+r<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||ym}catch(t){return he.log("failed to get media.buffered",t),ym}}}const oS=/\{\$([a-zA-Z0-9-_]+)\}/g;function vm(n){return oS.test(n)}function zd(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(oS,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function Em(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))i=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function sk(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const ik=/^(\d+)x(\d+)$/,Sm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Le{constructor(e,t){typeof e=="string"&&(e=Le.parseAttrList(e,t)),ge(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=ik.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={},i='"';for(Sm.lastIndex=0;(r=Sm.exec(e))!==null;){const a=r[1].trim();let o=r[2];const l=o.indexOf(i)===0&&o.lastIndexOf(i)===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=zd(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":he.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=o}return s}}const ak="com.apple.hls.interstitial";function ok(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function lk(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class lS{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const a in i)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==i[a]){he.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=ge(new Le({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);W(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(he.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(W(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ak}get isValid(){return!!this.id&&!this._badValueForSameId&&W(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const uk=10;class ck{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?W(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||uk}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Kl(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function xm(n,e){return!n&&!e?!0:!n||!e?!1:Kl(n,e)}function oi(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function bf(n){switch(n){case"AES-128":case"AES-256":return Hr.cbc;case"AES-256-CTR":return Hr.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Rf(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Yd(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function dk(n){const e=Yd(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function uS(n){const e=function(r,s,i){const a=r[s];r[s]=r[i],r[i]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function cS(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",a=s[1];i?(r.splice(-1,1),t=Rf(a)):t=dk(a)}}return t}const Wl=typeof self<"u"?self:void 0;var be={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},st={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Jo(n){switch(n){case st.FAIRPLAY:return be.FAIRPLAY;case st.PLAYREADY:return be.PLAYREADY;case st.WIDEVINE:return be.WIDEVINE;case st.CLEARKEY:return be.CLEARKEY}}function hc(n){switch(n){case be.FAIRPLAY:return st.FAIRPLAY;case be.PLAYREADY:return st.PLAYREADY;case be.WIDEVINE:return st.WIDEVINE;case be.CLEARKEY:return st.CLEARKEY}}function qi(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[be.FAIRPLAY,be.WIDEVINE,be.PLAYREADY,be.CLEARKEY].filter(s=>!!e[s]):[];return!r[be.WIDEVINE]&&t&&r.push(be.WIDEVINE),r}const dS=function(n){return Wl!=null&&(n=Wl.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function hk(n,e,t,r){let s;switch(n){case be.FAIRPLAY:s=["cenc","sinf"];break;case be.WIDEVINE:case be.PLAYREADY:s=["cenc"];break;case be.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return fk(s,e,t,r)}function fk(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function gk(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function hS(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Rf(o).subarray(0,16);return uS(l),l}}return null}let Ds={};class $r{static clearKeyUriToKeyIdMap(){Ds={}}static setKeyIdForUri(e,t){Ds[e]=t}static addKeyIdForUri(e){const t=Object.keys(Ds).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Ds[e]=r,r}constructor(e,t,r,s=[1],i=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!oi(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array($E(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Kl(e.keyFormatVersions,this.keyFormatVersions)&&xm(e.iv,this.iv)&&xm(e.keyId,this.keyId)}isSupported(){if(this.method){if(oi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case st.FAIRPLAY:case st.WIDEVINE:case st.PLAYREADY:case st.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(oi(this.method)){let i=this.iv;return i||(typeof e!="number"&&(he.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=mk(e)),new $r(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Ds[this.uri];if(i&&!Kl(this.keyId,i)&&$r.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=cS(this.uri);if(r)switch(this.keyFormat){case st.WIDEVINE:if(this.pssh=r,!this.keyId){const i=E1(r.buffer);if(i.length){var s;const a=i[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=Tm(t));break;case st.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=v1(i,null,r),this.keyId=hS(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const a=new Uint8Array(16);a.set(i,16-i.length),i=a}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=pk(t),i||(i=Tm(t),i||(i=Ds[this.uri])),i&&(this.keyId=i,$r.setKeyIdForUri(this.uri,i))}return this}}function pk(n){const e=n==null?void 0:n[st.WIDEVINE];return e?e.keyId:null}function Tm(n){const e=n==null?void 0:n[st.PLAYREADY];if(e){const t=cS(e.uri);if(t)return hS(t)}return null}function mk(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Im=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Am=/#EXT-X-MEDIA:(.*)/g,yk=/^#EXT(?:INF|-X-TARGETDURATION):/m,fc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),vk=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Pn{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return Sf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return yk.test(e)}static parseMasterPlaylist(e,t){const r=vm(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(Im.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=Im.exec(e))!=null;)if(a[1]){var o;const u=new Le(a[1],s),c=zd(s,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Pn.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),wm(u.CODECS,d);const f=u["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},wm(f,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||i.push(d),s.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new Le(c,s),h=d["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=d);break}case"SESSION-KEY":{const d=_m(c,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):he.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new Le(c,s);Em(s,d,t)}break}case"CONTENT-STEERING":{const d=new Le(c,s);s.contentSteering={uri:Pn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Lm(c);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},a=r.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Am.lastIndex=0;(s=Am.exec(e))!==null;){const u=new Le(s[1],r),c=u.TYPE;if(c){const d=o[c],h=i[c]||[];i[c]=h;const f=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],m=u.CHANNELS,v=u.CHARACTERISTICS,p=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?Pn.resolve(u.URI,t):""};if(g&&(y.assocLang=g),m&&(y.channels=m),v&&(y.characteristics=v),p&&(y.instreamId=p),d!=null&&d.length){const E=Pn.findGroup(d,y.groupId)||d[0];bm(y,E,"audioCodec"),bm(y,E,"textCodec")}h.push(y)}}return i}static parseLevelPlaylist(e,t,r,s,i,a){var o;const l={url:t},u=new ck(t),c=u.fragments,d=[];let h=null,f=0,g=0,m=0,v=0,p=0,y=null,E=new uc(s,l),T,A,w,_=-1,L=!1,b=null,I;if(fc.lastIndex=0,u.m3u8=e,u.hasVariableRefs=vm(e),((o=fc.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=fc.exec(e))!==null;){L&&(L=!1,E=new uc(s,l),E.playlistOffset=m,E.setStart(m),E.sn=f,E.cc=v,p&&(E.bitrate=p),E.level=r,h&&(E.initSegment=h,h.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),b&&(E.setByteRange(b),b=null)));const C=T[1];if(C){E.duration=parseFloat(C);const F=(" "+T[2]).slice(1);E.title=F||null,E.tagList.push(F?["INF",C,F]:["INF",C])}else if(T[3]){if(W(E.duration)){E.playlistOffset=m,E.setStart(m),w&&km(E,w,u),E.sn=f,E.level=r,E.cc=v,c.push(E);const F=(" "+T[3]).slice(1);E.relurl=zd(u,F),qd(E,y,d),y=E,m+=E.duration,f++,g=0,L=!0}}else{if(T=T[0].match(vk),!T){he.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<T.length&&T[A]===void 0;A++);const F=(" "+T[A]).slice(1),B=(" "+T[A+1]).slice(1),O=T[A+2]?(" "+T[A+2]).slice(1):null;switch(F){case"BYTERANGE":y?E.setByteRange(B,y):E.setByteRange(B);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=B,E.tagList.push(["PROGRAM-DATE-TIME",B]),_===-1&&(_=c.length);break;case"PLAYLIST-TYPE":u.type&&$n(u,F,T),u.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?$n(u,F,T):c.length>0&&Cm(u,F,T),f=u.startSN=parseInt(B);break;case"SKIP":{u.skippedSegments&&$n(u,F,T);const R=new Le(B,u),M=R.decimalInteger("SKIPPED-SEGMENTS");if(W(M)){u.skippedSegments+=M;for(let V=M;V--;)c.push(null);f+=M}const G=R.enumeratedString("RECENTLY-REMOVED-DATERANGES");G&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(G.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&$n(u,F,T),u.targetduration=Math.max(parseInt(B),1);break;case"VERSION":u.version!==null&&$n(u,F,T),u.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||$n(u,F,T),u.live=!1;break;case"#":(B||O)&&E.tagList.push(O?[B,O]:[B]);break;case"DISCONTINUITY":v++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([F]);break;case"BITRATE":E.tagList.push([F,B]),p=parseInt(B)*1e3,W(p)?E.bitrate=p:p=0;break;case"DATERANGE":{const R=new Le(B,u),M=new lS(R,u.dateRanges[R.ID],u.dateRangeTagCount);u.dateRangeTagCount++,M.isValid||u.skippedSegments?u.dateRanges[M.id]=M:he.warn(`Ignoring invalid DATERANGE tag: "${B}"`),E.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const R=new Le(B,u);"IMPORT"in R?sk(u,R,a):Em(u,R,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?$n(u,F,T):c.length>0&&Cm(u,F,T),u.startCC=v=parseInt(B);break;case"KEY":{const R=_m(B,t,u);if(R.isSupported()){if(R.method==="NONE"){w=void 0;break}w||(w={});const M=w[R.keyFormat];M!=null&&M.matches(R)||(M&&(w=ge({},w)),w[R.keyFormat]=R)}else he.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${B}"`);break}case"START":u.startTimeOffset=Lm(B);break;case"MAP":{const R=new Le(B,u);if(E.duration){const M=new uc(s,l);Rm(M,R,r,w),h=M,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{const M=E.byteRangeEndOffset;if(M){const G=E.byteRangeStartOffset;b=`${M-G}@${G}`}else b=null;Rm(E,R,r,w),h=E,L=!0}h.cc=v;break}case"SERVER-CONTROL":{I&&$n(u,F,T),I=new Le(B),u.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),u.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&$n(u,F,T);const R=new Le(B);u.partTarget=R.decimalFloatingPoint("PART-TARGET");break}case"PART":{let R=u.partList;R||(R=u.partList=[]);const M=g>0?R[R.length-1]:void 0,G=g++,V=new Le(B,u),$=new s1(V,E,l,G,M);R.push($),E.duration+=$.duration;break}case"PRELOAD-HINT":{const R=new Le(B,u);u.preloadHint=R;break}case"RENDITION-REPORT":{const R=new Le(B,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(R);break}default:he.warn(`line parsed but not handled: ${T}`);break}}}y&&!y.relurl?(c.pop(),m-=y.duration,u.partList&&(u.fragmentHint=y)):u.partList&&(qd(E,y,d),E.cc=v,u.fragmentHint=E,w&&km(E,w,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const k=c.length,H=c[0],U=c[k-1];if(m+=u.skippedSegments*u.targetduration,m>0&&k&&U){u.averagetargetduration=m/k;const C=U.sn;u.endSN=C!=="initSegment"?C:0,u.live||(U.endList=!0),_>0&&(Sk(c,_),H&&d.unshift(H))}return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,d.length&&u.dateRangeTagCount&&H&&fS(d,u),u.endCC=v,u}}function fS(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];n.push(o),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let o=i.length;o--;){const l=e.dateRanges[i[o]],u=l.startDate.getTime();l.tagAnchor=r.ref;for(let c=t;c--;){var a;if(((a=n[c])==null?void 0:a.sn)<e.startSN)break;const d=Ek(e,u,n,c,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function Ek(n,e,t,r,s){const i=t[r];if(i){const o=i.programDateTime;if(e>=o||r===0){var a;const l=(((a=t[r+1])==null?void 0:a.start)||s)-i.start;if(e<=o+l*1e3){const u=t[r].sn-n.startSN;if(u<0)return-1;const c=n.fragments;if(c.length>t.length){const h=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let f=h;f>u;f--){const g=c[f].programDateTime;if(e>=g&&e<g+c[f].duration*1e3)return f}}return u}}}return-1}function _m(n,e,t){var r,s;const i=new Le(n,t),a=(r=i.METHOD)!=null?r:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(s=i.KEYFORMAT)!=null?s:"identity";o&&i.IV&&!l&&he.error(`Invalid IV: ${i.IV}`);const d=o?Pn.resolve(o,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new $r(a,d,c,h,l,i.KEYID)}function Lm(n){const t=new Le(n).decimalFloatingPoint("TIME-OFFSET");return W(t)?t:null}function wm(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>If(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function bm(n,e,t){const r=e[t];r&&(n[t]=r)}function Sk(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function qd(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Rm(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function km(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function $n(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Cm(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function gc(n,e){const t=e.startPTS;if(W(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function gS(n,e,t,r,s,i,a){r-t<=0&&(a.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let l=t,u=r;const c=e.startPTS,d=e.endPTS;if(W(c)){const p=Math.abs(c-t);n&&p>n.totalduration?a.warn(`media timestamps and playlist times differ by ${p}s for level ${e.level} ${n.url}`):W(e.deltaPTS)?e.deltaPTS=Math.max(p,e.deltaPTS):e.deltaPTS=p,l=Math.max(t,c),t=Math.min(t,c),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,u=Math.min(r,d),r=Math.max(r,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=r,e.minEndPTS=u,e.endDTS=i;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let g;const m=f-n.startSN,v=n.fragments;for(v[m]=e,g=m;g>0;g--)gc(v[g],v[g-1]);for(g=m;g<v.length-1;g++)gc(v[g],v[g+1]);return n.fragmentHint&&gc(v[v.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,h}function xk(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let c=s.length-1;c>=0;c--){const d=s[c].initSegment;if(d){r=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;Ak(n,e,(c,d,h,f)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const g=c.cc-d.cc;for(let m=h;m<f.length;m++)f[m].cc+=g;e.endCC=f[f.length-1].cc}W(c.startPTS)&&W(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,r=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(r&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(c.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Tk(n.dateRanges,e,t));const c=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&qd(o[d],o[d-1],c);fS(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const c=yS(n,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:a[0].cc}Ik(n.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),i?gS(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):pS(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Tk(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=ge({},n);s&&s.forEach(l=>{delete i[l]});const o=Object.keys(i).length;return o?(Object.keys(r).forEach(l=>{const u=i[l],c=new lS(r[l].attr,u);c.isValid?(i[l]=c,u||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ye(r[l].attr)}"`)}),i):r}function Ik(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const a=n[s],o=e[s+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function Ak(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=s;u<=i;u++){const c=l[a+u];let d=o[u];if(r&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,o);const h=c.relurl,f=d.relurl;if(h&&_k(h,f)){e.playlistParsingError=Pm(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Pm(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function Pm(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function pS(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let a=0;if(i&&r<s.length)a=s[r].start;else if(i&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(i&&t)a=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Xd(e,a)}function Xd(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function mS(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function yS(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function Dm(n,e,t){return n?vS(n.partList,e,t):null}function vS(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function ES(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function _k(n,e){return n!==e&&e?Nm(n)!==Nm(e):!1}function Nm(n){return n.replace(/\?[^?]*$/,"")}function oa(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function Lk(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function Om(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function SS(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)Om(t[r],n);e.fragmentHint&&Om(e.fragmentHint,n),e.alignedSliding=!0}function wk(n,e){n&&(xS(e,n),e.alignedSliding||zl(e,n),!e.alignedSliding&&!e.skippedSegments&&pS(n,e,!1))}function xS(n,e){if(!Lk(e,n))return;const t=Math.min(e.endCC,n.endCC),r=oa(e.fragments,t),s=oa(n.fragments,t);if(!r||!s)return;he.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;SS(i,n)}function zl(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(s=oa(r,a),i=oa(t,a)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=oa(t,s.cc)||t[Math.floor(t.length/2)]);const o=s.programDateTime,l=i.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(i.start-s.start);SS(u,n)}function ft(n,e,t){It(n,e,t),n.addEventListener(e,t)}function It(n,e,t){n.removeEventListener(e,t)}const bk={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},j={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class kf extends aS{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=j.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=ne.bufferInfo(u||l,d,a.maxBufferHole),f=!h.len;if(this.log(`Media seeking to ${W(d)?d.toFixed(3):d}, state: ${c}, ${f?"out of":"in"} buffer`),this.state===j.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,m=o.start-g,v=o.start+o.duration+g;if(f||v<h.start||m>h.end){const p=d>v;(d<m||p)&&(p&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const m=Math.max(h.end,d),v=this.shouldLoadParts(this.getLevelDetails(),m);v&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${f?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,f&&(this.startPosition=d)),f&&this.state===j.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new nk(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Lf(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===j.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=j.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=ne.bufferedInfo(i,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ne.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;ft(r,"seeking",this.onMediaSeeking),ft(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===j.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),It(s,"seeking",this.onMediaSeeking),It(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=j.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const a=i.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(a,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const a=this.state,o=i.frag;if(this.fragContextChanged(o)){(a===j.FRAG_LOADING||!this.fragCurrent&&a===j.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=j.IDLE);return}"payload"in i&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(S.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Ke.APPENDING){const i=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Ke.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(S.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:a}=r,o=i.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&oi(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,bf(o.method)).catch(u=>{throw s.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(u=>{const c=self.performance.now();return s.trigger(S.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==j.STOPPED&&(this.state=j.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?bk.toString(ne.getBuffered(r)):"(detached)"})`),Ue(e)){var s;if(e.type!==Y.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=j.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=j.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,a=!i||i.length===0||i.some(l=>!l),o=new wf(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=j.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(S.KEY_LOADED,h),this.state===j.KEY_LOADING&&(this.state=j.IDLE),h}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ue(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(r=Math.max(e.start,r||0),this.loadingParts&&Ue(e)){const h=a.partList;if(h&&s){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const f=this.getNextPart(h,e,r);if(f>-1){const g=h[f];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${f}/${h.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=j.FRAG_LOADING;let m;return o?m=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(v=>this.handleFragLoadError(v)):m=this.doFragPartsLoad(e,g,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:g,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(h,r))return Promise.resolve(null)}}if(Ue(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),W(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=j.FRAG_LOADING;const c=this.config.progressive&&e.type!==Y.SUBTITLE;let d;return c&&o?d=o.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,s)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,c?s:void 0),o]).then(([h])=>(!c&&s&&s(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,s){return new Promise((i,a)=>{var o;const l=[],u=(o=r.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,s).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(S.FRAG_LOADED,h);const g=Dm(r.details,e.sn,d.index+1)||vS(u,e.sn,d.index+1);if(g)c(g);else return i({frag:e,part:f,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===X.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==j.PARSING){!this.fragCurrent&&this.state!==j.STOPPED&&this.state!==j.ERROR&&(this.state=j.IDLE);return}const{frag:r,part:s,level:i}=t,a=self.performance.now();r.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===Y.SUBTITLE)return!1;const a=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=o.details,u=a>-1?Dm(l,i,a):null,c=u?u.fragment:yS(l,i,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==j.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=Qt(a,o)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:s,offset:c,parent:t.type,data:l};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ne.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=ne.bufferInfo(t,r,0),i=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),o=Math.max(Math.min(e.start-a,s.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!W(s))return null;const a=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,r,s){const i=ne.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(i.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(i.nextStart,a.end)-t,s);return ne.bufferInfo(e,t,o)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=Y.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,a=r[0].start,o=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:f)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Ke.OK||r===Ke.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(o!==null&&r.len+o.len>=i){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Mm(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Mm(this.config)&&e.type!==Y.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let a=i.length;a--;){const o=i[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,s>-1&&r<u.start)break;const c=u.loaded;c?s=-1:(i||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${u.start}`),s=o),i=c}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=H1(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];r.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=rS(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=s,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var f;const m=e<this.lastCurrentTime||e>t-u||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:u;h=Ts(i,a,e,m)}else h=a[a.length-1];if(h){const g=h.sn-r.startSN,m=this.fragmentTracker.getState(h);if((m===Ke.OK||m===Ke.PARTIAL&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!d||c[0].fragment.sn>h.sn||!r.live)&&h.level===i.level){const p=a[g+1];h.sn<o&&this.fragmentTracker.getState(p)!==Ke.OK?h=p:h=null}}return h}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,a=!t,o=e.alignedSliding&&W(i);if(a||!o&&!i){wk(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,a=i?this.startTimeOffset:e.startTimeOffset;a!==null&&W(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ue(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==j.FRAG_LOADING_WAITING_RETRY)&&(this.state=j.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const p=this.getCurrentContext(t.chunkMeta);p&&(t.frag=p.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const a=t.details===N.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction;if(!o){this.state=j.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=o,h=!!d,f=h&&l===nt.RetryRequest,g=h&&!o.resolved&&u===Ct.MoveAllAlternatesMatchingHost,m=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!f&&g&&Ue(s)&&!s.endList&&m&&!iS(t))this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((f||g)&&c<d.maxNumRetry){var v;const p=Wd((v=t.response)==null?void 0:v.code),y=_f(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+y,this.state=j.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,p){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${y}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&l!==nt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===nt.SendAlternateToPenaltyBox?this.state=j.WAITING_LEVEL:this.state=j.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Wd(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=j.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===j.PARSING||this.state===j.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!i;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Y.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==j.STOPPED&&(this.state=j.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=ne.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===j.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==j.STOPPED&&(this.state=j.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=s?0:gS(i,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:i,level:r,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((r.fragmentError===0||l&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=j.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Y.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Mm(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class TS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=Rk(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function Rk(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var pc={exports:{}},Fm;function kk(){return Fm||(Fm=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,d||l,h),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,f,g){var m=t?t+u:u;if(!this._events[m])return!1;var v=this._events[m],p=arguments.length,y,E;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),p){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,h),!0;case 5:return v.fn.call(v.context,c,d,h,f),!0;case 6:return v.fn.call(v.context,c,d,h,f,g),!0}for(E=1,y=new Array(p-1);E<p;E++)y[E-1]=arguments[E];v.fn.apply(v.context,y)}else{var T=v.length,A;for(E=0;E<T;E++)switch(v[E].once&&this.removeListener(u,v[E].fn,void 0,!0),p){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,c);break;case 3:v[E].fn.call(v[E].context,c,d);break;case 4:v[E].fn.call(v[E].context,c,d,h);break;default:if(!y)for(A=1,y=new Array(p-1);A<p;A++)y[A-1]=arguments[A];v[E].fn.apply(v[E].context,y)}}return!0},o.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var f=t?t+u:u;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,f);else{for(var m=0,v=[],p=g.length;m<p;m++)(g[m].fn!==c||h&&!g[m].once||d&&g[m].context!==d)&&v.push(g[m]);v.length?this._events[f]=v.length===1?v[0]:v:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(pc)),pc.exports}var Ck=kk(),Cf=n1(Ck);const Ma="1.6.15",xi={};function Pk(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Dk(){const n=xi[Ma];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return xi[Ma]=s,s}function Nk(n){const e=xi[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return xi[n]=s,s}function Ok(n){const e=xi[n||Ma];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete xi[n||Ma],s&&self.URL.revokeObjectURL(s),r.terminate()}}function IS(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Pf(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Tu(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Fa(n,e){const t=e;let r=0;for(;Pf(n,e);){r+=10;const s=Tu(n,e+6);r+=s,IS(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function Mk(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],a=i>>2&15;if(a>12){const f=new Error(`invalid ADTS sampling index:${a}`);n.emit(S.ERROR,S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,u="mp4a.40."+o,c=s[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return he.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function AS(n,e){return n[e]===255&&(n[e+1]&246)===240}function _S(n,e){return n[e+1]&1?7:9}function Df(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Fk(n,e){return e+5<n.length}function Yl(n,e){return e+1<n.length&&AS(n,e)}function Uk(n,e){return Fk(n,e)&&AS(n,e)&&Df(n,e)<=n.length-e}function Bk(n,e){if(Yl(n,e)){const t=_S(n,e);if(e+t>=n.length)return!1;const r=Df(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||Yl(n,s)}return!1}function LS(n,e,t,r,s){if(!n.samplerate){const i=Mk(e,t,r,s);if(!i)return;ge(n,i)}}function wS(n){return 1024*9e4/n}function $k(n,e){const t=_S(n,e);if(e+t<=n.length){const r=Df(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function bS(n,e,t,r,s){const i=wS(n.samplerate),a=r+s*i,o=$k(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,f=h+d,g=Math.max(0,t+f-e.length);g?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const m={unit:l,pts:a};return g||n.samples.push(m),{sample:m,length:f,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function jk(n,e){return Pf(n,e)&&Tu(n,e+6)+10<=n.length-e}function Gk(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function mc(n,e=0,t=1/0){return Vk(n,e,t,Uint8Array)}function Vk(n,e,t,r){const s=Hk(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const a=Kk(n)?n.byteOffset:0,o=(a+n.byteLength)/i,l=(a+e)/i,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new r(s,u,c-u)}function Hk(n){return n instanceof ArrayBuffer?n:n.buffer}function Kk(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Wk(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Ft(mc(n.data,1,r)),i=n.data[2+r],a=n.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=Ft(mc(n.data,3+r,a));let l;return s==="-->"?l=Ft(mc(n.data,4+r+a)):l=Gk(n.data.subarray(4+r+a)),e.mimeType=s,e.pictureType=i,e.description=o,e.data=l,e}function zk(n){if(n.size<2)return;const e=Ft(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function Yk(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Ft(n.data.subarray(t),!0);t+=r.length+1;const s=Ft(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Ft(n.data.subarray(1));return{key:n.type,info:"",data:e}}function qk(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Ft(n.data.subarray(t),!0);t+=r.length+1;const s=Ft(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Ft(n.data);return{key:n.type,info:"",data:e}}function Xk(n){return n.type==="PRIV"?zk(n):n.type[0]==="W"?qk(n):n.type==="APIC"?Wk(n):Yk(n)}function Qk(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Tu(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Io=10,Jk=10;function RS(n){let e=0;const t=[];for(;Pf(n,e);){const r=Tu(n,e+6);n[e+5]>>6&1&&(e+=Io),e+=Io;const s=e+r;for(;e+Jk<s;){const i=Qk(n.subarray(e)),a=Xk(i);a&&t.push(a),e+=i.size+Io}IS(n,e)&&(e+=Io)}return t}function kS(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function Zk(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Nf(n){const e=RS(n);for(let t=0;t<e.length;t++){const r=e[t];if(kS(r))return Zk(r)}}let Nt=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function wn(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Of{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Qt(this.cachedData,e),this.cachedData=null);let r=Fa(e,0),s=r?r.length:0,i;const a=this._audioTrack,o=this._id3Track,l=r?Nf(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&W(l))&&(this.basePTS=eC(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Nt.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(a,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,i=s):s=u}else jk(e,s)?(r=Fa(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Nt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===u&&i!==u){const c=e.slice(i);this.cachedData?this.cachedData=Qt(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:wn(),id3Track:o,textTrack:wn()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:wn(),id3Track:this._id3Track,textTrack:wn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const eC=(n,e,t)=>{if(W(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Ao=null;const tC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],nC=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],rC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],sC=[0,1,1,4];function CS(n,e,t,r,s){if(t+24>e.length)return;const i=PS(e,t);if(i&&t+i.frameLength<=e.length){const a=i.samplesPerFrame*9e4/i.sampleRate,o=r+s*a,l={unit:e.subarray(t,t+i.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function PS(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=tC[l*14+s-1]*1e3,d=nC[(t===3?0:t===2?1:2)*3+i],h=o===3?1:2,f=rC[t][r],g=sC[r],m=f*8*g,v=Math.floor(f*u/d+a)*g;if(Ao===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ao=E?parseInt(E[1]):0}return!!Ao&&Ao<=87&&r===2&&u>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:v,samplesPerFrame:m}}}function Mf(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function DS(n,e){return e+1<n.length&&Mf(n,e)}function iC(n,e){return Mf(n,e)&&4<=n.length-e}function NS(n,e){if(e+1<n.length&&Mf(n,e)){const r=PS(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||DS(n,i)}return!1}class aC extends Of{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Fa(e,0);let s=(r==null?void 0:r.length)||0;if(NS(e,s))return!1;for(let i=e.length;s<i;s++)if(Bk(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Uk(e,t)}appendFrame(e,t,r){LS(e,this.observer,t,r,e.manifestCodec);const s=bS(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const OS=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=n[e];const o=Math.min(r,8),l=8-o;i[0]=4278190080>>>24+l<<l,s[0]=(a[0]&i[0])>>l,t=t?t<<o|s[0]:s[0],e+=1,r-=o}return t};class oC extends Of{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=MS(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Fa(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Nf(t)!==void 0&&OS(e,r)<16}}function MS(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const o=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,m=[2,1,2,3,3,4,4,5][d]+f,v=e[t+5]>>3,p=e[t+5]&7,y=new Uint8Array([i<<6|v<<1|p>>2,(p&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),E=1536/o*9e4,T=r+s*E,A=e.subarray(t,t+c);return n.config=y,n.channelCount=m,n.samplerate=o,n.samples.push({unit:A,pts:T}),c}class lC extends Of{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Fa(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Nf(t)!==void 0&&OS(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(NS(e,r))return he.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return iC(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return CS(e,t,r,this.basePTS,this.frameIndex)}}const uC=/\/emsg[-/]ID3/i;class cC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=wn("video",1),a=this.audioTrack=wn("audio",1),o=this.txtTrack=wn("text",1);if(this.id3Track=wn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=WE(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;i.id=u,i.timescale=o.timescale=c,i.codec=d,i.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=VE.text,i.sampleDuration=0,i.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return o1(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Qt(this.remainderData,e));const o=g1(r);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=r;const a=this.extractID3Track(s,t);return i.samples=tm(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=tm(e,t),{videoTrack:t,audioTrack:wn(),id3Track:s,textTrack:wn()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=se(e.samples,["emsg"]);s&&s.forEach(i=>{const a=m1(i);if(uC.test(a.schemeIdUri)){const o=Um(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;r.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:Nt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=Um(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Nt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Um(n,e){return W(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class dC{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Lf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Hr.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const a=qE(i.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const a=i[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,s,a),!this.decrypter.isSync()))return}}}}class FS{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const a=i,o=[];let l=0,u,c,d,h=-1,f=0;for(i===-1&&(h=0,f=this.getNALuType(t,0),i=0,l=1);l<s;){if(u=t[l++],!i){i=u?0:1;continue}if(i===1){i=u?0:2;continue}if(!u)i=3;else if(u===1){if(c=l-i-1,h>=0){const g={data:t.subarray(h,c),type:f};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=Qt(g.data,t.subarray(0,c)),g.state=0))}l<s?(d=this.getNALuType(t,l),h=l,f=d,i=0):i=-1}else i=0}if(h>=0&&i>=0){const g={data:t.subarray(h,s),type:f,state:i};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Qt(g.data,t))}return e.naluState=i,o}}class la{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&he.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class hC extends FS{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,d;switch(u.type){case 1:{let m=!1;o=!0;const v=u.data;if(l&&v.length>4){const p=this.readSliceType(v);(p===2||p===4||p===7||p===9)&&(m=!0)}if(m){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=m;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Tf(u.data,1,r.pts,t.samples);break}case 7:{var f,g;o=!0,l=!0;const m=u.data,v=this.readSPS(m);if(!e.sps||e.width!==v.width||e.height!==v.height||((f=e.pixelRatio)==null?void 0:f[0])!==v.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[m];const p=m.subarray(1,4);let y="avc1.";for(let E=0;E<3;E++){let T=p[E].toString(16);T.length<2&&(T="0"+T),y+=T}e.codec=y}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new la(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let a=0;a<e;a++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new la(e);let r=0,s=0,i=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),g=t.skipBits.bind(t),m=t.skipEG.bind(t),v=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);c();const y=c();if(d(5),g(3),c(),v(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const L=h();if(L===3&&g(1),v(),v(),g(1),f())for(l=L!==3?8:12,u=0;u<l;u++)f()&&(u<6?p(16,t):p(64,t))}v();const E=h();if(E===0)h();else if(E===1)for(g(1),m(),m(),o=h(),u=0;u<o;u++)m();v(),g(1);const T=h(),A=h(),w=d(1);w===0&&g(1),g(1),f()&&(r=h(),s=h(),i=h(),a=h());let _=[1,1];if(f()&&f())switch(c()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-r*2-s*2),height:(2-w)*(A+1)*16-(w?2:4)*(i+a),pixelRatio:_}}}class fC extends FS{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Tf(u.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ge(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(u.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in f.params)e.params[g]=f.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(u.data);for(const g in f)e.params[g]=f[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new la(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new la(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=t.readUByte(),p=t.readUByte(),y=[],E=[];for(let ae=0;ae<r;ae++)y.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let ae=r;ae<8;ae++)t.readBits(2);for(let ae=0;ae<r;ae++)y[ae]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[ae]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const A=t.readUEG(),w=t.readUEG(),_=t.readBoolean();let L=0,b=0,I=0,k=0;_&&(L+=t.readUEG(),b+=t.readUEG(),I+=t.readUEG(),k+=t.readUEG());const H=t.readUEG(),U=t.readUEG(),C=t.readUEG(),F=t.readBoolean();for(let ae=F?0:r;ae<=r;ae++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Te=0;Te<4;Te++)for(let vt=0;vt<(Te===3?2:6);vt++)if(!t.readBoolean())t.readUEG();else{const Rt=Math.min(64,1<<4+(Te<<1));Te>1&&t.readEG();for(let Me=0;Me<Rt;Me++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const R=t.readUEG();let M=0;for(let ae=0;ae<R;ae++){let Te=!1;if(ae!==0&&(Te=t.readBoolean()),Te){ae===R&&t.readUEG(),t.readBoolean(),t.readUEG();let vt=0;for(let en=0;en<=M;en++){const Rt=t.readBoolean();let Me=!1;Rt||(Me=t.readBoolean()),(Rt||Me)&&vt++}M=vt}else{const vt=t.readUEG(),en=t.readUEG();M=vt+en;for(let Rt=0;Rt<vt;Rt++)t.readUEG(),t.readBoolean();for(let Rt=0;Rt<en;Rt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ae=t.readUEG();for(let Te=0;Te<ae;Te++){for(let vt=0;vt<C+4;vt++)t.readBits(1);t.readBits(1)}}let V=0,$=1,Q=1,re=!0,J=1,te=0;t.readBoolean(),t.readBoolean();let Ae=!1;if(t.readBoolean()){if(t.readBoolean()){const Gt=t.readUByte(),Za=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Bn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Gt>0&&Gt<16?($=Za[Gt-1],Q=Bn[Gt-1]):Gt===255&&($=t.readBits(16),Q=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ae=t.readBoolean(),Ae&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(J=t.readBits(32),te=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Bn=t.readBoolean(),Ls=t.readBoolean();let yn=!1;(Bn||Ls)&&(yn=t.readBoolean(),yn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),yn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ri=0;Ri<=r;Ri++){re=t.readBoolean();const ws=re||t.readBoolean();let bs=!1;ws?t.readEG():bs=t.readBoolean();const ki=bs?1:t.readUEG()+1;if(Bn)for(let cr=0;cr<ki;cr++)t.readUEG(),t.readUEG(),yn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ls)for(let cr=0;cr<ki;cr++)t.readUEG(),t.readUEG(),yn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),V=t.readUEG())}let Oe=A,bt=w;if(_){let ae=1,Te=1;T===1?ae=Te=2:T==2&&(ae=2),Oe=A-ae*b-ae*L,bt=w-Te*k-Te*I}const mn=s?["A","B","C"][s]:"",bi=o<<24|l<<16|u<<8|c;let _s=0;for(let ae=0;ae<32;ae++)_s=(_s|(bi>>ae&1)<<31-ae)>>>0;let Zt=_s.toString(16);return a===1&&Zt==="2"&&(Zt="6"),{codecString:`hvc1.${mn}${a}.${Zt}.${i?"H":"L"}${p}.B0`,params:{general_tier_flag:i,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,h,f,g,m,v],general_level_idc:p,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:U,min_spatial_segmentation_idc:V,chroma_format_idc:T,frame_rate:{fixed:re,fps:te/J}},width:Oe,height:bt,pixelRatio:[$,Q]}}readPPS(e){const t=new la(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let a=1;return i&&s?a=0:i?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Xe=188;class Sr{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=Sr.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Xe*5,t-Xe)+1,s=0;for(;s<r;){let i=!1,a=-1,o=0;for(let l=s;l<t;l+=Xe)if(e[l]===71&&(t-l===Xe||e[l+Xe]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+Xe*99,e.length-Xe)+1)),i||(i=Qd(e,l)===0),i&&o>1&&(a===0&&o>2||l+Xe>r))return a}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:VE[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Sr.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Sr.createTrack("audio",s),this._id3Track=Sr.createTrack("id3"),this._txtTrack=Sr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,h=o.pid,f=l.pid,g=o.pesData,m=l.pesData,v=null,p=this.pmtParsed,y=this._pmtId,E=e.length;if(this.remainderData&&(e=Qt(this.remainderData,e),E=e.length,this.remainderData=null),E<Xe&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const T=Math.max(0,Sr.syncOffset(e));E-=(E-T)%Xe,E<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let A=0;for(let _=T;_<E;_+=Xe)if(e[_]===71){const L=!!(e[_+1]&64),b=Qd(e,_),I=(e[_+3]&48)>>4;let k;if(I>1){if(k=_+5+e[_+4],k===_+Xe)continue}else k=_+4;switch(b){case c:L&&(d&&(i=Ns(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(k,_+Xe)),d.size+=_+Xe-k);break;case h:if(L){if(g&&(i=Ns(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(k,_+Xe)),g.size+=_+Xe-k);break;case f:L&&(m&&(i=Ns(m,this.logger))&&this.parseID3PES(l,i),m={data:[],size:0}),m&&(m.data.push(e.subarray(k,_+Xe)),m.size+=_+Xe-k);break;case 0:L&&(k+=e[k]+1),y=this._pmtId=gC(e,k);break;case y:{L&&(k+=e[k]+1);const H=pC(e,k,this.typeSupported,r,this.observer,this.logger);c=H.videoPid,c>0&&(a.pid=c,a.segmentCodec=H.segmentVideoCodec),h=H.audioPid,h>0&&(o.pid=h,o.segmentCodec=H.segmentAudioCodec),f=H.id3Pid,f>0&&(l.pid=f),v!==null&&!p&&(this.logger.warn(`MPEG-TS PMT found at ${_} after unknown PID '${v}'. Backtracking to sync byte @${T} to parse all TS packets.`),v=null,_=T-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=b;break}}else A++;A>0&&Jd(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=m;const w={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,a=r.pesData,o=t.pesData,l=s.pesData;let u;if(a&&(u=Ns(a,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,u,!0),r.pesData=null)):r.pesData=a,o&&(u=Ns(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=Ns(l,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new dC(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new hC:e==="hevc"&&(this.videoParser=new fC))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,h=s.sample.unit.byteLength;if(d===-1)i=Qt(s.sample.unit,i);else{const f=h-d;s.sample.unit.set(i.subarray(0,d),f),e.samples.push(s.sample),r=s.missing}}let a,o;for(a=r,o=i.length;a<o-1&&!Yl(i,a);a++);if(a!==r){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",Jd(this.observer,new Error(d),h,this.logger),!h)return}LS(e,this.observer,i,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=wS(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=bS(e,i,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!Yl(i,a);a++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(DS(r,a)){const l=CS(e,r,a,o,i);if(l)a+=l.length,i++;else break}else a++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let a=0,o=0,l;for(;o<i&&(l=MS(e,r,o,s,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=ge({},t,{type:this._videoTrack?Nt.emsg:Nt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Qd(n,e){return((n[e+1]&31)<<8)+n[e+2]}function gC(n,e){return(n[e+10]&31)<<8|n[e+11]}function pC(n,e,t,r,s,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=Qd(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){yc("ADTS AAC",i);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!r){yc("H.264",i);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!r){yc("AC-3",i);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(n[h]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const m=n[h+1]+2;h+=m,f-=m}}break;case 194:case 135:return Jd(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return a}function Jd(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(S.ERROR,S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function yc(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Ns(n,e){let t=0,r,s,i,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Qt(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const c=r[7];c&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),i=r[8];let d=i+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let f=0,g=l.length;f<g;f++){r=l[f];let m=r.byteLength;if(d)if(d>m){d-=m;continue}else r=r.subarray(d),m-=d,d=0;h.set(r,t),t+=m}return s&&(s-=i+3),{data:h,pts:a,dts:o,len:s}}return null}class mC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const gr=Math.pow(2,32)-1;class D{static init(){D.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in D.types)D.types.hasOwnProperty(e)&&(D.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=i,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,a,l,a,o),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),s=0,r=8;s<i;s++)a.set(t[s],r),r+=t[s].byteLength;return a}static hdlr(e){return D.box(D.types.hdlr,D.HDLR_TYPES[e])}static mdat(e){return D.box(D.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(gr+1)),s=Math.floor(t%(gr+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return D.box(D.types.mdia,D.mdhd(e.timescale||0,e.duration||0),D.hdlr(e.type),D.minf(e))}static mfhd(e){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(e)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(e))}static moof(e,t,r){return D.box(D.types.moof,D.mfhd(e),D.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=D.trak(e[t]);return D.box.apply(null,[D.types.moov,D.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(D.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=D.trex(e[t]);return D.box.apply(null,[D.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(gr+1)),s=Math.floor(t%(gr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return D.box(D.types.sdtp,r)}static stbl(e){return D.box(D.types.stbl,D.stsd(e),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))}static avc1(e){let t=[],r=[],s,i,a;for(s=0;s<e.sps.length;s++)i=e.sps[s],a=i.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],a=i.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(i));const o=D.box(D.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return D.box(D.types.mp4a,D.audioStsd(e),D.box(D.types.esds,D.esds(e)))}static mp3(e){return D.box(D.types[".mp3"],D.audioStsd(e))}static ac3(e){return D.box(D.types["ac-3"],D.audioStsd(e),D.box(D.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return D.box(D.types.stsd,D.STSD,D.mp4a(e));if(t==="ac3"&&e.config)return D.box(D.types.stsd,D.STSD,D.ac3(e));if(t==="mp3"&&e.codec==="mp3")return D.box(D.types.stsd,D.STSD,D.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return D.box(D.types.stsd,D.STSD,D.avc1(e));if(t==="hevc"&&e.vps)return D.box(D.types.stsd,D.STSD,D.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,a=Math.floor(r/(gr+1)),o=Math.floor(r%(gr+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=D.sdtp(e),s=e.id,i=Math.floor(t/(gr+1)),a=Math.floor(t%(gr+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255])),D.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,D.box(D.types.trak,D.tkhd(e),D.mdia(e))}static trex(e){const t=e.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,a=new Uint8Array(i);let o,l,u,c,d,h;for(t+=8+i,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=r[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return D.box(D.types.trun,a)}static initSegment(e){D.types||D.init();const t=D.moov(e);return Qt(D.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=i.length;for(let g=0;g<r.length;g+=1){a+=3;for(let m=0;m<r[g].length;m+=1)a+=2+r[g][m].length}const o=new Uint8Array(a);o.set(i,0),a=i.length;const l=r.length-1;for(let g=0;g<r.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,r[g].length]),a),a+=3;for(let m=0;m<r[g].length;m+=1)o.set(new Uint8Array([r[g][m].length>>8,r[g][m].length&255]),a),a+=2,o.set(r[g][m],a),a+=r[g][m].length}const u=D.box(D.types.hvcC,o),c=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return D.box(D.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}D.types=void 0;D.HDLR_TYPES=void 0;D.STTS=void 0;D.STSC=void 0;D.STCO=void 0;D.STSZ=void 0;D.VMHD=void 0;D.SMHD=void 0;D.STSD=void 0;D.FTYP=void 0;D.DINF=void 0;const US=9e4;function Ff(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function yC(n,e,t=1,r=!1){return Ff(n,e,1/t,r)}function ji(n,e=!1){return Ff(n,1e3,1/US,e)}function vC(n,e=1){return Ff(n,US,1/e)}function Bm(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const EC=10*1e3,SC=1024,xC=1152,TC=1536;let Os=null,vc=null;function $m(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Zo extends Jt{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Os===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Os=a?parseInt(a[1]):0}if(vc===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);vc=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Bm(t)} > ${e&&Bm(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,a)=>{let o=a.pts,l=o-i;return l<-4294967296&&(t=!0,o=Pt(o,r),l=o-i),l>0?i:o},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,a,o,l){let u,c,d,h,f,g,m=i,v=i;const p=e.pid>-1,y=t.pid>-1,E=t.samples.length,T=e.samples.length>0,A=o&&E>0||E>1;if((!p||T)&&(!y||A)||this.ISGenerated||o){if(this.ISGenerated){var _,L,b,I;const C=this.videoTrackConfig;(C&&(t.width!==C.width||t.height!==C.height||((_=t.pixelRatio)==null?void 0:_[0])!==((L=C.pixelRatio)==null?void 0:L[0])||((b=t.pixelRatio)==null?void 0:b[1])!==((I=C.pixelRatio)==null?void 0:I[1]))||!C&&A||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,a));const k=this.isVideoContiguous;let H=-1,U;if(A&&(H=IC(t.samples),!k&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,H>0){this.warn(`Dropped ${H} out of ${E} video samples due to a missing keyframe`);const C=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,v+=(t.samples[0].pts-C)/t.inputTimeScale,U=v}else H===-1&&(this.warn(`No keyframe found out of ${E} video samples`),g=!1);if(this.ISGenerated){if(T&&A){const C=this.getVideoStartPts(t.samples),B=(Pt(e.samples[0].pts,C)-C)/t.inputTimeScale;m+=Math.max(0,B),v+=Math.max(0,-B)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,a)),c=this.remuxAudio(e,m,this.isAudioContiguous,a,y||A||l===Y.AUDIO?v:void 0),A){const C=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,a)),u=this.remuxVideo(t,v,k,C)}}else A&&(u=this.remuxVideo(t,v,k,0));u&&(u.firstKeyFrame=H,u.independent=H!==-1,u.firstKeyFramePTS=U)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=BS(r,i,this._initPTS,this._initDTS)),s.samples.length&&(h=$S(s,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:f}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let a=Pt(e,i);if(a<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-a)/t} ${s}`);a<i+t;)a+=8589934592;return a-i}generateIS(e,t,r,s){const i=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||s,d="audio/mp4",h,f,g,m=-1;if(c&&(h=f=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):D.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.id,g=e.inputTimeScale,!u||g!==u.timescale?h=f=this.computeInitPts(i[0].pts,g,r,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:D.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const v=this.getVideoStartPts(a),p=Pt(a[0].dts,v),y=this.computeInitPts(p,g,r,"video"),E=this.computeInitPts(v,g,r,"video");f=Math.min(f,y),h=Math.min(h,E)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${h/g} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${h/g} (${h}/${g}) trackId: ${m}`),this._initPTS={baseTime:h,timescale:g,trackId:m},this._initDTS={baseTime:f,timescale:g,trackId:m}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:m}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS,c=u.baseTime*i/u.timescale;let d=this.nextVideoTs,h=8,f=this.videoSampleDuration,g,m,v=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=!1;if(!r||d===null){const V=c+t*i,$=a[0].pts-Pt(a[0].dts,a[0].pts);Os&&d!==null&&Math.abs(V-$-(d+c))<15e3?r=!0:d=V-$-c}const E=d+c;for(let V=0;V<l;V++){const $=a[V];$.pts=Pt($.pts,E),$.dts=Pt($.dts,E),$.dts<a[V>0?V-1:V].dts&&(y=!0)}y&&a.sort(function(V,$){const Q=V.dts-$.dts,re=V.pts-$.pts;return Q||re}),g=a[0].dts,m=a[a.length-1].dts;const T=m-g,A=T?Math.round(T/(l-1)):f||e.inputTimeScale/30;if(r){const V=g-E,$=V>A,Q=V<-1;if(($||Q)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(V,!0)} ms (${V}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ji(-V,!0)} ms (${V}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Q||E>=a[0].pts||Os)){g=E;const re=a[0].pts-V;if($)a[0].dts=g,a[0].pts=re;else{let J=!0;for(let te=0;te<a.length&&!(a[te].dts>re&&J);te++){const Ae=a[te].pts;if(a[te].dts-=V,a[te].pts-=V,te<a.length-1){const Be=a[te+1].pts,Oe=a[te].pts,bt=Be<=Oe,mn=Be<=Ae;J=bt==mn}}}this.log(`Video: Initial PTS/DTS adjusted: ${ji(re,!0)}/${ji(g,!0)}, delta: ${ji(V,!0)} ms`)}}g=Math.max(0,g);let w=0,_=0,L=g;for(let V=0;V<l;V++){const $=a[V],Q=$.units,re=Q.length;let J=0;for(let te=0;te<re;te++)J+=Q[te].data.length;_+=J,w+=re,$.length=J,$.dts<L?($.dts=L,L+=A/4|0||1):L=$.dts,v=Math.min($.pts,v),p=Math.max($.pts,p)}m=a[l-1].dts;const b=_+4*w+8;let I;try{I=new Uint8Array(b)}catch(V){this.observer.emit(S.ERROR,S.ERROR,{type:X.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:b,reason:`fail allocating video mdat ${b}`});return}const k=new DataView(I.buffer);k.setUint32(0,b),I.set(D.types.mdat,4);let H=!1,U=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let V=0;V<l;V++){const $=a[V],Q=$.units;let re=0;for(let Ae=0,Be=Q.length;Ae<Be;Ae++){const Oe=Q[Ae],bt=Oe.data,mn=Oe.data.byteLength;k.setUint32(h,mn),h+=4,I.set(bt,h),h+=mn,re+=4+mn}let J;if(V<l-1)f=a[V+1].dts-$.dts,J=a[V+1].pts-$.pts;else{const Ae=this.config,Be=V>0?$.dts-a[V-1].dts:A;if(J=V>0?$.pts-a[V-1].pts:A,Ae.stretchShortVideoTrack&&this.nextAudioTs!==null){const Oe=Math.floor(Ae.maxBufferHole*i),bt=(s?v+s*i:this.nextAudioTs+c)-$.pts;bt>Oe?(f=bt-Be,f<0?f=Be:H=!0,this.log(`It is approximately ${bt/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=Be}else f=Be}const te=Math.round($.pts-$.dts);U=Math.min(U,f),F=Math.max(F,f),C=Math.min(C,J),B=Math.max(B,J),o.push($m($.key,f,re,te))}if(o.length){if(Os){if(Os<70){const V=o[0].flags;V.dependsOn=2,V.isNonSync=0}}else if(vc&&B-C<F-U&&A/F<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let V=g;for(let $=0,Q=o.length;$<Q;$++){const re=V+o[$].duration,J=V+o[$].cts;if($<Q-1){const te=re+o[$+1].cts;o[$].duration=te-J}else o[$].duration=$?o[$-1].duration:A;o[$].cts=0,V=re}}}f=H||!f?A:f;const O=m+f;this.nextVideoTs=d=O-c,this.videoSampleDuration=f,this.isVideoContiguous=!0;const G={data1:D.moof(e.sequenceNumber++,g,ge(e,{samples:o})),data2:I,startPTS:(v-c)/i,endPTS:(p+f-c)/i,startDTS:(g-c)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,G}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return xC;case"ac3":return TC;default:return SC}}remuxAudio(e,t,r,s,i){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=i!==void 0;let m=e.samples,v=h?0:8,p=this.nextAudioTs||-1;const y=d.baseTime*a/d.timescale,E=y+t*a;if(this.isAudioContiguous=r=r||m.length&&p>0&&(s&&Math.abs(E-(p+y))<9e3||Math.abs(Pt(m[0].pts,E)-(p+y))<20*c),m.forEach(function(B){B.pts=Pt(B.pts,E)}),!r||p<0){const B=m.length;if(m=m.filter(O=>O.pts>=0),B!==m.length&&this.warn(`Removed ${m.length-B} of ${B} samples (initPTS ${y} / ${a})`),!m.length)return;i===0?p=0:s&&!g?p=Math.max(0,E-y):p=m[0].pts-y}if(e.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let O=0,R=p+y;O<m.length;O++){const M=m[O],G=M.pts,V=G-R,$=Math.abs(1e3*V/a);if(V<=-B*c&&g)O===0&&(this.warn(`Audio frame @ ${(G/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*V/a)} ms.`),this.nextAudioTs=p=G-y,R=G);else if(V>=B*c&&$<EC&&g){let Q=Math.round(V/c);for(R=G-Q*c;R<0&&Q&&c;)Q--,R+=c;O===0&&(this.nextAudioTs=p=R-y),this.warn(`Injecting ${Q} audio frames @ ${((R-y)/a).toFixed(3)}s due to ${Math.round(1e3*V/a)} ms gap.`);for(let re=0;re<Q;re++){let J=mC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);J||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),J=M.unit.subarray()),m.splice(O,0,{unit:J,pts:R}),R+=c,O++}}M.pts=R,R+=c}}let T=null,A=null,w,_=0,L=m.length;for(;L--;)_+=m[L].unit.byteLength;for(let B=0,O=m.length;B<O;B++){const R=m[B],M=R.unit;let G=R.pts;if(A!==null){const $=f[B-1];$.duration=Math.round((G-A)/l)}else if(r&&e.segmentCodec==="aac"&&(G=p+y),T=G,_>0){_+=v;try{w=new Uint8Array(_)}catch($){this.observer.emit(S.ERROR,S.ERROR,{type:X.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:_,reason:`fail allocating audio mdat ${_}`});return}h||(new DataView(w.buffer).setUint32(0,_),w.set(D.types.mdat,4))}else return;w.set(M,v);const V=M.byteLength;v+=V,f.push($m(!0,u,V,0)),A=G}const b=f.length;if(!b)return;const I=f[f.length-1];p=A-y,this.nextAudioTs=p+l*I.duration;const k=h?new Uint8Array(0):D.moof(e.sequenceNumber++,T/l,ge({},e,{samples:f}));e.samples=[];const H=(T-y)/a,U=this.nextAudioTs/a,F={data1:k,data2:w,startPTS:H,endPTS:U,startDTS:H,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,F}}function Pt(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function IC(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function BS(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let o=0;o<s;o++){const l=n.samples[o];l.pts=Pt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=Pt(l.dts-r.baseTime*i/r.timescale,e*i)/i}const a=n.samples;return n.samples=[],{samples:a}}function $S(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let a=0;a<r;a++){const o=n.samples[a];o.pts=Pt(o.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((a,o)=>a.pts-o.pts);const i=n.samples;return n.samples=[],{samples:i}}class AC extends Jt{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:a}=this.initData=WE(e);if(t)d1(e,t);else{const l=i||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(r=jm(i,me.AUDIO,this)),a&&(s=jm(a,me.VIDEO,this));const o={};i&&a?o.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:i?o.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,s,i,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};W(c)||(c=this.lastEndTime=i||0);const h=t.samples;if(!h.length)return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=f1(h,g,this),v=g.audio?m[g.audio.id]:null,p=g.video?m[g.video.id]:null,y=_o(p,1/0),E=_o(v,1/0),T=_o(p,0,!0),A=_o(v,0,!0);let w=i,_=0;const L=v&&(!p||!u&&E<y||u&&u.trackId===g.audio.id),b=L?v:p;if(b){const R=b.timescale,M=b.start-i*R,G=L?g.audio.id:g.video.id;w=b.start/R,_=L?A-E:T-y,(a||!u)&&(_C(u,w,i,_)||R!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${M/R} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${w-i} (${M}/${R}) trackId: ${G}`),u=null,f.initPTS=M,f.timescale=R,f.trackId=G)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);u?(f.initPTS=u.baseTime,f.timescale=u.timescale,f.trackId=u.trackId):((!f.timescale||f.trackId===void 0||f.initPTS===void 0)&&(this.warn("Could not set initPTS"),f.initPTS=w,f.timescale=1,f.trackId=-1),this.initPTS=u={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const I=w-u.baseTime/u.timescale,k=I+_;_>0?this.lastEndTime=k:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!g.audio,U=!!g.video;let C="";H&&(C+="audio"),U&&(C+="video");const F=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),B={data1:h,startPTS:I,startDTS:I,endPTS:k,endDTS:k,type:C,hasAudio:H,hasVideo:U,nb:1,dropped:0,encrypted:F};d.audio=H&&!U?B:void 0,d.video=U?B:void 0;const O=p==null?void 0:p.sampleCount;if(O){const R=p.keyFrameIndex,M=R!==-1;B.nb=O,B.dropped=R===0||this.isVideoContiguous?0:M?R:O,B.independent=M,B.firstKeyFrame=R,M&&p.keyFrameStart&&(B.firstKeyFramePTS=(p.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=M),this.isVideoContiguous||(this.isVideoContiguous=M),B.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${R}/${O} dropped: ${B.dropped} start: ${B.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=BS(r,i,u,u),s.samples.length&&(d.text=$S(s,i,u)),d}}function _o(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function _C(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function jm(n,e,t){const r=n.codec;return r&&r.length>4?r:e===me.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?$l(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let Hn;try{Hn=self.performance.now.bind(self.performance)}catch{Hn=Date.now}const el=[{demux:cC,remux:AC},{demux:Sr,remux:Zo},{demux:aC,remux:Zo},{demux:lC,remux:Zo}];el.splice(2,0,{demux:oC,remux:Zo});class Gm{constructor(e,t,r,s,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=Hn();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:g}=s||o,{audioCodec:m,videoCodec:v,defaultInitPts:p,duration:y,initSegmentData:E}=l,T=LC(a,t);if(T&&oi(T.method)){const L=this.getDecrypter(),b=bf(T.method);if(L.isSync()){let I=L.softwareDecrypt(a,T.key.buffer,T.iv.buffer,b);if(r.part>-1){const H=L.flush();I=H&&H.buffer}if(!I)return i.executeEnd=Hn(),Ec(r);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer,b).then(I=>{const k=this.push(I,null,r);return this.decryptionPromise=null,k}),this.decryptionPromise}const A=this.needsProbing(c,d);if(A){const L=this.configureTransmuxer(a);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),i.executeEnd=Hn(),Ec(r)}(c||d||g||A)&&this.resetInitSegment(E,m,v,y,t),(c||g||A)&&this.resetInitialTimestamp(p),u||this.resetContiguity();const w=this.transmux(a,T,f,h,r);this.asyncResult=Ua(w);const _=this.currentTransmuxState;return _.contiguous=!0,_.discontinuity=!1,_.trackSwitch=!1,i.executeEnd=Hn(),w}flush(e){const t=e.transmuxing;t.executeStart=Hn();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const a=[],{timeOffset:o}=s;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Hn();const d=[Ec(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return Ua(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Y.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(s,i,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Hn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,s),o.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,s,i):a=this.transmuxUnencrypted(e,r,s,i),a}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,o,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let d=0,h=el.length;d<h;d++){var a;if((a=el[d].demux)!=null&&a.probe(e,this.logger)){i=el[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=i.remux,c=i.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,s,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(r,t,s,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Lf(this.config)),e}}function LC(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ec=n=>({remuxResult:{},chunkMeta:n});function Ua(n){return"then"in n&&n.then instanceof Function}class wC{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class bC{constructor(e,t,r,s,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=a}}let Vm=0;class jS{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Vm++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===S.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Cf,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const o=sm(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||Pk()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=Nk(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Dk());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:ye(i)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Gm(this.observer,o,i,"",t,e.logger)}return}}this.transmuxer=new Gm(this.observer,o,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Vm++;const t=this.hls.config,r=sm(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:ye(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Ok(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,a,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:g}=this,m=a?a.start:i.start,v=i.decryptdata,p=this.frag,y=!(p&&i.cc===p.cc),E=!(p&&u.level===p.level),T=p?u.sn-p.sn:-1,A=this.part?u.part-this.part.index:-1,w=T===0&&u.id>1&&u.id===(p==null?void 0:p.stats.chunkCount),_=!E&&(T===1||T===0&&(A===1||w&&A<=0)),L=self.performance.now();(E||T||i.stats.parsing.start===0)&&(i.stats.parsing.start=L),a&&(A||!_)&&(a.stats.parsing.start=L);const b=!(p&&((d=i.initSegment)==null?void 0:d.url)===((h=p.initSegment)==null?void 0:h.url)),I=new bC(y,_,l,E,m,b);if(!_||y||b){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===Y.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${y}
        trackSwitch: ${E}
        contiguous: ${_}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${b}`);const k=new wC(r,s,t,o,c);this.configureTransmuxer(k)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:I},e instanceof ArrayBuffer?[e]:[]);else if(g){const k=g.push(e,v,u,I);Ua(k)?k.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(k)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);Ua(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Hm=100;class RC extends kf{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Y.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:a}){if(r===Y.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:i,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${s/i} (${s}/${i}) trackId: ${a}`),this.mainAnchor=t,this.state===j.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===j.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=rS(a,i,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===j.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=j.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(Hm),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=j.IDLE):this.state=j.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case j.IDLE:this.doTickIdle();break;case j.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=j.WAITING_INIT_PTS}break}case j.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case j.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=j.FRAG_LOADING;const o=s.flush().buffer,l={frag:t,part:r,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=j.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[i]))return;const o=r[i],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=j.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,me.AUDIO,Y.AUDIO));const c=this.getFwdBufferInfo(u,Y.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=j.ENDED;return}const d=c.len,h=t.maxBufferLength,f=l.fragments,g=f[0].start,m=this.getLoadPosition(),v=this.flushing?m:c.end;if(this.switchingTrack&&s){const E=m;l.PTSKnown&&E<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&v<f[f.length-1].start)return;let p=this.getNextFragment(v,l);if(p&&this.isLoopLoading(p,v)&&(p=this.getNextFragmentLoopLoading(p,l,c,Y.MAIN,h)),!p){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Ue(p)&&!p.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===Ke.OK&&(this.mainFragLoading=y=null),y&&Ue(y))){if(p.start>y.end){const T=this.fragmentTracker.getFragAtPos(v,Y.MAIN);T&&T.end>y.end&&(y=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(p.start>y.end)return}this.loadFragment(p,o,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Oa(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==j.STOPPED&&(this.setInterval(Hm),this.state=j.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:a,groupId:o,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||i.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==j.STOPPED&&(this.state=j.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=s[a];let d=0;if(i.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(i,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}i.alignedSliding||(xS(i,u),i.alignedSliding||zl(i,u),d=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.state===j.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=j.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new jS(this.hls,Y.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(f!==void 0){const v=s?s.index:-1,p=v!==-1,y=new wf(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,p);h.push(i,g,d,"",r,s,c.totalduration,!1,y,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new TS,complete:!1};m.push(new Uint8Array(i)),this.state!==j.STOPPED&&(this.state=j.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Y.MAIN&&Ue(t.frag)&&(this.mainFragLoading=t,this.state===j.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==Y.AUDIO){!this.audioOnly&&r.type===Y.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ue(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,de({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=j.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Y.AUDIO,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===j.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ie.AUDIO_TRACK&&(this.state=j.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==me.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==me.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===j.ENDED&&(this.state=j.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Y.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:f,id3:g,initSegment:m}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=j.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(m,l))return;this._bufferInitSegment(c,m.tracks,v,a),s.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:m.tracks})}if(h){const{startPTS:v,endPTS:p,startDTS:y,endDTS:E}=h;u&&(u.elementaryStreams[me.AUDIO]={startPTS:v,endPTS:p,startDTS:y,endDTS:E}),l.setElementaryStreamInfo(me.AUDIO,v,p,y,E),this.bufferFragmentData(h,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const v=ge({id:r,frag:l,details:d},g);s.trigger(S.FRAG_PARSING_METADATA,v)}if(f){const v=ge({id:r,frag:l,details:d},f);s.trigger(S.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,s){if(this.state!==j.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=Y.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&a.split(",").length===1&&(i.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,t);const o=i.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:o};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Ke.NOT_LOADED||s===Ke.PARTIAL){var i;if(!Ue(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=j.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&zl(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o}=this.bufferedTrack;fs({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o},e,as)||(Gl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,de({},e))}}class Uf extends Jt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let a=0;a<s.length;a++){const o=s[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){i=a;break}else l===e.substring(0,l.length)&&(i=a)}if(i!==-1){const a=s[i],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&im(r);return new am(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,a=self.performance.now(),o=i.loading.first?Math.max(0,a-i.loading.first):0;s.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const c=Math.max(l||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(s.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){xk(r,s,this);const y=s.playlistParsingError;if(y){this.warn(y);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=t;E.trigger(S.ERROR,{type:X.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:y,reason:y.message,level:t.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:T,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(s.edge-h)*1e3,g=mS(s,f);if(s.requestScheduled+g<a?s.requestScheduled=a:s.requestScheduled+=g,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let m,v,p;if(s.canBlockReload&&s.endSN&&s.advanced){const y=this.hls.config.lowLatencyMode,E=s.lastPartSn,T=s.endSN,A=s.lastPartIndex,w=A!==-1,_=E===T;w?_?(v=T+1,p=y?0:A):(v=E,p=y?A+1:s.maxPartIndex):v=T+1;const L=s.age,b=L+s.ageHeader;let I=Math.min(b-s.partTarget,s.targetduration*1.5);if(I>0){if(b>s.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,p=void 0;else if(r!=null&&r.tuneInGoal&&b-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${I} with playlist age: ${s.age}`),I=0;else{const k=Math.floor(I/s.targetduration);if(v+=k,p!==void 0){const H=Math.round(I%s.targetduration/s.partTarget);p+=H}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${I} skip sn ${k} to part ${p}`)}s.tuneInGoal=I}if(m=this.getDeliveryDirectives(s,t.deliveryDirectives,v,p),y||!_){s.requestScheduled=a,this.loadingPlaylist(c,m);return}}else(s.canBlockReload||s.canSkipUntil)&&(m=this.getDeliveryDirectives(s,t.deliveryDirectives,v,p));m&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,m,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),a=s.requestScheduled;if(i>=a){this.loadingPlaylist(e,t);return}const o=a-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,s){let i=im(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Qo.No),new am(r,s,i)}checkRetry(e){const t=e.details,r=Vl(e),s=e.errorAction,{action:i,retryCount:a=0,retryConfig:o}=s||{},l=!!s&&!!o&&(i===nt.RetryRequest||!s.resolved&&i===nt.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=_f(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function GS(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Ba(n[t].attrs,e[t].attrs))return!1;return!0}function Ba(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function Zd(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class kC extends Uf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!r||r.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!i&&l){const h=Cn(l,o,as);if(h>-1)i=o[h];else{const f=Cn(l,this.tracks);i=this.tracks[f]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===ie.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&fs(e,s,as))return s;const i=Cn(e,this.tracksInGroup,as);if(i>-1){const a=this.tracksInGroup[i];return this.setAudioTrack(i),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=G1(e,t.levels,r,a,as);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Cn(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,de({},s)),i))return;const a=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||fs(e,s,as)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(fs({name:r,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l},c,as))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Ba(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Ba(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Gl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class CC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const Km=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,VS="HlsJsTrackRemovedError";class PC extends Error{constructor(e){super(e),this.name=VS}}class DC extends Jt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=t1(Vr(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const a=this.isQueued();(i||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?ge(r,s.tracks):this.sourceBuffers.forEach(i=>{const[a]=i;a&&(r[a]=ge({},this.tracks[a]),this.removeBuffer(a)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Vr(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),i)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,Wm(r),NC(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,a=i?i.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ye(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${ye(s,(l,u)=>l==="initSegment"?void 0:u)}}`),!BE(s,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,i.forEach(l=>{const u=l,c=s[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,f=c.id;if(h.hasFragments(f)||h.hasParts(f)){const v=ne.getBuffered(d);h.detectEvictedFragments(u,v,f,null,!0)}const g=Sc(u),m=[u,d];this.sourceBuffers[g]=m,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:a}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=i.readyState==="open";try{const l=i.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),i.removeSourceBuffer(l[u]);o&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&Wm(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Sc(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new CC(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var u,c;const d=t[l],{id:h,codec:f,levelCodec:g,container:m,metadata:v,supplemental:p}=d;let y=s[l];const E=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],T=E!=null&&E.buffer?E:y,A=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),w=T==null?void 0:T.levelCodec;y||(y=s[l]={buffer:void 0,listeners:[],codec:f,supplemental:p,container:m,levelCodec:g,metadata:v,id:h});const _=Xo(A,w),L=_==null?void 0:_.replace(Km,"$1");let b=Xo(f,g);const I=(c=b)==null?void 0:c.replace(Km,"$1");b&&_&&L!==I&&(l.slice(0,5)==="audio"&&(b=$l(b,this.appendSource)),this.log(`switching codec ${A} to ${b}`),b!==(y.pendingCodec||y.codec)&&(y.pendingCodec=b),y.container=m,this.appendChangeType(l,m,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),o.changeType(s),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,Y.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&ne.isBuffered(l.buffer,s)||((o=this.fragmentTracker.getAppendedFrag(s,Y.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:a,frag:o,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[i],{sn:h,cc:f}=o,g=self.performance.now();d.start=g;const m=o.stats.buffering,v=l?l.stats.buffering:null;m.start===0&&(m.start=g),v&&v.start===0&&(v.start=g);const p=r.audio;let y=!1;i==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const E=r.video,T=E==null?void 0:E.buffer;if(T&&h!=="initSegment"){const _=l||o,L=this.blockedAudioAppend;if(i==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const I=_.start+_.duration*.05,k=T.buffered,H=this.currentOp("video");!k.length&&!H?this.blockAudio(_):!H&&!ne.isBuffered(T,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(_)}else if(i==="video"){const b=_.end;if(L){const I=L.frag.start;(b>I||b<this.lastVideoAppendEnd||ne.isBuffered(T,I))&&this.unblockAudio()}this.lastVideoAppendEnd=b}}const A=(l||o).start,w={label:`append-${i}`,execute:()=>{var _;d.executeStart=self.performance.now();const L=(_=this.tracks[i])==null?void 0:_.buffer;L&&(y?this.updateTimestampOffset(L,A,.1,i,h,f):c!==void 0&&W(c)&&this.updateTimestampOffset(L,c,1e-6,i,h,f)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const _=self.performance.now();d.executeEnd=d.end=_,m.first===0&&(m.first=_),v&&v.first===0&&(v.first=_);const L={};this.sourceBuffers.forEach(([b,I])=>{b&&(L[b]=ne.getBuffered(I))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:i,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:L})},onError:_=>{var L;const b={type:X.MEDIA_ERROR,parent:o.type,details:N.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:o,part:l,chunkMeta:u,error:_,err:_,fatal:!1},I=(L=this.media)==null?void 0:L.error;if(_.code===DOMException.QUOTA_EXCEEDED_ERR||_.name=="QuotaExceededError"||"quota"in _)b.details=N.BUFFER_FULL_ERROR;else if(_.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)b.errorAction=ai(!0);else if(_.name===VS&&this.sourceBufferCount===0)b.errorAction=ai(!0);else{const k=++this.appendErrors[i];this.warn(`Failed ${k}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${I||"no media error"})`),(k>=this.hls.config.appendErrorMaxRetry||I)&&(b.fatal=!0)}this.hls.trigger(S.ERROR,b)}};this.log(`queuing "${i}" append sn: ${h}${l?" p: "+l.index:""} of ${o.type===Y.MAIN?"level":"track"} ${o.level} cc: ${f}`),this.append(w,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,i),a)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],a=s?s.elementaryStreams:r.elementaryStreams;a[me.AUDIOVIDEO]?i.push("audiovideo"):(a[me.AUDIO]&&i.push("audio"),a[me.VIDEO]&&i.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:r.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:r,part:s,stats:u,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===N.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;W(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,a=t.levelTargetDuration,o=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(W(o)&&o>=0){const u=Math.max(o,a),c=Math.floor(i/a)*a-u;this.flushBackBuffer(i,a,c)}const l=s.frontBufferFlushThreshold;if(W(l)&&l>0){const u=Math.max(s.maxBufferLength,l),c=Math.max(u,a),d=Math.floor(i/a)*a+c;this.flushFrontBuffer(i,a,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=ne.getBuffered(i);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=ne.getBuffered(i),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return W(i)?{duration:i}:null;const a=this.media.duration,o=W(r.duration)?r.duration:0;return s>o&&s>a||!W(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(W(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ye(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${ye(o)}`);try{const c=r.addSourceBuffer(u),d=Sc(a),h=[a,c];t[d]=h,o.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Da(r,"video")&&(s=I1(s,r));const i=Xo(s,e.levelCodec);return i?t.slice(0,5)==="audio"?$l(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,a){const o=t-e.timestampOffset;Math.abs(o)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!s||!i||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=W(s.duration)?s.duration:1/0,u=W(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new PC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const a=r.bind(this,e);s.listeners.push({event:t,listener:a}),i.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function Wm(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function NC(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Sc(n){return n==="audio"?1:0}class Bf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&W(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Bf.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let i=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&s(l,e[o+1])){i=o;break}}return i}}const OC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Et=OC,MC={HLS:"h"},FC=MC;class Mn{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Mn?r:new Mn(r))),this.value=e,this.params=t}}const UC="Dict";function BC(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function $C(n,e,t,r){return new Error(`failed to ${n} "${BC(e)}" as ${t}`,{cause:r})}function Fn(n,e,t){return $C("serialize",n,e,t)}class HS{constructor(e){this.description=e}}const zm="Bare Item",jC="Boolean";function GC(n){if(typeof n!="boolean")throw Fn(n,jC);return n?"?1":"?0"}function VC(n){return btoa(String.fromCharCode(...n))}const HC="Byte Sequence";function KC(n){if(ArrayBuffer.isView(n)===!1)throw Fn(n,HC);return`:${VC(n)}:`}const WC="Integer";function zC(n){return n<-999999999999999||999999999999999<n}function KS(n){if(zC(n))throw Fn(n,WC);return n.toString()}function YC(n){return`@${KS(n.getTime()/1e3)}`}function WS(n,e){if(n<0)return-WS(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const qC="Decimal";function XC(n){const e=WS(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Fn(n,qC);const t=e.toString();return t.includes(".")?t:`${t}.0`}const QC="String",JC=/[\x00-\x1f\x7f]+/;function ZC(n){if(JC.test(n))throw Fn(n,QC);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function eP(n){return n.description||n.toString().slice(7,-1)}const tP="Token";function Ym(n){const e=eP(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Fn(e,tP);return e}function eh(n){switch(typeof n){case"number":if(!W(n))throw Fn(n,zm);return Number.isInteger(n)?KS(n):XC(n);case"string":return ZC(n);case"symbol":return Ym(n);case"boolean":return GC(n);case"object":if(n instanceof Date)return YC(n);if(n instanceof Uint8Array)return KC(n);if(n instanceof HS)return Ym(n);default:throw Fn(n,zm)}}const nP="Key";function th(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Fn(n,nP);return n}function $f(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${th(e)}`:`;${th(e)}=${eh(t)}`).join("")}function zS(n){return n instanceof Mn?`${eh(n.value)}${$f(n.params)}`:eh(n)}function rP(n){return`(${n.value.map(zS).join(" ")})${$f(n.params)}`}function sP(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Fn(n,UC);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Mn||(i=new Mn(i));let a=th(s);return i.value===!0?a+=$f(i.params):(a+="=",Array.isArray(i.value)?a+=rP(i):a+=zS(i)),a}).join(`,${r}`)}function YS(n,e){return sP(n,e)}const xn="CMCD-Object",De="CMCD-Request",ts="CMCD-Session",pr="CMCD-Status",iP={br:xn,ab:xn,d:xn,ot:xn,tb:xn,tpb:xn,lb:xn,tab:xn,lab:xn,url:xn,pb:De,bl:De,tbl:De,dl:De,ltc:De,mtp:De,nor:De,nrr:De,rc:De,sn:De,sta:De,su:De,ttfb:De,ttfbb:De,ttlb:De,cmsdd:De,cmsds:De,smrt:De,df:De,cs:De,ts:De,cid:ts,pr:ts,sf:ts,sid:ts,st:ts,v:ts,msd:ts,bs:pr,bsd:pr,cdn:pr,rtp:pr,bg:pr,pt:pr,ec:pr,e:pr},aP={REQUEST:De};function oP(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function lP(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?oP(e):{};return r.reduce((i,a)=>{var o;const l=iP[a]||s[a]||aP.REQUEST,u=(o=i[l])!==null&&o!==void 0?o:i[l]={};return u[a]=n[a],i},t)}function uP(n){return["ot","sf","st","e","sta"].includes(n)}function cP(n){return typeof n=="number"?W(n):n!=null&&n!==""&&n!==!1}const qS="event";function dP(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const tl=n=>Math.round(n),nh=(n,e)=>Array.isArray(n)?n.map(t=>nh(t,e)):n instanceof Mn&&typeof n.value=="string"?new Mn(nh(n.value,e),n.params):(e.baseUrl&&(n=dP(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Lo=n=>tl(n/100)*100,hP=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Mn&&typeof n.value=="string"?t=new Mn([n]):typeof n=="string"&&(t=[n])),nh(t,e)},fP={br:tl,d:tl,bl:Lo,dl:Lo,mtp:Lo,nor:hP,rtp:Lo,tb:tl},XS="request",QS="response",jf=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],gP=["e"],pP=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Iu(n){return pP.test(n)}function mP(n){return jf.includes(n)||gP.includes(n)||Iu(n)}const JS=["d","dl","nor","ot","rtp","su"];function yP(n){return jf.includes(n)||JS.includes(n)||Iu(n)}const vP=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function EP(n){return jf.includes(n)||JS.includes(n)||vP.includes(n)||Iu(n)}const SP=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function xP(n){return SP.includes(n)||Iu(n)}const TP={[QS]:EP,[qS]:mP,[XS]:yP};function ZS(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||XS,i=r===1?xP:TP[s];let a=Object.keys(n).filter(i);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=s===QS||s===qS;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const u=ge({},fP,e.formatters),c={version:r,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let h=n[d];const f=u[d];if(typeof f=="function"&&(h=f(h,c)),d==="v"){if(r===1)return;h=r}d=="pr"&&h===1||(l&&d==="ts"&&!W(h)&&(h=Date.now()),cP(h)&&(uP(d)&&typeof h=="string"&&(h=new HS(h)),t[d]=h))}),t}function IP(n,e={}){const t={};if(!n)return t;const r=ZS(n,e),s=lP(r,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[a,o])=>{const l=YS(o,{whitespace:!1});return l&&(i[a]=l),i},t)}function AP(n,e,t){return ge(n,IP(e,t))}const _P="CMCD";function LP(n,e={}){return n?YS(ZS(n,e),{whitespace:!1}):""}function wP(n,e={}){if(!n)return"";const t=LP(n,e);return encodeURIComponent(t)}function bP(n,e={}){if(!n)return"";const t=wP(n,e);return`${_P}=${t}`}const qm=/CMCD=[^&#]+/;function RP(n,e,t){const r=bP(e,t);if(!r)return n;if(qm.test(n))return n.replace(qm,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class kP{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Et.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:a}=s,o=this.hls.levels[i.level],l=this.getObjectType(i),u={d:(a||i).duration*1e3,ot:l};(l===Et.VIDEO||l===Et.AUDIO||l==Et.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(i);c!=null&&c.url&&c.url!==i.url&&(u.nor=c.url),this.apply(s,u)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:FC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ge(t,this.createData());const r=t.ot===Et.INIT||t.ot===Et.VIDEO||t.ot===Et.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,o)=>(s.includes(o)&&(a[o]=t[o]),a),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),AP(e.headers,t,i)):e.url=RP(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:a}=s;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.index===r&&l.fragment.sn===a)return i[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Et.TIMED_TEXT;if(e.sn==="initSegment")return Et.INIT;if(t==="audio")return Et.AUDIO;if(t==="main")return this.hls.audioTracks.length?Et.VIDEO:Et.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===Et.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,a=i>-1?i+1:s.levels.length;r=s.levels.slice(0,a)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Et.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ne.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}}const CP=3e5;class PP extends Jt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===nt.SendAlternateToPenaltyBox&&r.flags===Ct.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&s?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a),t.details===N.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${ye(i)} penalized: ${ye(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>CP&&delete r[i]});for(let i=0;i<e.length;i++){const a=e[i];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,ES(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===ie.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===ie.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new Le(c.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(r[d.AUDIO]=h,d.AUDIO=h),f&&(s[d.SUBTITLES]=f,d.SUBTITLES=f);const g=ex(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Oa({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let v=1;v<c.audioGroups.length;v++)m.addGroupId("audio",`${c.audioGroups[v]}_clone_${a}`);if(c.subtitleGroups)for(let v=1;v<c.subtitleGroups.length;v++)m.addGroupId("text",`${c.subtitleGroups[v]}_clone_${a}`);return m});t.push(...u),Xm(this.audioTracks,r,l,a),Xm(this.subtitleTracks,s,l,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,f)=>{this.log(`Loaded steering manifest: "${s}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":p}=g;if(m)try{this.uri=new self.URL(m,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||h.url),v&&this.clonePathways(v);const y={steeringManifest:g,url:s.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,y),p&&this.updatePathwayPriority(p)},onError:(c,d,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const v=m.getResponseHeader("Retry-After");v&&(g=parseFloat(v)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Xm(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(a=>a.groupId===s).map(a=>{const o=ge({},a);return o.details=void 0,o.attrs=new Le(o.attrs),o.url=o.attrs.URI=ex(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=r,o});n.push(...i)})}function ex(n,e,t,r){const{HOST:s,PARAMS:i,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return s&&!o&&(l.host=s),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}class li extends Jt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=li.CDMCleanupPromise?[li.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=qi(this.config));const o=a.map(hc).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Jo(a);if(r!=="sinf"||o!==be.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}let l;try{const f=Ve(new Uint8Array(s)),g=Rf(JSON.parse(f).sinf),m=YE(g);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(m.subarray(8,24))}catch(f){this.warn(`${i} Failed to parse sinf: ${f}`);return}const u=rt(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[u];for(let f=0;f<d.length;f++){const g=d[f],m=g.decryptdata;if(!m.keyId)continue;const v=rt(m.keyId);if(Kl(l,m.keyId)||m.uri.replace(/-/g,"").indexOf(u)!==-1){if(h=c[v],!h)continue;if(m.pssh)break;delete c[v],m.pssh=new Uint8Array(s),m.keyId=l,h=c[u]=h.then(()=>this.generateRequestWithPreferredKeySession(g,r,s,"encrypted-event-key-match")),h.catch(p=>this.handleError(p));break}}h||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===be.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,s=t.map(a=>a.audioCodec).filter(r),i=t.map(a=>a.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,i).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof kt?o(d):o(new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return dS===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=hk(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(s=a)==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ye(i)}`),o=this.requestMediaKeySystemAccess(e,i);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${rt(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=wo(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${rt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>hc(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=hc(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=qi(this.config),r=e.map(Jo).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=DP(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=wo(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const o=Qm(s||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=o,o}return a.catch(o=>{if(o instanceof kt){const l=de({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new kt(l,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof kt){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${rt(r.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=wo(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=Jo(e.keyFormat),i=s?[s]:qi(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=qi(this.config)),e.length===0)throw new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ye({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const a=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(a)try{const g=a.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const o=wo(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${r.byteLength})`);const u=new Cf,c=e._onmessage=g=>{const m=e.mediaKeysSession;if(!m){u.emit("error",new Error("invalid state"));return}const{messageType:v,message:p}=g;this.log(`"${v}" message event for session "${m.sessionId}" message size: ${p.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,p).catch(y=>{u.eventNames().length?u.emit("error",y):this.handleError(y)}):v==="license-release"?e.keySystem===be.FAIRPLAY&&this.updateKeySession(e,Yd("acknowledged")).then(()=>this.removeSession(e)).catch(y=>this.handleError(y)):this.warn(`unhandled media key message type "${v}"`)},d=(g,m)=>{m.keyStatus=g;let v;g.startsWith("usable")?u.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?v=Qm(g,m.decryptdata):g==="expired"?v=new Error(`key expired (keyId: ${o})`):g==="released"?v=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${o})`),v&&(u.eventNames().length?u.emit("error",v):this.handleError(v))},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(T=>v[T]!=="status-pending"))return;if(v[o]==="expired"){this.log(`Expired key ${ye(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let y=v[o];if(y)d(y,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[o]||(E[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const A=this.getKeyStatus(e.decryptdata);if(A&&A!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${A} from other session.`),d(A,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),y="internal-error",d(y,e)},1e3)),this.log(`No status for keyId ${o} (${ye(v)}).`)}};ft(e.mediaKeysSession,"message",c),ft(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((g,m)=>{u.on("error",m),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(g=>{throw new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>f).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const o=s;s=r,r=o}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===be.PLAYREADY&&i.length===16){const o=rt(i);t[o]=r,uS(i)}const a=rt(i);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{a(h.data)},onError:(h,f,g,m)=>{o(new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:de({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${i}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,g)=>{o(new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(h,f,g)=>{o(new Error("aborted"))}};s.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(a=>{i(new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let d=0,h=i.length;d<h;d++){var a,o;c=i[d];const f=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;f&&g&&e.setRequestHeader(f,g)}}const l=s.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Yd(atob(u))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}s(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)i(new kt({type:X.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==be.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,ft(r,"encrypted",this.onMediaEncrypted),ft(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(It(e,"encrypted",this.onMediaEncrypted),It(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,$r.clearKeyUriToKeyIdMap();const i=s.length;li.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${rt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(gk(o)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}li.CDMCleanupPromise=void 0;function wo(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return rt(n.keyId)}function DP(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class kt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Qm(n,e){const t=n==="output-restricted",r=t?N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new kt({type:X.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class NP{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/i,u=this.hls;if(u.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function tx(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function nx(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){he.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){he.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function qs(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function rh(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=MP(n.cues,e,t);for(let a=0;a<i.length;a++)(!r||r(i[a]))&&n.removeCue(i[a])}s==="disabled"&&(n.mode=s)}function OP(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function MP(n,e,t){const r=[],s=OP(n,e);if(s>-1)for(let i=s,a=n.length;i<a;i++){const o=n[i];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function nl(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class FP extends Uf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=nl(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;nl(r.textTracks).forEach(a=>{qs(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!i&&o){this.selectDefaultTrack=!1;const c=Cn(o,a);if(c>-1)i=a[c];else{const d=Cn(o,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||fs(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(Ba(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(Ba(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(Zd(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ie.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&fs(e,r))return r;const s=Cn(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=Cn(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=nl(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>Zd(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!W(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=s;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(d)}}function UP(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function ua(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const ui=.025;let ql=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function BP(n,e,t){return`${n.identifier}-${t+1}-${ua(e)}`}class $P{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return xc(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=xc(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=W(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return xc(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ui))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?ql.Range:ql.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return jP(this)}}function xc(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<ui)?e.start:e.start+e.duration}function rx(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Tc(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function jP(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ms(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class GP{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const a=()=>{this.hasDetails=!0};i.once(S.LEVEL_LOADED,a),i.once(S.AUDIO_TRACK_LOADED,a),i.once(S.SUBTITLE_TRACK_LOADED,a),i.on(S.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(S.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,i.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=rx(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=ne.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ne.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ms(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Jm=.033;class VP extends Jt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const a=r[i];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,a=this.parseDateRanges(s,{url:r.url},t),o=Object.keys(s),l=i?i.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,f=c.cue.pre,g=c.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!f&&!h&&!g){const m=u.startTime,v=c.startTime;if(m!==v)return m-v}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,a=this.parseSchedule(s,e);(r||t.length||(i==null?void 0:i.length)!==a.length||a.some((l,u)=>Math.abs(l.playout.start-i[u].playout.start)>.005||Math.abs(l.playout.end-i[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let a=0;a<i.length;a++){const o=i[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new $P(l,t),this.eventMap[o]=u,r===!1&&(u.appendInPlace=r)),s.push(u)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,f=c.cue.post,g=e[d-1]||null,m=c.appendInPlace,v=f?i:c.startOffset,p=c.duration,y=c.timelineOccupancy===ql.Range?p:0,E=c.resumptionOffset,T=(g==null?void 0:g.startTime)===v,A=v+c.cumulativeDuration;let w=m?A+p:v+E;if(h||!f&&v<=0){const L=u;u+=y,c.timelineStart=A;const b=a;a+=p,r.push({event:c,start:A,end:w,playout:{start:b,end:a},integrated:{start:L,end:u}})}else if(v<=i){if(!T){const I=v-l;if(I>Jm){const k=l,H=u;u+=I;const U=a;a+=I;const C={previousEvent:e[d-1]||null,nextEvent:c,start:k,end:k+I,playout:{start:U,end:a},integrated:{start:H,end:u}};r.push(C)}else I>0&&g&&(g.cumulativeDuration+=I,r[r.length-1].end=v)}f&&(w=A),c.timelineStart=A;const L=u;u+=y;const b=a;a+=p,r.push({event:c,start:A,end:w,playout:{start:b,end:a},integrated:{start:L,end:u}})}else return;const _=c.resumeTime;f||_>i?l=i:l=_}),l<i){var o;const c=l,d=u,h=i-l;u+=h;const f=a;a+=h,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:f,end:a},integrated:{start:d,end:u}})}this.setDurations(i,a,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?s:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=i:(i=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=Ts(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Jm&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=W(o.resumeOffset)?o.resumeOffset:o.duration;i+=f})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>ui?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${l}`),!1;const u=Ts(null,o.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-r)<ui+c||Math.abs(u.end-r)<ui+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+r;o.startOffset=r,o.timelineStart=l,s||(s=o.duration===null),i||(i=!!o.error);const u=o.error?0:o.duration||0;r+=u}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function rn(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class HP{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=rx(r,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,h,r);this.hls.trigger(S.ERROR,f);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,a=i.loader,o=new a(i),l={responseType:"json",url:s.href},u=i.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const v=h.data,p=v==null?void 0:v.ASSETS;if(!Array.isArray(p)){const y=this.assignAssetListError(e,N.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,f,m);this.hls.trigger(S.ERROR,y);return}e.assetListResponse=v,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:m})},onError:(h,f,g,m)=>{const v=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,m,g);this.hls.trigger(S.ERROR,v)},onTimeout:(h,f,g)=>{const m=this.assignAssetListError(e,N.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,g);this.hls.trigger(S.ERROR,m)}};return o.load(l,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,s,i,a){return e.error=r,{type:X.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:a,stats:i}}}function Zm(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function bo(n,e){return`[${n}] Advancing timeline position to ${e}`}class KP extends Jt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&r<o.start||r>=o.end){var l;const f=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(r);if(g===-1&&(g=f+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${r} (resolving from ${f} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>f){const m=this.schedule.findJumpRestrictedIndex(f+1,g);if(m>f){this.setSchedulePosition(m);return}}this.setSchedulePosition(g);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const f=o.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,f))}return}const c=u.timelineStart,d=u.duration||0;if(a&&r<c||r>=c+d){var h;(h=o.event)!=null&&h.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,u)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const o=this.findItemIndex(s);this.setSchedulePosition(o+1)}const i=this.playingAsset;if(!i)return;const a=i.timelineStart+(i.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const a=this.playingItem,o=i.events||[],l=i.items||[],u=i.durations,c=r.map(m=>m.identifier),d=!!(o.length||c.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(m=>rn(m))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let h=null,f=null;a&&(h=this.updateItem(a,this.timelinePos),this.itemsMatch(a,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(f=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,f)?this.bufferingItem=f:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),r.forEach(m=>{m.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(m=>{if(m.interstitial.appendInPlace){const v=m.assetItem.timelineStart,p=m.timelineOffset-v;if(p)try{m.timelineOffset=v}catch(y){Math.abs(p)>ui&&this.warn(`${y} ("${m.assetId}" ${m.timelineOffset}->${v})`)}}}),d||s){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(h,a),g&&f!==h&&this.trimInPlace(f,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new HP(e),this.schedule=new VP(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){It(e,"play",this.onPlay),It(e,"pause",this.onPause),It(e,"seeking",this.onSeeking),It(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;ft(r,"seeking",this.onSeeking),ft(r,"timeupdate",this.onTimeupdate),ft(r,"play",this.onPlay),ft(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),s=(d,h,f,g,m)=>{if(d){let v=d[h].start;const p=d.event;if(p){if(h==="playout"||p.timelineOccupancy!==ql.Point){const y=r(f);(y==null?void 0:y.interstitial)===p&&(v+=y.assetItem.startOffset+y[m])}}else{const y=g==="bufferedPos"?a():e[g];v+=y-d.start}return v}return 0},i=(d,h)=>{var f;if(d!==0&&h!=="primary"&&(f=e.schedule)!=null&&f.length){var g;const m=e.schedule.findItemIndexAtTime(d),v=(g=e.schedule.items)==null?void 0:g[m];if(v){const p=v[h].start-v.start;return d+p}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h,f;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((f=e.schedule)==null?void 0:f.durations[d])||0},l=(d,h)=>{var f,g;const m=e.effectivePlayingItem;if(m!=null&&(f=m.event)!=null&&f.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const v=e.effectivePlayingItem,p=e.schedule.findItemIndexAtTime(d,h),y=(g=e.schedule.items)==null?void 0:g[p],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,A=T==null?void 0:T.appendInPlace,w=v&&e.itemsMatch(v,y);if(v&&(A||w)){const _=r(e.playingAsset),L=(_==null?void 0:_.media)||e.primaryMedia;if(L){const b=h==="primary"?L.currentTime:s(v,h,e.playingAsset,"timelinePos","currentTime"),I=d-b,k=(A?b:L.currentTime)+I;if(k>=0&&(!_||A||k<=_.duration)){L.currentTime=k;return}}}if(y){let _=d;if(h!=="primary"){const b=y[h].start,I=d-b;_=y.start+I}const L=!e.isInterstitial(y);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(L||y.event.appendInPlace)){const b=e.media||(A?E==null?void 0:E.media:null);b&&(b.currentTime=_)}else if(v){const b=e.findItemIndex(v);if(p>b){const k=e.schedule.findJumpRestrictedIndex(b+1,p);if(k>b){e.setSchedulePosition(k);return}}let I=0;if(L)e.timelinePos=_,e.checkBuffer();else{const k=y.event.assetList,H=d-(y[h]||y).start;for(let U=k.length;U--;){const C=k[U];if(C.duration&&H>=C.startOffset&&H<C.startOffset+C.duration){I=U;break}}}e.setSchedulePosition(p,I)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var f;return s(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((f=e.bufferingAsset)==null?void 0:f.startOffset)||0}return 0},get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?s(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!W(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ye(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(a.media)l&&(i=a.transferMedia(),this.detachedData=i),c="Primary";else if(u){const g=this.getBufferingPlayer();g?(i=g.transferMedia(),c=`${g}`):c="detached MediaSource"}else c="detached media";if(!i){if(u)i=this.detachedData,this.log(`using detachedData: MediaSource ${ye(i)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(m=>{if(o&&m.interstitial.appendInPlace!==l){const v=m.interstitial;this.clearInterstitial(m.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",h=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(h===i&&f){const g=o&&e.assetId===f.assetIdAtEnd;h.overrides={duration:f.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(bo("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(i>=0||!this.primaryLive){const a=this.timelinePos=i>0?i:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=Tc(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,r){const s=Tc(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const a=t+1,o=i.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(bo("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const a=r.findEventIndex(s),o=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,a,o-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&rn(i)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,h=d==null?void 0:d.identifier,f=h?this.getAssetPlayer(h):null;if(f&&h&&(!this.eventItemsMatch(a,i)||t!==void 0&&h!==c.assetList[t].identifier)){var l;const g=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${c.assetList.length} ${Ms(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:g,event:c,schedule:s.slice(0),scheduleIndex:e,player:f}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(h,i),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(a,i)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${rn(a)}`),c.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const g=(u=this.schedule)==null?void 0:u.items;if(i&&g){const m=this.findItemIndex(i);this.advanceSchedule(m,g,t,a,o)}return}}this.advanceSchedule(e,s,t,a,o)}advanceSchedule(e,t,r,s,i){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,h=a.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(r===void 0){r=a.findAssetIndex(c,this.timelinePos);const g=Tc(c,r-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,r);return}r=g}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let h=this.preloadAssets(c,r);if(this.eventItemsMatch(o,d||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${rn(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=c.assetList[r];if(!f){this.advanceAfterAssetEnded(c,e,r||0);return}if(h||(h=this.getAssetPlayer(f.identifier)),h===null||h.destroyed){const g=c.assetList.length;this.warn(`asset ${r+1}/${g} player destroyed ${c}`),h=this.createAssetPlayer(c,f,r),h.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(h,r,t,e,l),this.shouldPlay&&Zm(h.media)}else o?(this.resumePrimary(o,e,s),this.shouldPlay&&Zm(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${rn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(bo("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const a=(i=this.schedule)==null?void 0:i.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${rn(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ne.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(bo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=de(de({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=de(de({},this.altSelection),{},{audio:r});return}const i=de(de({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=de(de({},this.altSelection),{},{subtitles:r});return}const i=de(de({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=lm(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=lm(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const a=this.schedule.findEventIndex(i.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=ne.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${rn(e)} (was ${rn(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=ne.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(i),d=Math.min(c+1,t.length-1),h=t[d];if((l===-1&&i&&e>=i.end||(u=h.event)!=null&&u.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(i)){const f=i.event;if(d-o>1&&f.appendInPlace===!1||f.assetList.length===0&&f.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>o)this.bufferedToItem(h);else{const f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else r&&a&&!this.itemsMatch(a,i)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${rn(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const h=this.getAssetPlayer(c.identifier);h&&(d===u&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,a=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&s){for(let u=t;u<s;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,a){const o={parentIdentifier:e.identifier,identifier:BP(e,a,t),duration:i,startOffset:r,timelineStart:s,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let a=i.videoPreference;const o=s.loadLevelObj||s.levels[s.currentLevel];(a||o)&&(a=ge({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const A=t.duration;A&&T<A&&(c=T)}}const d=t.identifier,h=de(de({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||i.audioPreference,subtitlePreference:u||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=ge({},f,{contentId:ua(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new GP(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[r]=t;let m=!0;const v=T=>{if(T.live){var A;const L=new Error(`Interstitials MUST be VOD assets ${e}`),b={fatal:!0,type:X.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:L},I=((A=this.schedule)==null?void 0:A.findEventIndex(e.identifier))||-1;this.handleAssetItemError(b,e,I,r,L.message);return}const w=T.edge-T.fragmentStart,_=t.duration;(m||_===null||w>_)&&(m=!1,this.log(`Interstitial asset "${d}" duration change ${_} > ${w}`),t.duration=w,this.updateSchedule())};g.on(S.LEVEL_UPDATED,(T,{details:A})=>v(A)),g.on(S.LEVEL_PTS_UPDATED,(T,{details:A})=>v(A)),g.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const p=(T,A)=>{const w=this.getAssetPlayer(d);if(w&&A.tracks){w.off(S.BUFFER_CODECS,p),w.tracks=A.tracks;const _=this.primaryMedia;this.bufferingAsset===w.assetItem&&_&&!w.media&&this.bufferAssetPlayer(w,_)}};g.on(S.BUFFER_CODECS,p);const y=()=>{var T;const A=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${A}`),!A||!this.schedule)return;const w=this.schedule.findEventIndex(e.identifier),_=(T=this.schedule.items)==null?void 0:T[w];this.isInterstitial(_)&&this.advanceAssetBuffering(_,t)};g.on(S.BUFFERED_TO_END,y);const E=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const w=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,w,T)};return g.once(S.MEDIA_ENDED,E(r)),g.once(S.PLAYOUT_LIMIT_REACHED,E(1/0)),g.on(S.ERROR,(T,A)=>{if(!this.schedule)return;const w=this.getAssetPlayer(d);if(A.details===N.BUFFER_STALLED_ERROR){if(w!=null&&w.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${A.error} ${e}`)}),g.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const A=new Error(`Asset player destroyed unexpectedly ${d}`),w={fatal:!0,type:X.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:A};this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),r,A.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ms(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&rn(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Ms(o)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:a}=e,o=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=i.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!BE(d,e.tracks)){const h=new Error(`Asset ${Ms(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:X.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=i.findAssetIndex(a);this.handleAssetItemError(f,i,o,g,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),a=e.assetList[i];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||s-a.timelineStart,u=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${o} ${e} (media.currentTime: ${s})`),l&&(u/r.playbackRate<.5||o.bufferedInPlaceToEnd(r))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===N.BUFFER_STALLED_ERROR)return;const a=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Ms(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=ge({},e,{fatal:!1,errorAction:ai(!0),asset:a,assetListIndex:s,event:t,schedule:c,scheduleIndex:r,player:u});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=this.bufferingAsset,g=new Error(i);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(m=>!m.error))t.error=g;else for(let m=s;m<t.assetList.length;m++)this.resetAssetPlayer(t.assetList[m].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===o?this.advanceAfterAssetEnded(t,r,s):f&&f.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${rn(r)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const a=this.updateItem(r,s);this.itemsMatch(r,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var r,s;const i=t.event,a=i.identifier,o=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(a)))return;const l=i.timelineStart,u=i.duration;let c=0;o.forEach((m,v)=>{const p=parseFloat(m.DURATION);this.createAsset(i,v,c,l+c,p,m.URI),c+=p}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${i}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const f=(s=this.bufferingItem)==null?void 0:s.event;if(h){var g;const m=this.schedule.findEventIndex(a),v=(g=this.schedule.items)==null?void 0:g[m];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){i.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(m)}else if((f==null?void 0:f.identifier)===a){const m=i.assetList[0];if(m){const v=this.getAssetPlayer(m.identifier);if(f.appendInPlace){const p=this.primaryMedia;v&&p&&this.bufferAssetPlayer(v,p)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case N.ASSET_LIST_PARSING_ERROR:case N.ASSET_LIST_LOAD_ERROR:case N.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case N.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const e0=500;class WP extends kf{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Y.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=j.IDLE,this.setInterval(e0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(Ue(r)&&(this.fragPrevious=r),this.state=j.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const o=r.start;for(let u=0;u<i.length;u++)if(o>=i[u].start&&o<=i[u].end){a=i[u];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=i){a.shift();continue}else if(a[o].start<i)a[o].start=i;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,i,Y.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===Y.SUBTITLE&&(t.details===N.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==j.STOPPED&&(this.state=j.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&GS(this.levels,t)){this.levels=t.map(r=>new Oa(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Oa(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Y.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==j.STOPPED&&this.setInterval(e0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:a,id:o}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=i[o];if(o>=i.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(r=l.details)!=null&&r.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(zl(a,d),u=a.fragmentStart):h&&(u=h.start,Xd(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,Xd(a,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=a,this.levelLastLoaded=l,o===s&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===j.IDLE&&(Ts(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&oi(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,bf(s.method)).catch(o=>{throw i.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();i.trigger(S.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=j.IDLE})}}doTick(){if(!this.media){this.state=j.IDLE;return}if(this.state===j.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),a=ne.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:o,len:l}=a,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,f=u.edge;let g=null;const m=this.fragPrevious;if(o<f){const y=s.maxFragLookUpTolerance,E=o>f-y?0:y;g=Ts(m,d,Math.max(d[0].start,o),E),!g&&m&&m.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const v=g.sn-u.startSN,p=d[v-1];if(p&&p.cc===g.cc&&this.fragmentTracker.getState(p)===Ke.NOT_LOADED&&(g=p),this.fragmentTracker.getState(g)===Ke.NOT_LOADED){const y=this.mapToInitFragWhenRequired(g);y&&this.loadFragment(y,r,o)}}}loadFragment(e,t,r){Ue(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new zP(this.tracksBuffered[this.currentTrackId]||[])}}class zP{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const YP={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},sx=n=>String.fromCharCode(YP[n]||n),an=15,jn=100,qP={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},XP={17:2,18:4,21:6,22:8,23:10,19:13,20:15},QP={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},JP={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ZP=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class eD{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;he.log(`${this.time} [${e}] ${r}`)}}}const ns=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class ix{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class tD{constructor(){this.uchar=" ",this.penState=new ix}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class nD{constructor(e){this.chars=[],this.pos=0,this.currPenState=new ix,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<jn;t++)this.chars.push(new tD);this.logger=e}equals(e){for(let t=0;t<jn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<jn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<jn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>jn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=jn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=sx(e);if(this.pos>=jn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<jn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<jn;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ic{constructor(e){this.rows=[],this.currRow=an-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<an;t++)this.rows.push(new nD(e));this.logger=e}reset(){for(let e=0;e<an;e++)this.rows[e].clear();this.currRow=an-1}equals(e){let t=!0;for(let r=0;r<an;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<an;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<an;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ye(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<an;o++)this.rows[o].clear();const i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[i+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,a=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ye(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<an;i++){const a=this.rows[i].getTextString();a&&(s=i+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class t0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ic(r),this.nonDisplayedMemory=new Ic(r),this.lastOutputScreen=new Ic(r),this.currRollUpRow=this.displayedMemory.rows[an-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[an-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+ye(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class n0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=sD(),this.logger=void 0;const s=this.logger=new eD;this.channels=[null,new t0(e,t,s),new t0(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let a=!1,o=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+ns([t[r],t[r+1]])+"] -> ("+ns([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(rD(s,i,l)){Ro(null,null,l),this.logger.log(3,()=>"Repeated command ("+ns([s,i])+") is dropped");continue}Ro(s,i,this.cmdHistory),a=this.parseCmd(s,i),a||(a=this.parseMidrow(s,i)),a||(a=this.parsePAC(s,i)),a||(a=this.parseBackgroundAttributes(s,i))}else Ro(null,null,l);if(!a&&(o=this.parseChars(s,i),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ns([s,i])+" orig: "+ns([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ns([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?qP[e]:QP[e]:r=a===1?XP[e]:JP[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let a;i===17?a=t+80:i===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+sx(a)+"' in channel "+r),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+ns(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const a={};e===16||e===24?(i=Math.floor((t-32)/2),a.background=ZP[i],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ro(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ro(n,e,t){t.a=n,t.b=e}function rD(n,e,t){return t.a===n&&t.b===e}function sD(){return{a:null,b:null}}var Gf=function(){if(Wl!=null&&Wl.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function r(o){return t(n,o)}function s(o){return t(e,o)}function i(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,g=o,m=l,v=u,p=null,y="",E=!0,T="auto",A="start",w=50,_="middle",L=50,b="middle";Object.defineProperty(c,"id",i({},d,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(c,"pauseOnExit",i({},d,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(c,"startTime",i({},d,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},d,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},d,{get:function(){return v},set:function(I){v=""+I,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},d,{get:function(){return p},set:function(I){p=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},d,{get:function(){return y},set:function(I){const k=r(I);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},d,{get:function(){return E},set:function(I){E=!!I,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},d,{get:function(){return T},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},d,{get:function(){return A},set:function(I){const k=s(I);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");A=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},d,{get:function(){return w},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");w=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},d,{get:function(){return _},set:function(I){const k=s(I);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");_=k,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},d,{get:function(){return L},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");L=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},d,{get:function(){return b},set:function(I){const k=s(I);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");b=k,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class iD{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ax(n){function e(r,s,i,a){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class aD{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function ox(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const a=s[i].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const sh=new Gf(0,0,""),ko=sh.align==="middle"?"middle":"center";function oD(n,e,t){const r=n;function s(){const o=ax(n);if(o===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function i(o,l){const u=new aD;ox(o,function(h,f){let g;switch(h){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===f){u.set(h,t[m].region);break}break;case"vertical":u.alt(h,f,["rl","lr"]);break;case"line":g=f.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",ko,"end"]);break;case"position":g=f.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",ko,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,f);break;case"align":u.alt(h,f,["start",ko,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&sh.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",ko);let d=u.get("position","auto");d==="auto"&&sh.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),a(),e.endTime=s(),a(),i(n,e)}function lx(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class lD{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new iD,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,a=0;for(i=lx(i);a<i.length&&i[a]!=="\r"&&i[a]!==`
`;)++a;const o=i.slice(0,a);return i[a]==="\r"&&++a,i[a]===`
`&&++a,t.buffer=i.slice(a),o}function s(i){ox(i,function(a,o){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const o=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Gf(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{oD(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=i.indexOf("-->")!==-1;if(!i||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const uD=/\r\n|\n\r|\n|\r/g,Ac=function(e,t,r=0){return e.slice(r,r+t.length)===t},cD=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!W(t)||!W(r)||!W(s)||!W(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t};function Vf(n,e,t){return ua(n.toString())+ua(e.toString())+ua(t)}const dD=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=i)!=null&&a.new;){var a;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function hD(n,e,t,r,s,i,a){const o=new lD,l=Ft(new Uint8Array(n)).trim().replace(uD,`
`).split(`
`),u=[],c=e?vC(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,g,m=!0;o.oncue=function(v){const p=t[r];let y=t.ccOffset;const E=(h-c)/9e4;if(p!=null&&p.new&&(f!==void 0?y=t.ccOffset=p.start:dD(t,r,E)),E){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}y=E-t.presentationOffset}const T=v.endTime-v.startTime,A=Pt((v.startTime+y-f)*9e4,s*9e4)/9e4;v.startTime=Math.max(A,0),v.endTime=Math.max(A+T,0);const w=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(w)),v.id||(v.id=Vf(v.startTime,v.endTime,w)),v.endTime>0&&u.push(v)},o.onparsingerror=function(v){g=v},o.onflush=function(){if(g){a(g);return}i(u)},l.forEach(v=>{if(m)if(Ac(v,"X-TIMESTAMP-MAP=")){m=!1,v.slice(16).split(",").forEach(p=>{Ac(p,"LOCAL:")?d=p.slice(6):Ac(p,"MPEGTS:")&&(h=parseInt(p.slice(7)))});try{f=cD(d)/1e3}catch(p){g=p}return}else v===""&&(m=!1);o.parse(v+`
`)}),o.flush()}const _c="stpp.ttml.im1t",ux=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,cx=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,fD={left:"start",center:"center",right:"end",start:"start",end:"end"};function r0(n,e,t,r){const s=se(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(o=>Ft(o)),a=yC(e.baseTime,1,e.timescale);try{i.forEach(o=>t(gD(o,a)))}catch(o){r(o)}}function gD(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce((d,h)=>(d[h]=s.getAttribute(`ttp:${h}`)||i[h],d),{}),o=s.getAttribute("xml:space")!=="preserve",l=s0(Lc(s,"styling","style")),u=s0(Lc(s,"layout","region")),c=Lc(s,"body","[begin]");return[].map.call(c,d=>{const h=dx(d,o);if(!h||!d.hasAttribute("begin"))return null;const f=bc(d.getAttribute("begin"),a),g=bc(d.getAttribute("dur"),a);let m=bc(d.getAttribute("end"),a);if(f===null)throw i0(d);if(m===null){if(g===null)throw i0(d);m=f+g}const v=new Gf(f-e,m-e,h);v.id=Vf(v.startTime,v.endTime,v.text);const p=u[d.getAttribute("region")],y=l[d.getAttribute("style")],E=pD(p,y,l),{textAlign:T}=E;if(T){const A=fD[T];A&&(v.lineAlign=A),v.align=T}return ge(v,E),v}).filter(d=>d!==null)}function Lc(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function s0(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function dx(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?dx(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function pD(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),i.reduce((o,l)=>{const u=wc(e,r,l)||wc(n,r,l)||wc(s,r,l);return u&&(o[l]=u),o},{})}function wc(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function i0(n){return new Error(`Could not parse ttml timestamp ${n}`)}function bc(n,e){if(!n)return null;let t=ax(n);return t===null&&(ux.test(n)?t=mD(n,e):cx.test(n)&&(t=yD(n,e))),t}function mD(n,e){const t=ux.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function yD(n,e){const t=cx.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Co{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class vD{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Co(this,"textTrack1"),t=new Co(this,"textTrack2"),r=new Co(this,"textTrack3"),s=new Co(this,"textTrack4");this.cea608Parser1=new n0(1,e,t),this.cea608Parser2=new n0(3,r,s)}addCues(e,t,r,s,i){let a=!1;for(let o=i.length;o--;){const l=i[o],u=ED(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),a=!0,u/(r-t)>.5))return}if(a||i.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,s)}else{const o=this.Cues.newCue(null,t,r,s);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:a}){const{unparsedVttFrags:o}=this;r===Y.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,l):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(a0(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:a}=t[e],o=this.getExistingTrack(i,a);if(o)r[e]=o,qs(r[e]),tx(r[e],s);else{const l=this.createTextTrack("captions",i,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{qs(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)qs(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===_c);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(GS(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?nl(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&a0(o[h],l)){d=o[h],o[h]=null;break}d&&(c=d)}if(c)qs(c);else{const d=hx(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,a=this.captionsProperties[i];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Y.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===Y.SUBTITLE)if(s.byteLength){const i=r.decryptdata,a="stats"in t;if(i==null||!i.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===_c?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;r0(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:a}=this,o=i.length-1;if(!i[r.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?Qt(r.initSegment.data,new Uint8Array(s)).buffer:s;hD(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,s),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>r.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||r0(t,this.initPTS[e.cc],()=>{r.textCodec=_c,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>nx(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Y.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===Y.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const a=s[i].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(s[i].pts,o[0]),this.cea608Parser2.addData(s[i].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!i||i==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>rh(o[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>rh(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const a=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function hx(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function a0(n,e){return!!n&&n.kind===hx(e)&&Zd(e,n)}function ED(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function o0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const SD=/\s/,xD={newCue(n,e,t,r){const s=[];let i,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(i=r.rows[h],o=!0,l=0,u="",!i.isEmpty()){var d;for(let m=0;m<i.chars.length;m++)SD.test(i.chars[m].uchar)&&o?l++:(u+=i.chars[m].uchar,o=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=lx(u.trim()),g=Vf(e,t,f);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new c(e,t,f),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(a))}return n&&s.length&&(s.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),s.forEach(h=>nx(n,h))),s}};function TD(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const ID=/(\d+)-(\d+)\/(\d+)/;class l0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||wD,this.controller=new self.AbortController,this.stats=new xf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=AD(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&W(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Ua(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(f-s.loading.start)),!d.ok){const{status:m,statusText:v}=d;throw new bD(v||"fetch, bad network response",m,d)}s.loading.first=f,s.total=LD(d.headers)||s.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&W(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const m=d[o];m&&(s.loaded=s.total=m);const v={url:g.url,data:d,code:g.status},p=(h=this.callbacks)==null?void 0:h.onProgress;p&&!W(t.highWaterMark)&&p(s,e,d,g),(f=this.callbacks)==null||f.onSuccess(v,s,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const f=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:g},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const a=new TS,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&i(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<s||a.dataLength?(a.push(c),a.dataLength>=s&&i(t,r,a.flush().buffer,e)):i(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function AD(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ge({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function _D(n){const e=ID.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function LD(n){const e=n.get("Content-Range");if(e){const r=_D(e);if(W(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function wD(n,e){return new self.Request(n.url,e)}class bD extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const RD=/^age:\s*[\d.]+\s*$/im;class fx{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=r.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&W(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=m,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const v=(a=this.callbacks)==null?void 0:a.onProgress;v&&v(r,e,g,t);const p={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(p,r,e,t);return}}const d=i.loadPolicy.errorRetry,h=r.retry,f={url:e.url,data:void 0,code:u};if(Hl(d,h,!1,f))this.retry(d);else{var l;he.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Hl(e,t,!0))this.retry(e);else{var r;he.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=_f(e,r.retry),r.retry++,he.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&RD.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const kD={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},CD=de(de({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:fx,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:V1,bufferController:DC,capLevelController:Bf,errorController:Y1,fpsController:NP,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:dS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:kD},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},PD()),{},{subtitleStreamController:WP,subtitleTrackController:FP,timelineController:vD,audioStreamController:RC,audioTrackController:kC,emeController:li,cmcdController:kP,contentSteeringController:PP,interstitialsController:KP});function PD(){return{cueHandler:xD,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function DD(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=ih(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];i.forEach(c=>{const d=`${a}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const f=r[o].default;switch(e[o]={default:f},c){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${ye(e[o])}`)}),de(de({},r),e)}function ih(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(ih):Object.keys(n).reduce((e,t)=>(e[t]=ih(n[t]),e),{}):n}function ND(n,e){const t=n.loader;t!==l0&&t!==fx?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):TD()&&(n.loader=l0,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const rl=2,OD=.1,MD=.05,FD=100;class UD extends aS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(FD),this.mediaSource=t.mediaSource;const r=this.media=t.media;ft(r,"playing",this.onMediaPlaying),ft(r,"waiting",this.onMediaWaiting),ft(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(It(r,"playing",this.onMediaPlaying),It(r,"waiting",this.onMediaWaiting),It(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!ne.getBuffered(a).length){this.nudgeRetry=0;return}const d=ne.bufferInfo(a,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const w=u0(this.hls.inFlightFragments,e),_=d.len>rl,L=!h||w||h-e>rl&&!f.getPartialFragment(e);if(_||L)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const _=Math.max(h,d.start||0)-e,b=!!(g!=null&&g.live)?g.targetduration*2:rl,I=Po(e,f);if(_>0&&(_<=b||I)){a.paused||this._trySkipBufferHole(I);return}}const m=i.detectStallWithCurrentTimeMs,v=self.performance.now(),p=this.waiting;let y=this.stalled;if(y===null)if(p>0&&v-p<m)y=this.stalled=p;else{this.stalled=v;return}const E=v-y;if(!o&&(E>=m||p)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const A=ne.bufferInfo(a,e,i.maxBufferHole);this._tryFixBufferStall(A,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=ne.bufferedInfo(ne.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const a=ne.timeRangesToArray(s),o=ne.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=ne.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=Po(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const f=ne.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:a,media:o}=this,l=(s=this.hls)==null?void 0:s.config;if(!o||!a||!l)return;const u=(i=this.hls)==null?void 0:i.latestLevelDetails,c=Po(r,a);if((c||u!=null&&u.live&&r<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,Y.MAIN),a=r.getFragAtPos(s,Y.MAIN);if(i&&a)return a.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${ye(e)})`);this.warn(a.message),t.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const a=s.currentTime,o=ne.bufferInfo(s,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=i.maxBufferHole,d=o.len>0&&o.len<1&&s.readyState<3,h=l-a;if(h>0&&(c||d)){if(h>i.maxBufferHole){let g=!1;if(a===0){const m=r.getAppendedFrag(0,Y.MAIN);m&&l<m.end&&(g=!0)}if(!g&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||u0(this.hls.inFlightFragments,l))return 0;let v=!1,p=e.end;for(;p<l;){const y=Po(p,r);if(y)p+=y.duration;else{v=!0;break}}if(v)return 0}}const f=Math.max(l+MD,a+OD);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${f}`),this.moved=!0,s.currentTime=f,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${f}`),m={type:X.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?m.part=e:m.frag=e),this.hls.trigger(S.ERROR,m)}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const a=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const o=a+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),r.currentTime=o,t.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${i.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function u0(n,e){const t=c0(n.main);if(t&&t.start<=e)return t;const r=c0(n.audio);return r&&r.start<=e?r:null}function c0(n){if(!n)return null;switch(n.state){case j.IDLE:case j.STOPPED:case j.ENDED:case j.ERROR:return null}return n.frag}function Po(n,e){return e.getAppendedFrag(n,Y.MAIN)||e.getPartialFragment(n)}const BD=.25;function ah(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Rc(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,ye(s?de({type:s},r):r))}return i}const Do=(()=>{const n=ah();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class $D{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&qs(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return tx(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=ah();if(a)for(let o=0;o<i.length;o++){const l=i[o].type;if(l===Nt.emsg&&!r||!s)continue;const u=RS(i[o].data),c=i[o].pts;let d=c+i[o].duration;d>Do&&(d=Do),d-c<=0&&(d=c+BD);for(let f=0;f<u.length;f++){const g=u[f];if(!kS(g)){this.updateId3CueEnds(c,l);const m=Rc(a,c,d,g,l);m&&this.id3Track.addCue(m)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const a=s[i];a.type===t&&a.startTime<e&&a.endTime===Do&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let u;s==="audio"?u=c=>c.type===Nt.audioId3&&l:s==="video"?u=c=>c.type===Nt.emsg&&o:u=c=>c.type===Nt.audioId3&&l||c.type===Nt.emsg&&o,rh(i,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:a}=this.hls.config;if(!i)return;const o=ah();if(r&&s&&!a){const{fragmentStart:m,fragmentEnd:v}=e;let p=this.assetCue;p?(p.startTime=m,p.endTime=v):o&&(p=this.assetCue=Rc(o,m,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),p&&(p.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(p),p.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const m=Object.keys(d).filter(v=>!c.includes(v));for(let v=m.length;v--;){var f;const p=m[v],y=(f=d[p])==null?void 0:f.cues;delete d[p],y&&Object.keys(y).forEach(E=>{const T=y[E];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(c.length===0||!W(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let m=0;m<c.length;m++){const v=c[m],p=u[v],y=p.startTime,E=d[v],T=(E==null?void 0:E.cues)||{};let A=(E==null?void 0:E.durationKnown)||!1,w=Do;const{duration:_,endDate:L}=p;if(L&&_!==null)w=y+_,A=!0;else if(p.endOnNext&&!A){const I=c.reduce((k,H)=>{if(H!==p.id){const U=u[H];if(U.class===p.class&&U.startDate>p.startDate&&(!k||p.startDate<k.startDate))return U}return k},null);I&&(w=I.startTime,A=!0)}const b=Object.keys(p.attr);for(let I=0;I<b.length;I++){const k=b[I];if(!ok(k))continue;const H=T[k];if(H)A&&!(E!=null&&E.durationKnown)?H.endTime=w:Math.abs(H.startTime-y)>.01&&(H.startTime=y,H.endTime=w);else if(o){let U=p.attr[k];lk(k)&&(U=$E(U));const F=Rc(o,y,w,{key:k,data:U},Nt.dateRange);F&&(F.id=v,this.id3Track.addCue(F),T[k]=F,a&&(k==="X-ASSET-LIST"||k==="X-ASSET-URL")&&F.addEventListener("enter",this.onEventCueEnter))}}d[v]={cues:T,dateRange:p,durationKnown:A}}}}}class jD{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:a}=this.config;if(!i||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const l=s-o,u=Math.min(this.maxLatency,o+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:a*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,a=s-r.totalduration,o=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class GD extends Uf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:f}=c;h&&(c.audioCodec=h=$l(h,r)||void 0),f&&(f=c.videoCodec=A1(f));const{width:g,height:m,unknownCodecs:v}=c,p=(v==null?void 0:v.length)||0;if(o||(o=!!(g&&m)),l||(l=!!f),u||(u=!!h),p||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:y,"FRAME-RATE":E,"HDCP-LEVEL":T,"PATHWAY-ID":A,RESOLUTION:w,"VIDEO-RANGE":_}=d,b=`${`${A||"."}-`}${c.bitrate}-${w}-${E}-${y}-${_}-${T}`;if(i[b])if(i[b].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const I=a[b]+=1;c.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const k=this.createLevel(c);i[b]=k,s.push(k)}else i[b].addGroupId("audio",d.AUDIO),i[b].addGroupId("text",d.SUBTITLES);else{const I=this.createLevel(c);i[b]=I,a[b]=1,s.push(I)}}),this.filterAndSortMediaOptions(s,t,o,l,u)}createLevel(e){const t=new Oa(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=JE(s,[])}return t}isAudioSupported(e){return Da(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Da(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var a;let o=[],l=[],u=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((r||s)&&i&&(u=u.filter(({videoCodec:y,videoRange:E,width:T,height:A})=>(!!y||!!(T&&A))&&N1(E))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",E=y;t.levels.length&&(E=`one or more CODECS in variant not supported: ${ye(t.levels.map(A=>A.attrs.CODECS).filter((A,w,_)=>_.indexOf(A)===w))}`,this.warn(E),y+=` (${E})`);const T=new Error(y);this.hls.trigger(S.ERROR,{type:X.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:T,reason:E})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),d0(o)),t.subtitles&&(l=t.subtitles,d0(l));const d=u.slice(0);u.sort((y,E)=>{if(y.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&y.height!==E.height)return y.height-E.height;if(y.frameRate!==E.frameRate)return y.frameRate-E.frameRate;if(y.videoRange!==E.videoRange)return jl.indexOf(y.videoRange)-jl.indexOf(E.videoRange);if(y.videoCodec!==E.videoCodec){const T=nm(y.videoCodec),A=nm(E.videoCodec);if(T!==A)return A-T}if(y.uri===E.uri&&y.codecSet!==E.codecSet){const T=Bl(y.codecSet),A=Bl(E.codecSet);if(T!==A)return A-T}return y.averageBitrate!==E.averageBitrate?y.averageBitrate-E.averageBitrate:0});let h=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let y=0;y<d.length;y++)if(d[y].pathwayId===u[0].pathwayId){h=d[y];break}}this._levels=u;for(let y=0;y<u.length;y++)if(u[y]===h){var f;this._firstLevel=y;const E=h.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${E}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const A=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);A>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=A)}break}const g=i&&!s,m=this.hls.config,v=!!(m.audioStreamController&&m.audioTrackController),p={levels:u,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:v&&!g&&o.some(y=>!!y.url)};c.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,p)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&s&&i===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===ie.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Y.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(i.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));ES(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(S.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function d0(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function gx(){return self.SourceBuffer||self.WebKitSourceBuffer}function px(){if(!Vr())return!1;const e=gx();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function VD(){if(!px())return!1;const n=Vr();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Na(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Na(e,"audio"))))}function HD(){var n;const e=gx();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const KD=100;class WD extends kf{constructor(e,t,r){super(e,t,r,"stream-controller",Y.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!W(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const a=this.getFwdBufferInfoAtPos(s,i,Y.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(KD),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=j.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=j.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case j.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=j.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=j.IDLE;break}break}case j.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===j.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const a=r[i],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(S.BUFFER_EOS,m),this.state=j.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=a.details;if(!u||this.state===j.WAITING_LEVEL||this.waitForLive(a)){this.level=i,this.state=j.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&Ue(f)&&this.fragmentTracker.getState(f)!==Ke.OK){var g;const v=((g=this.backtrackFragment)!=null?g:f).sn-u.startSN,p=u.fragments[v-1];p&&f.cc===p.cc&&(f=p,this.fragmentTracker.removeFragment(p))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const v=this.audioOnly&&!this.altAudio?me.AUDIO:me.VIDEO,p=(v===me.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;p&&this.afterBufferFlushed(p,v,Y.MAIN)}f=this.getNextFragmentLoopLoading(f,u,o,Y.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===Ke.NOT_LOADED||s===Ke.PARTIAL?Ue(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Y.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<i.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case j.KEY_LOADING:case j.FRAG_LOADING:case j.FRAG_LOADING_WAITING_RETRY:case j.PARSING:case j.PARSED:this.state=j.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;ft(r,"playing",this.onMediaPlaying),ft(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(It(r,"playing",this.onMediaPlaying),It(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const a=t.levels[i].audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!HD(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==j.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=j.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,a=t.level,o=t.details,l=o.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===j.FRAG_LOADING||this.state===j.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=u.details)!=null&&r.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=o,this.levelLastLoaded=u,i||this.setStartPosition(o,d),this.hls.trigger(S.LEVEL_UPDATED,{details:o,level:a}),this.state===j.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=j.IDLE}i&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=i>=a-t.maxFragLookUpTolerance&&i<=o;if(s!==null&&r.duration>s&&(i<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||i<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=ne.bufferInfo(r,s,0);if(!((u=d.buffered)!=null&&u.length)){r.currentTime=s;return}if(d.start<=i){r.currentTime=s;return}const{nextStart:f}=ne.bufferedInfo(d.buffered,i,0);f&&(r.currentTime=f)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new jS(this.hls,Y.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,m=g!==-1,v=new wf(r.level,r.sn,r.stats.chunkCount,i.byteLength,g,m),p=this.initPTS[r.cc];f.push(i,d,h,u,r,s,l.totalduration,c,v,p)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio!==0;if(Gl(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),r.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Gl(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(i=o,s=l,o==="video"){const u=r[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===Y.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===j.PARSED&&(this.state=j.IDLE);return}const o=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ue(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const a=this.media;a&&(!this._hasEnoughToStart&&ne.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=j.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Y.MAIN,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===j.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ie.LEVEL&&(this.state=j.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=j.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==me.AUDIO||!this.altAudio){const r=(t===me.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,Y.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),a=ne.getBuffered(e),o=a.length?a.start(0):0,l=o-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=j.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=i.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(S.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a){this.resetWhenMissingContext(i);return}const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:h,initSegment:f}=s,{details:g}=u,m=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=j.PARSING,f){const v=f.tracks;if(v){const T=o.initSegment||o;if(this.unhandledEncryptionError(f,o))return;this._bufferInitSegment(u,v,T,i),r.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:v})}const p=f.initPTS,y=f.timescale,E=this.initPTS[o.cc];if(W(p)&&(!E||E.baseTime!==p||E.timescale!==y)){const T=f.trackId;this.initPTS[o.cc]={baseTime:p,timescale:y,trackId:T},r.trigger(S.INIT_PTS_FOUND,{frag:o,id:t,initPTS:p,timescale:y,trackId:T})}}if(c&&g){m&&c.type==="audiovideo"&&this.logMuxedErr(o);const v=g.fragments[o.sn-1-g.startSN],p=o.sn===g.startSN,y=!v||o.cc>v.cc;if(s.independent!==!1){const{startPTS:E,endPTS:T,startDTS:A,endDTS:w}=c;if(l)l.elementaryStreams[c.type]={startPTS:E,endPTS:T,startDTS:A,endDTS:w};else if(c.firstKeyFrame&&c.independent&&i.id===1&&!y&&(this.couldBacktrack=!0),c.dropped&&c.independent){const _=this.getMainFwdBufferInfo(),L=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,b=c.firstKeyFramePTS?c.firstKeyFramePTS:E;if(!p&&L<b-this.config.maxBufferHole&&!y){this.backtrack(o);return}else y&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,T,o.start,w,!0)}else p&&E-(g.appliedTimelineOffset||0)>rl&&(o.gap=!0);o.setElementaryStreamInfo(c.type,E,T,A,w),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,i,p||y)}else if(p||y)o.gap=!0;else{this.backtrack(o);return}}if(m){const{startPTS:v,endPTS:p,startDTS:y,endDTS:E}=m;l&&(l.elementaryStreams[me.AUDIO]={startPTS:v,endPTS:p,startDTS:y,endDTS:E}),o.setElementaryStreamInfo(me.AUDIO,v,p,y,E),this.bufferFragmentData(m,o,l,i)}if(g&&h!=null&&h.samples.length){const v={id:t,frag:o,details:g,samples:h.samples};r.trigger(S.FRAG_PARSING_METADATA,v)}if(g&&d){const v={id:t,frag:o,details:g,samples:d.samples};r.trigger(S.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${Ue(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==j.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:a,audiovideo:o}=t;if(i){const u=e.audioCodec;let c=Xo(i.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const h=i.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),i.levelCodec=c,i.id=Y.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${i.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Y.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:u,data:d,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Y.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=j.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ne.isBuffered(e,r)?t=this.getAppendedFrag(r):ne.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return W(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(W(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?Ts(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const a=i+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class zD extends Jt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=N.KEY_LOAD_ERROR,r,s,i){return new Vn({type:X.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const a=t[s];if(e.cc<=a.cc&&(!Ue(e)||!Ue(a)||e.sn<a.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Jo(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=qi(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,u))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=kc(i);let l=this.keyIdToKeyInfo[o];if((r=l)!=null&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${i.keyId?" keyId: "+rt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const a=h1(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${rt(o)}`),$r.setKeyIdForUri(e.decryptdata.uri,o)):(o=$r.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${rt(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Ue(t))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(a=>(e.mediaKeySessionContext=a,r))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const{frag:v,keyInfo:p}=g,y=kc(p.decryptdata);if(!v.decryptdata||p!==this.keyIdToKeyInfo[y])return o(this.createKeyLoadError(v,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));p.decryptdata.key=v.decryptdata.key=new Uint8Array(h.data),v.keyLoader=null,p.loader=null,a({frag:v,keyInfo:p})},onError:(h,f,g,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,de({url:l.url,data:void 0},h)))},onTimeout:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};i.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const a=kc(r.decryptdata)||s;delete this.keyIdToKeyInfo[a],i&&i.destroy()}}function kc(n){if(n.keyFormat!==st.FAIRPLAY){const e=n.keyId;if(e)return rt(e)}return n.uri}function h0(n){const{type:e}=n;switch(e){case ie.AUDIO_TRACK:return Y.AUDIO;case ie.SUBTITLE_TRACK:return Y.SUBTITLE;default:return Y.MAIN}}function Cc(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class YD{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,a=new i(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ie.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:ie.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ie.AUDIO_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:ie.SUBTITLE_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[ie.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[ie.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===ie.MANIFEST?i=r.manifestLoadPolicy.default:i=ge({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),W((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ie.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ie.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ie.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;i=ge({},i,{maxTimeToFirstByteMs:Math.min(h,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;c.parsing.start=performance.now(),Pn.isMediaPlaylist(g)||d.type!==ie.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,f):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,a=e.data,o=Cc(e,r),l=Pn.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g}=l;this.variableList=g,c.forEach(y=>{const{unknownCodecs:E}=y;if(E){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:A,videoCodec:w}=y;for(let _=E.length;_--;){const L=E[_];Da(L,"audio",T)?(y.audioCodec=A=A?`${A},${L}`:L,Si.audio[A.substring(0,4)]=2,E.splice(_,1)):Da(L,"video",T)&&(y.videoCodec=w=w?`${w},${L}`:L,Si.video[w.substring(0,4)]=2,E.splice(_,1))}}});const{AUDIO:m=[],SUBTITLES:v,"CLOSED-CAPTIONS":p}=Pn.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Le({}),bitrate:0,url:""})),i.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:v,captions:p,contentSteering:u,url:o,stats:t,networkDetails:s,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,s,i){const a=this.hls,{id:o,level:l,type:u}=r,c=Cc(e,r),d=W(l)?l:W(o)?o:0,h=h0(r),f=Pn.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===ie.MANIFEST){const g={attrs:new Le({}),bitrate:0,details:f,name:"",url:c};f.requestScheduled=t.loading.start+mS(f,0),a.trigger(S.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(S.ERROR,{type:X.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===ie.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let a=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ie.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ie.AUDIO_TRACK||e.type===ie.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=N.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ie.MANIFEST:l=r?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,u=!0;break;case ie.LEVEL:l=r?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,u=!1;break;case ie.AUDIO_TRACK:l=r?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ie.SUBTITLE_TRACK:l=r?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:X.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:i};if(s){const h=(t==null?void 0:t.url)||e.url;d.response=de({url:h,data:void 0},s)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,a){const o=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:h,deliveryDirectives:f}=s,g=Cc(t,s),m=h0(s);let v=typeof s.level=="number"&&m===Y.MAIN?u:void 0;const p=e.playlistParsingError;if(p){if(this.hls.logger.warn(`${p} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(S.ERROR,{type:X.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:p,reason:p.message,response:t,context:s,level:v,parent:m,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(S.ERROR,{type:X.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:t,context:s,level:v,parent:m,networkDetails:i,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ie.MANIFEST:case ie.LEVEL:if(v){if(!c)v=0;else if(c!==o.levels[v]){const y=o.levels.indexOf(c);y>-1&&(v=y)}}o.trigger(S.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:v||0,id:d||0,stats:r,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:l===ie.MANIFEST});break;case ie.AUDIO_TRACK:o.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case ie.SUBTITLE_TRACK:o.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:r,networkDetails:i,deliveryDirectives:f});break}}}class kn{static get version(){return Ma}static isMSESupported(){return px()}static isSupported(){return VD()}static getMediaSource(){return Vr()}static get Events(){return S}static get MetadataSchema(){return Nt}static get ErrorTypes(){return X}static get ErrorDetails(){return N}static get DefaultConfig(){return kn.defaultConfig?kn.defaultConfig:CD}static set DefaultConfig(e){kn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Cf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=e1(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=DD(kn.DefaultConfig,e,t);this.userConfig=e,r.progressive&&ND(r,t);const{abrController:s,bufferController:i,capLevelController:a,errorController:o,fpsController:l}=r,u=new o(this),c=this.abrController=new s(this),d=new q1(this),h=r.interstitialsController,f=h?this.interstitialsController=new h(this,kn):null,g=this.bufferController=new i(this,d),m=this.capLevelController=new a(this),v=new l(this),p=new YD(this),y=r.contentSteeringController,E=y?new y(this):null,T=this.levelController=new GD(this,E),A=new $D(this),w=new zD(this.config,this.logger),_=this.streamController=new WD(this,d,w),L=this.gapController=new UD(this,d);m.setStreamController(_),v.setStreamController(_);const b=[p,T,_];f&&b.splice(1,0,f),E&&b.splice(1,0,E),this.networkControllers=b;const I=[c,g,L,m,v,A,d];this.audioTrackController=this.createController(r.audioTrackController,b);const k=r.audioStreamController;k&&b.push(this.audioStreamController=new k(this,d,w)),this.subtitleTrackController=this.createController(r.subtitleTrackController,b);const H=r.subtitleStreamController;H&&b.push(this.subtititleStreamController=new H(this,d,w)),this.createController(r.timelineController,I),w.emeController=this.emeController=this.createController(r.emeController,I),this.cmcdController=this.createController(r.cmcdController,I),this.latencyController=this.createController(jD,I),this.coreComponents=I,b.push(u);const U=u.onErrorOut;typeof U=="function"&&this.on(S.ERROR,U,u),this.on(S.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===S.ERROR;this.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:X.OTHER_ERROR,details:N.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(S.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=Sf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Y.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Y.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Y.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=UP()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){D1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const a=e[i].attrs["HDCP-LEVEL"];if(a&&a<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=tS(t);return ZE(e,r,navigator.mediaCapabilities)}}kn.defaultConfig=void 0;function Ut(n,e=""){return typeof n=="string"?n:typeof n=="number"?String(n):e}function bn(n){const e=Ut(n).trim();return e?/^https?:\/\//i.test(e)?e:e.startsWith("//")?`https:${e}`:/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(e)?`https://${e}`:"":""}function mx(n){if(!n||typeof n!="string")return"";try{const e=new URL(n),t=e.hostname.toLowerCase();if(t.includes("youtube.com")){if(e.pathname.startsWith("/embed/"))return e.toString();if(e.pathname==="/watch"){const r=e.searchParams.get("v");return r?`https://www.youtube.com/embed/${r}`:""}}if(t==="youtu.be"){const r=e.pathname.replace("/","");return r?`https://www.youtube.com/embed/${r}`:""}return t.includes("ok.ru")||t.includes("dailymotion.com")||t.includes("rumble.com")||t.includes("vidhide")||t.includes("rubyvid")||t.includes("listeamed.net")||t.includes("vidguard")||t.includes("streamwish")||t.includes("filemoon")||t.includes("dood")||t.includes("mixdrop")||t.includes("streamtape")||t.includes("mp4upload")||t.includes("turbovidhls.com")||/^\/e\/[^/]+/i.test(e.pathname)||e.pathname.includes("/embed")||e.pathname.includes("videoembed")?e.toString():""}catch{return""}}function qD(n){const e=Ut(n);return/\.(m3u8|mp4|webm)(\?|$)/i.test(e)}function oh(n,e=new Set,t=0){if(t>8||n==null)return e;if(typeof n=="string"){const r=bn(n);return r&&e.add(r),e}return Array.isArray(n)?(n.forEach(r=>oh(r,e,t+1)),e):(typeof n=="object"&&Object.entries(n).forEach(([r,s])=>{const i=r.toLowerCase();if(typeof s=="string"){const a=bn(s);a&&(i.includes("url")||i.includes("src")||i.includes("file")||i.includes("embed")||i.includes("stream")||i.includes("video")||i.includes("link"))&&e.add(a)}oh(s,e,t+1)}),e)}function XD(...n){const e=n.flat().filter(Boolean),t=new Set,r=[];return e.forEach(s=>{const i=bn(s==null?void 0:s.url);!i||t.has(i)||(t.add(i),r.push({id:s.id||i,name:s.name||"Source",url:i}))}),r}function QD(n){return n.map(t=>t.url).find(t=>/\.(mp4|webm)(\?|$)/i.test(t))||""}function JD(n){const e=(n==null?void 0:n.data)||{},t=["sub","dub","raw"],r={sub:[],dub:[],raw:[]};return t.forEach(s=>{const i=Array.isArray(e==null?void 0:e[s])?e[s]:[];r[s]=i.map((a,o)=>{const l=Ut((a==null?void 0:a.serverName)||(a==null?void 0:a.server_name)||(a==null?void 0:a.serverId)||(a==null?void 0:a.server_id));return l?{id:l,name:Ut((a==null?void 0:a.serverName)||(a==null?void 0:a.server_name)||(a==null?void 0:a.name),`Server ${o+1}`)}:null}).filter(Boolean)}),r}function Xl(n){const e=Ut(n).trim().toLowerCase();return e?e.includes("ok.ru")||e==="ok.ru"||e.includes("okru")?1:e.includes("dailymotion")?2:e.includes("rumble")?3:e==="hd-2"?1:e==="hd-1"?2:e==="hd-3"?3:e.includes("vid")?6:e.includes("mega")?7:50:999}function f0(n){return!Array.isArray(n)||n.length===0?null:[...n].sort((e,t)=>Xl((e==null?void 0:e.name)||(e==null?void 0:e.id))-Xl((t==null?void 0:t.name)||(t==null?void 0:t.id)))[0]||null}function ZD(n){var s;const t=(Array.isArray((s=n==null?void 0:n.data)==null?void 0:s.sources)?n.data.sources:[]).map((i,a)=>{const o=bn(i==null?void 0:i.url);if(!o)return null;const l=Ut(i==null?void 0:i.quality);return{id:`source-${a}-${l||"stream"}`,name:l?`Source ${l}`:`Source ${a+1}`,url:o}}).filter(Boolean),r=Array.from(oh(n)).map((i,a)=>({id:`auto-${a}`,name:`Auto ${a+1}`,url:i}));return XD(t,r)}function eN(n,e,t){var a,o;const r=Ut(e).trim();if(r)return r;const s=Number(t);if(Number.isFinite(s)&&s>0){const l=n.find(u=>Number(u==null?void 0:u.number)===s);if(l!=null&&l.episodeId)return l.episodeId}if(!Array.isArray(n)||n.length===0)return"";const i=[...n].filter(l=>l==null?void 0:l.episodeId).sort((l,u)=>Number((u==null?void 0:u.number)||0)-Number((l==null?void 0:l.number)||0))[0];return i!=null&&i.episodeId?Ut(i.episodeId):Ut(((a=n==null?void 0:n[n.length-1])==null?void 0:a.episodeId)||((o=n==null?void 0:n[0])==null?void 0:o.episodeId))}function tN(n,e=0){const t=Number(n==null?void 0:n.number),r=Ut(n==null?void 0:n.title).trim(),s=e+1,i=Number.isFinite(t)&&t>0?t:s;return r?/^episode\s*\d+/i.test(r)?r:`Episode ${i} - ${r}`:`Episode ${i}`}function nN(n,e){var r,s,i,a;const t=[(r=n==null?void 0:n.trailer)==null?void 0:r.embed_url,(s=n==null?void 0:n.trailer)==null?void 0:s.url,(i=e.find(o=>o.embedUrl))==null?void 0:i.embedUrl,(a=e.find(o=>o.url))==null?void 0:a.url];for(const o of t){const l=mx(o||"");if(l)return l}return""}function rN(n,e){const t=[n,"sub","dub","raw"],r=new Set,s=[];return t.forEach(i=>{const a=Ut(i).toLowerCase();!a||r.has(a)||!Array.isArray(e==null?void 0:e[a])||e[a].length===0||(r.add(a),s.push(a))}),s}function g0(){var ki,cr,Kf,Wf;const n=Ov(),e=Ka(),t=ur(),{user:r,markEpisodeWatched:s,adLink:i}=wt(),a=n.animeId||"",o=n.source||Wn,l=o==="hianime"?Wn:o,u=new URLSearchParams(t.search),c=u.get("ep")||"",d=u.get("epid")||"",h=u.get("slug")||"",[f,g]=P.useState(!0),[m,v]=P.useState(""),[p,y]=P.useState({}),[E,T]=P.useState([]),[A,w]=P.useState([]),[_,L]=P.useState(""),[b,I]=P.useState(null),[k,H]=P.useState({sub:[],dub:[],raw:[]}),[U,C]=P.useState("sub"),[F,B]=P.useState(""),[O,R]=P.useState([]),[M,G]=P.useState(""),[V,$]=P.useState(""),[Q,re]=P.useState(!1),[J,te]=P.useState(!1),[Ae,Be]=P.useState(!0),[Oe,bt]=P.useState(null),mn=P.useRef(""),bi=P.useRef(new Set),_s=P.useRef(null),Zt=P.useRef(null),Ye=P.useMemo(()=>{var z;return!!((z=r==null?void 0:r.premium)!=null&&z.active)},[(ki=r==null?void 0:r.premium)==null?void 0:ki.active]),ae=P.useMemo(()=>!Ye&&!J,[Ye,J]),Te=(k==null?void 0:k[U])||[],vt=P.useMemo(()=>["sub","dub","raw"].filter(z=>Array.isArray(k==null?void 0:k[z])&&k[z].length>0),[k]);P.useEffect(()=>{te(!1),Be(!0)},[a,l,c,d,h]),P.useEffect(()=>{if(!ae)return;const z=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=z}},[ae]),P.useEffect(()=>{let z=!0;return(async()=>{try{g(!0),v("");const[Pe,Ee,Ge]=await Promise.allSettled([ht.getAnimeDetail(a,{source:l,slug:h}),ht.getAnimeEpisodes(a,1,{source:l,slug:h}),ht.getAnimeVideos(a,{source:l,slug:h})]);if(!z)return;const _e=Pe.status==="fulfilled"?FE(Pe.value,"anime"):{},$e=Ee.status==="fulfilled"?UE(Ee.value):[],Qr=Ge.status==="fulfilled"?bR(Ge.value):[];y(_e),w($e),T(Qr);const qe=eN($e,d,c);if(!qe){L(""),H({sub:[],dub:[],raw:[]}),R([]),v("Episode belum tersedia untuk donghua ini.");return}L(qe);const ce=$e.find(Pi=>(Pi==null?void 0:Pi.episodeId)===qe)||null;if(I(Number(ce==null?void 0:ce.number)||null),bt({animeId:(_e==null?void 0:_e.animeId)||a,episodeId:qe,episodeNumber:Number(ce==null?void 0:ce.number)||null,title:(_e==null?void 0:_e.title)||a,episodeTitle:Ut(ce==null?void 0:ce.title),poster:(_e==null?void 0:_e.poster)||"",source:l||Wn,slug:h}),l!==Wn){H({sub:[],dub:[],raw:[]}),B("");return}const Ze=await ht.getEpisodeServers(qe);if(!z)return;const Jr=JD(Ze);H(Jr);const Ci=["sub","dub","raw"].find(Pi=>{var zf;return((zf=Jr[Pi])==null?void 0:zf.length)>0})||"sub";C(Ci);const Au=f0(Jr[Ci]||[]);B((Au==null?void 0:Au.id)||"")}catch(Pe){v(Pe.message||"Gagal memuat halaman watch.")}finally{z&&g(!1)}})(),()=>{z=!1}},[a,l,h,c,d]),P.useEffect(()=>{if(!(Oe!=null&&Oe.animeId))return;const z=`${Oe.animeId}:${Oe.episodeId||Oe.episodeNumber||""}`;!z||mn.current===z||(mn.current=z,s(Oe))},[Oe,s]),P.useEffect(()=>{if(!Te.length){B("");return}if(Ye&&Te.some(Pe=>Pe.id===F))return;const z=f0(Te);B((z==null?void 0:z.id)||Te[0].id)},[Te,F,Ye]),P.useEffect(()=>{let z=!0;return(async()=>{if(l!==Wn||!_||!F){R([]),G(""),$("");return}try{re(!0);const Ee=(Ye?[U]:rN(U,k)).map(qe=>({category:qe,servers:((k==null?void 0:k[qe])||[]).filter(ce=>ce==null?void 0:ce.id).sort((ce,Ze)=>Xl((ce==null?void 0:ce.name)||(ce==null?void 0:ce.id))-Xl((Ze==null?void 0:Ze.name)||(Ze==null?void 0:Ze.id))).map(ce=>ce.id)}));let Ge=[],_e=F,$e=U,Qr=null;for(const qe of Ee){const ce=Ye&&F?[F]:qe.servers;for(const Ze of ce)try{const Jr=await ht.getEpisodeSources({animeEpisodeId:_,server:Ze,category:qe.category}),Ci=ZD(Jr);if(Ci.length>0){Ge=Ci,_e=Ze,$e=qe.category;break}}catch(Jr){Qr=Jr}if(Ge.length>0)break}if(Ge.length>0&&(!Ye&&$e!==U&&C($e),!Ye&&_e!==F&&B(_e),v("")),!z)return;if(!Ge.length)throw Qr||new Error("Tidak ada source valid dari server yang tersedia.");R(Ge),G(qe=>{var ce;return Ge.some(Ze=>Ze.id===qe)?qe:((ce=Ge[0])==null?void 0:ce.id)||""})}catch(Pe){if(!z)return;R([]),G(""),$(""),v(Pe.message||"Gagal memuat source episode.")}finally{z&&re(!1)}})(),()=>{z=!1}},[l,_,F,U,Te,Ye]),P.useEffect(()=>{var Pe,Ee;if(!Ye){$("");return}if(!M){$(((Pe=O[0])==null?void 0:Pe.url)||"");return}const z=O.find(Ge=>Ge.id===M);$((z==null?void 0:z.url)||((Ee=O[0])==null?void 0:Ee.url)||"")},[O,M,Ye]);const en=Ye?V||((cr=O[0])==null?void 0:cr.url)||"":((Kf=O[0])==null?void 0:Kf.url)||"",Rt=QD(O),Me=bn(en||Rt),Gt=qD(Me),Za=nN(p,E),Bn=Gt?"":mx(Me),Ls=Bn||Za,yn=Me||(p==null?void 0:p.url)||((Wf=p==null?void 0:p.trailer)==null?void 0:Wf.url)||(a?`https://anichin.club/${encodeURIComponent(a)}`:""),Ri=bn(i),ws=P.useCallback(z=>{const Pe=bn(z);Pe&&bi.current.add(Pe);const Ee=O.findIndex($e=>bn($e==null?void 0:$e.url)===bn(en)),Ge=Ee>=0?Ee+1:0,_e=O.slice(Ge).find($e=>($e==null?void 0:$e.url)&&!bi.current.has(bn($e.url)));if(!_e){v("Source stream error. Semua source yang tersedia sudah dicoba.");return}v(`Source error, pindah otomatis ke ${_e.name||"source berikutnya"}.`),Ye?G(_e.id):R($e=>{const Qr=$e.findIndex(Ze=>(Ze==null?void 0:Ze.id)===_e.id);if(Qr<=0)return $e;const qe=[...$e],[ce]=qe.splice(Qr,1);return[ce,...qe]})},[en,Ye,O]);P.useEffect(()=>{bi.current.clear()},[_,F,U,O.length]),P.useEffect(()=>{const z=_s.current;if(!z)return;if(Zt.current&&(Zt.current.destroy(),Zt.current=null),!Me||Bn||!Gt){z.removeAttribute("src"),z.load();return}if(!/\.m3u8(\?|$)/i.test(Me)){z.src=Me,z.load();return}if(z.canPlayType("application/vnd.apple.mpegurl")){z.src=Me,z.load();return}if(kn.isSupported()){const Ee=new kn({enableWorker:!0,lowLatencyMode:!0});Ee.on(kn.Events.ERROR,(Ge,_e)=>{_e!=null&&_e.fatal&&ws(Me)}),Zt.current=Ee,Ee.loadSource(Me),Ee.attachMedia(z)}return()=>{Zt.current&&(Zt.current.destroy(),Zt.current=null)}},[Me,Bn,Gt,ws]);const bs=()=>{if(te(!0),!!i)try{window.open(i,"_blank","noopener,noreferrer")}catch{}};return f?x.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:x.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})}):x.jsxs("section",{className:"space-y-4",children:[x.jsx("button",{type:"button",onClick:()=>e(-1),className:"inline-flex rounded-full border border-white/20 bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20",children:"Kembali"}),ae?x.jsx("div",{role:"button",tabIndex:0,onClick:bs,onKeyDown:z=>{(z.key==="Enter"||z.key===" ")&&bs()},className:"fixed inset-0 z-[100] flex h-screen w-screen items-center justify-center bg-black/95 p-4 text-left",children:x.jsxs("div",{className:"mx-auto w-full max-w-4xl overflow-hidden rounded-2xl border border-white/20 bg-zinc-950",children:[Ri&&Ae?x.jsx("img",{src:Ri,alt:"Sponsor",className:"max-h-[72vh] w-full object-contain bg-black",onError:()=>Be(!1)}):x.jsxs("div",{className:"flex min-h-[260px] flex-col items-center justify-center bg-[radial-gradient(circle_at_50%_10%,rgba(239,68,68,.35),transparent_38%),linear-gradient(165deg,#050505,#18181b)] px-6 py-10 text-center",children:[x.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-cyan-200",children:"Sponsored"}),x.jsx("p",{className:"mt-3 font-heading text-3xl font-bold text-white sm:text-4xl",children:"Ketuk Untuk Lanjut Menonton"}),x.jsx("p",{className:"mt-2 text-sm text-zinc-300",children:"Sponsor harus dibuka dulu. Setelah disentuh, player akan otomatis tersedia."}),i?x.jsx("p",{className:"mt-3 line-clamp-1 text-xs text-zinc-400",children:i}):null]}),x.jsx("div",{className:"border-t border-white/10 bg-black/70 px-4 py-3 text-center text-xs text-zinc-300",children:"Sentuh area iklan untuk lanjut menonton."}),x.jsx("div",{className:"border-t border-white/10 bg-black/80 p-3 text-center",children:x.jsx("button",{type:"button",onClick:z=>{z.stopPropagation(),bs()},className:"rounded-xl bg-gradient-to-r from-fuchsia-500 to-cyan-400 px-4 py-2 text-sm font-semibold text-white",children:"Lanjutkan Menonton"})})]})}):null,x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-4",children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:p.title||`Donghua ${a}`}),b?x.jsxs("p",{className:"mt-1 text-sm text-cyan-200",children:["Episode #",b]}):null,x.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Pilih episode, category, dan server, lalu mulai menonton."})]}),m?x.jsx("p",{className:"rounded-xl border border-red-500/40 bg-red-500/10 p-3 text-sm text-red-300",children:m}):null,l===Wn?x.jsxs("div",{className:"grid gap-3 rounded-2xl border border-white/10 bg-slate-900/60 p-4 sm:grid-cols-2",children:[x.jsxs("label",{className:"text-sm text-slate-200 sm:col-span-2",children:[x.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Episode"}),x.jsx("select",{value:_,onChange:z=>{const Pe=z.target.value;L(Pe);const Ee=A.find(Ge=>(Ge==null?void 0:Ge.episodeId)===Pe)||null;I(Number(Ee==null?void 0:Ee.number)||null),bt({animeId:(p==null?void 0:p.animeId)||a,episodeId:Pe,episodeNumber:Number(Ee==null?void 0:Ee.number)||null,title:(p==null?void 0:p.title)||a,episodeTitle:Ut(Ee==null?void 0:Ee.title),poster:(p==null?void 0:p.poster)||"",source:l,slug:h})},className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:A.map((z,Pe)=>x.jsx("option",{value:z.episodeId||"",children:tN(z,Pe)},z.episodeId||z.id||z.title))})]}),x.jsxs("label",{className:"text-sm text-slate-200",children:[x.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Category"}),x.jsx("select",{value:U,onChange:z=>C(z.target.value),className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:vt.map(z=>x.jsx("option",{value:z,children:z.toUpperCase()},z))})]}),x.jsxs("label",{className:"text-sm text-slate-200",children:[x.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Server"}),x.jsx("select",{value:F,onChange:z=>{Ye&&B(z.target.value)},disabled:!Ye,className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:Te.map(z=>x.jsx("option",{value:z.id,children:z.name},z.id))})]}),Ye?x.jsxs("label",{className:"text-sm text-slate-200 sm:col-span-2",children:[x.jsx("span",{className:"mb-1 block text-xs uppercase tracking-wider text-slate-400",children:"Source"}),x.jsx("select",{value:M,onChange:z=>G(z.target.value),className:"w-full rounded-xl border border-white/15 bg-slate-950/80 px-3 py-2 text-sm text-white outline-none focus:border-cyan-300/60",children:O.map(z=>x.jsx("option",{value:z.id,children:z.name},z.id))})]}):x.jsx("p",{className:"text-xs text-amber-300 sm:col-span-2",children:"Free Plan: server dikunci otomatis ke yang paling stabil (auto fallback jika gagal)."})]}):null,x.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-white/10 bg-black",children:[!ae&&Q?x.jsx("div",{className:"absolute right-3 top-3 z-20 rounded-full bg-black/70 px-3 py-1 text-xs text-slate-300",children:"Loading source..."}):null,Me&&!Bn&&Gt?x.jsx("video",{ref:_s,className:"aspect-video w-full bg-black",controls:!0,playsInline:!0,preload:"metadata",onError:()=>ws(Me)}):Ls?x.jsx("iframe",{className:"aspect-video w-full",src:Ls,title:p.title||"Streaming",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onError:()=>ws(Me||Ls)}):x.jsxs("div",{className:"flex aspect-video flex-col items-center justify-center gap-3 text-sm text-slate-400",children:[x.jsx("p",{children:"Video player tidak tersedia untuk donghua ini."}),yn?x.jsx("a",{href:yn,target:"_blank",rel:"noreferrer",className:"rounded-full border border-cyan-300/40 bg-cyan-400/10 px-4 py-2 text-xs font-semibold text-cyan-200 transition hover:bg-cyan-400/20",children:"Buka Streaming di Tab Baru"}):null]})]}),!Me&&yn?x.jsx("a",{href:yn,target:"_blank",rel:"noreferrer",className:"inline-flex rounded-full border border-cyan-300/40 bg-cyan-400/10 px-4 py-2 text-xs font-semibold text-cyan-200 transition hover:bg-cyan-400/20",children:"Jika player kosong, buka stream di tab baru"}):null,x.jsx(ze,{to:`/anime/${encodeURIComponent(l)}/${encodeURIComponent(a)}${h?`?slug=${encodeURIComponent(h)}`:""}`,className:"inline-flex rounded-full bg-white/10 px-4 py-2 text-sm text-white transition hover:bg-white/20",children:"Back to Detail"})]})}function sN(){const{watchlist:n,removeFromWatchlist:e}=wt();return x.jsxs("section",{className:"space-y-5",children:[x.jsxs("div",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-5",children:[x.jsx("h1",{className:"font-heading text-2xl font-bold text-white sm:text-3xl",children:"Watchlist"}),x.jsx("p",{className:"mt-1 text-sm text-slate-300",children:"Daftar donghua yang kamu simpan untuk ditonton nanti."})]}),n.length===0?x.jsx("p",{className:"text-sm text-slate-400",children:"Watchlist masih kosong."}):x.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:n.map(t=>x.jsxs("div",{className:"rounded-2xl border border-white/10 bg-slate-900/70 p-3",children:[x.jsxs(ze,{to:`/anime/${encodeURIComponent(t.source||"anichin")}/${encodeURIComponent(t.animeId)}${t.slug?`?slug=${encodeURIComponent(t.slug)}`:""}`,className:"block",children:[x.jsx("div",{className:"overflow-hidden rounded-lg bg-slate-800",children:t.poster?x.jsx("img",{src:t.poster,alt:t.title,className:"aspect-[3/4] w-full object-cover"}):null}),x.jsx("p",{className:"mt-2 line-clamp-2 text-sm font-semibold text-white",children:t.title})]}),x.jsx("button",{type:"button",onClick:()=>e(t.animeId),className:"mt-3 w-full rounded-lg border border-cyan-300/30 bg-cyan-400/10 px-3 py-2 text-xs font-semibold text-cyan-200 transition hover:bg-cyan-400/20",children:"Hapus dari Watchlist"})]},`${t.animeId}-${t.addedAt}`))})]})}function Hf(){return x.jsx("div",{className:"flex min-h-[40vh] items-center justify-center",children:x.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-white/20 border-t-cyan-300"})})}function Tn({children:n}){const{isLoggedIn:e,ready:t}=wt();return t?e?n:x.jsx(mu,{to:"/login",replace:!0}):x.jsx(Hf,{})}function iN({children:n}){const{isAdmin:e,ready:t}=wt();return t?e?n:x.jsx(mu,{to:"/",replace:!0}):x.jsx(Hf,{})}function p0({children:n}){const{isLoggedIn:e,ready:t}=wt();return t?e?x.jsx(mu,{to:"/",replace:!0}):n:x.jsx(Hf,{})}function aN(){const n=ur();return x.jsxs("div",{className:"min-h-screen bg-bg font-body text-text",children:[x.jsx(gR,{}),x.jsx("main",{className:"mx-auto w-full max-w-7xl px-3 py-4 sm:px-5 sm:py-6 lg:px-8",children:x.jsx("div",{className:"animate-page-in",children:x.jsxs(OA,{children:[x.jsx(et,{path:"/signup",element:x.jsx(p0,{children:x.jsx(KR,{})})}),x.jsx(et,{path:"/login",element:x.jsx(p0,{children:x.jsx(jR,{})})}),x.jsx(et,{path:"/",element:x.jsx(Tn,{children:x.jsx($R,{})})}),x.jsx(et,{path:"/about",element:x.jsx(GR,{})}),x.jsx(et,{path:"/contact",element:x.jsx(DR,{})}),x.jsx(et,{path:"/privacy-policy",element:x.jsx(HR,{})}),x.jsx(et,{path:"/anime/:animeId",element:x.jsx(Tn,{children:x.jsx(Wp,{})})}),x.jsx(et,{path:"/anime/:source/:animeId",element:x.jsx(Tn,{children:x.jsx(Wp,{})})}),x.jsx(et,{path:"/watch/:animeId",element:x.jsx(Tn,{children:x.jsx(g0,{})})}),x.jsx(et,{path:"/watch/:source/:animeId",element:x.jsx(Tn,{children:x.jsx(g0,{})})}),x.jsx(et,{path:"/history",element:x.jsx(Tn,{children:x.jsx(NR,{})})}),x.jsx(et,{path:"/watchlist",element:x.jsx(Tn,{children:x.jsx(sN,{})})}),x.jsx(et,{path:"/premium",element:x.jsx(Tn,{children:x.jsx(VR,{})})}),x.jsx(et,{path:"/account",element:x.jsx(Tn,{children:x.jsx(mR,{})})}),x.jsx(et,{path:"/admin",element:x.jsx(Tn,{children:x.jsx(iN,{children:x.jsx(yR,{})})})}),x.jsx(et,{path:"*",element:x.jsx(mu,{to:"/",replace:!0})})]})},n.pathname)}),x.jsx(pR,{})]})}Pc.createRoot(document.getElementById("root")).render(x.jsx(L0.StrictMode,{children:x.jsx(VA,{children:x.jsx(fR,{children:x.jsx(aN,{})})})}));
